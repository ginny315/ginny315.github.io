<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>作品集合</title>
    <link href="/2024/01/01/%E4%BD%9C%E5%93%81%E9%9B%86%E5%90%88/"/>
    <url>/2024/01/01/%E4%BD%9C%E5%93%81%E9%9B%86%E5%90%88/</url>
    
    <content type="html"><![CDATA[<blockquote><p>奇奇怪怪的东西有空整理在这里。</p></blockquote><span id="more"></span> <ol><li>朴素的工作</li></ol><p>1.1 opsdev前端搭建、迭代<br><img src="/../img/0-3.png" alt="opsdev"></p><p>1.2 N卡运行信息展示<br><img src="/../img/0-4.png" alt="nvidia"></p><p>1.3 维护卡卡运行信息展示<br><img src="/../img/0-6.png" alt="nvidia"></p><p>1.4 model garden<br><img src="/../img/0-5.png" alt="garden"> </p><p>1.5 AI管理台<br><img src="/../img/0-7.png" alt="AI管理台"> </p><p>1.6 数字化平台<br><img src="/../img/0-8.png" alt="数字化平台"> </p><ol start="2"><li>读书脑洞</li></ol><p>2.1 基于Spark的分布式人脸识别系统-前世你可能是只猫<br><img src="/../img/0-1.png" alt="前世你可能是一只猫"></p><p>2.2 基于WebGL的森林渲染，使用WebGL进行森林渲染，并力图实现渲染最优。<br><img src="/../img/0-2.png" alt="基于WebGL的森林渲染"><br><a href="https://guoningyan.com/dissertation/">毕设进展</a></p><p>2.3 <a href="https://guoningyan.com/visual/">可视化课程网站</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（25）统一系统入口-子系统处理</title>
    <link href="/2023/06/28/vue3%E7%AC%94%E8%AE%B0%EF%BC%8825%EF%BC%89%E7%BB%9F%E4%B8%80%E7%B3%BB%E7%BB%9F%E5%85%A5%E5%8F%A3-%E5%AD%90%E7%B3%BB%E7%BB%9F%E5%A4%84%E7%90%86/"/>
    <url>/2023/06/28/vue3%E7%AC%94%E8%AE%B0%EF%BC%8825%EF%BC%89%E7%BB%9F%E4%B8%80%E7%B3%BB%E7%BB%9F%E5%85%A5%E5%8F%A3-%E5%AD%90%E7%B3%BB%E7%BB%9F%E5%A4%84%E7%90%86/</url>
    
    <content type="html"><![CDATA[<blockquote><p>原版各子系统相互独立，有单独的登录入口，对应不同的后端 token 鉴权；新版系统有统一的入口，各子系统共享 token，走统一的 apisix 鉴权；同时菜单及可访问路由的配置统一由 UMS 系统（用户信息管理）处理。<br>本篇是统一迁移记录。基于Vue3 + Vue-router4 + pinia + vite 技术栈已经调试成功，老旧系统基于Vue3 + Vuex + vue-cli 另需调整。</p></blockquote><span id="more"></span><h3 id="设计思路"><a href="#设计思路" class="headerlink" title="设计思路"></a>设计思路</h3><ol><li>本次设计了一个UMS（User Manage System）作为用户登录和修改个人信息的入口，登录成功的用户可以选择性访问子系统，用户的子系统访问权限设置也在 UMS 中。</li><li>为了使 UMS 和子系统可以共享 token ，这里在部署时将这些系统部署在一个域中，通过浏览器 cookie 共享实现；</li><li>UMS 中 token 失效（请求中后端返回401），清除 token ，跳转 login 登录页面；</li><li>子系统中 token 失效（请求中后端返回401），清除 token ，跳转 UMS 系统首页，由 UMS 系统跳转 login 登录页面；</li><li>进入子系统，路由守卫判断无 token，跳转 UMS 系统首页，由 UMS 系统跳转 login 登录页面；</li><li>子系统获取动态菜单，若访问路由不存在，跳转 404 页面；</li><li>若访问路由存在，<a href="https://guoningyan.com/2023/05/08/vue3%E7%AC%94%E8%AE%B0%EF%BC%8821-2%EF%BC%89%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1/">之前已经写过动态路由的渲染</a>，渲染页面；<br><img src="/../img/vue21-2.png" alt="系统设计"></li></ol><h3 id="设计思路子系统中实现注意事项"><a href="#设计思路子系统中实现注意事项" class="headerlink" title="设计思路子系统中实现注意事项"></a>设计思路子系统中实现注意事项</h3><p>在守卫路由中通过 token 判断能否继续访问，所有跳转都在其中设置地址，例如：</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">if</span> (token) &#123; <br>  <span class="hljs-comment">// 获取菜单，判断能否前往</span><br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">origin</span> + <span class="hljs-string">&quot;/ums/&quot;</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>其余地方只需要去除 token，刷新页面。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">removeToken</span>()<br><span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-title function_">reload</span>()<br></code></pre></div></td></tr></table></figure><p>这样的好处是，如果修改了跳转地址，只需要改一处即可，代码逻辑解耦。</p><h3 id="本地调试"><a href="#本地调试" class="headerlink" title="本地调试"></a>本地调试</h3><p>路由守卫中可暂时注释if(token)，使用mock菜单数据进行调试；<br>若子系统后端尚且使用旧 token 鉴权，可以手动在浏览器种 cookie。</p><h4 id="菜单获取修改"><a href="#菜单获取修改" class="headerlink" title="菜单获取修改"></a>菜单获取修改</h4><ol><li><code>router/index.ts</code>中去除 404 等固定路由以外的路由；</li><li><code>views/layout/index.ts</code>中暴露 BasicLayout 等整体父级样式；</li><li><code>store/modules/permission.ts</code>中修改动态路由的获取（data&#x3D;[&#x2F;<em>菜单数组</em>&#x2F;]）；</li><li><code>permission.ts</code> 路由守卫修改（可暂时注释if(token)，避免调试时页面跳转）；</li><li><code>views/layout/components/Sidebar/index.vue</code>中修改菜单获取；</li><li><code>views/layout/components/Sidebar/sidebar-item.vue</code>中修改侧栏菜单渲染；</li><li><code>vite.config.ts</code> proxy 代理修改成 apisix 对应的后端路由；</li></ol><h4 id="跳转修改"><a href="#跳转修改" class="headerlink" title="跳转修改"></a>跳转修改</h4><ol><li><code>config/axios/service.ts</code>中修改 401 跳转；</li><li><code>store/modules/user.ts</code>中修改 resetToken；</li></ol><h4 id="业务相关代码修改"><a href="#业务相关代码修改" class="headerlink" title="业务相关代码修改"></a>业务相关代码修改</h4><ol><li><code>components/BreadCrumb/index.vue</code> 中修改面包屑。一般导航可以直接使用该组件，特殊导航（例如：三级导航）需要传数据到组件中；具体用法见 readme.md</li><li>若有 created_by、updated_by 相关代码，需要去除；</li><li><code>views/layout/components/Navbar/avatar.vue</code>中修改个人信息 hover 下拉菜单，只留下 logout 功能，同时修改用户名展示；</li></ol><h4 id="上线修改"><a href="#上线修改" class="headerlink" title="上线修改"></a>上线修改</h4><ol><li>若调试无问题，修改 API 获取真实菜单，<code>permission.ts</code> 路由守卫中放开 token；</li><li>打包环境 <code>**.env</code> 中修改成 apisix 对应的后端路由；</li></ol><h3 id="基于Vuex-vue-cli"><a href="#基于Vuex-vue-cli" class="headerlink" title="基于Vuex + vue-cli"></a>基于Vuex + vue-cli</h3><ol><li>注意各处导入 store 语法区别；</li><li><code>store/modules/permission.ts</code>中不管是开发环境还是生产环境，都使用 <code>() =&gt;   import()</code>导入模块；getMenus 方法标记为 action</li><li><code>vue.config.ts</code> proxy 代理修改成 apisix 对应的后端路由；publicPath 修改生产环境路径；</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（24）动态规则绑定</title>
    <link href="/2023/05/31/vue3%E7%AC%94%E8%AE%B0%EF%BC%8824%EF%BC%89%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%99%E7%BB%91%E5%AE%9A/"/>
    <url>/2023/05/31/vue3%E7%AC%94%E8%AE%B0%EF%BC%8824%EF%BC%89%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%99%E7%BB%91%E5%AE%9A/</url>
    
    <content type="html"><![CDATA[<blockquote><p>又有让我眉头一紧的新 feature 了，表格中某几项需要根据选择来确定规则，包含字符校验和必填项的改变。<br>这篇记录动态规则绑定及检验遇到的坑。</p></blockquote><span id="more"></span><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>使用 v-if 多写几个 form-item，用 type 动态控制显示，但是这样的话会让已填项清空，舍弃。</p><h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>根据选择的 type 动态设置 prop，不同的 prop 在 rule 中定义不同的规则。这里定义 path 为必填，path1 为非必填，</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-form</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;menuFormRef&quot;</span> <span class="hljs-attr">:model</span>=<span class="hljs-string">&quot;menuForm&quot;</span> <span class="hljs-attr">:rules</span>=<span class="hljs-string">&quot;menuRules&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;前端路由：&quot;</span> <span class="hljs-attr">:prop</span>=<span class="hljs-string">&quot;menuForm.type == 1 ? &#x27;path&#x27; : &#x27;path1&#x27;&quot;</span>&gt;</span><br>    el-input v-model=&quot;menuForm.path&quot; placeholder=&quot;请输入前端路由&quot;&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">el-input</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">el-form</span>/&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> menuRules = <span class="hljs-title function_">reactive</span>(&#123;<br>  <span class="hljs-attr">path</span>: [<br>    &#123; <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;请输入前端路由&#x27;</span>, <span class="hljs-attr">trigger</span>: [<span class="hljs-string">&#x27;blur&#x27;</span>, <span class="hljs-string">&#x27;change&#x27;</span>] &#125;,<br>    &#123; <span class="hljs-attr">validator</span>: validateText50Required, <span class="hljs-attr">trigger</span>: [<span class="hljs-string">&#x27;blur&#x27;</span>, <span class="hljs-string">&#x27;change&#x27;</span>] &#125;<br>  ],<br>  <span class="hljs-attr">path1</span>: [<br>    &#123; <span class="hljs-attr">required</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;请输入前端路由&#x27;</span>, <span class="hljs-attr">trigger</span>: [<span class="hljs-string">&#x27;blur&#x27;</span>, <span class="hljs-string">&#x27;change&#x27;</span>] &#125;,<br>    &#123; <span class="hljs-attr">validator</span>: validateText50, <span class="hljs-attr">trigger</span>: [<span class="hljs-string">&#x27;blur&#x27;</span>, <span class="hljs-string">&#x27;change&#x27;</span>] &#125;<br>  ]<br>&#125;)<br></code></pre></div></td></tr></table></figure><p>问题来了，当切换类型时，出错提示依然显示；当手动点一下输入框（触发blur）或者点击提交按钮时，出错提示消失，可见校验规则是切换了。<br><img src="/../img/vue24-1.png" alt="type=1"><br><img src="/../img/vue24-2.png" alt="type=2"></p><h3 id="方法三"><a href="#方法三" class="headerlink" title="方法三"></a>方法三</h3><p>手动根据状态改变 rule </p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span></span><br><span class="hljs-tag">    <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;前端路由：&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">prop</span>=<span class="hljs-string">&quot;fold&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">:rules</span>=<span class="hljs-string">&quot;</span></span><br><span class="hljs-string"><span class="hljs-tag">      menuForm.type == 1</span></span><br><span class="hljs-string"><span class="hljs-tag">        ? menuRules.path</span></span><br><span class="hljs-string"><span class="hljs-tag">        : [&#123; validator: validateText50, trigger: [&#x27;blur&#x27;, &#x27;change&#x27;] &#125;]</span></span><br><span class="hljs-string"><span class="hljs-tag">    &quot;</span></span><br><span class="hljs-tag">  &gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;menuForm.path&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入前端路由&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-input</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>问题是当切换类型时，必填红色*没有消失。经过检验，规则也没有切换成功。这个方法是网友写过技术总结的，详情见附录，我实在不理解为啥到我这儿就失败了。。。</p><h3 id="方法四"><a href="#方法四" class="headerlink" title="方法四"></a>方法四</h3><p>使用 watch 监听 type ，改变时直接将校验规则改变。<br>优势：完全实现了校验规则的切换。<br>劣势：切换时一定会触发一次全局规则校验（效果类似于点击了一次提交）</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">watch</span>(<br>  <span class="hljs-function">() =&gt;</span> state.<span class="hljs-property">menuForm</span>.<span class="hljs-property">type</span>,<br>  <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (state.<span class="hljs-property">menuForm</span>.<span class="hljs-property">type</span> == <span class="hljs-number">1</span>) &#123;<br>      menuRules.<span class="hljs-property">path</span> = [<br>        &#123; <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;请输入前端路由&#x27;</span>, <span class="hljs-attr">trigger</span>: [<span class="hljs-string">&#x27;blur&#x27;</span>, <span class="hljs-string">&#x27;change&#x27;</span>] &#125;,<br>        &#123; <span class="hljs-attr">validator</span>: validateText50Required, <span class="hljs-attr">trigger</span>: [<span class="hljs-string">&#x27;blur&#x27;</span>, <span class="hljs-string">&#x27;change&#x27;</span>] &#125;<br>      ]<br>    &#125;<br>    <span class="hljs-keyword">if</span> (menuFormRef?.<span class="hljs-property">value</span>) &#123;<br>      menuFormRef?.<span class="hljs-property">value</span>.<span class="hljs-title function_">clearValidate</span>()<br>    &#125;<br>  &#125;<br>)<br></code></pre></div></td></tr></table></figure><p><code>附录</code><br>[elementUI el-form动态控制表单验]<a href="https://blog.csdn.net/zuoyiran520081/article/details/118051248">https://blog.csdn.net/zuoyiran520081/article/details/118051248</a>)</p>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（23-2）el-tree在父子节点的联动</title>
    <link href="/2023/05/26/vue3%E7%AC%94%E8%AE%B0%EF%BC%8823-2%EF%BC%89el-tree%E4%B9%8B%E7%88%B6%E5%AD%90%E8%8A%82%E7%82%B9%E8%81%94%E5%8A%A8/"/>
    <url>/2023/05/26/vue3%E7%AC%94%E8%AE%B0%EF%BC%8823-2%EF%BC%89el-tree%E4%B9%8B%E7%88%B6%E5%AD%90%E8%8A%82%E7%82%B9%E8%81%94%E5%8A%A8/</url>
    
    <content type="html"><![CDATA[<blockquote><p>el-tree在父子节点的联动上有点小麻烦，在设计时我并没有仔细研究API，导致出现了好多问题，本篇是踩坑记录。<br>另有全选&#x2F;全不选，全部展开&#x2F;收起操作，本篇也做一个记录。</p></blockquote><span id="more"></span><h3 id="父子节点默认非严格关联"><a href="#父子节点默认非严格关联" class="headerlink" title="父子节点默认非严格关联"></a>父子节点默认非严格关联</h3><p><code>check-strictly</code> 属性表示在显示复选框的情况下，是否严格的遵循父子不互相关联的做法，默认为 false。此时，选择父级菜单，子级菜单会全部选中；选择子级菜单，父级前会有-标记<br><img src="/../img/vue23-4.png" alt="父子非严格不互相关联选择父级菜单"><br><img src="/../img/vue23-1.png" alt="父子非严格不互相关联选择子级菜单"><br>当值设置为 true 时，选择父级菜单，子级菜单不被选中<br><img src="/../img/vue23-3.png" alt="父子严格不互相关联"></p><h3 id="菜单权限设计"><a href="#菜单权限设计" class="headerlink" title="菜单权限设计"></a>菜单权限设计</h3><p>在菜单权限设计中，选择子级菜单，对应的父级也应该有权限。<br>当角色已被分配权限时，打开权限设置时，应将已有权限做一个勾选。</p><h3 id="方案一：非严格关联"><a href="#方案一：非严格关联" class="headerlink" title="方案一：非严格关联"></a>方案一：非严格关联</h3><p>在提交选择时，应该将子级菜单对应的父级也加入</p><figure class="highlight javascript"><table><tr><td class="gutter hljs hljs hljs hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">getAllNodes</span>(treeRef.<span class="hljs-property">value</span>!.<span class="hljs-title function_">getCheckedNodes</span>(<span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>))<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">getAllNodes</span> = (<span class="hljs-params">arr: <span class="hljs-built_in">Array</span></span>) =&gt; &#123;<br>  <span class="hljs-keyword">let</span> list = []<br>  <span class="hljs-keyword">let</span> pidList = []<br>  arr.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>    list.<span class="hljs-title function_">push</span>(item.<span class="hljs-property">id</span>)<br>    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">pid</span> !== <span class="hljs-number">0</span> &amp;&amp; list.<span class="hljs-title function_">indexOf</span>(item.<span class="hljs-property">pid</span>) == -<span class="hljs-number">1</span>) &#123;<br>      list.<span class="hljs-title function_">push</span>(item.<span class="hljs-property">pid</span>)<br>      pidList.<span class="hljs-title function_">push</span>(item.<span class="hljs-property">pid</span>)<br>    &#125;<br>  &#125;)<br>  <span class="hljs-comment">// menuTree 是树状图的数据源</span><br>  <span class="hljs-keyword">if</span> (state.<span class="hljs-property">menuTree</span> &amp;&amp; state.<span class="hljs-property">menuTree</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) &#123;<br>    state.<span class="hljs-property">menuTree</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">sys</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (sys.<span class="hljs-property">children</span> &amp;&amp; sys.<span class="hljs-property">children</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) &#123;<br>        sys.<span class="hljs-property">children</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> &#123;<br>          pidList.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">pid</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">if</span> (i.<span class="hljs-property">level</span> !== <span class="hljs-number">0</span> &amp;&amp; i.<span class="hljs-property">id</span> == pid) &#123;<br>              list.<span class="hljs-title function_">push</span>(i.<span class="hljs-property">pid</span>)<br>            &#125;<br>          &#125;)<br>        &#125;)<br>      &#125;<br>    &#125;)<br>  &#125;<br>  <span class="hljs-keyword">return</span> list<br>&#125;<br></code></pre></div></td></tr></table></figure><p>提交时完美实现。<br>但是出现了一个之前欠考虑的问题，就是在编辑状态下（即新增时已有勾选，初始化时后端返回已勾选数组，需要前端在打开时勾选），因为父子非严格关联，导致父节点勾选时，对应所有子节点都被选择。</p><h3 id="方案二：严格关联"><a href="#方案二：严格关联" class="headerlink" title="方案二：严格关联"></a>方案二：严格关联</h3><p>使用 changeCheck 方法，在节点被勾选时，将其所有父节点勾选。level 为组件自带属性，可以基于此进行节点递归。</p><figure class="highlight html"><table><tr><td class="gutter hljs hljs hljs hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-tree</span></span><br><span class="hljs-tag">  <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;treeRef&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:data</span>=<span class="hljs-string">&quot;menuTree&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">show-checkbox</span></span><br><span class="hljs-tag">  <span class="hljs-attr">node-key</span>=<span class="hljs-string">&quot;id&quot;</span> </span><br><span class="hljs-tag">  <span class="hljs-attr">:props</span>=<span class="hljs-string">&quot;defaultProps&quot;</span></span><br><span class="hljs-tag">  @<span class="hljs-attr">check</span>=<span class="hljs-string">&quot;changeCheck&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:check-strictly</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">/&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter hljs hljs hljs hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">changeCheck</span> = (<span class="hljs-params">node</span>) =&gt; &#123;<br>  <span class="hljs-keyword">let</span> thisNode = treeRef.<span class="hljs-property">value</span>!.<span class="hljs-title function_">getNode</span>(node.<span class="hljs-property">id</span>) <span class="hljs-comment">// 获取当前节点</span><br>  <span class="hljs-keyword">const</span> keys = treeRef.<span class="hljs-property">value</span>!.<span class="hljs-title function_">getCheckedKeys</span>() <span class="hljs-comment">// 获取已勾选节点的key值</span><br>  <span class="hljs-keyword">if</span> (thisNode.<span class="hljs-property">checked</span>) &#123; <span class="hljs-comment">// 当前节点若被选中</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = thisNode.<span class="hljs-property">level</span>; i &gt; <span class="hljs-number">1</span>; i--) &#123; <span class="hljs-comment">// 判断是否有父级节点</span><br>      <span class="hljs-keyword">if</span> (!thisNode.<span class="hljs-property">parent</span>.<span class="hljs-property">checked</span>) &#123;<br>        <span class="hljs-comment">// 父级节点未被选中，则将父节点替换成当前节点，往上继续查询，并将此节点key存入keys数组</span><br>        thisNode = thisNode.<span class="hljs-property">parent</span><br>        keys.<span class="hljs-title function_">push</span>(thisNode.<span class="hljs-property">data</span>.<span class="hljs-property">id</span>)<br>      &#125;<br>    &#125;<br>  &#125;<br>  treeRef.<span class="hljs-property">value</span>!.<span class="hljs-title function_">setCheckedKeys</span>(keys) <span class="hljs-comment">// 将所有keys数组的节点全选</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p><img src="/../img/vue23-2.png" alt="父子严格不互相关联"><br>这个有个新问题就是，用户在操作时，可能将父节点取消勾选，在提交时就只剩下子节点了，所以需要在提交时再进行一次校验，将未加入（用户手动取消）的父节点再次加入。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs hljs hljs hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleAddRoleMenu</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-title function_">getAllNodes</span>(treeRef.<span class="hljs-property">value</span>!.<span class="hljs-title function_">getCheckedNodes</span>(<span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>))<br>  <span class="hljs-keyword">const</span> nodeList = treeRef.<span class="hljs-property">value</span>!.<span class="hljs-title function_">getCheckedKeys</span>(<span class="hljs-literal">false</span>)<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">getAllNodes</span> = (<span class="hljs-params">arr: <span class="hljs-built_in">Array</span></span>) =&gt; &#123;<br>  arr.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>    <span class="hljs-title function_">changeCheck</span>(item)<br>  &#125;)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>提交时保证了所有被选择节点，及其父节点都被加入。</p><h3 id="全选-x2F-全不选"><a href="#全选-x2F-全不选" class="headerlink" title="全选&#x2F;全不选"></a>全选&#x2F;全不选</h3><figure class="highlight html"><table><tr><td class="gutter hljs hljs hljs hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-switch</span></span><br><span class="hljs-tag">  <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;changeSelectV&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:active-value</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:inactive-value</span>=<span class="hljs-string">&quot;false&quot;</span></span><br><span class="hljs-tag">  @<span class="hljs-attr">change</span>=<span class="hljs-string">&quot;changeSelect&quot;</span></span><br><span class="hljs-tag">/&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter hljs hljs hljs hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">changeSelect</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (changeSelectV.<span class="hljs-property">value</span> == <span class="hljs-literal">true</span>) &#123;<br>    treeRef.<span class="hljs-property">value</span>!.<span class="hljs-title function_">setCheckedNodes</span>(state.<span class="hljs-property">menuTree</span>)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    treeRef.<span class="hljs-property">value</span>!.<span class="hljs-title function_">setCheckedNodes</span>([])<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="全部展开-x2F-收起"><a href="#全部展开-x2F-收起" class="headerlink" title="全部展开&#x2F;收起"></a>全部展开&#x2F;收起</h3><figure class="highlight html"><table><tr><td class="gutter hljs hljs hljs hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-switch</span></span><br><span class="hljs-tag">  <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;changeCollapseV&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:active-value</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:inactive-value</span>=<span class="hljs-string">&quot;false&quot;</span></span><br><span class="hljs-tag">  @<span class="hljs-attr">change</span>=<span class="hljs-string">&quot;changeCollapse&quot;</span></span><br><span class="hljs-tag">/&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter hljs hljs hljs hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">changeCollapse</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-title function_">travelExpend</span>(state.<span class="hljs-property">menuTree</span>, changeCollapseV.<span class="hljs-property">value</span>)<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">travelExpend</span> = (<span class="hljs-params">branch: <span class="hljs-built_in">Array</span>, expend: boolean</span>) =&gt; &#123;<br>  branch.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>    treeRef.<span class="hljs-property">value</span>!.<span class="hljs-property">store</span>.<span class="hljs-property">nodesMap</span>[item.<span class="hljs-property">id</span>].<span class="hljs-property">expanded</span> = expend<br>    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">children</span>) &#123;<br>      <span class="hljs-title function_">travelExpend</span>(item.<span class="hljs-property">children</span>, expend)<br>    &#125;<br>  &#125;)<br>&#125;<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（23-3）el-tree在父子节点的联动</title>
    <link href="/2023/05/26/vue3%E7%AC%94%E8%AE%B0%EF%BC%8823-3%EF%BC%89el-tree%E4%B9%8B%E7%88%B6%E5%AD%90%E8%8A%82%E7%82%B9%E8%81%94%E5%8A%A8/"/>
    <url>/2023/05/26/vue3%E7%AC%94%E8%AE%B0%EF%BC%8823-3%EF%BC%89el-tree%E4%B9%8B%E7%88%B6%E5%AD%90%E8%8A%82%E7%82%B9%E8%81%94%E5%8A%A8/</url>
    
    <content type="html"><![CDATA[<blockquote><p>el-tree在父子节点的联动上有点小麻烦，在刚开始设计时我并没有仔细研究API，导致出现了好多问题，本篇是踩坑记录。<br>另有全选&#x2F;全不选，全部展开&#x2F;收起操作，本篇也做一个记录。</p></blockquote><span id="more"></span><h3 id="菜单权限设计"><a href="#菜单权限设计" class="headerlink" title="菜单权限设计"></a>菜单权限设计</h3><p>业务需求：在菜单权限设计中，新增权限状态下，选择子级菜单，对应的父级菜单也应该被赋予权限。<br>编辑权限状态下，打开权限设置时，应将已有权限做一个勾选。</p><h3 id="父子节点默认非严格关联"><a href="#父子节点默认非严格关联" class="headerlink" title="父子节点默认非严格关联"></a>父子节点默认非严格关联</h3><p><code>check-strictly</code> 属性表示在“显示复选框”的情况下，是否严格的遵循父子不互相关联的做法，默认为 false。此时，选择父级菜单，子级菜单会全部选中；选择子级菜单，父级前会有“-”标记：<br><img src="/../img/vue23-4.png" alt="父子非严格不互相关联选择父级菜单"><br><img src="/../img/vue23-1.png" alt="父子非严格不互相关联选择子级菜单"><br>当值设置为 true 时，选择父级菜单，子级菜单不会被选中：<br><img src="/../img/vue23-3.png" alt="父子严格不互相关联"></p><h3 id="方案一：非严格关联"><a href="#方案一：非严格关联" class="headerlink" title="方案一：非严格关联"></a>方案一：非严格关联</h3><p>在提交选择时，应该将子级菜单对应的父级也加入</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">getAllNodes</span>(treeRef.<span class="hljs-property">value</span>!.<span class="hljs-title function_">getCheckedNodes</span>(<span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>))<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">getAllNodes</span> = (<span class="hljs-params">arr: <span class="hljs-built_in">Array</span></span>) =&gt; &#123;<br>  <span class="hljs-keyword">let</span> list = []<br>  <span class="hljs-keyword">let</span> pidList = []<br>  arr.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>    list.<span class="hljs-title function_">push</span>(item.<span class="hljs-property">id</span>)<br>    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">pid</span> !== <span class="hljs-number">0</span> &amp;&amp; list.<span class="hljs-title function_">indexOf</span>(item.<span class="hljs-property">pid</span>) == -<span class="hljs-number">1</span>) &#123;<br>      list.<span class="hljs-title function_">push</span>(item.<span class="hljs-property">pid</span>)<br>      pidList.<span class="hljs-title function_">push</span>(item.<span class="hljs-property">pid</span>)<br>    &#125;<br>  &#125;)<br>  <span class="hljs-comment">// menuTree 是树状图的数据源</span><br>  <span class="hljs-keyword">if</span> (state.<span class="hljs-property">menuTree</span> &amp;&amp; state.<span class="hljs-property">menuTree</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) &#123;<br>    state.<span class="hljs-property">menuTree</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">sys</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (sys.<span class="hljs-property">children</span> &amp;&amp; sys.<span class="hljs-property">children</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) &#123;<br>        sys.<span class="hljs-property">children</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> &#123;<br>          pidList.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">pid</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">if</span> (i.<span class="hljs-property">level</span> !== <span class="hljs-number">0</span> &amp;&amp; i.<span class="hljs-property">id</span> == pid) &#123;<br>              list.<span class="hljs-title function_">push</span>(i.<span class="hljs-property">pid</span>)<br>            &#125;<br>          &#125;)<br>        &#125;)<br>      &#125;<br>    &#125;)<br>  &#125;<br>  <span class="hljs-keyword">return</span> list<br>&#125;<br></code></pre></div></td></tr></table></figure><p>提交时完美实现。<br>但是出现了一个之前欠考虑的问题，就是在编辑状态下（即新增时已有勾选，初始化时后端返回已勾选数组，需要前端在打开时勾选），因为父子非严格关联，导致父节点勾选时，对应所有子节点都被勾选。</p><h3 id="方案二：严格关联"><a href="#方案二：严格关联" class="headerlink" title="方案二：严格关联"></a>方案二：严格关联</h3><p>使用 changeCheck 方法，在节点被勾选时，将其所有父节点勾选。level 为组件自带属性，可以基于此进行节点递归。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-tree</span></span><br><span class="hljs-tag">  <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;treeRef&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:data</span>=<span class="hljs-string">&quot;menuTree&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">show-checkbox</span></span><br><span class="hljs-tag">  <span class="hljs-attr">node-key</span>=<span class="hljs-string">&quot;id&quot;</span> </span><br><span class="hljs-tag">  <span class="hljs-attr">:props</span>=<span class="hljs-string">&quot;defaultProps&quot;</span></span><br><span class="hljs-tag">  @<span class="hljs-attr">check</span>=<span class="hljs-string">&quot;changeCheck&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:check-strictly</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">/&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">changeCheck</span> = (<span class="hljs-params">node</span>) =&gt; &#123;<br>  <span class="hljs-keyword">let</span> thisNode = treeRef.<span class="hljs-property">value</span>!.<span class="hljs-title function_">getNode</span>(node.<span class="hljs-property">id</span>) <span class="hljs-comment">// 获取当前节点</span><br>  <span class="hljs-keyword">const</span> keys = treeRef.<span class="hljs-property">value</span>!.<span class="hljs-title function_">getCheckedKeys</span>() <span class="hljs-comment">// 获取已勾选节点的key值</span><br>  <span class="hljs-keyword">if</span> (thisNode.<span class="hljs-property">checked</span>) &#123; <span class="hljs-comment">// 当前节点若被选中</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = thisNode.<span class="hljs-property">level</span>; i &gt; <span class="hljs-number">1</span>; i--) &#123; <span class="hljs-comment">// 判断是否有父级节点</span><br>      <span class="hljs-keyword">if</span> (!thisNode.<span class="hljs-property">parent</span>.<span class="hljs-property">checked</span>) &#123;<br>        <span class="hljs-comment">// 父级节点未被选中，则将父节点替换成当前节点，往上继续查询，并将此节点key存入keys数组</span><br>        thisNode = thisNode.<span class="hljs-property">parent</span><br>        keys.<span class="hljs-title function_">push</span>(thisNode.<span class="hljs-property">data</span>.<span class="hljs-property">id</span>)<br>      &#125;<br>    &#125;<br>  &#125;<br>  treeRef.<span class="hljs-property">value</span>!.<span class="hljs-title function_">setCheckedKeys</span>(keys) <span class="hljs-comment">// 将所有keys数组的节点全选</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p><img src="/../img/vue23-2.png" alt="父子严格不互相关联"><br>这个有个新问题就是，用户在操作时，可能将父节点取消勾选，在提交时就只剩下子节点了，所以需要在提交时再进行一次校验，将未加入（用户手动取消）的父节点再次加入。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleAddRoleMenu</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-title function_">getAllNodes</span>(treeRef.<span class="hljs-property">value</span>!.<span class="hljs-title function_">getCheckedNodes</span>(<span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>))<br>  <span class="hljs-keyword">const</span> nodeList = treeRef.<span class="hljs-property">value</span>!.<span class="hljs-title function_">getCheckedKeys</span>(<span class="hljs-literal">false</span>)<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">getAllNodes</span> = (<span class="hljs-params">arr: <span class="hljs-built_in">Array</span></span>) =&gt; &#123;<br>  arr.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>    <span class="hljs-title function_">changeCheck</span>(item)<br>  &#125;)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>提交时保证了所有被选择节点，及其父节点都被加入。</p><h3 id="全选-x2F-全不选"><a href="#全选-x2F-全不选" class="headerlink" title="全选&#x2F;全不选"></a>全选&#x2F;全不选</h3><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-switch</span></span><br><span class="hljs-tag">  <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;changeSelectV&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:active-value</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:inactive-value</span>=<span class="hljs-string">&quot;false&quot;</span></span><br><span class="hljs-tag">  @<span class="hljs-attr">change</span>=<span class="hljs-string">&quot;changeSelect&quot;</span></span><br><span class="hljs-tag">/&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">changeSelect</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (changeSelectV.<span class="hljs-property">value</span> == <span class="hljs-literal">true</span>) &#123;<br>    treeRef.<span class="hljs-property">value</span>!.<span class="hljs-title function_">setCheckedNodes</span>(state.<span class="hljs-property">menuTree</span>)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    treeRef.<span class="hljs-property">value</span>!.<span class="hljs-title function_">setCheckedNodes</span>([])<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>当tree 设置了<code>check-strictly</code>，通过 setCheckedNodes 全选方法失效，父子不关联，只能选中一级父节点，只能用遍历的方式选中节点。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">changeSelect</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (changeSelectV.<span class="hljs-property">value</span> == <span class="hljs-literal">true</span>) &#123;<br>    <span class="hljs-title function_">travelNodes</span>(state.<span class="hljs-property">menuTree</span>)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    treeRef.<span class="hljs-property">value</span>!.<span class="hljs-title function_">setCheckedNodes</span>([])<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">travelNodes</span> = (<span class="hljs-params">tmpRoot</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(tmpRoot)) &#123;<br>    tmpRoot.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>      treeRef.<span class="hljs-property">value</span>!.<span class="hljs-title function_">setChecked</span>(item.<span class="hljs-property">id</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>)<br>      <span class="hljs-keyword">if</span> (item.<span class="hljs-property">children</span> &amp;&amp; item.<span class="hljs-property">children</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-title function_">travelNodes</span>(item.<span class="hljs-property">children</span>)<br>      &#125;<br>    &#125;)<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="全部展开-x2F-收起"><a href="#全部展开-x2F-收起" class="headerlink" title="全部展开&#x2F;收起"></a>全部展开&#x2F;收起</h3><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-switch</span></span><br><span class="hljs-tag">  <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;changeCollapseV&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:active-value</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:inactive-value</span>=<span class="hljs-string">&quot;false&quot;</span></span><br><span class="hljs-tag">  @<span class="hljs-attr">change</span>=<span class="hljs-string">&quot;changeCollapse&quot;</span></span><br><span class="hljs-tag">/&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">changeCollapse</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-title function_">travelExpend</span>(state.<span class="hljs-property">menuTree</span>, changeCollapseV.<span class="hljs-property">value</span>)<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">travelExpend</span> = (<span class="hljs-params">branch: <span class="hljs-built_in">Array</span>, expend: boolean</span>) =&gt; &#123;<br>  branch.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>    treeRef.<span class="hljs-property">value</span>!.<span class="hljs-property">store</span>.<span class="hljs-property">nodesMap</span>[item.<span class="hljs-property">id</span>].<span class="hljs-property">expanded</span> = expend<br>    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">children</span>) &#123;<br>      <span class="hljs-title function_">travelExpend</span>(item.<span class="hljs-property">children</span>, expend)<br>    &#125;<br>  &#125;)<br>&#125;<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（23-2）table树状展开</title>
    <link href="/2023/05/26/vue3%E7%AC%94%E8%AE%B0%EF%BC%8823-2%EF%BC%89el-tree%E4%B9%8Btable%E6%A0%91%E7%8A%B6%E5%B1%95%E5%BC%80/"/>
    <url>/2023/05/26/vue3%E7%AC%94%E8%AE%B0%EF%BC%8823-2%EF%BC%89el-tree%E4%B9%8Btable%E6%A0%91%E7%8A%B6%E5%B1%95%E5%BC%80/</url>
    
    <content type="html"><![CDATA[<blockquote><p>table是作为数据展示重要的一项，最近的需求是需要做一个系统的菜单配置，菜单可能有多级，设计稿要求是多级菜单可以以树状图展开。<br>本篇前后使用了两种方法，记录一下踩坑。</p></blockquote><span id="more"></span><h3 id="方法一：expand"><a href="#方法一：expand" class="headerlink" title="方法一：expand"></a>方法一：expand</h3><p>给el-table-column设置属性 type&#x3D;”expand” 可以自定义展开，实现table内嵌table的效果。<br>我的设计思路是展开的column也设置同样的属性，那不就可以共享列了嘛～<br>还有一个问题就是slot中展开的table列可能会和父级table列对不齐，于是我给子集设计了一个空列，长度加起来和父级table列宽度相同，初看非常完美，代码如下：</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-table</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:data</span>=<span class="hljs-string">&quot;sysList&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:row-key</span>=<span class="hljs-string">&quot;getRowKeys&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:expand-row-keys</span>=<span class="hljs-string">&quot;expands&quot;</span></span><br><span class="hljs-tag">  @<span class="hljs-attr">expand-change</span>=<span class="hljs-string">&quot;toggleRowExpansion&quot;</span></span><br><span class="hljs-tag">&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">fixed</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;expand&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">&quot;plcs&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">el-table</span></span><br><span class="hljs-tag">        <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;plcsTable&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">:data</span>=<span class="hljs-string">&quot;plcs.row.children&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">:row-key</span>=<span class="hljs-string">&quot;getRowKeys&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">:show-header</span>=<span class="hljs-string">&quot;false&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">:expand-row-keys</span>=<span class="hljs-string">&quot;childExpands&quot;</span></span><br><span class="hljs-tag">        @<span class="hljs-attr">expand-change</span>=<span class="hljs-string">&quot;childRowExpansion&quot;</span></span><br><span class="hljs-tag">      &gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">fixed</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;40&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">fixed</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;expand&quot;</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">&quot;sys&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">el-table</span></span><br><span class="hljs-tag">              <span class="hljs-attr">:data</span>=<span class="hljs-string">&quot;sys.row.btn&quot;</span></span><br><span class="hljs-tag">              <span class="hljs-attr">:row-key</span>=<span class="hljs-string">&quot;getRowKeys&quot;</span></span><br><span class="hljs-tag">              <span class="hljs-attr">:show-header</span>=<span class="hljs-string">&quot;false&quot;</span></span><br><span class="hljs-tag">              <span class="hljs-attr">:expand-row-keys</span>=<span class="hljs-string">&quot;childExpands&quot;</span></span><br><span class="hljs-tag">              @<span class="hljs-attr">expand-change</span>=<span class="hljs-string">&quot;childRowExpansion&quot;</span></span><br><span class="hljs-tag">            &gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">fixed</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;120&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span></span><br><span class="hljs-tag">                <span class="hljs-attr">fixed</span></span><br><span class="hljs-tag">                <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;菜单名称&quot;</span></span><br><span class="hljs-tag">                <span class="hljs-attr">prop</span>=<span class="hljs-string">&quot;name&quot;</span></span><br><span class="hljs-tag">                <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;148&quot;</span></span><br><span class="hljs-tag">              &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span><br>              <span class="hljs-comment">&lt;!-- 这里是各个table-column --&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">el-table</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">fixed</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;菜单名称&quot;</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;180&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 这里是各个table-column --&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">el-table</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">fixed</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;菜单名称&quot;</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;220&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- 这里是各个table-column --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-table</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>还需要设置 row-key ，保证每列不同，这样展开收起时不会产生冲突。expand-change 是每次展开操作时调用的方法，这里主要是控制自身状态改变，以及父级展开自身时将子级收起，实现手风琴效果。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> expands = <span class="hljs-title function_">ref</span>([])<br><span class="hljs-keyword">const</span> childExpands = <span class="hljs-title function_">ref</span>([])<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">toggleRowExpansion</span> = (<span class="hljs-params">row</span>) =&gt; &#123;<br>  childExpands.<span class="hljs-property">value</span> = []<br>  <span class="hljs-title function_">toggleExpansion</span>(<span class="hljs-string">&#x27;expands&#x27;</span>, row)<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(expands.<span class="hljs-property">value</span>, childExpands.<span class="hljs-property">value</span>)<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">childRowExpansion</span> = (<span class="hljs-params">row</span>) =&gt; &#123;<br>  <span class="hljs-title function_">toggleExpansion</span>(<span class="hljs-string">&#x27;childExpands&#x27;</span>, row)<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(expands.<span class="hljs-property">value</span>, childExpands.<span class="hljs-property">value</span>)<br>&#125;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">toggleExpansion</span> = (<span class="hljs-params">Expands, row</span>) =&gt; &#123;<br>  <span class="hljs-keyword">let</span> [expandsNum] = [<span class="hljs-title class_">Expands</span>]<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;expandsNum=&#x27;</span>, expandsNum, <span class="hljs-string">&#x27;toggleExpansion&#x27;</span>, <span class="hljs-title class_">Expands</span>, <span class="hljs-string">&#x27;row.id=&#x27;</span>, row.<span class="hljs-property">id</span>)<br>  <span class="hljs-keyword">if</span> (expandsNum == row.<span class="hljs-property">id</span>) &#123;<br>    ;[<span class="hljs-title class_">Expands</span>] = []<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>  &#125;<br>  ;[<span class="hljs-title class_">Expands</span>] = []<br>  ;[<span class="hljs-title class_">Expands</span>].<span class="hljs-title function_">push</span>(row.<span class="hljs-property">id</span>)<br>&#125;<br><span class="hljs-comment">// 获取row的key值</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">getRowKeys</span> = (<span class="hljs-params">row</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> row.<span class="hljs-property">id</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>由于本项目中列数较多，产品要求序号列、name列和操作列固定，对用户更友好。于是我给这些列设置了属性 fixed ，结果，新问题来了，子集展开table无法固定了！如下图所示：<br><img src="/../img/vue22-6.png" alt="tree-props实现效果"><br>我想了半天是不是还需要手动给 slot 中的table设置样式呢？这样也太麻烦了吧。。。</p><h3 id="方法二：tree-props"><a href="#方法二：tree-props" class="headerlink" title="方法二：tree-props"></a>方法二：tree-props</h3><p>再次查阅资料，发现了 tree-props 这个属性，设置 tree-props 为{children: ‘children’,hasChildren: ‘hasChildren’} ，data 绑定的数据需要保留 children 属性，当 row 中包含 children 字段时，被视为树形数据。渲染树形数据时，必须要指定 row-key（绑定数据的唯一值变量id）；<br>支持子节点数据异步加载；<br>注意：如果不是懒加载的话，不要设置 hasChildren 这个属性，要不然树形无法显示；如果是懒加载，则需要设置hasChildren字段。<br>尝试代码如下：</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-table</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:data</span>=<span class="hljs-string">&quot;sysList&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:row-key</span>=<span class="hljs-string">&quot;getRowKeys&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;table-expand&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:tree-props</span>=<span class="hljs-string">&quot;&#123; children: &#x27;children&#x27;, hasChildren: &#x27;hasChildren&#x27; &#125;&quot;</span></span><br><span class="hljs-tag">&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">fixed</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">fixed</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;菜单名称&quot;</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;220&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- 这里是各个table-column --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">fixed</span>=<span class="hljs-string">&quot;right&quot;</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;操作&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;350&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">&quot;scope&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;openEdit(scope.$index, scope.row)&quot;</span>&gt;</span>编辑<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-table</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>哦豁，居然完美实现了固定列和下拉展开！只是展开会有状态的延续性，点击下一级无法实现手风琴效果。<br>网上说添加<code>:expand-row-keys=&quot;expands&quot; @expand-change=&quot;expandSelect&quot;</code>可以控制展开，但是我添加之后发现连原始的小箭头都无法点击了，遂放弃。<br>在 fixed 和手风琴效果里面 trade-off，还是 fixed 更重要吧～<br><img src="/../img/vue22-5.png" alt="tree-props实现效果"></p><h3 id="进一步优化-按照层级对齐"><a href="#进一步优化-按照层级对齐" class="headerlink" title="进一步优化-按照层级对齐"></a>进一步优化-按照层级对齐</h3><p>展开多级以后，发现各层级之间查看较为眼花，最好能用缩进来展示层级，这里我设计了动态 style ，按照层级加一个 padding ，轻松搞定～</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">fixed</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;菜单名称&quot;</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;220&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">&quot;scope&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;&#123; &#x27;padding-left&#x27;: (scope.row.level - 1) * 8 + &#x27;px&#x27; &#125;&quot;</span>&gt;</span>&#123;&#123;<br>      scope.row.name<br>    &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p><img src="/../img/vue22-7.png" alt="tree-props按照层级对齐"></p><p><code>附录</code><br><a href="https://blog.csdn.net/momoomom/article/details/108016148">element-ui table expand 展开树形菜单手风琴效果</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（23-1）el-tree组合el-tooltip</title>
    <link href="/2023/05/26/vue3%E7%AC%94%E8%AE%B0%EF%BC%8823-1%EF%BC%89el-tree%E7%BB%84%E5%90%88el-tooltip/"/>
    <url>/2023/05/26/vue3%E7%AC%94%E8%AE%B0%EF%BC%8823-1%EF%BC%89el-tree%E7%BB%84%E5%90%88el-tooltip/</url>
    
    <content type="html"><![CDATA[<blockquote><p>树状目录出现了文字太长的情况，这篇记录解决方案。</p></blockquote><span id="more"></span><h3 id="问题来源"><a href="#问题来源" class="headerlink" title="问题来源"></a>问题来源</h3><p>树状展示目录出现了文字太长的情况，文字被挤出，不仅无法知晓目录代表什么，更无法进行编辑操作。</p><h3 id="解决方案-增加滚动条"><a href="#解决方案-增加滚动条" class="headerlink" title="解决方案-增加滚动条"></a>解决方案-增加滚动条</h3><p>效果如下：<br><img src="/../img/vue17-1.png" alt="scroll"></p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;down-tree&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-tree</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;treeData&quot;</span> <span class="hljs-attr">:data</span>=<span class="hljs-string">&quot;treeData&quot;</span> <span class="hljs-attr">:props</span>=<span class="hljs-string">&quot;defaultProps&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;filter-tree&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">el-tree</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-class">.down-tree</span> &#123;<br>  <span class="hljs-attribute">overflow</span>: auto;<br>  <span class="hljs-attribute">max-height</span>: <span class="hljs-number">790px</span>;<br>  <span class="hljs-comment">/*滚动条整体样式*/</span><br>  &amp;::-webkit-scrollbar &#123;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-number">10px</span>; <span class="hljs-comment">/*高宽分别对应横竖滚动条的尺寸*/</span><br>    <span class="hljs-attribute">height</span>: <span class="hljs-number">10px</span>;<br>  &#125;<br>   <span class="hljs-comment">/*滚动条里面小方块*/</span><br>  &amp;::-webkit-scrollbar-thumb &#123;<br>    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgb</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>);<br>    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;<br>  &#125;<br>  &amp;::-webkit-scrollbar-track &#123;<br>    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgb</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>);<br>    <span class="hljs-attribute">box-shadow</span>: inset <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">3px</span> <span class="hljs-built_in">rgb</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>);<br>    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;<br>  &#125;<br>  &amp;::-webkit-scrollbar-button &#123;<br>    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgb</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>);<br>    <span class="hljs-attribute">display</span>: none;<br>  &#125;<br> <br>  &amp;<span class="hljs-selector-pseudo">:hover</span> &#123;<br>    <span class="hljs-comment">/*滚动条里面小方块*/</span><br>    &amp;::-webkit-scrollbar-thumb &#123;<br>      <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.2</span>);<br>      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;<br>    &#125;<br>    &amp;::-webkit-scrollbar-track &#123;<br>      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;<br>      <span class="hljs-attribute">box-shadow</span>: inset <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">3px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">253</span>, <span class="hljs-number">249</span>, <span class="hljs-number">249</span>, <span class="hljs-number">0.1</span>);<br>      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;<br>    &#125;<br>    &amp;::-webkit-scrollbar-button &#123;<br>      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#eee</span>;<br>      <span class="hljs-attribute">display</span>: none;<br>    &#125;<br>  &#125;<br>&#125;<br><span class="hljs-selector-class">.el-tree</span> &#123;<br>  <span class="hljs-attribute">min-width</span>: <span class="hljs-number">100%</span>;<br>  <span class="hljs-attribute">display</span>: inline-block;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="解决方案-增加Tootlip提示"><a href="#解决方案-增加Tootlip提示" class="headerlink" title="解决方案-增加Tootlip提示"></a>解决方案-增加Tootlip提示</h3><p>效果如下：<br><img src="/../img/vue17-2.png" alt="scroll"><br>首先需要限制字数，多余部分<code>...</code>表示，在hover时展示所有文字。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">arrToTree</span> = (<span class="hljs-params">data: <span class="hljs-built_in">Array</span>&lt;deptOne&gt;</span>) =&gt; &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Treedata=&quot;</span>, data);<br>  <span class="hljs-keyword">const</span> tree = [];<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(data)) &#123;<br>    <span class="hljs-keyword">return</span> tree;<br>  &#125;<br>  <span class="hljs-keyword">const</span> map = &#123;&#125;;<br>  data.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>    map[item.<span class="hljs-property">id</span>] = item;<br>  &#125;);<br>  data.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> parent = map[item.<span class="hljs-property">parent</span>];<br>    <span class="hljs-keyword">delete</span> item.<span class="hljs-property">parent</span>;<br>    item[<span class="hljs-string">&quot;label&quot;</span>] = item.<span class="hljs-property">name</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">6</span> ? item.<span class="hljs-property">name</span>.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>,<span class="hljs-number">6</span>) + <span class="hljs-string">&#x27;...&#x27;</span> : item.<span class="hljs-property">name</span>;<br>    item[<span class="hljs-string">&quot;value&quot;</span>] = item.<span class="hljs-property">id</span>;<br>    <span class="hljs-comment">// delete item.name; 保留name作为原始数据</span><br><br>    <span class="hljs-keyword">if</span> (parent) &#123;<br>      (parent.<span class="hljs-property">children</span> || (parent.<span class="hljs-property">children</span> = [])).<span class="hljs-title function_">push</span>(item);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      tree.<span class="hljs-title function_">push</span>(item);<br>    &#125;<br>  &#125;);<br>  <span class="hljs-keyword">return</span> tree[<span class="hljs-number">0</span>];<br>&#125;;<br></code></pre></div></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-tree</span></span><br><span class="hljs-tag"><span class="hljs-attr">:data</span>=<span class="hljs-string">&quot;attrTree&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">:props</span>=<span class="hljs-string">&quot;defaultProps&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">node-key</span>=<span class="hljs-string">&quot;id&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">default-expand-all</span></span><br><span class="hljs-tag"><span class="hljs-attr">:expand-on-click-node</span>=<span class="hljs-string">&quot;false&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">:render-content</span>=<span class="hljs-string">&quot;renderContent&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">:highlight-current</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">@<span class="hljs-attr">node-click</span>=<span class="hljs-string">&quot;handleNodeClick&quot;</span></span><br><span class="hljs-tag">&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">&quot;&#123; node, data &#125;&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;custom-tree-node&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-tooltip</span></span><br><span class="hljs-tag">      <span class="hljs-attr">effect</span>=<span class="hljs-string">&quot;dark&quot;</span></span><br><span class="hljs-tag">      <span class="hljs-attr">:content</span>=<span class="hljs-string">&quot;data.name&quot;</span></span><br><span class="hljs-tag">      <span class="hljs-attr">placement</span>=<span class="hljs-string">&quot;top-start&quot;</span></span><br><span class="hljs-tag">      <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-size: 14px&quot;</span></span><br><span class="hljs-tag">    &gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;&#123; node.label &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">el-tooltip</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;data.label == &#x27;XX信息&#x27;&quot;</span></span><br><span class="hljs-tag">        @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;openAddDir(data.id, 1, data)&quot;</span>&gt;</span><br>      +<br>      <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;!data.children &amp;&amp;!(data.label == &#x27;XX信息&#x27;)&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin-left: 8px&quot;</span></span><br><span class="hljs-tag">        @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;remove(data.id)&quot;</span>&gt;</span><br>        -<br>      <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;!data.children &amp;&amp;!(data.label == &#x27;XX信息&#x27;)&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin-left: 8px&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span></span><br><span class="hljs-tag">          <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;search-dir&quot;</span></span><br><span class="hljs-tag">          @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;openAddDir(data.id, 2, data)&quot;</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">Edit</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-tree</span>&gt;</span><br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（22）多环境发版脚本</title>
    <link href="/2023/05/10/vue3%E7%AC%94%E8%AE%B0%EF%BC%8822%EF%BC%89%E5%A4%9A%E7%8E%AF%E5%A2%83%E5%8F%91%E7%89%88%E8%84%9A%E6%9C%AC/"/>
    <url>/2023/05/10/vue3%E7%AC%94%E8%AE%B0%EF%BC%8822%EF%BC%89%E5%A4%9A%E7%8E%AF%E5%A2%83%E5%8F%91%E7%89%88%E8%84%9A%E6%9C%AC/</url>
    
    <content type="html"><![CDATA[<blockquote><p>分了开发环境、测试环境、demo演示环境、生产环境四个环境，对应API不一样，vite打包一次接近5分钟，如果改个bug就要重新发版，那老夫就不能准时下班了。<br>为了解决这个问题，写了个多环境一键发版脚本。</p></blockquote><span id="more"></span><h3 id="原方式"><a href="#原方式" class="headerlink" title="原方式"></a>原方式</h3><p><code>deploy.bash</code>脚本写了多个环境的发版，分别执行，虽然没啥问题，但是人力成本、时间成本略大。</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment"># **环境</span><br>npm run build:<span class="hljs-built_in">test</span><br><span class="hljs-built_in">rm</span> -rf cardlc<br><span class="hljs-built_in">mv</span> dist cardlc<br>scp -r cardlc/  root@***:/data/<br></code></pre></div></td></tr></table></figure><h3 id="新方式"><a href="#新方式" class="headerlink" title="新方式"></a>新方式</h3><p>在<code>public/static/config.js</code>中写入全局变量，打包后通过脚本分别修改不同环境的请求API地址，然后发布到服务器。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">g</span> = &#123;<br>  <span class="hljs-attr">apiUrl</span>: <span class="hljs-string">&quot;http://10.10.34.31:8087&quot;</span>,<br>  <span class="hljs-attr">tag</span>: <span class="hljs-string">&quot;1&quot;</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p><code>buildMultiEnv.js</code>脚本进行文件读写</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br><span class="hljs-keyword">const</span> filePath = <span class="hljs-string">&#x27;./dist/static/config.js&#x27;</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">changeBuildUrl</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  fs.<span class="hljs-title function_">readFile</span>(filePath, <span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) &#123;<br>    <span class="hljs-keyword">if</span>(err) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err)<br>      <span class="hljs-keyword">return</span><br>    &#125; <br>    <span class="hljs-keyword">let</span> str = data.<span class="hljs-title function_">toString</span>()<br>    <span class="hljs-keyword">const</span> tag = str.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;tag: &quot;&#x27;</span>)[<span class="hljs-number">1</span>].<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;&quot;&#x27;</span>)[<span class="hljs-number">0</span>]<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(tag)<br>    <span class="hljs-keyword">let</span> content = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">if</span>(tag == <span class="hljs-string">&#x27;1&#x27;</span>) &#123; <span class="hljs-comment">// 开发环境</span><br>      content = <span class="hljs-string">&#x27;window.g=&#123;apiUrl:&quot;http://***.31:8080&quot;,tag: &quot;2&quot;&#125;&#x27;</span><br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(tag == <span class="hljs-string">&#x27;2&#x27;</span>) &#123; <span class="hljs-comment">// 测试环境</span><br>      content = <span class="hljs-string">&#x27;window.g=&#123;apiUrl:&quot;http://***.32:8080&quot;,tag: &quot;3&quot;&#125;&#x27;</span><br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(tag == <span class="hljs-string">&#x27;3&#x27;</span>) &#123; <span class="hljs-comment">// demo环境</span><br>      content = <span class="hljs-string">&#x27;window.g=&#123;apiUrl:&quot;http://***.31:8089&quot;,tag: &quot;1&quot;&#125;&#x27;</span><br>    &#125;<span class="hljs-keyword">else</span> &#123;&#125;<br>    fs.<span class="hljs-title function_">writeFile</span>(filePath, content, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (err) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;写入失败&quot;</span>, err);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;写入成功。&quot;</span>);<br>      &#125;<br>    &#125;)<br>  &#125;)<br>&#125;;<br><span class="hljs-title function_">changeBuildUrl</span>();<br></code></pre></div></td></tr></table></figure><p><code>deplay.bash</code> 最终脚本，生产环境涉及一些特殊处理，单独罗列。<br>一定要注意先把之前的文件清空，不然生成的新文件会被移动到旧文件里面。</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment"># 开发环境、测试环境、演示demo环境一键更新</span><br><span class="hljs-built_in">rm</span> -rf cardlc<br>npm run build:<span class="hljs-built_in">test</span><br>node ./buildMultiEnv.js <br><span class="hljs-built_in">cp</span> -r dist cardlc<br>scp -r cardlc/  root@***.31:/data/<br><span class="hljs-built_in">rm</span> -rf cardlc<br>node ./buildMultiEnv.js <br><span class="hljs-built_in">cp</span> -r dist cardlc<br>scp -r cardlc/  root@***.32:/data/<br><span class="hljs-built_in">rm</span> -rf cardlc<br>node ./buildMultiEnv.js <br><span class="hljs-built_in">cp</span> -r dist cardlc<br>scp -r cardlc/  root@***.31:/data/demo<br><br><span class="hljs-comment"># 生产环境</span><br>npm run build:prod<br><span class="hljs-built_in">rm</span> -rf cardlc<br><span class="hljs-built_in">mv</span> dist cardlc<br>scp -r cardlc/  root@***.33:/data/<br></code></pre></div></td></tr></table></figure><p>试了一下，打包完之后上传至服务器，输入密码，再次执行两次，非常丝滑，nice～</p>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（21-2）动态路由</title>
    <link href="/2023/05/08/vue3%E7%AC%94%E8%AE%B0%EF%BC%8821-2%EF%BC%89%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1/"/>
    <url>/2023/05/08/vue3%E7%AC%94%E8%AE%B0%EF%BC%8821-2%EF%BC%89%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1/</url>
    
    <content type="html"><![CDATA[<blockquote><p>这篇是上一篇的延伸，详细记录下动态路由的使用。</p></blockquote><span id="more"></span><h3 id="项目中使用-子系统"><a href="#项目中使用-子系统" class="headerlink" title="项目中使用-子系统"></a>项目中使用-子系统</h3><p>动态菜单格式如下：</p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">200</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;msg&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;菜单获取成功&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;pid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 最上层pid代表系统</span><br>    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;一级菜单&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;一级菜单&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/first&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;fold&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;component&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;BasicLayout&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;icon&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;first-icon&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;hidden&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;meta&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;一级菜单&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;icon&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;first-icon&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;hidden&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;multiple&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;children&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;pid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;二级菜单&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;二级菜单&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/second&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;fold&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;home&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;component&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;test&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;icon&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;first-icon&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;hidden&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;children&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;pid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;删除&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;hidden&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;api&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/api/partner/&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;method&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;DELETE&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></div></td></tr></table></figure><p>其中 level&#x3D;3 数组，用于前端按钮展示，为了用户友好，系统定义若用户无权限访问（例如只能查看，不能修改），直接将操作按钮隐藏。</p><p><code>store/modules/permission.ts</code>中存储菜单信息，这里<code>MenuType</code>添加了类型fold，表示文件夹地址，因为前端在工程设计时将不同组件存放于不同文件夹下，如果直接在path中写几层地址，这里会导致导入组件失败。<br>routes表示静态路由，例如：首页（&#x2F;），404（&#x2F;404）等应用开放给所有用户的页面，dynamicRoutes表示动态路由，是在应用初始化时从后端获取的。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; defineStore &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;pinia&#x27;</span><br><span class="hljs-keyword">import</span> &#123; store &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/store/index&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">BasicLayout</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/views/layout/index&#x27;</span><br><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../router&#x27;</span><br><span class="hljs-keyword">import</span> &#123; getUserRoutes &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/api/user&#x27;</span><br><br><span class="hljs-keyword">export</span> type <span class="hljs-title class_">MenuType</span> = &#123;<br>  <span class="hljs-attr">path</span>: string<br>  <span class="hljs-attr">title</span>: string<br>  fold?: string<br>  meta?: any<br>  <span class="hljs-attr">component</span>: string<br>  redirect?: string<br>  children?: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">MenuType</span>&gt;<br>&#125;<br><br>interface <span class="hljs-title class_">IPermissionState</span> &#123;<br>  <span class="hljs-attr">routes</span>: any[]<br>  <span class="hljs-attr">dynamicRoutes</span>: any[]<br>&#125;<br><br><span class="hljs-comment">// 生产环境导入组件</span><br><span class="hljs-keyword">const</span> modules = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-title function_">glob</span>(<span class="hljs-string">&#x27;../../views/**/*.vue&#x27;</span>)<br><span class="hljs-comment">// 本地开发环境导入组件</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">_import</span> = (<span class="hljs-params">path: string, fold: string</span>) =&gt; <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">`../../views/<span class="hljs-subst">$&#123;fold&#125;</span>/<span class="hljs-subst">$&#123;path&#125;</span>.vue`</span>)<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">assembleRouter</span> = (<span class="hljs-params">routers: any</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> addRouter = routers.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">router: any</span>) =&gt;</span> &#123;<br>    router.<span class="hljs-property">title</span> &amp;&amp;<br>      router.<span class="hljs-property">icon</span> &amp;&amp;<br>      (router.<span class="hljs-property">meta</span> = &#123;<br>        <span class="hljs-attr">title</span>: router.<span class="hljs-property">title</span><br>        <span class="hljs-comment">// icon: router.icon, // 子菜单暂时不用icon</span><br>      &#125;)<br>    <span class="hljs-keyword">if</span> (router.<span class="hljs-property">component</span> === <span class="hljs-string">&#x27;BasicLayout&#x27;</span>) &#123;<br>      router.<span class="hljs-property">component</span> = <span class="hljs-title function_">shallowRef</span>(<span class="hljs-title class_">BasicLayout</span>)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">MODE</span> === <span class="hljs-string">&#x27;dev&#x27;</span>) &#123;<br>        router.<span class="hljs-property">component</span> = <span class="hljs-title function_">_import</span>(router.<span class="hljs-property">component</span>, router.<span class="hljs-property">fold</span>)<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        router.<span class="hljs-property">component</span> = modules[<span class="hljs-string">`../../views/<span class="hljs-subst">$&#123;router.fold&#125;</span>/<span class="hljs-subst">$&#123;router.component&#125;</span>.vue`</span>]<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (router.<span class="hljs-property">children</span> &amp;&amp; router.<span class="hljs-property">children</span>.<span class="hljs-property">length</span>) &#123;<br>      router.<span class="hljs-property">children</span> = <span class="hljs-title function_">assembleRouter</span>(router.<span class="hljs-property">children</span>)<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>  &#125;)<br>  <span class="hljs-keyword">return</span> addRouter<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> usePermissionStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">&#x27;permission&#x27;</span>, &#123;<br>  <span class="hljs-attr">state</span>: (): <span class="hljs-function"><span class="hljs-params">IPermissionState</span> =&gt;</span> (&#123;<br>    <span class="hljs-attr">routes</span>: [],<br>    <span class="hljs-attr">dynamicRoutes</span>: [],<br>  &#125;),<br>  <span class="hljs-attr">getters</span>: &#123;<br>    <span class="hljs-title function_">getRoutes</span>(): any[] &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">routes</span><br>    &#125;,<br>    <span class="hljs-title function_">getDynamicRoutes</span>(): any[] &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dynamicRoutes</span><br>    &#125;<br>  &#125;,<br>  <span class="hljs-attr">actions</span>: &#123;<br>    <span class="hljs-keyword">async</span> <span class="hljs-title function_">getMenus</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getUserRoutes</span>(&#123;&#125;)<br>         <span class="hljs-variable language_">this</span>.<span class="hljs-property">dynamicRoutes</span> = data<br>        <span class="hljs-comment">// 组件路由</span><br>        <span class="hljs-keyword">const</span> addRouter = <span class="hljs-title function_">assembleRouter</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dynamicRoutes</span>)<br>        <span class="hljs-comment">// 动态添加菜单</span><br>        addRouter.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">ts: any</span>) =&gt;</span> &#123;<br>          router.<span class="hljs-title function_">addRoute</span>(ts)<br>        &#125;)<br>      &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(err)<br>      &#125;<br>    &#125;,<br>    <span class="hljs-title function_">clearMenus</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">dynamicRoutes</span>.<span class="hljs-property">length</span> = <span class="hljs-number">0</span><br>    &#125;<br>  &#125;<br>&#125;)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">usePermissionStoreWithOut</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">usePermissionStore</span>(store)<br>&#125;<br></code></pre></div></td></tr></table></figure><p><code>Sidebar/index.vue</code>中渲染菜单，这里可以使用<br>（1）router.getRoutes()<br>（2）router.options.routes和dynamicRoutes的组合来展示侧栏菜单<br>但是 getRoutes 中携带的数据不够，这里需要自定义菜单的部分内容，所以还是采用获取的后端原始数据的 dynamicRoutes。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-scrollbar</span> <span class="hljs-attr">wrap-class</span>=<span class="hljs-string">&quot;scrollbar-wrapper&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-menu</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">sidebar-item</span></span><br><span class="hljs-tag">        <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;menu in menuList&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;menu.path&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">:item</span>=<span class="hljs-string">&quot;menu&quot;</span></span><br><span class="hljs-tag">      /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">el-menu</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">el-scrollbar</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">const</span> menuList = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">    <span class="hljs-comment">// return router.getRoutes()</span></span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> routes = router.<span class="hljs-property">options</span>.<span class="hljs-property">routes</span> || []</span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> menus = permissionStore.<span class="hljs-property">dynamicRoutes</span> || []</span><br><span class="language-javascript">    <span class="hljs-keyword">return</span> routes.<span class="hljs-title function_">concat</span>(menus)</span><br><span class="language-javascript">  &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>子系统<code>permission.ts</code>路由守卫中中判断token。<br>若有，执行获取动态菜单的操作，并且在获取成功之后进行过滤，如果当前去往的地址在白名单内，则放行；反之，跳转404页面。<br>若无token，则跳转UMS首页。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./router&#x27;</span><br><span class="hljs-keyword">import</span> &#123; useUserStore &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/store/modules/user&#x27;</span><br><span class="hljs-keyword">import</span> &#123; usePermissionStore &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/store/modules/permission&#x27;</span><br><br>router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> (to, <span class="hljs-keyword">from</span>, next) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>()<br>  <span class="hljs-keyword">const</span> token = userStore.<span class="hljs-property">getToken</span><br><br>  <span class="hljs-keyword">if</span> (token) &#123;<br>    <span class="hljs-keyword">const</span> permissionStore = <span class="hljs-title function_">usePermissionStore</span>()<br>    <span class="hljs-keyword">const</span> &#123; dynamicRoutes, getMenus &#125; = permissionStore<br>    <span class="hljs-keyword">if</span> (dynamicRoutes.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// 调用接口获取动态路由菜单</span><br>        <span class="hljs-keyword">await</span> <span class="hljs-title function_">getMenus</span>()<br>        <span class="hljs-keyword">const</span> allowList = router.<span class="hljs-title function_">getRoutes</span>()<br>        <span class="hljs-keyword">const</span> userP = allowList.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-property">path</span> == to.<span class="hljs-property">path</span>)<br>        <span class="hljs-keyword">if</span> (userP.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) &#123;<br>          <span class="hljs-comment">// 访问路径在白名单中</span><br>          <span class="hljs-title function_">next</span>(&#123; ...to, <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span> &#125;)<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-title function_">next</span>(&#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/404&#x27;</span> &#125;)<br>        &#125;<br>      &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err)<br>      &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// 动态路由已获取</span><br>      <span class="hljs-title function_">next</span>()<br>    &#125;<br>  &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// 无token，跳转ums首页</span><br>    <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-title function_">reload</span>()<br>&#125;)<br></code></pre></div></td></tr></table></figure><p>同时在<code>service.ts</code>中也需要设置若token失效（请求中后端返回401），跳转&#x2F;ums&#x2F;</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">service.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<br>  <span class="hljs-function">(<span class="hljs-params">response: AxiosResponse&lt;any&gt;</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> &#123; config, status, data &#125; = response<br>    <span class="hljs-keyword">if</span> (config.<span class="hljs-property">responseType</span> === <span class="hljs-string">&#x27;blob&#x27;</span>) &#123;<br>      <span class="hljs-keyword">return</span> response <span class="hljs-comment">// 如果是文件流，直接过</span><br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (status === result_code) &#123;<br>      <span class="hljs-keyword">return</span> data<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(data.<span class="hljs-property">message</span>)<br>    &#125;<br>  &#125;,<br>  <span class="hljs-function">(<span class="hljs-params">error: AxiosError</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;error=&#x27;</span>, error)<br>    <span class="hljs-keyword">if</span> (error &amp;&amp; <span class="hljs-title class_">String</span>(error).<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;401&#x27;</span>) &gt; -<span class="hljs-number">1</span>) &#123;<br>      <span class="hljs-comment">// Unauthorized</span><br>      <span class="hljs-title function_">removeToken</span>()<br>      <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-title function_">reload</span>()<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error &amp;&amp; <span class="hljs-title class_">String</span>(error).<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;403&#x27;</span>) &gt; -<span class="hljs-number">1</span>) &#123;<br>      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;当前没有操作权限，请联系管理员。&#x27;</span>)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(error.<span class="hljs-property">message</span>)<br>      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)<br>    &#125;<br>  &#125;<br>)<br></code></pre></div></td></tr></table></figure><h3 id="UMS系统"><a href="#UMS系统" class="headerlink" title="UMS系统"></a>UMS系统</h3><p>这里设置白名单，无token状态下白名单路由放行。<br>casdoor登录成功跳转页（&#x2F;cb）在白名单中，用作系统登录中转（使用casdoor SDK登录），成功后跳转首页。<br>同理，若在子系统已清除token情况下，跳转UMS首页（&#x2F;ums），则通过首页中转后间接跳转登录页（&#x2F;login）。<br><code>ums</code>中的路由守卫如下：</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./router&#x27;</span><br><span class="hljs-keyword">import</span> &#123; useUserStore &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/store/modules/user&#x27;</span><br><br><span class="hljs-keyword">const</span> whiteList = [<span class="hljs-string">&#x27;/login&#x27;</span>, <span class="hljs-string">&#x27;/cb&#x27;</span>]<br><br>router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> (to, <span class="hljs-keyword">from</span>, next) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>()<br>  <span class="hljs-keyword">const</span> token = userStore.<span class="hljs-property">getToken</span><br>  <span class="hljs-keyword">if</span> (token) &#123;<br>    <span class="hljs-keyword">if</span> (to.<span class="hljs-property">path</span> === <span class="hljs-string">&#x27;/login&#x27;</span>) &#123;<br>      <span class="hljs-title function_">next</span>(&#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span> &#125;)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title function_">next</span>()<br>    &#125;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">if</span> (whiteList.<span class="hljs-title function_">indexOf</span>(to.<span class="hljs-property">path</span>) !== -<span class="hljs-number">1</span>) &#123;<br>      <span class="hljs-title function_">next</span>()<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title function_">next</span>(&#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/login&#x27;</span> &#125;)<br>    &#125;<br>  &#125;<br>&#125;)<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（21-1）vue-router4</title>
    <link href="/2023/05/08/vue3%E7%AC%94%E8%AE%B0%EF%BC%8821-1%EF%BC%89vue-router4/"/>
    <url>/2023/05/08/vue3%E7%AC%94%E8%AE%B0%EF%BC%8821-1%EF%BC%89vue-router4/</url>
    
    <content type="html"><![CDATA[<blockquote><p>这篇详细记录下用到过的路由方法，基于vue-router4</p></blockquote><span id="more"></span><h3 id="项目中使用"><a href="#项目中使用" class="headerlink" title="项目中使用"></a>项目中使用</h3><ol><li><p><code>main.ts</code>中引入<br>安装router插件的时候注册了router-link和router-view这两个全局组件，项目中能直接使用。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./router&#x27;</span><br><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)<br>app.<span class="hljs-title function_">use</span>(router).<span class="hljs-title function_">mount</span>(<span class="hljs-string">&#x27;#app&#x27;</span>)<br></code></pre></div></td></tr></table></figure></li><li><p><code>router/index.ts</code>中写静态路由</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; createRouter, createWebHistory, <span class="hljs-title class_">RouteRecordRaw</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">SimpleLayout</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/views/layout/simple.vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">NotFound</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/views/error/404.vue&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">constantRoutes</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">RouteRecordRaw</span>&gt; = [<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/login&#x27;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-title function_">defineAsyncComponent</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/login/auth.vue&#x27;</span>)),<br>    <span class="hljs-attr">meta</span>: &#123; <span class="hljs-attr">hidden</span>: <span class="hljs-literal">true</span> &#125;<br>  &#125;,<br>  &#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/:pathMatch(.*)*&#x27;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;NotFound&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">NotFound</span> &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;dash&#x27;</span>, <span class="hljs-comment">// 路由命名</span><br>    <span class="hljs-attr">component</span>: <span class="hljs-title class_">SimpleLayout</span>,<br>    <span class="hljs-attr">redirect</span>: <span class="hljs-string">&#x27;/dash&#x27;</span>, <span class="hljs-comment">// 重定向，还可以写成命名路由、方法</span><br>    <span class="hljs-attr">meta</span>: &#123; <span class="hljs-comment">// 路由元信息</span><br>      <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;dash&#x27;</span>,<br>      <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;userm&#x27;</span>,<br>      <span class="hljs-attr">hidden</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-attr">level</span>: <span class="hljs-number">1</span> <span class="hljs-comment">// 用于在sidebar中渲染子菜单，可设置成level=2</span><br>    &#125;,<br>    <span class="hljs-attr">children</span>: [ <span class="hljs-comment">// 可以有多个子菜单</span><br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/dash&#x27;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-title function_">defineAsyncComponent</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/home/index.vue&#x27;</span>))<br>      &#125;<br>    ]<br>  &#125;<br>]<br><br><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>(&#123;<br>  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">BASE_URL</span>), <span class="hljs-comment">// 手动启用历史记录模式</span><br>  <span class="hljs-attr">routes</span>: constantRoutes<br>&#125;)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router<br></code></pre></div></td></tr></table></figure></li></ol><p>（1）在写 redirect 的时候，可以省略 component 配置，因为它从来没有被直接访问过。唯一的例外是嵌套路由：如果一个路由记录有 children 和 redirect 属性，它也应该有 component 属性。</p><p>（2）<code>createWebHistory</code>创建 HTML5 模式，需要在<code>nginx</code> 中需要添加以下配置，作为一个简单的回退路由。如果 URL 不匹配任何静态资源，返回与 index.html 相同的页面。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">location / &#123;<br>  try_files $uri $uri/ /index.html;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>（3）meta属性接收任意路由附加信息，并且它可以在路由地址和导航守卫上都被访问到。   </p><ol start="3"><li><code>layout/app-main.vue</code>中引入<br>router-link的页面切换只是更新了页面的部分内容，不会进行整个页面的刷新<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;app-main&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">transition</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;fade&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;transition&quot;</span> <span class="hljs-attr">mode</span>=<span class="hljs-string">&quot;out-in&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">transition</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li></ol><h3 id="跳转方式一：sibebar-item中使用"><a href="#跳转方式一：sibebar-item中使用" class="headerlink" title="跳转方式一：sibebar-item中使用"></a>跳转方式一：sibebar-item中使用</h3><p>属性 to 与 router.push 接受的对象种类相同，两者的规则完全相同。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">&quot;...&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">slot</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">&quot;...&quot;</span> <span class="hljs-attr">replace</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="跳转方式二：组件中使用"><a href="#跳转方式二：组件中使用" class="headerlink" title="跳转方式二：组件中使用"></a>跳转方式二：组件中使用</h3><p> 编程式导航注意：</p><ol><li>params 不能与 path 一起使用</li><li>router.push 和所有其他导航方法都会返回一个 Promise</li><li>replace 在导航时不会向 history 添加新记录</li><li>直接 watch 期望改变的参数，避免监听整个 route 对象</li><li>若路由导航相同，相同的组件实例将被重复使用（组件的生命周期钩子不会被调用）<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; useRouter, useRoute &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span><br><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()<br><span class="hljs-keyword">const</span> route = <span class="hljs-title function_">useRoute</span>()<br><br>router.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;/users&#x27;</span>)<br>router.<span class="hljs-title function_">push</span>(&#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/home&#x27;</span>, <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span> &#125;) <br><span class="hljs-comment">// 相当于router.replace(&#123; path: &#x27;/home&#x27; &#125;)</span><br><br><span class="hljs-comment">// 带有路径的对象</span><br>router.<span class="hljs-title function_">push</span>(&#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/users&#x27;</span> &#125;)<br><br><span class="hljs-comment">// 命名的路由，并加上参数，让路由建立 url</span><br>router.<span class="hljs-title function_">push</span>(&#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-attr">params</span>: &#123; <span class="hljs-attr">username</span>: <span class="hljs-string">&#x27;ginny&#x27;</span> &#125; &#125;)<br><br><span class="hljs-comment">// 带查询参数，结果是 /aaa?b=1&amp;c=1</span><br>router.<span class="hljs-title function_">push</span>(&#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/aaa&#x27;</span>, <span class="hljs-attr">query</span>: &#123; ...route.<span class="hljs-property">query</span>, ...query &#125; &#125;)<br><br><span class="hljs-comment">// 带 hash，结果是 /about#team</span><br>router.<span class="hljs-title function_">push</span>(&#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/about&#x27;</span>, <span class="hljs-attr">hash</span>: <span class="hljs-string">&#x27;#team&#x27;</span> &#125;)<br>router.<span class="hljs-title function_">go</span>(-<span class="hljs-number">1</span>)  <span class="hljs-comment">// 返回、后退一步</span><br><span class="hljs-title function_">watch</span>( <span class="hljs-comment">// 当参数更改时获取用户信息</span><br>  <span class="hljs-function">() =&gt;</span> route.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>,<br>  <span class="hljs-keyword">async</span> newId =&gt; &#123;<br>    userData.<span class="hljs-property">value</span> = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUser</span>(newId)<br>  &#125;<br>)<br></code></pre></div></td></tr></table></figure></li></ol><h3 id="守卫导航"><a href="#守卫导航" class="headerlink" title="守卫导航"></a>守卫导航</h3><ol><li>触发时，全局前置守卫按照创建顺序调用。守卫是异步解析执行，此时导航在所有守卫 resolve 完之前一直处于等待中。</li><li>若返回 false ，取消当前的导航。如果浏览器的 URL 改变了(可能是用户手动或者浏览器后退按钮)，那么 URL 地址会重置到 from 路由对应的地址。</li><li>若返回一个路由地址，跳转。</li></ol><h3 id="获取参数的js原生方法"><a href="#获取参数的js原生方法" class="headerlink" title="获取参数的js原生方法"></a>获取参数的js原生方法</h3><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">search</span>)<br><span class="hljs-keyword">const</span> aaa = params.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;aaa&#x27;</span>) <span class="hljs-comment">// http://***/?aaa=1</span><br></code></pre></div></td></tr></table></figure><p><code>附录</code><br><a href="https://router.vuejs.org/zh/">Vue Router | Vue.js 的官方路由</a><br><a href="https://blog.csdn.net/lcl130/article/details/122800643">Vue Router 4 的使用</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（20-2）textarea处理</title>
    <link href="/2023/05/06/vue3%E7%AC%94%E8%AE%B0%EF%BC%8820-2%EF%BC%89textarea%E5%B0%81%E8%A3%85/"/>
    <url>/2023/05/06/vue3%E7%AC%94%E8%AE%B0%EF%BC%8820-2%EF%BC%89textarea%E5%B0%81%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<blockquote><p>有一个备注框限制输入200个字符，要求是允许用户输入空格、换行，并且在详情中可以看到空格和换行组成的文字串儿。<br>后端在存储时可以保留空格，但是换行会转译，在textarea中换行是算作一个字符的，这就导致了新建时200个字符，编辑时变成了203个字符，OMG…<br>本篇是对textarea的处理。</p></blockquote><span id="more"></span><h3 id="textarea输入框"><a href="#textarea输入框" class="headerlink" title="textarea输入框"></a>textarea输入框</h3><ol><li>可以通过maxlength限制字数</li><li>可以通过rows控制显示行数，超过将出现滚动条<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-input</span></span><br><span class="hljs-tag">  <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;textarea&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;testForm.remark&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入备注&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:rows</span>=<span class="hljs-string">&quot;4&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">maxlength</span>=<span class="hljs-string">&quot;200&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">show-word-limit</span></span><br><span class="hljs-tag">&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-input</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li></ol><p>同时也加入正则校验，保证字数及输入字符满足需求。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> testRules = <span class="hljs-title function_">reactive</span>(&#123;<br> <span class="hljs-attr">remark</span>: [&#123; <span class="hljs-attr">validator</span>: validateText200, <span class="hljs-attr">trigger</span>: [<span class="hljs-string">&#x27;blur&#x27;</span>, <span class="hljs-string">&#x27;change&#x27;</span>] &#125;]<br>&#125;)<br></code></pre></div></td></tr></table></figure><h3 id="换行操作"><a href="#换行操作" class="headerlink" title="换行操作"></a>换行操作</h3><p>在textarea中空格、换行是算作一个字符的，后端在存储时可以保留空格，但是换行会转译，这就导致了新建时200个字符，编辑时变成了203个字符。但是如果我删除了最后一个字符，又变回了199个，说明用户操作会引起组件内部对换行的转译。<br><img src="/../img/vue22-2.png" alt="输入200个字符"><br>这就需要前端在保存时将换行先转成<code>&lt;br/&gt;</code>,在编辑前将<code>&lt;br/&gt;</code>变回换行符。</p><p>这里使用<code>preText</code>作为保存时的转化，使用<code>afterText</code>作为编辑状态下的初始化。  </p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; preText, afterText &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils/validate&#x27;</span><br><span class="hljs-comment">// 表格初始化</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">formInit</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> params = route.<span class="hljs-property">query</span><br>  <span class="hljs-keyword">if</span> (params &amp;&amp; params.<span class="hljs-property">detail</span>) &#123;<br>    state.<span class="hljs-property">pageOp</span> = <span class="hljs-number">2</span><br>    <span class="hljs-keyword">let</span> detail = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(params.<span class="hljs-property">detail</span> <span class="hljs-keyword">as</span> string)<br>    detail.<span class="hljs-property">remark</span> = <span class="hljs-title function_">afterText</span>(detail.<span class="hljs-property">remark</span>)<br>  &#125;<br>&#125;<br><span class="hljs-comment">// 提交API</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleAdd</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  orderParams.<span class="hljs-property">remark</span> = <span class="hljs-title function_">preText</span>(orderParams.<span class="hljs-property">remark</span>)<br>&#125;<br></code></pre></div></td></tr></table></figure><p><code>/utils/validate</code>中写转换方法</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">preText</span> = (<span class="hljs-params">pretext: string</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> pretext.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\r\n/g</span>, <span class="hljs-string">&#x27;&lt;br/&gt;&#x27;</span>).<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\n/g</span>, <span class="hljs-string">&#x27;&lt;br/&gt;&#x27;</span>)<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">afterText</span> = (<span class="hljs-params">pretext: string</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> pretext.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&lt;br\/&gt;/g</span>, <span class="hljs-string">&#x27;\n&#x27;</span>)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>详情页中需要使用<code>v-html</code>来保证直接识别<code>&lt;br/&gt;</code>，通过css控制换行。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;remark-break&quot;</span> <span class="hljs-attr">v-html</span>=<span class="hljs-string">&quot;item[&#x27;remark&#x27;]&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-class">.remark-break</span> &#123;<br>  <span class="hljs-attribute">word-break</span>: break-all;<br>  <span class="hljs-attribute">white-space</span>: pre-line<br>&#125;<br></code></pre></div></td></tr></table></figure><p>新建、编辑、详情均显示正常<br><img src="/../img/vue22-3.png" alt="新建/编辑状态"><br><img src="/../img/vue22-4.png" alt="详情"></p>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（20-1）el-input踩坑</title>
    <link href="/2023/05/04/vue3%E7%AC%94%E8%AE%B0%EF%BC%8820-1%EF%BC%89el-input%E8%B8%A9%E5%9D%91/"/>
    <url>/2023/05/04/vue3%E7%AC%94%E8%AE%B0%EF%BC%8820-1%EF%BC%89el-input%E8%B8%A9%E5%9D%91/</url>
    
    <content type="html"><![CDATA[<blockquote><p>一个最基础的输入框居然藏着坑！<br>本篇所有内容基于el-form校验。</p></blockquote><span id="more"></span><h3 id="输入框"><a href="#输入框" class="headerlink" title="输入框"></a>输入框</h3><h4 id="文字输入框"><a href="#文字输入框" class="headerlink" title="文字输入框"></a>文字输入框</h4><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-form</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;testFormRef&quot;</span> <span class="hljs-attr">:model</span>=<span class="hljs-string">&quot;testForm&quot;</span> <span class="hljs-attr">:rules</span>=<span class="hljs-string">&quot;testFormRule&quot;</span> <span class="hljs-attr">label-width</span>=<span class="hljs-string">&quot;300px&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;aaa：&quot;</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">&quot;aaa&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;testForm.aaa&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入aaa&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-input</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-form</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h4 id="数字输入框"><a href="#数字输入框" class="headerlink" title="数字输入框"></a>数字输入框</h4><ol><li>数字输入框可以通过左右两边的+-实现基于步长的直接增减，方便操作；</li><li>数字输入框可以限制输入最大值和最小值，不在区间范围内的，会自动变成边界值；</li><li>数字输入框可以设置输入数值的精度，精度为0，只能输入整数；<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-input-number</span></span><br><span class="hljs-tag">  <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;testForm.bbb&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:precision</span>=<span class="hljs-string">&quot;0&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:min</span>=<span class="hljs-string">&quot;0&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:max</span>=<span class="hljs-string">&quot;1000&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入bbb&quot;</span></span><br><span class="hljs-tag">/&gt;</span><br></code></pre></div></td></tr></table></figure>数字输入框有一点其他文档里都没有说明，就是有种骚操作（来自测试同学），直接粘贴了小数点.，在设置了精度为0的条件下，这个输入框居然没有报错！<br>我原来以为再加一个正则判断就行，谁知还是绕过了验证…<br><img src="/../img/vue22-1.png" alt="输入小数点"><br>在打印之后，发现小数点在输入框中的值是null，难怪正则验证不出来…</li></ol><h4 id="文字输入框输入数字"><a href="#文字输入框输入数字" class="headerlink" title="文字输入框输入数字"></a>文字输入框输入数字</h4><p>通过v-model.number和正则结合可以控制只输入整数</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> </span><br><span class="hljs-tag">  <span class="hljs-attr">v-model.number</span>=<span class="hljs-string">&quot;tetForm.ccc&quot;</span> </span><br><span class="hljs-tag">  <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入ccc&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-input</span>&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> testFormRule = <span class="hljs-title function_">reactive</span>(&#123;<br>  <span class="hljs-attr">aaa</span>: [<br>    &#123; <span class="hljs-attr">required</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">trigger</span>: [<span class="hljs-string">&#x27;blur&#x27;</span>, <span class="hljs-string">&#x27;change&#x27;</span>] &#125;,<br>    &#123; <span class="hljs-attr">validator</span>: validateText50, <span class="hljs-attr">trigger</span>: [<span class="hljs-string">&#x27;blur&#x27;</span>, <span class="hljs-string">&#x27;change&#x27;</span>] &#125;<br>  ],<br>  <span class="hljs-attr">ccc</span>: [<br>    &#123; <span class="hljs-attr">required</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">trigger</span>: [<span class="hljs-string">&#x27;blur&#x27;</span>, <span class="hljs-string">&#x27;change&#x27;</span>] &#125;,<br>    &#123; <span class="hljs-attr">validator</span>: validateNumber, <span class="hljs-attr">trigger</span>: [<span class="hljs-string">&#x27;blur&#x27;</span>, <span class="hljs-string">&#x27;change&#x27;</span>] &#125;<br>  ]<br>&#125;)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">validateNumber</span> = (<span class="hljs-params">rule: any, value: number, callback: <span class="hljs-built_in">Function</span></span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isValidNumber</span>(value)) &#123;<br>    <span class="hljs-title function_">callback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;请输入整数&#x27;</span>))<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_">callback</span>()<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">isValidNumber</span> = (<span class="hljs-params">n: number</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (n) &#123;<br>    <span class="hljs-keyword">const</span> reg1 = <span class="hljs-regexp">/^\d+$/</span><br>    <span class="hljs-keyword">const</span> v1 = reg1.<span class="hljs-title function_">test</span>(n)<br>    <span class="hljs-keyword">return</span> v1<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>  &#125;<br>&#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">validateText50</span> = (<span class="hljs-params">rule: any, value: string, callback: <span class="hljs-built_in">Function</span></span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isValidName50</span>(value)) &#123;<br>    <span class="hljs-title function_">callback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;请输入0-50位中文、字母或数字，支持部分特殊符号&#x27;</span>))<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_">callback</span>()<br>  &#125;<br>&#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">isValidName50</span> = (<span class="hljs-params">checkStr: string</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> str = checkStr ? checkStr : <span class="hljs-string">&#x27;&#x27;</span><br>  <span class="hljs-keyword">const</span> reg1 =<br>    <span class="hljs-regexp">/^[0-9\u4e00-\u9fa5a-zA-Z0-9“”&quot;‘’/&#x27;\-()\[\]!！@#$￥%^&amp;*&#123;&#125;&lt;&gt;《》·`。.,，；;：【】:（）]&#123;0,50&#125;$/</span><br>  <span class="hljs-keyword">const</span> v1 = reg1.<span class="hljs-title function_">test</span>(str)<br>  <span class="hljs-keyword">const</span> v2 = str.<span class="hljs-property">length</span> &lt; <span class="hljs-number">51</span><br>  <span class="hljs-keyword">return</span> v1 &amp;&amp; v2<br>&#125;<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>微前端（1）</title>
    <link href="/2023/04/23/%E5%BE%AE%E5%89%8D%E7%AB%AF%EF%BC%881%EF%BC%89/"/>
    <url>/2023/04/23/%E5%BE%AE%E5%89%8D%E7%AB%AF%EF%BC%881%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本篇是微前端的学习记录。</p></blockquote><span id="more"></span><h3 id="适用业务场景"><a href="#适用业务场景" class="headerlink" title="适用业务场景"></a>适用业务场景</h3><ol><li>需要将多个后台系统统一收口的一个系统内。</li><li>庞大的单页面应用，开发&#x2F;构建时间长。<br>微前端可以实现各个微应用的独立开发和发版，主应用管理微应用的注册和渲染，将整个系统彻底解耦。</li></ol><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><ol><li>主应用：一个系统只有一个，系统整体 Layout 的设计，所有微应用的配置与注册。</li><li>微应用：通常是一个单页面应用（SPA），可能包含一个或多个路由页面，一般情况下不存在多个微应用同时运行的场景。<br>本身是普通的前端应用，负责具体的业务逻辑；<br>可以独立交付（开发、部署、运行），但是一般会集成到主应用中运行；<br>如有必要，甚至能集成到不同的主应用中。</li></ol><h3 id="icestark试用"><a href="#icestark试用" class="headerlink" title="icestark试用"></a>icestark试用</h3><p><code>附录</code><br><a href="https://iceteam.gitee.io/docs/guide">飞冰</a><br><a href="https://micro-frontends.ice.work/docs/guide">飞冰</a><br><a href="https://qiankun.umijs.org/zh/guide">乾坤</a><br><a href="https://wujie-micro.github.io/doc/">无界</a><br><a href="https://zeroing.jd.com/micro-app/docs.html#/">京东</a><br><a href="https://zh-hans.single-spa.js.org/docs/getting-started-overview">single_spa</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（19-3）文件预览</title>
    <link href="/2023/04/21/vue3%E7%AC%94%E8%AE%B0%EF%BC%8819-3%EF%BC%89%E6%96%87%E4%BB%B6%E9%A2%84%E8%A7%88/"/>
    <url>/2023/04/21/vue3%E7%AC%94%E8%AE%B0%EF%BC%8819-3%EF%BC%89%E6%96%87%E4%BB%B6%E9%A2%84%E8%A7%88/</url>
    
    <content type="html"><![CDATA[<blockquote><p>经过调研发现，开源库中对docx预览支持较多，doc未找到合适可用的库，包括微软官方js预览插件也仅支持docx。<br>本篇是对预览组件的封装，可支持docx、jpg、png、txt文件预览</p></blockquote><span id="more"></span><h3 id="文件预览组件编写"><a href="#文件预览组件编写" class="headerlink" title="文件预览组件编写"></a>文件预览组件编写</h3><p>这里以弹窗形式展示预览文件，最终效果如下：<br><img src="/../img/vue21-1.png" alt="文件预览"></p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;preview-list&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">iframe</span></span><br><span class="hljs-tag">      <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;txtUrl&quot;</span></span><br><span class="hljs-tag">      <span class="hljs-attr">:src</span>=<span class="hljs-string">&quot;txtUrl&quot;</span></span><br><span class="hljs-tag">      <span class="hljs-attr">frameborder</span>=<span class="hljs-string">&quot;0&quot;</span></span><br><span class="hljs-tag">    &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-dialog</span></span><br><span class="hljs-tag">      <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;文件预览&quot;</span></span><br><span class="hljs-tag">      <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;dialogVisible&quot;</span></span><br><span class="hljs-tag">      <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;dialog-file&quot;</span></span><br><span class="hljs-tag">      @<span class="hljs-attr">close</span>=<span class="hljs-string">&quot;handleCancle&quot;</span></span><br><span class="hljs-tag">    &gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;imgUrl&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;img-prew&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">&quot;imgUrl&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span> /&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;docxFile&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;docx-wrap&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;docxContainer&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">el-dialog</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ElMessage</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-plus&#x27;</span></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123; getFileType, createUrl &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils/file&#x27;</span></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> docx <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;docx-preview&#x27;</span></span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> props = defineProps&lt;&#123;</span><br><span class="language-javascript">  <span class="hljs-attr">fileObj</span>: <span class="hljs-title class_">Object</span></span><br><span class="language-javascript">&#125;&gt;()</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>(&#123;</span><br><span class="language-javascript">  <span class="hljs-attr">imgUrl</span>: <span class="hljs-string">&#x27;&#x27;</span>,</span><br><span class="language-javascript">  <span class="hljs-attr">txtUrl</span>: <span class="hljs-string">&#x27;&#x27;</span>,</span><br><span class="language-javascript">  <span class="hljs-attr">docFile</span>: <span class="hljs-literal">false</span>,</span><br><span class="language-javascript">  <span class="hljs-attr">docxFile</span>: <span class="hljs-literal">false</span>,</span><br><span class="language-javascript">  <span class="hljs-attr">docValue</span>: <span class="hljs-literal">null</span></span><br><span class="language-javascript">&#125;)</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> &#123; imgUrl, txtUrl, docxFile &#125; = <span class="hljs-title function_">toRefs</span>(state)</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> dialogVisible = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> fileTypeMap = &#123;</span><br><span class="language-javascript">  <span class="hljs-attr">xls</span>: <span class="hljs-string">&#x27;application/vnd.ms-excel&#x27;</span>,</span><br><span class="language-javascript">  <span class="hljs-attr">xlsx</span>: <span class="hljs-string">&#x27;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#x27;</span>,</span><br><span class="language-javascript">  <span class="hljs-attr">doc</span>: <span class="hljs-string">&#x27;application/msword&#x27;</span>,</span><br><span class="language-javascript">  <span class="hljs-attr">docx</span>: <span class="hljs-string">&#x27;application/vnd.openxmlformats-officedocument.wordprocessingml.document&#x27;</span>,</span><br><span class="language-javascript">  <span class="hljs-attr">pdf</span>: <span class="hljs-string">&#x27;application/pdf&#x27;</span>,</span><br><span class="language-javascript">  <span class="hljs-attr">png</span>: <span class="hljs-string">&#x27;image/png&#x27;</span>,</span><br><span class="language-javascript">  <span class="hljs-attr">jpeg</span>: <span class="hljs-string">&#x27;image/jpeg&#x27;</span>,</span><br><span class="language-javascript">  <span class="hljs-attr">jpg</span>: <span class="hljs-string">&#x27;image/jpeg&#x27;</span>,</span><br><span class="language-javascript">  <span class="hljs-attr">txt</span>: <span class="hljs-string">&#x27;text/plain&#x27;</span></span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> docxContainer = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-comment">// 查看</span></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleqaPreviewFileRaw</span> = (<span class="hljs-params"></span>) =&gt; &#123;</span><br><span class="language-javascript">  <span class="hljs-keyword">const</span> fileRaw = props.<span class="hljs-property">fileObj</span>.<span class="hljs-property">fileRaw</span></span><br><span class="language-javascript">  <span class="hljs-keyword">const</span> name = props.<span class="hljs-property">fileObj</span>.<span class="hljs-property">name</span></span><br><span class="language-javascript">  <span class="hljs-keyword">let</span> suffix = <span class="hljs-title function_">getFileType</span>(name)</span><br><span class="language-javascript">  <span class="hljs-keyword">const</span> type = fileTypeMap[suffix]</span><br><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">if</span> (suffix == <span class="hljs-string">&#x27;pdf&#x27;</span>) &#123;</span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([fileRaw], &#123; type &#125;)</span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> url = <span class="hljs-title function_">createUrl</span>(blob)</span><br><span class="language-javascript">    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(url)</span><br><span class="language-javascript">  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (suffix == <span class="hljs-string">&#x27;txt&#x27;</span>) &#123;</span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([fileRaw], &#123; type &#125;)</span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> url = <span class="hljs-title function_">createUrl</span>(blob)</span><br><span class="language-javascript">    state.<span class="hljs-property">txtUrl</span> = url</span><br><span class="language-javascript">    dialogVisible.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span></span><br><span class="language-javascript">  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (suffix == <span class="hljs-string">&#x27;docx&#x27;</span>) &#123;</span><br><span class="language-javascript">    state.<span class="hljs-property">docxFile</span> = <span class="hljs-literal">true</span></span><br><span class="language-javascript">    dialogVisible.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span></span><br><span class="language-javascript">    <span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">      docx.<span class="hljs-title function_">renderAsync</span>(fileRaw, docxContainer.<span class="hljs-property">value</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">x</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;docx: finished&#x27;</span>, x))</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript">  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (suffix == <span class="hljs-string">&#x27;png&#x27;</span> || suffix == <span class="hljs-string">&#x27;jpg&#x27;</span> || suffix == <span class="hljs-string">&#x27;jpeg&#x27;</span>) &#123;</span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> url = <span class="hljs-title function_">createUrl</span>(fileRaw)</span><br><span class="language-javascript">    state.<span class="hljs-property">imgUrl</span> = url</span><br><span class="language-javascript">    dialogVisible.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span></span><br><span class="language-javascript">  &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="language-javascript">    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">&#x27;本文件暂不支持预览，请直接下载后查看，谢谢！&#x27;</span>)</span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handlePreviewClear</span> = (<span class="hljs-params"></span>) =&gt; &#123;</span><br><span class="language-javascript">  state.<span class="hljs-property">docFile</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript">  state.<span class="hljs-property">docxFile</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript">  state.<span class="hljs-property">imgUrl</span> = <span class="hljs-string">&#x27;&#x27;</span></span><br><span class="language-javascript">  state.<span class="hljs-property">txtUrl</span> = <span class="hljs-string">&#x27;&#x27;</span></span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleCancle</span> = (<span class="hljs-params"></span>) =&gt; &#123;</span><br><span class="language-javascript">  dialogVisible.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">  dialogVisible.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript">&#125;)</span><br><span class="language-javascript"><span class="hljs-title function_">defineExpose</span>(&#123; handlePreviewClear, handleqaPreviewFileRaw &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;scss&quot;</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span><br><span class="language-css"><span class="hljs-selector-class">.preview-list</span> &#123;</span><br><span class="language-css">  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">20px</span>;</span><br><span class="language-css">  <span class="hljs-selector-class">.img-prew</span> &#123;</span><br><span class="language-css">    <span class="hljs-attribute">width</span>: <span class="hljs-number">600px</span>;</span><br><span class="language-css">    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;</span><br><span class="language-css">    <span class="hljs-selector-tag">img</span> &#123;</span><br><span class="language-css">      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;</span><br><span class="language-css">    &#125;</span><br><span class="language-css">  &#125;</span><br><span class="language-css">  <span class="hljs-selector-class">.docx-wrap</span> &#123;</span><br><span class="language-css">    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;</span><br><span class="language-css">  &#125;</span><br><span class="language-css">&#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="文件预览组件使用"><a href="#文件预览组件使用" class="headerlink" title="文件预览组件使用"></a>文件预览组件使用</h3><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;filebox&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(file, index) in detail[&#x27;attachment_info&#x27;]&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;format-file-name&quot;</span>&gt;</span>&#123;&#123; file.name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;one&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fileop&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;handlePreview(file, &#x27;tracechip&#x27;)&quot;</span>&gt;</span>查看<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">file-preview</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;fileRef&quot;</span> <span class="hljs-attr">:fileObj</span>=<span class="hljs-string">&quot;fileObj&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">file-preview</span>&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handlePreview</span> = (<span class="hljs-params">file, name: string</span>) =&gt; &#123;<br>  <span class="hljs-title function_">lookFile</span>(&#123;<br>    <span class="hljs-attr">attachment_uid</span>: file.<span class="hljs-property">uid</span>,<br>    <span class="hljs-attr">bucket_name</span>: name<br>  &#125;)<br>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>      <span class="hljs-title function_">handleqaPreviewFileRaw</span>(res.<span class="hljs-property">data</span>, file.<span class="hljs-property">name</span>)<br>    &#125;)<br>    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error)<br>    &#125;)<br>&#125;<br><br><span class="hljs-comment">// 查看</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleqaPreviewFileRaw</span> = (<span class="hljs-params">fileRaw, name</span>) =&gt; &#123;<br>  fileRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">handlePreviewClear</span>()<br>  state.<span class="hljs-property">fileObj</span>.<span class="hljs-property">fileRaw</span> = fileRaw<br>  state.<span class="hljs-property">fileObj</span>.<span class="hljs-property">name</span> = name<br>  fileRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">handleqaPreviewFileRaw</span>()<br>&#125;<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（19-2）文件上传</title>
    <link href="/2023/04/04/vue3%E7%AC%94%E8%AE%B0%EF%BC%8819-2%EF%BC%89%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    <url>/2023/04/04/vue3%E7%AC%94%E8%AE%B0%EF%BC%8819-2%EF%BC%89%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</url>
    
    <content type="html"><![CDATA[<blockquote><p>原来的项目都是直接使用el-upload组件，结果遇到个新项目一个form里面可能需要使用多个el-upload，数据多了以后显得代码臃肿。<br>本篇做一个文件上传抽取处理。</p></blockquote><span id="more"></span><h3 id="文件上传公用方法"><a href="#文件上传公用方法" class="headerlink" title="文件上传公用方法"></a>文件上传公用方法</h3><p><code>file.ts</code>中写一些公用方法</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// 获取文件后缀</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getFileType</span> = (<span class="hljs-params">name</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (name) &#123;<br>    <span class="hljs-keyword">if</span> (name.<span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-string">&#x27;.&#x27;</span>) &gt; -<span class="hljs-number">1</span>) &#123;<br>      <span class="hljs-keyword">return</span> name.<span class="hljs-title function_">slice</span>(name.<span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-string">&#x27;.&#x27;</span>) + <span class="hljs-number">1</span>)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> acceptList = [<span class="hljs-string">&#x27;.pdf&#x27;</span>,<span class="hljs-string">&#x27;.doc&#x27;</span>,<span class="hljs-string">&#x27;.docx&#x27;</span>,<span class="hljs-string">&#x27;.jpg&#x27;</span>,<span class="hljs-string">&#x27;.png&#x27;</span>,<span class="hljs-string">&#x27;.xls&#x27;</span>,<span class="hljs-string">&#x27;.xlsx&#x27;</span>]<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> suffixList = [<span class="hljs-string">&#x27;pdf&#x27;</span>, <span class="hljs-string">&#x27;doc&#x27;</span>, <span class="hljs-string">&#x27;docx&#x27;</span>, <span class="hljs-string">&#x27;jpg&#x27;</span>, <span class="hljs-string">&#x27;png&#x27;</span>, <span class="hljs-string">&#x27;xlsx&#x27;</span>, <span class="hljs-string">&#x27;xls&#x27;</span>]<br></code></pre></div></td></tr></table></figure><h3 id="文件上传组件编写"><a href="#文件上传组件编写" class="headerlink" title="文件上传组件编写"></a>文件上传组件编写</h3><p><code>uploadAttachment.vue</code>中将el-upload做一个封装，并把fileList暴露出去，这里获取的attachmentInfo是已经上传成功的文件列表（只有编辑状态下可能出现）。</p><ol><li>设置可上传文件格式，通过组件accept属性判断</li><li>设置单文件不能超过10M，通过组件绑定on-change函数判断；</li><li>设置最大可上传10个文件，通过动态控制组件limit属性和upload按钮判断；</li><li>通过设置<code>auto-upload=&quot;false&quot;</code>可实现手动上传；</li></ol><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-upload</span></span><br><span class="hljs-tag">    <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;upload&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">multiple</span></span><br><span class="hljs-tag">    <span class="hljs-attr">:auto-upload</span>=<span class="hljs-string">&quot;false&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">v-model:file-list</span>=<span class="hljs-string">&quot;fileList&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">:on-remove</span>=<span class="hljs-string">&quot;handleFileRemove&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">:on-change</span>=<span class="hljs-string">&quot;handleFileChange&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">:accept</span>=<span class="hljs-string">&quot;acceptList&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">:limit</span>=<span class="hljs-string">&quot;maxNum&quot;</span></span><br><span class="hljs-tag">  &gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">&quot;Upload&quot;</span> <span class="hljs-attr">:disabled</span>=<span class="hljs-string">&quot;maxNum - chooseNum == 0&quot;</span>&gt;</span>上传文件<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">tip</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;el-upload__tip&quot;</span>&gt;</span> 支持扩展名：.doc .docx .pdf .jpg .png .xlsx .xls<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">el-upload</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;props.attachmentInfo &amp;&amp; props.attachmentInfo.length &gt; 0&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;attachmentList&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>已上传文件如下：<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(file, idx) in props.attachmentInfo&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;idx&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">el-tooltip</span> <span class="hljs-attr">placement</span>=<span class="hljs-string">&quot;top&quot;</span> <span class="hljs-attr">:content</span>=<span class="hljs-string">&quot;file.name&quot;</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;format-file-name2&quot;</span>&gt;</span>&#123;&#123; file.name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">el-tooltip</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">text</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;danger&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;handleFileDelete(file.id)&quot;</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123; acceptList &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils/file&#x27;</span></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> props = defineProps&lt;&#123;</span><br><span class="language-javascript">  attachmentInfo?: <span class="hljs-title class_">Array</span>&lt;any&gt;</span><br><span class="language-javascript">  refName?: string</span><br><span class="language-javascript">&#125;&gt;()</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> myEmit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">&#x27;handleEmitDel&#x27;</span>])</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> fileList = <span class="hljs-title function_">ref</span>([])</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> disUpload = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-comment">// 最多上传10个文件</span></span><br><span class="language-javascript"><span class="hljs-keyword">let</span> maxNum = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">  <span class="hljs-keyword">const</span> num1 = (props.<span class="hljs-property">attachmentInfo</span> &amp;&amp; props.<span class="hljs-property">attachmentInfo</span>.<span class="hljs-property">length</span>) || <span class="hljs-number">0</span></span><br><span class="language-javascript">  <span class="hljs-keyword">return</span> <span class="hljs-number">10</span> - num1</span><br><span class="language-javascript">&#125;)</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-comment">// 已选择文件数量</span></span><br><span class="language-javascript"><span class="hljs-keyword">let</span> chooseNum = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">  <span class="hljs-keyword">const</span> num2 = (fileList.<span class="hljs-property">value</span> &amp;&amp; fileList.<span class="hljs-property">value</span>.<span class="hljs-property">length</span>) || <span class="hljs-number">0</span></span><br><span class="language-javascript">  <span class="hljs-keyword">return</span> num2</span><br><span class="language-javascript">&#125;)</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-comment">// 已选择文件删除</span></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleFileRemove</span> = (<span class="hljs-params">uploadFile, uploadFiles</span>) =&gt; &#123;</span><br><span class="language-javascript">  fileList.<span class="hljs-property">value</span> = <span class="hljs-title function_">toRaw</span>(uploadFiles)</span><br><span class="language-javascript">  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;remove   &#x27;</span>, fileList.<span class="hljs-property">value</span>)</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-comment">// 已上传文件删除-可自定义组件refName</span></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleFileDelete</span> = (<span class="hljs-params">id</span>) =&gt; &#123;</span><br><span class="language-javascript">  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">refName</span>) &#123;</span><br><span class="language-javascript">    <span class="hljs-title function_">myEmit</span>(<span class="hljs-string">&#x27;handleEmitDel&#x27;</span>, &#123; <span class="hljs-attr">id</span>: id, <span class="hljs-attr">name</span>: props.<span class="hljs-property">refName</span> &#125;)</span><br><span class="language-javascript">  &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="language-javascript">    <span class="hljs-title function_">myEmit</span>(<span class="hljs-string">&#x27;handleEmitDel&#x27;</span>, id)</span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-comment">// 文件改变时触发-判断文件大小、判断文件格式</span></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleFileChange</span> = (<span class="hljs-params">file, fileList</span>) =&gt; &#123;</span><br><span class="language-javascript">  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(file, fileList)</span><br><span class="language-javascript">  <span class="hljs-keyword">const</span> fileType = <span class="hljs-title function_">getFileType</span>(file.<span class="hljs-property">name</span>)</span><br><span class="language-javascript">  <span class="hljs-keyword">if</span> (suffixList.<span class="hljs-title function_">indexOf</span>(fileType) &lt; <span class="hljs-number">0</span>) &#123;</span><br><span class="language-javascript">    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">&#x27;文件格式不符合要求&#x27;</span>)</span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> currIdx = fileList.<span class="hljs-title function_">indexOf</span>(file)</span><br><span class="language-javascript">    fileList.<span class="hljs-title function_">splice</span>(currIdx, <span class="hljs-number">1</span>)</span><br><span class="language-javascript">    <span class="hljs-keyword">return</span></span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript">  <span class="hljs-keyword">const</span> isLt10M = file.<span class="hljs-property">size</span> / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span> &lt;= <span class="hljs-number">10</span></span><br><span class="language-javascript">  <span class="hljs-keyword">if</span> (!isLt10M) &#123;</span><br><span class="language-javascript">    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">&#x27;文件大小不能超过10M&#x27;</span>)</span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> currIdx = fileList.<span class="hljs-title function_">indexOf</span>(file)</span><br><span class="language-javascript">    fileList.<span class="hljs-title function_">splice</span>(currIdx, <span class="hljs-number">1</span>)</span><br><span class="language-javascript">    <span class="hljs-keyword">return</span></span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> &#123;&#125;)</span><br><span class="language-javascript"><span class="hljs-title function_">defineExpose</span>(&#123; fileList &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="文件上传组件使用"><a href="#文件上传组件使用" class="headerlink" title="文件上传组件使用"></a>文件上传组件使用</h3><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">upload-attachment</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:attachmentInfo</span>=<span class="hljs-string">&quot;testForm.attachment_info&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;uploadRef&quot;</span></span><br><span class="hljs-tag">  @<span class="hljs-attr">handleEmitDel</span>=<span class="hljs-string">&quot;handleEmitDel&quot;</span></span><br><span class="hljs-tag">&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">upload-attachment</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123; fdWithFiles &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils/file&#x27;</span></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> uploadAttachment <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/components/File/uploadAttachment.vue&#x27;</span></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> emyptForm = &#123;</span><br><span class="language-javascript">  <span class="hljs-attr">attachment_info</span>: []</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>(&#123;</span><br><span class="language-javascript">  <span class="hljs-attr">testForm</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(emyptForm)),</span><br><span class="language-javascript">&#125;)</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleAdd</span> = (<span class="hljs-params">formEl: <span class="hljs-keyword">typeof</span> FormInstance</span>) =&gt; &#123;</span><br><span class="language-javascript">  formEl.<span class="hljs-title function_">validate</span>(<span class="hljs-function">(<span class="hljs-params">valid: boolean</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">    <span class="hljs-keyword">if</span> (valid) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> params = &#123; ...state.<span class="hljs-property">testForm</span> &#125;</span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> fd = <span class="hljs-title function_">fdWithFiles</span>(uploadRef.<span class="hljs-property">value</span>.<span class="hljs-property">fileList</span>, params)</span><br><span class="language-javascript">      <span class="hljs-comment">// add API，传入fd</span></span><br><span class="language-javascript">    &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span></span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">  &#125;)</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleEmitDel</span> = (<span class="hljs-params">params</span>) =&gt; &#123;</span><br><span class="language-javascript">  <span class="hljs-keyword">const</span> preFiles = state.<span class="hljs-property">testForm</span>[params.<span class="hljs-property">name</span>]</span><br><span class="language-javascript">  <span class="hljs-keyword">let</span> currentFiles = []</span><br><span class="language-javascript">  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;preFiles=&#x27;</span>, preFiles)</span><br><span class="language-javascript">  preFiles.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">id</span> != params.<span class="hljs-property">id</span>) &#123;</span><br><span class="language-javascript">      currentFiles.<span class="hljs-title function_">push</span>(item)</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">  &#125;)</span><br><span class="language-javascript">  state.<span class="hljs-property">testForm</span>[params.<span class="hljs-property">name</span>] = currentFiles</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="文件上传公用方法-交互数据处理"><a href="#文件上传公用方法-交互数据处理" class="headerlink" title="文件上传公用方法-交互数据处理"></a>文件上传公用方法-交互数据处理</h3><p>和后端约定和上传文件有关的接口以formdata形式交互，在<code>/utils/file</code>中抽取数据转换方法。因为formdata可能将空字符串转为null，这里添加一层空值过滤。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// 文件files，其他参数params</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">fdWithFiles</span> = (<span class="hljs-params">fileList: <span class="hljs-built_in">Array</span>&lt;any&gt;, params: <span class="hljs-built_in">Object</span>, fileName?: string</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> fd = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>()<br>  <span class="hljs-keyword">if</span> (fileList.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) &#123;<br>    fileList.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;item.raw=&#x27;</span>, item.<span class="hljs-property">raw</span>)<br>      <span class="hljs-keyword">const</span> name = fileName ? fileName : <span class="hljs-string">&#x27;files&#x27;</span><br>      fd.<span class="hljs-title function_">append</span>(name, item.<span class="hljs-property">raw</span>)<br>    &#125;)<br>  &#125;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> params) &#123;<br>    <span class="hljs-comment">// 参数为数组，数组为空不传</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(params[key])) &#123;<br>      <span class="hljs-keyword">if</span> (params[key].<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) fd.<span class="hljs-title function_">append</span>(key, params[key])<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">// 参数为对象，对象为空不传</span><br>      <span class="hljs-keyword">if</span> (params[key]) fd.<span class="hljs-title function_">append</span>(key, params[key])<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> fd<br>&#125;<br><br><span class="hljs-comment">// 多组文件+参数 params=[&#123;fileList:[], fileName:&#x27;&#x27;&#125;]</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">fdWithMultiFiles</span> = (<span class="hljs-params">filesAll: <span class="hljs-built_in">Array</span>&lt;any&gt;, params: <span class="hljs-built_in">Object</span></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> fd = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>()<br>  filesAll.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (i.<span class="hljs-property">fileList</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) &#123;<br>      i.<span class="hljs-property">fileList</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">const</span> name = i.<span class="hljs-property">fileName</span> ? i.<span class="hljs-property">fileName</span> : <span class="hljs-string">&#x27;files&#x27;</span><br>        fd.<span class="hljs-title function_">append</span>(name, item.<span class="hljs-property">raw</span>)<br>      &#125;)<br>    &#125;<br>  &#125;)<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> params) &#123;<br>    <span class="hljs-comment">// 参数为数组</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(params[key])) &#123;<br>      <span class="hljs-keyword">if</span> (params[key].<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) fd.<span class="hljs-title function_">append</span>(key, params[key])<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">if</span> (params[key]) fd.<span class="hljs-title function_">append</span>(key, params[key])<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> fd<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="解决上传文件按钮在选取文件按钮禁用后仍可点击问题"><a href="#解决上传文件按钮在选取文件按钮禁用后仍可点击问题" class="headerlink" title="解决上传文件按钮在选取文件按钮禁用后仍可点击问题"></a>解决上传文件按钮在选取文件按钮禁用后仍可点击问题</h3><p>这个问题测试同学提出之前，我是万万没想到…<br>按照要最多可以上传10个文件，我通过maxNum - chooseNum &#x3D;&#x3D; 0来实现判断，问题是按钮已经置灰，但是居然还可以点击，出现文件选择框，虽然选了不会上传，依然影响用户体验。<br>查阅资料后，发现有个slot的改变可以防止这个现象出现，代码如下：</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"> <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">trigger</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;!(maxNum - chooseNum == 0)&quot;</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">&quot;Upload&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">:disabled</span>=<span class="hljs-string">&quot;maxNum - chooseNum == 0&quot;</span></span><br><span class="hljs-tag">  &gt;</span>上传文件<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">tip</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">disabled</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;maxNum - chooseNum == 0&quot;</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">&quot;Upload&quot;</span>&gt;</span> 上传文件<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p><code>附录</code><br><a href="https://blog.csdn.net/Oscrazy/article/details/125315916">让element-ui的el-upload组件文件列表中文件图标自定义显示</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（19-1）文件下载</title>
    <link href="/2023/04/04/vue3%E7%AC%94%E8%AE%B0%EF%BC%8819-1%EF%BC%89%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/"/>
    <url>/2023/04/04/vue3%E7%AC%94%E8%AE%B0%EF%BC%8819-1%EF%BC%89%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/</url>
    
    <content type="html"><![CDATA[<blockquote><p>文件下载方法很多，开发过程也走了几个坑，特别是部署到测试环境后，出现了本地开发不曾出现过的问题，本篇记录一下各种写法和实际问题解决。</p></blockquote><h3 id="文件格式"><a href="#文件格式" class="headerlink" title="文件格式"></a>文件格式</h3><p>后端读取文件后以流的形式传给我，从前端的角度理解就是Blob形式。<br>打开浏览器调试工具，resonpse需要携带这样的头：<br><img src="/../img/vue13-1.png" alt="response"><br>注意在请求接口里面需要添加一个<code>responseType</code></p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">downloadFile</span>(<span class="hljs-params">url: string, json: object</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">axios</span>(&#123;<br>    url,<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>    <span class="hljs-attr">data</span>: json,<br>    <span class="hljs-attr">responseType</span>: <span class="hljs-string">&quot;blob&quot;</span>,<br>  &#125;)<br>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> res)<br>    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> error);<br>&#125;<br></code></pre></div></td></tr></table></figure><span id="more"></span><h3 id="使用前端直接下载"><a href="#使用前端直接下载" class="headerlink" title="使用前端直接下载"></a>使用前端直接下载</h3><p>在表格row上绑定导出方法，并将数据传入。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Export</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../utils/export&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleExport</span> = (<span class="hljs-params">index, row</span>) =&gt; &#123;<br>  <span class="hljs-keyword">let</span> data = [];<br>  data[<span class="hljs-number">0</span>] = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-title function_">toRaw</span>(row)));<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;export&quot;</span>, data);<br>  <span class="hljs-title class_">Export</span>(data, fields, <span class="hljs-string">&quot;导出名字&quot;</span>);<br> &#125;<br></code></pre></div></td></tr></table></figure><p><code>export.ts</code>中提前配置好</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;file-saver&quot;</span>;<br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">XLSX</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;xlsx&quot;</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> (json, fields, filename = <span class="hljs-string">&quot;测试数据.xlsx&quot;</span>) =&gt; &#123;<br>  json.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> i <span class="hljs-keyword">in</span> item) &#123;<br>      <span class="hljs-keyword">if</span> (fields.<span class="hljs-title function_">hasOwnProperty</span>(i)) &#123;<br>        item[fields[i]] = item[i];<br>      &#125;<br>      <span class="hljs-keyword">delete</span> item[i]; <span class="hljs-comment">//删除原先的对象属性</span><br>    &#125;<br>  &#125;);<br><br>  <span class="hljs-keyword">const</span> sheetName = filename; <span class="hljs-comment">//excel的文件名称</span><br>  <span class="hljs-keyword">const</span> wb = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-property">utils</span>.<span class="hljs-title function_">book_new</span>(); <span class="hljs-comment">//工作簿对象包含一SheetNames数组，以及一个表对象映射表名称到表对象。XLSX.utils.book_new实用函数创建一个新的工作簿对象。</span><br>  <span class="hljs-keyword">const</span> ws = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-property">utils</span>.<span class="hljs-title function_">json_to_sheet</span>(json, &#123; <span class="hljs-attr">header</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(fields) &#125;); <span class="hljs-comment">//将JS对象数组转换为工作表。</span><br>  wb.<span class="hljs-property">SheetNames</span>.<span class="hljs-title function_">push</span>(sheetName);<br>  wb.<span class="hljs-property">Sheets</span>[sheetName] = ws;<br>  <span class="hljs-keyword">const</span> defaultCellStyle = &#123;<br>    <span class="hljs-attr">font</span>: &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Verdana&quot;</span>, <span class="hljs-attr">sz</span>: <span class="hljs-number">13</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">&quot;FF00FF88&quot;</span> &#125;,<br>    <span class="hljs-attr">fill</span>: &#123; <span class="hljs-attr">fgColor</span>: &#123; <span class="hljs-attr">rgb</span>: <span class="hljs-string">&quot;FFFFAA00&quot;</span> &#125; &#125;,<br>  &#125;; <span class="hljs-comment">//设置表格的样式</span><br>  <span class="hljs-keyword">const</span> wopts = &#123;<br>    <span class="hljs-attr">bookType</span>: <span class="hljs-string">&quot;xlsx&quot;</span>,<br>    <span class="hljs-attr">bookSST</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;binary&quot;</span>,<br>    <span class="hljs-attr">cellStyles</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">defaultCellStyle</span>: defaultCellStyle,<br>    <span class="hljs-attr">showGridLines</span>: <span class="hljs-literal">false</span>,<br>  &#125;; <span class="hljs-comment">//写入的样式</span><br>  <span class="hljs-keyword">const</span> wbout = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-title function_">write</span>(wb, wopts);<br>  <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([<span class="hljs-title function_">s2ab</span>(wbout)], &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;application/octet-stream&quot;</span> &#125;);<br>  fs.<span class="hljs-title function_">saveAs</span>(blob, filename + <span class="hljs-string">&quot;.xlsx&quot;</span>);<br>&#125;;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">s2ab</span> = (<span class="hljs-params">s</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">ArrayBuffer</span> !== <span class="hljs-string">&quot;undefined&quot;</span>) &#123;<br>    <span class="hljs-keyword">const</span> buf = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(s.<span class="hljs-property">length</span>);<br>    <span class="hljs-keyword">const</span> view = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buf);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i != s.<span class="hljs-property">length</span>; ++i) view[i] = s.<span class="hljs-title function_">charCodeAt</span>(i) &amp; <span class="hljs-number">0xff</span>;<br>    <span class="hljs-keyword">return</span> buf;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">const</span> buf = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(s.<span class="hljs-property">length</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i != s.<span class="hljs-property">length</span>; ++i) buf[i] = s.<span class="hljs-title function_">charCodeAt</span>(i) &amp; <span class="hljs-number">0xff</span>;<br>    <span class="hljs-keyword">return</span> buf;<br>  &#125;<br>&#125;;<br></code></pre></div></td></tr></table></figure><h3 id="使用后端接口获取Blob数据下载"><a href="#使用后端接口获取Blob数据下载" class="headerlink" title="使用后端接口获取Blob数据下载"></a>使用后端接口获取Blob数据下载</h3><p>文件使用Blob流表示。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleExport</span> = (<span class="hljs-params">index, row</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> ids = [];<br>  ids.<span class="hljs-title function_">push</span>(row.<span class="hljs-property">id</span>);<br>  <span class="hljs-title function_">exportBatchStandard</span>(&#123; <span class="hljs-attr">ids</span>: ids &#125;)<br>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>      <span class="hljs-title function_">fileDownloadFun</span>(res);<br>    &#125;)<br>    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;导出错误！&quot;</span>);<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error)<br>    &#125;);<br>&#125;;<br></code></pre></div></td></tr></table></figure><p><code>index.ts</code>中两种下载方式<br>方法一：使用<code>fileDownload</code>库</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// 下载文件</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">fileDownloadFun</span> = (<span class="hljs-params">res: any, name?: string</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (name) &#123;<br>    <span class="hljs-title function_">fileDownload</span>(res.<span class="hljs-property">data</span>, name)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">let</span> fileName = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">let</span> contentDisposition = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">if</span> (res.<span class="hljs-property">headers</span>[<span class="hljs-string">&#x27;content-disposition&#x27;</span>]) contentDisposition = res.<span class="hljs-property">headers</span>[<span class="hljs-string">&#x27;content-disposition&#x27;</span>]<br>    <span class="hljs-keyword">if</span> (res.<span class="hljs-property">headers</span>[<span class="hljs-string">&#x27;Content-Disposition&#x27;</span>]) contentDisposition = res.<span class="hljs-property">headers</span>[<span class="hljs-string">&#x27;Content-Disposition&#x27;</span>]<br>    <span class="hljs-keyword">const</span> result = contentDisposition.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;filename*=utf-8&#x27;&#x27;&quot;</span>)[<span class="hljs-number">1</span>]<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;result=&#x27;</span>, result)<br>    <span class="hljs-keyword">if</span> (result == <span class="hljs-literal">undefined</span>) &#123;<br>      <span class="hljs-comment">// fileName = &#x27;导出文件.xlsx&#x27;</span><br>      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;下载文件失败&#x27;</span>)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      fileName = <span class="hljs-built_in">decodeURIComponent</span>(result)<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;download=&#x27;</span>, res.<span class="hljs-property">data</span>, <span class="hljs-string">&#x27;file=&#x27;</span>, fileName)<br>      <span class="hljs-title function_">fileDownload</span>(res.<span class="hljs-property">data</span>, fileName)<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>方法二：使用<a>标签</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">download</span> = (<span class="hljs-params">res: any, name?: string</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> data = res.<span class="hljs-property">data</span>;<br>  <span class="hljs-keyword">if</span> (!res.<span class="hljs-property">data</span>) &#123;<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-comment">// 设置下载文件名称，使用正则取出名称</span><br>  <span class="hljs-keyword">const</span> pat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">&quot;(?&lt;=filename=).*&quot;</span>);<br>  <span class="hljs-keyword">let</span> contentDisposition = <span class="hljs-string">&quot;&quot;</span>;<br>  <span class="hljs-comment">//浏览器问题可能会出现 content-disposition 匹配不到</span><br>  <span class="hljs-keyword">if</span> (res.<span class="hljs-property">headers</span>[<span class="hljs-string">&quot;content-disposition&quot;</span>])<br>    contentDisposition = res.<span class="hljs-property">headers</span>[<span class="hljs-string">&quot;content-disposition&quot;</span>];<br>  <span class="hljs-keyword">if</span> (res.<span class="hljs-property">headers</span>[<span class="hljs-string">&quot;Content-Disposition&quot;</span>])<br>    contentDisposition = res.<span class="hljs-property">headers</span>[<span class="hljs-string">&quot;Content-Disposition&quot;</span>];<br>  <span class="hljs-keyword">const</span> result = pat.<span class="hljs-title function_">exec</span>(contentDisposition);<br>  <span class="hljs-keyword">let</span> fileName = result &amp;&amp; result[<span class="hljs-number">0</span>];<br>  <span class="hljs-keyword">if</span> (fileName == <span class="hljs-literal">undefined</span>) &#123;<br>    fileName = name;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    fileName = <span class="hljs-built_in">decodeURIComponent</span>(fileName);<br>  &#125;<br>  <span class="hljs-keyword">const</span> url = <span class="hljs-variable language_">window</span>.<span class="hljs-property">URL</span>.<span class="hljs-title function_">createObjectURL</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([data]));<br>  <span class="hljs-keyword">const</span> link = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;a&quot;</span>);<br>  link.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">&quot;none&quot;</span>;<br>  link.<span class="hljs-property">href</span> = url;<br>  link.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&quot;download&quot;</span>, fileName);<br>  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(link);<br>  link.<span class="hljs-title function_">click</span>();<br>&#125;;<br></code></pre></div></td></tr></table></figure><p>注意：</p><ol><li>一定要让后端添加暴露header的字段，不然前端可能获取不到<code>content-disposition</code>（本地环境代理没问题，提交到线上环境出现了问题）</li><li>约定好formdata格式，前端可能需要添加hearder（根据框架封装程度而定）<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">response.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&quot;Access-Control-Expose-Headers&quot;</span>, <span class="hljs-string">&quot;Content-Disposition&quot;</span>)<br>response.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&quot;Content-Disposition&quot;</span>, ...)<br></code></pre></div></td></tr></table></figure></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（18-2）vite首次打开界面加载慢问题</title>
    <link href="/2023/03/19/vue3%E7%AC%94%E8%AE%B0%EF%BC%8818-2%EF%BC%89vite%E9%A6%96%E6%AC%A1%E6%89%93%E5%BC%80%E7%95%8C%E9%9D%A2%E5%8A%A0%E8%BD%BD%E6%85%A2%E9%97%AE%E9%A2%98/"/>
    <url>/2023/03/19/vue3%E7%AC%94%E8%AE%B0%EF%BC%8818-2%EF%BC%89vite%E9%A6%96%E6%AC%A1%E6%89%93%E5%BC%80%E7%95%8C%E9%9D%A2%E5%8A%A0%E8%BD%BD%E6%85%A2%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<blockquote><p>项目改用vite之后，启动确实特别快，但是首次打开界面加载慢的我想去刷一会儿微博（开玩笑）…<br>本篇记录我在熟悉项目之后对项目构建做的一些优化尝试。</p></blockquote><span id="more"></span><h3 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h3><ol><li>vite开发环境下，模块以原生 ESModule 的形式（es6原生的模块加载机制）被浏览器加载；</li><li>vite没有对代码进行打包压缩处理，所以服务启动很快；下载的文件是没有被处理过的源码，所以要比webpack处理过的文件大很多；</li><li>项目启动后浏览器第一次加载才会慢；慢的主要原因是vite需要动态的解析依赖，并打包，引入；</li></ol><h3 id="浏览器调试工具waterfall"><a href="#浏览器调试工具waterfall" class="headerlink" title="浏览器调试工具waterfall"></a>浏览器调试工具waterfall</h3><p>waterfall性能检测详解详解:<br>Queueing：排队<br>Stalled：阻塞。请求访问该URL的主机是有并发和连接数限制，必须要等之前的执行完成才能执行之后的，stalled代表这段时间的耗时<br>DNS Lookup:域名解析所耗时间<br>Initial connection:初始化连接时间。这里一般是TCP 3次连接握手时间<br>SSL：https特有，是一种协议<br>Request sent：发送请求所消耗的时间<br>Waiting：等待响应时间（这里一般是最耗时的）<br>Content Download：下载内容所需要消耗的时间</p><h3 id="vite首次加载慢的原因"><a href="#vite首次加载慢的原因" class="headerlink" title="vite首次加载慢的原因"></a>vite首次加载慢的原因</h3><p>在查看waterfall之后，发现首次加载中Waiting阶段时间耗费较长，等待响应时间就是vite在编译的时间。</p><h3 id="解决方案一（未成功）"><a href="#解决方案一（未成功）" class="headerlink" title="解决方案一（未成功）"></a>解决方案一（未成功）</h3><p>这个方案是网上查阅资料后基本统一的解决方法，但是尝试后发现在vite4中并不适用，特别是推荐的安装的两个包，安装也没有成功，所以方案一仅仅是做一个记录。<br>在<code>vite.config.ts</code>中添加配置</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">&#123;<br>   <span class="hljs-attr">optimizeDeps</span>: &#123;<br>      <span class="hljs-attr">include</span>: [<br>        <span class="hljs-string">&#x27;vue&#x27;</span>,<br>        <span class="hljs-string">&#x27;map-factory&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/form/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/radio-group/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/radio/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/checkbox/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/checkbox-group/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/switch/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/time-picker/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/date-picker/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/col/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/form-item/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/alert/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/breadcrumb/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/select/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/input/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/breadcrumb-item/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/tag/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/pagination/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/table/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/table-column/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/card/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/row/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/button/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/menu/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/sub-menu/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/menu-item/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/option/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;@element-plus/icons-vue&#x27;</span>,<br>        <span class="hljs-string">&#x27;pinia&#x27;</span>,<br>        <span class="hljs-string">&#x27;axios&#x27;</span>,<br>        <span class="hljs-string">&#x27;vue-request&#x27;</span>,<br>        <span class="hljs-string">&#x27;vue-router&#x27;</span>,<br>        <span class="hljs-string">&#x27;@vueuse/core&#x27;</span>,<br>      ],<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>使用插件来进行上面一段的插入</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm i -D vite-plugin-optimize-persist vite-plugin-package-config<br></code></pre></div></td></tr></table></figure><p><img src="/../img/vue18-1.png" alt="包引入失败"><br>git主页有这句话<code>You no longer need this plugin since Vite 2.9.1</code></p><h3 id="解决方案二（待调研…）"><a href="#解决方案二（待调研…）" class="headerlink" title="解决方案二（待调研…）"></a>解决方案二（待调研…）</h3><p><code>附录</code><br><a href="https://cn.vitejs.dev/guide/">Vite官方文档</a><br><a href="https://blog.csdn.net/pzy_666/article/details/123017630">vite首次打开界面加载慢问题&#x2F;解决</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（18-2）vite首次打开界面加载慢问题</title>
    <link href="/2023/03/18/vue3%E7%AC%94%E8%AE%B0%EF%BC%8818%EF%BC%89vite%E9%A6%96%E6%AC%A1%E6%89%93%E5%BC%80%E7%95%8C%E9%9D%A2%E5%8A%A0%E8%BD%BD%E6%85%A2%E9%97%AE%E9%A2%98/"/>
    <url>/2023/03/18/vue3%E7%AC%94%E8%AE%B0%EF%BC%8818%EF%BC%89vite%E9%A6%96%E6%AC%A1%E6%89%93%E5%BC%80%E7%95%8C%E9%9D%A2%E5%8A%A0%E8%BD%BD%E6%85%A2%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<blockquote><p>项目改用vite之后，启动确实特别快，但是首次打开界面加载慢的我想去刷一会儿微博（开玩笑）…<br>本篇记录我在熟悉项目之后对项目构建做的一些优化尝试。</p></blockquote><span id="more"></span><h3 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h3><ol><li>vite开发环境下，模块以原生 ESModule 的形式（es6原生的模块加载机制）被浏览器加载；</li><li>vite没有对代码进行打包压缩处理，所以服务启动很快；下载的文件是没有被处理过的源码，所以要比webpack处理过的文件大很多；</li><li>项目启动后浏览器第一次加载才会慢；慢的主要原因是vite需要动态的解析依赖，并打包，引入；</li></ol><h3 id="浏览器调试工具waterfall"><a href="#浏览器调试工具waterfall" class="headerlink" title="浏览器调试工具waterfall"></a>浏览器调试工具waterfall</h3><p>waterfall性能检测详解详解:<br>Queueing：排队<br>Stalled：阻塞。请求访问该URL的主机是有并发和连接数限制，必须要等之前的执行完成才能执行之后的，stalled代表这段时间的耗时<br>DNS Lookup:域名解析所耗时间<br>Initial connection:初始化连接时间。这里一般是TCP 3次连接握手时间<br>SSL：https特有，是一种协议<br>Request sent：发送请求所消耗的时间<br>Waiting：等待响应时间（这里一般是最耗时的）<br>Content Download：下载内容所需要消耗的时间</p><h3 id="vite首次加载慢的原因"><a href="#vite首次加载慢的原因" class="headerlink" title="vite首次加载慢的原因"></a>vite首次加载慢的原因</h3><p>在查看waterfall之后，发现首次加载中Waiting阶段时间耗费较长，等待响应时间就是vite在编译的时间。</p><h3 id="解决方案一（未成功）"><a href="#解决方案一（未成功）" class="headerlink" title="解决方案一（未成功）"></a>解决方案一（未成功）</h3><p>这个方案是网上查阅资料后基本统一的解决方法，但是尝试后发现在vite4中并不适用，特别是推荐的安装的两个包，安装也没有成功，所以方案一仅仅是做一个记录。<br>在<code>vite.config.ts</code>中添加配置</p><figure class="highlight javascript"><table><tr><td class="gutter hljs hljs hljs hljs hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">&#123;<br>   <span class="hljs-attr">optimizeDeps</span>: &#123;<br>      <span class="hljs-attr">include</span>: [<br>        <span class="hljs-string">&#x27;vue&#x27;</span>,<br>        <span class="hljs-string">&#x27;map-factory&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/form/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/radio-group/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/radio/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/checkbox/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/checkbox-group/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/switch/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/time-picker/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/date-picker/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/col/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/form-item/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/alert/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/breadcrumb/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/select/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/input/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/breadcrumb-item/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/tag/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/pagination/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/table/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/table-column/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/card/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/row/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/button/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/menu/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/sub-menu/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/menu-item/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;element-plus/es/components/option/style/index&#x27;</span>,<br>        <span class="hljs-string">&#x27;@element-plus/icons-vue&#x27;</span>,<br>        <span class="hljs-string">&#x27;pinia&#x27;</span>,<br>        <span class="hljs-string">&#x27;axios&#x27;</span>,<br>        <span class="hljs-string">&#x27;vue-request&#x27;</span>,<br>        <span class="hljs-string">&#x27;vue-router&#x27;</span>,<br>        <span class="hljs-string">&#x27;@vueuse/core&#x27;</span>,<br>      ],<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>使用插件来进行上面一段的插入</p><figure class="highlight shell"><table><tr><td class="gutter hljs hljs hljs hljs hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm i -D vite-plugin-optimize-persist vite-plugin-package-config<br></code></pre></div></td></tr></table></figure><p><code>附录</code><br><a href="https://cn.vitejs.dev/guide/">Vite官方文档</a><br><a href="https://blog.csdn.net/pzy_666/article/details/123017630">vite首次打开界面加载慢问题&#x2F;解决</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（18-1）使用vite进行前端构建</title>
    <link href="/2023/03/16/vue3%E7%AC%94%E8%AE%B0%EF%BC%8818-1%EF%BC%89%E4%BD%BF%E7%94%A8vite%E8%BF%9B%E8%A1%8C%E5%89%8D%E7%AB%AF%E6%9E%84%E5%BB%BA/"/>
    <url>/2023/03/16/vue3%E7%AC%94%E8%AE%B0%EF%BC%8818-1%EF%BC%89%E4%BD%BF%E7%94%A8vite%E8%BF%9B%E8%A1%8C%E5%89%8D%E7%AB%AF%E6%9E%84%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<blockquote><p>之前的项目大多使用vue-cli搭建，感觉打包时间略长，随着项目体积增大，协作人数增加，尝试使用vite重新进行构建，并建立前端规范。</p></blockquote><span id="more"></span><h3 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h3><ol><li>开箱即用，API高度可扩展性</li><li>MHR速度快</li><li>一套构建指令，使用Rollup打包代码，预配置，输出高度优化的静态资源</li></ol><h3 id="项目初始化"><a href="#项目初始化" class="headerlink" title="项目初始化"></a>项目初始化</h3><p>使用vite创建项目，并根据需求选择相应配置：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm create vite@latest<br></code></pre></div></td></tr></table></figure><h3 id="实践中已使用的配置"><a href="#实践中已使用的配置" class="headerlink" title="实践中已使用的配置"></a>实践中已使用的配置</h3><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; defineConfig &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite&#x27;</span><br><span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@vitejs/plugin-vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">VueJsx</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@vitejs/plugin-vue-jsx&#x27;</span><br><span class="hljs-keyword">import</span> &#123; resolve &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;path&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">EslintPlugin</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite-plugin-eslint&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">AutoImport</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;unplugin-auto-import/vite&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">DefineOptions</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;unplugin-vue-define-options/vite&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Components</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;unplugin-vue-components/vite&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ElementPlusResolver</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;unplugin-vue-components/resolvers&#x27;</span><br><span class="hljs-keyword">import</span> &#123; createStyleImportPlugin, <span class="hljs-title class_">ElementPlusResolve</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite-plugin-style-import&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(&#123;<br>  <span class="hljs-attr">plugins</span>: [<br>    <span class="hljs-title function_">vue</span>(),<br>    <span class="hljs-title class_">VueJsx</span>(),<br>    <span class="hljs-title class_">Components</span>(&#123;<br>      <span class="hljs-comment">// 要搜索组件的目录的相对路径</span><br>      <span class="hljs-attr">dirs</span>: [<span class="hljs-string">&#x27;src/components&#x27;</span>],<br>      <span class="hljs-attr">extensions</span>: [<span class="hljs-string">&#x27;vue&#x27;</span>],<br>      <span class="hljs-comment">// 搜索子目录</span><br>      <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span>,<br>      <span class="hljs-comment">// 生成自定义 `auto-components.d.ts` 全局声明</span><br>      <span class="hljs-attr">dts</span>: <span class="hljs-string">&#x27;src/types/auto-components.d.ts&#x27;</span>,<br>      <span class="hljs-attr">include</span>: [<span class="hljs-regexp">/\.[tj]sx?$/</span>,  <span class="hljs-regexp">/\.vue$/</span>, <span class="hljs-regexp">/\.vue\?vue/</span>],<br>      <span class="hljs-comment">// 自定义组件的解析器</span><br>      <span class="hljs-attr">resolvers</span>: [<span class="hljs-title class_">ElementPlusResolver</span>()],<br>      <span class="hljs-attr">exclude</span>: [<span class="hljs-regexp">/[\\/]node_modules[\\/]/</span>]<br>    &#125;),<br>    <span class="hljs-title class_">AutoImport</span>(&#123;<br>      <span class="hljs-comment">// 生成自定义 `auto-components.d.ts` 全局声明</span><br>      <span class="hljs-attr">dts</span>: <span class="hljs-string">&#x27;src/types/auto-imports.d.ts&#x27;</span>,<br>      <span class="hljs-attr">include</span>: [<span class="hljs-regexp">/\.[tj]sx?$/</span>, <span class="hljs-regexp">/\.vue$/</span>],<br>      <span class="hljs-comment">// 自动引入的api从这里找</span><br>      <span class="hljs-attr">imports</span>: [<span class="hljs-string">&#x27;vue&#x27;</span>, <span class="hljs-string">&#x27;vue-router&#x27;</span>],<br>      <span class="hljs-attr">resolvers</span>: [<br>        <span class="hljs-title class_">ElementPlusResolver</span>() <span class="hljs-comment">// 自动导入Element-Plus的Api</span><br>      ],<br>      <span class="hljs-attr">eslintrc</span>: &#123;<br>        <span class="hljs-attr">enabled</span>: <span class="hljs-literal">false</span>,<br>        <span class="hljs-attr">filepath</span>: <span class="hljs-string">&#x27;./.eslintrc-auto-import.json&#x27;</span>,<br>        <span class="hljs-attr">globalsPropValue</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// Default `true`, (true | false | &#x27;readonly&#x27; | &#x27;readable&#x27; | &#x27;writable&#x27; | &#x27;writeable&#x27;)</span><br>      &#125;<br>    &#125;),<br>    <span class="hljs-title function_">createStyleImportPlugin</span>(&#123;<br>      <span class="hljs-attr">resolves</span>: [<span class="hljs-title class_">ElementPlusResolve</span>()],<br>      <span class="hljs-attr">libs</span>: [&#123;<br>        <span class="hljs-attr">libraryName</span>: <span class="hljs-string">&#x27;element-plus&#x27;</span>,<br>        <span class="hljs-attr">esModule</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">resolveStyle</span>: <span class="hljs-function">(<span class="hljs-params">name</span>) =&gt;</span> &#123;<br>          <span class="hljs-keyword">return</span> <span class="hljs-string">`element-plus/es/components/<span class="hljs-subst">$&#123;name.substring(<span class="hljs-number">3</span>)&#125;</span>/style/css`</span><br>        &#125;<br>      &#125;]<br>    &#125;),<br>    <span class="hljs-title class_">EslintPlugin</span>(&#123;<br>      <span class="hljs-attr">cache</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-attr">include</span>: [<span class="hljs-string">&#x27;src/**/*.vue&#x27;</span>, <span class="hljs-string">&#x27;src/**/*.ts&#x27;</span>, <span class="hljs-string">&#x27;src/**/*.tsx&#x27;</span>] <span class="hljs-comment">// 检查的文件</span><br>    &#125;),<br>    <span class="hljs-title class_">DefineOptions</span>()<br>  ],<br>  <span class="hljs-attr">css</span>: &#123;<br>    <span class="hljs-attr">preprocessorOptions</span>: &#123;<br>        <span class="hljs-attr">scss</span>: &#123;<br>            <span class="hljs-attr">additionalData</span>: <span class="hljs-string">`@use &quot;@/assets/scss/index.scss&quot;;`</span><br>        &#125;<br>    &#125;<br>  &#125;,<br>  <span class="hljs-attr">resolve</span>: &#123;<br>    <span class="hljs-attr">alias</span>: &#123;<br>      <span class="hljs-string">&#x27;@&#x27;</span>: <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;./src&#x27;</span>)<br>    &#125;<br>  &#125;,<br>  <span class="hljs-attr">build</span>: &#123;<br>    <span class="hljs-attr">minify</span>: <span class="hljs-string">&#x27;terser&#x27;</span>,<br>    <span class="hljs-attr">outDir</span>: <span class="hljs-string">&#x27;dist&#x27;</span>,<br>    <span class="hljs-attr">sourcemap</span>: <span class="hljs-string">&#x27;inline&#x27;</span>,<br>    <span class="hljs-attr">terserOptions</span>: &#123;<br>      <span class="hljs-attr">compress</span>: &#123;<br>        <span class="hljs-attr">drop_debugger</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">drop_console</span>: <span class="hljs-literal">false</span><br>      &#125;<br>    &#125;<br>  &#125;,<br>  <span class="hljs-attr">server</span>: &#123;<br>    <span class="hljs-attr">host</span>: <span class="hljs-string">&#x27;localhost&#x27;</span>,<br>    <span class="hljs-attr">port</span>: <span class="hljs-number">8080</span>,<br>    <span class="hljs-attr">open</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">//配置浏览器自动访问</span><br>    <span class="hljs-attr">headers</span>: &#123;<br>      <span class="hljs-string">&#x27;Access-Control-Allow-Origin&#x27;</span>: <span class="hljs-string">&#x27;*&#x27;</span><br>    &#125;,<br>    <span class="hljs-attr">proxy</span>: &#123;<br>      <span class="hljs-string">&#x27;/api&#x27;</span>: &#123;<br>        <span class="hljs-attr">target</span>: <span class="hljs-string">&#x27;http://&#x27;</span>,<br>        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">secure</span>: <span class="hljs-literal">false</span>,<br>        <span class="hljs-attr">rewrite</span>: <span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> path.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^\/api/</span>, <span class="hljs-string">&#x27;api&#x27;</span>)<br>      &#125;<br>    &#125;,<br>    <span class="hljs-attr">hmr</span>: <span class="hljs-literal">true</span>,<br>  &#125;<br>&#125;)<br></code></pre></div></td></tr></table></figure><p><code>附录</code><br><a href="https://cn.vitejs.dev/guide/">Vite官方文档</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（17-2）el-select组件封装</title>
    <link href="/2023/03/10/vue3%E7%AC%94%E8%AE%B0%EF%BC%8817-2%EF%BC%89el-select%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85/"/>
    <url>/2023/03/10/vue3%E7%AC%94%E8%AE%B0%EF%BC%8817-2%EF%BC%89el-select%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本篇接上一篇，将el-select封装成组件</p></blockquote><span id="more"></span><h3 id="子组件"><a href="#子组件" class="headerlink" title="子组件"></a>子组件</h3><p>使用 filter-method 进行前端本地搜索</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-select</span></span><br><span class="hljs-tag">    <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;selectedArr&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">multiple</span></span><br><span class="hljs-tag">    <span class="hljs-attr">filterable</span></span><br><span class="hljs-tag">    <span class="hljs-attr">:filter-method</span>=<span class="hljs-string">&quot;dataFilter&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">default-first-option</span></span><br><span class="hljs-tag">    <span class="hljs-attr">:placeholder</span>=<span class="hljs-string">&quot;text&quot;</span></span><br><span class="hljs-tag">  &gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-option</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;item in optionList&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;item.id&quot;</span> <span class="hljs-attr">:label</span>=<span class="hljs-string">&quot;item.name&quot;</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">&quot;item.name&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span></span><br><span class="hljs-tag">      <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;query.p * query.pageSize &lt; optionTotal &amp;&amp; showLoadMore&quot;</span></span><br><span class="hljs-tag">      @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;loadmore&quot;</span></span><br><span class="hljs-tag">      <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;load-more&quot;</span></span><br><span class="hljs-tag">    &gt;</span><br>      点击加载更多<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">el-select</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>text 表示输入框默认提示；optionAll 代表列表所有可选项，为了和业务解耦，从父组件中获取；optionTotal表示所有可选项的数量，如果父组件直接从接口获取到值，则直接传递给子组件。<br>这里要注意的是：</p><ol><li>vue3 setup 使用 defineEmits 语法糖，需要先注册再引用；</li><li>v-model是一个语法糖，等于:value+@input，所以这里使用 emit(‘input’) 来实现数据双向绑定；<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> props = defineProps&lt;&#123;<br>  <span class="hljs-attr">text</span>: string<br>  <span class="hljs-attr">optionAll</span>: <span class="hljs-title class_">Array</span>&lt;any&gt;<br>  optionTotal?: number<br>&#125;&gt;()<br><br><span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>(&#123;<br>  <span class="hljs-attr">optionList</span>: [],<br>  <span class="hljs-attr">showLoadMore</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">selectedArr</span>: [],<br>  <span class="hljs-attr">query</span>: &#123; <span class="hljs-attr">p</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">pageSize</span>: <span class="hljs-number">10</span> &#125;<br>&#125;)<br><span class="hljs-keyword">const</span> &#123; optionList, showLoadMore, selectedArr, query &#125; = <span class="hljs-title function_">toRefs</span>(state)<br><br><span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">&#x27;input&#x27;</span>])<br><span class="hljs-title function_">watch</span>(state.<span class="hljs-property">selectedArr</span>, <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> &#123;<br>  <span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;input&#x27;</span>, val)<br>&#125;)<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">loadmore</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  state.<span class="hljs-property">query</span>.<span class="hljs-property">p</span>++<br>  <span class="hljs-title function_">getItems</span>() <span class="hljs-comment">//类似于分页查询</span><br>&#125;<br><br><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">getItems</span>(<span class="hljs-number">1</span>)<br>&#125;)<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">dataFilter</span> = (<span class="hljs-params">val</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (val) &#123;<br>    state.<span class="hljs-property">optionList</span> = props.<span class="hljs-property">optionAll</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (item &amp;&amp; !!~item.<span class="hljs-property">name</span>.<span class="hljs-title function_">indexOf</span>(val)) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>      &#125;<br>    &#125;)<br>    showLoadMore.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span><br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_">getItems</span>(<span class="hljs-number">1</span>)<br>    showLoadMore.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span><br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">getItems</span> = (<span class="hljs-params">flag?: number</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (flag) &#123;<br>    state.<span class="hljs-property">query</span>.<span class="hljs-property">p</span> = flag<br>  &#125;<br>  <span class="hljs-keyword">let</span> num = ~~state.<span class="hljs-property">query</span>.<span class="hljs-property">p</span> * ~~state.<span class="hljs-property">query</span>.<span class="hljs-property">pageSize</span><br>  state.<span class="hljs-property">optionList</span> = props.<span class="hljs-property">optionAll</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item, index, arr</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (item) &#123;<br>      <span class="hljs-keyword">return</span> index &lt; num<br>    &#125;<br>  &#125;)<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="父组件调用"><a href="#父组件调用" class="headerlink" title="父组件调用"></a>父组件调用</h3></li></ol><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">tree-select</span></span><br><span class="hljs-tag">  <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;roleForm.users&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">text</span>=<span class="hljs-string">&quot;请选择包含的用户&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:optionAll</span>=<span class="hljs-string">&quot;userListAll&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:optionTotal</span>=<span class="hljs-string">&quot;userTotal&quot;</span></span><br><span class="hljs-tag">&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tree-select</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p><code>html</code></p><p><code>javascript</code><br><code>javascript</code><br><code>javascript</code></p>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（17-1）el-select搜索</title>
    <link href="/2023/03/10/vue3%E7%AC%94%E8%AE%B0%EF%BC%8817-1%EF%BC%89el-select%E6%90%9C%E7%B4%A2/"/>
    <url>/2023/03/10/vue3%E7%AC%94%E8%AE%B0%EF%BC%8817-1%EF%BC%89el-select%E6%90%9C%E7%B4%A2/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本篇记录el-select一般搜索和远程搜索。</p></blockquote><span id="more"></span><h3 id="搜索基础用法"><a href="#搜索基础用法" class="headerlink" title="搜索基础用法"></a>搜索基础用法</h3><p>添加<code>filterable</code>关键字即可实现过滤（也可理解为组件自带的本地搜索），注意：只有添加了该关键词才能输入。<code>multiple</code> 用于实现多选。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-select</span></span><br><span class="hljs-tag">    <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;roleForm.users&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">multiple</span></span><br><span class="hljs-tag">    <span class="hljs-attr">filterable</span></span><br><span class="hljs-tag">  &gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-option</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;item in userList&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;item.id&quot;</span> <span class="hljs-attr">:label</span>=<span class="hljs-string">&quot;item.name&quot;</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">&quot;item.id&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-select</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="远程搜索"><a href="#远程搜索" class="headerlink" title="远程搜索"></a>远程搜索</h3><p>远程搜索添加<code>remote</code>关键字，使用<code>remote-method</code>添加搜索方法，默认传参为输入值，通过输入值进行搜索。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-select</span></span><br><span class="hljs-tag">  <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;roleForm.users&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">multiple</span></span><br><span class="hljs-tag">  <span class="hljs-attr">filterable</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:loading</span>=<span class="hljs-string">&quot;loading&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">remote</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:remote-method</span>=<span class="hljs-string">&quot;remoteMethod&quot;</span></span><br><span class="hljs-tag">&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">getDataUser</span> = (<span class="hljs-params">data?: any</span>) =&gt; &#123;<br>  <span class="hljs-keyword">let</span> params = data || &#123;&#125;<br>  <span class="hljs-title function_">getUsers</span>(params)<br>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">const</span> &#123; data, data2, status, msg &#125; = res<br>      <span class="hljs-keyword">if</span> (status == <span class="hljs-string">&#x27;ok&#x27;</span>) &#123;<br>        state.<span class="hljs-property">userList</span> = data<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(msg)<br>      &#125;<br>    &#125;)<br>    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error)<br>    &#125;)<br>&#125;<br><br><span class="hljs-keyword">const</span> loading = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">remoteMethod</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">query: string</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (query) &#123;<br>    loading.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span><br>    <span class="hljs-keyword">await</span> <span class="hljs-title function_">getDataUser</span>(&#123; <span class="hljs-attr">name</span>: query, <span class="hljs-attr">p</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">pageSize</span>: <span class="hljs-number">10</span> &#125;)<br>    loading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span><br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">await</span> <span class="hljs-title function_">getDataUser</span>(&#123; <span class="hljs-attr">p</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">pageSize</span>: <span class="hljs-number">10</span> &#125;)<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="远程获取所有数据，前端实现本地搜索"><a href="#远程获取所有数据，前端实现本地搜索" class="headerlink" title="远程获取所有数据，前端实现本地搜索"></a>远程获取所有数据，前端实现本地搜索</h3><p><code>default-first-option</code> 属性表示在输入框按下回车，选择第一个匹配项，配合 filterable 使用；<code>filter-method</code> 用户过滤方法。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-select</span></span><br><span class="hljs-tag">    <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;roleForm.users&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">multiple</span></span><br><span class="hljs-tag">    <span class="hljs-attr">filterable</span></span><br><span class="hljs-tag">    <span class="hljs-attr">:filter-method</span>=<span class="hljs-string">&quot;dataFilter&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">default-first-option</span></span><br><span class="hljs-tag">  &gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-option</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;item in userList&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;item.id&quot;</span> <span class="hljs-attr">:label</span>=<span class="hljs-string">&quot;item.name&quot;</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">&quot;item.id&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-select</span>&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// 初始化时state.userListAll存储所有用户信息</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">dataFilter</span> = (<span class="hljs-params">val</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (val) &#123; <span class="hljs-comment">// 搜索框有值，本地过滤所有name含有相同字符的选项</span><br>    state.<span class="hljs-property">userList</span> = state.<span class="hljs-property">userListAll</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (item &amp;&amp; !!~item.<span class="hljs-property">name</span>.<span class="hljs-title function_">indexOf</span>(val)) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>      &#125;<br>    &#125;)<br>  &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// 搜索框为空，默认获取列表前十个选项</span><br>    <span class="hljs-title function_">getItems</span>(<span class="hljs-number">1</span>)<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">getItems</span> = (<span class="hljs-params">flag?: number</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (flag) &#123;<br>    dataList.<span class="hljs-property">user</span>.<span class="hljs-property">p</span> = flag<br>  &#125;<br>  <span class="hljs-keyword">let</span> num = ~~dataList.<span class="hljs-property">user</span>.<span class="hljs-property">p</span> * ~~dataList.<span class="hljs-property">user</span>.<span class="hljs-property">pageSize</span><br>  state.<span class="hljs-property">userList</span> = state.<span class="hljs-property">userListAll</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item, index, arr</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (item) &#123;<br>      <span class="hljs-keyword">return</span> index &lt; num<br>    &#125;<br>  &#125;)<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="懒加载"><a href="#懒加载" class="headerlink" title="懒加载"></a>懒加载</h3><p>如果初始化数据过多，可能会造成页面卡顿，这里尝试懒加载</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-select</span></span><br><span class="hljs-tag">  <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;roleForm.users&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">multiple</span></span><br><span class="hljs-tag">  <span class="hljs-attr">filterable</span></span><br><span class="hljs-tag">  <span class="hljs-attr">v-loadmore</span>=<span class="hljs-string">&quot;loadmore&quot;</span></span><br><span class="hljs-tag">&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-option</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;item in userList&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;item.id&quot;</span> <span class="hljs-attr">:label</span>=<span class="hljs-string">&quot;item.name&quot;</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">&quot;item.id&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-select</span>&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> vLoadmore = &#123;<br>  <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) &#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">SELECTWRAP_DOM</span> = el.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.el-select-dropdown .el-select-dropdown__wrap&#x27;</span>)<br>    <span class="hljs-variable constant_">SELECTWRAP_DOM</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;scroll&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-keyword">const</span> condition = <span class="hljs-variable language_">this</span>.<span class="hljs-property">scrollHeight</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">scrollTop</span> &lt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">clientHeight</span><br>      <span class="hljs-keyword">if</span> (condition) &#123;<br>        binding.<span class="hljs-title function_">value</span>()<br>      &#125;<br>    &#125;)<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">loadmore</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  dataList.<span class="hljs-property">user</span>.<span class="hljs-property">p</span>++<br>  <span class="hljs-title function_">getItems</span>() <span class="hljs-comment">//类似于分页查询</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>运行时控制台报错了！<br><img src="/../img/vue17-3.png" alt="loadmore error"><br>经过检查，发现是没有找到DOM，猜测方法执行时DOM渲染还没有完成。<br>因为这个组件是在 dialog 中初始化，猜测可能是 v-if 导致，先尝试将组件移除 dialog 来测试，结果还是报错。。。<br>再尝试在组件 <code>onMounted</code> 时给 <code>loadmore</code> 赋值，想法完全错误！指令不能这么写，必须写一个全局常量。自定义指令自身的 <code>mounted</code> 已经代表了在挂载的组件渲染完成之后执行。<br>接着打印 el 的值，发现 el-select 节点中没有 el-select-dropdown …查阅很多资料，大家好像都没遇到这个问题？？？</p><h3 id="点击加载更多"><a href="#点击加载更多" class="headerlink" title="点击加载更多"></a>点击加载更多</h3><p>没办法，手写一个点击加载更多！放在 el-option 下方：</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-option</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;item in userList&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;item.id&quot;</span> <span class="hljs-attr">:label</span>=<span class="hljs-string">&quot;item.name&quot;</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">&quot;item.id&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;user.p * user.pageSize &lt; userTotal&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;loadmore&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;load-more&quot;</span>&gt;</span><br>  点击加载更多<br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p><img src="/../img/vue17-4.png" alt="点击加载更多"></p><h3 id="防抖节流"><a href="#防抖节流" class="headerlink" title="防抖节流"></a>防抖节流</h3><p>防抖: n 秒后在执行该事件，若在 n 秒内被重复触发，则重新计时<br>节流: n 秒内只运行一次，若在 n 秒内重复触发，只有一次生效</p><p>防抖debounce在连续的事件，只需触发一次回调的场景有：</p><ol><li>搜索框搜索输入。只需用户最后一次输入完，再发送请求</li><li>手机号、邮箱验证输入检测</li><li>窗口大小resize。只需窗口调整完成后，计算窗口大小。防止重复渲染。</li></ol><p>节流throttle在间隔一段时间执行一次回调的场景有：</p><ol><li>滚动加载，加载更多或滚到底部监听</li><li>搜索框，搜索联想功能</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（16）axios定制化</title>
    <link href="/2023/03/09/vue3%E7%AC%94%E8%AE%B0%EF%BC%8816%EF%BC%89axios%E5%AE%9A%E5%88%B6%E5%8C%96/"/>
    <url>/2023/03/09/vue3%E7%AC%94%E8%AE%B0%EF%BC%8816%EF%BC%89axios%E5%AE%9A%E5%88%B6%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<blockquote><p>后端使用GO的JNS框架，关于请求参数的错误码code归结到400，在code同一层级使用reason标注错误原因。前端框架中使用了axios库，联调中发现后端定义的400错误reason前端捕捉不到。<br>这篇记录前后端交互出现的问题。</p></blockquote><span id="more"></span><h3 id="问题来源"><a href="#问题来源" class="headerlink" title="问题来源"></a>问题来源</h3><p>请求成功返回200，如下格式都没有异议。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">&#123; <br>  code: 200,<br>  data: &#123;<br>    data: &#123;data: Array(7), page: 1, total: 7&#125;<br>    msg: &quot;success&quot;<br>    status: 200<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>问题在于请求失败，失败的原因在于何处，是否涉及到业务错误？</p><h3 id="状态码定义"><a href="#状态码定义" class="headerlink" title="状态码定义"></a>状态码定义</h3><figure class="highlight basic"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs basic"><span class="hljs-symbol">200 </span>OK - [<span class="hljs-keyword">GET</span>]：服务器成功返回用户请求的数据，该操作是幂等的（Idempotent）。<br><span class="hljs-symbol">201 </span>CREATED - [POST/<span class="hljs-keyword">PUT</span>/PATCH]：用户新建或修改数据成功。<br><span class="hljs-symbol">202 </span>Accepted - [*]：表示一个请求已经进入后台排队（异步任务）<br><span class="hljs-symbol">204 </span>NO CONTENT - [<span class="hljs-keyword">DELETE</span>]：用户删除数据成功。<br><span class="hljs-symbol">400 </span>INVALID REQUEST - [POST/<span class="hljs-keyword">PUT</span>/PATCH]：用户发出的请求有错误，服务器没有进行新建或修改数据的操作，该操作是幂等的。<br><span class="hljs-symbol">401 </span>Unauthorized - [*]：表示用户没有权限（令牌、用户名、密码错误）。<br><span class="hljs-symbol">403 </span>Forbidden - [*] 表示用户得到授权（与<span class="hljs-number">401</span>错误相对），但是访问是被禁止的。<br><span class="hljs-symbol">404 </span><span class="hljs-keyword">NOT</span> FOUND - [*]：用户发出的请求针对的是不存在的记录，服务器没有进行操作，该操作是幂等的。<br><span class="hljs-symbol">406 </span><span class="hljs-keyword">Not</span> Acceptable - [<span class="hljs-keyword">GET</span>]：用户请求的格式不可得（比如用户请求JSON格式，但是只有XML格式）。<br><span class="hljs-symbol">410 </span>Gone -[<span class="hljs-keyword">GET</span>]：用户请求的资源被永久删除，且不会再得到的。<br><span class="hljs-symbol">422 </span>Unprocesable entity - [POST/<span class="hljs-keyword">PUT</span>/PATCH] 当创建一个对象时，发生一个验证错误。<br><span class="hljs-symbol">500 </span>INTERNAL SERVER <span class="hljs-keyword">ERROR</span> - [*]：服务器发生错误，用户将无法判断发出的请求是否成功。<br><span class="hljs-symbol">502 </span>网关错误<br><span class="hljs-symbol">503 </span>Service Unavailable<br><span class="hljs-symbol">504 </span>网关超时<br></code></pre></div></td></tr></table></figure><h3 id="规范确定"><a href="#规范确定" class="headerlink" title="规范确定"></a>规范确定</h3><p>涉及到业务错误，后端返回状态码任然为200，需要后端将具体的业务错误返回给前端，返回数据结构如下:</p><figure class="highlight dts"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dts"><span class="hljs-punctuation">&#123;</span><br><span class="hljs-symbol">  code:</span> <span class="hljs-number">200</span>,<br><span class="hljs-symbol">  data:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-symbol">    result:</span> <span class="hljs-string">&quot;fail&quot;</span>,<br><span class="hljs-symbol">    errorcode:</span> <span class="hljs-number">10001</span>,  <span class="hljs-meta"># 业务相关的错误编码</span><br><span class="hljs-symbol">    message:</span> “计算资源不可用” <span class="hljs-meta"># 业务相关的错误描述</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></div></td></tr></table></figure><p>涉及到40x之类的错误，后端返回状态码为40x，同时需要在返回数据结构中注明具体错误。</p><figure class="highlight dts"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dts"><span class="hljs-punctuation">&#123;</span><br><span class="hljs-symbol">  code:</span> <span class="hljs-number">40</span>x,<br><span class="hljs-symbol">  data:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-symbol">    result:</span> <span class="hljs-string">&quot;fail&quot;</span>,<br><span class="hljs-symbol">    message:</span> “计算资源不可用” <span class="hljs-meta"># 业务相关的错误描述</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></div></td></tr></table></figure><h3 id="axios拦截器捕捉"><a href="#axios拦截器捕捉" class="headerlink" title="axios拦截器捕捉"></a>axios拦截器捕捉</h3><p>可以在<code>request.ts</code>中通过axios拦截器获取捕捉的error，通过error描述对比直接进行处理，适用于code专一性表示错误的项目。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// 请求拦截器</span><br>axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<br>  <span class="hljs-function">(<span class="hljs-params">config: AxiosRequestConfig</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">UserModule</span>.<span class="hljs-property">token</span>) &#123;<br>      config.<span class="hljs-property">headers</span>[<span class="hljs-string">&quot;Authorization&quot;</span>] = <span class="hljs-string">&quot;JWT &quot;</span> + <span class="hljs-title class_">UserModule</span>.<span class="hljs-property">token</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> config;<br>  &#125;,<br>  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>    <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);<br>  &#125;<br>);<br><br>axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<br>  <span class="hljs-function">(<span class="hljs-params">res: AxiosResponse</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> res;<br>  &#125;,<br>  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;error=&quot;</span>, error);<br>    <span class="hljs-keyword">if</span> (error == <span class="hljs-string">&quot;Error: Request failed with status code 403&quot;</span>) &#123;<br>      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;当前没有查看权限，请联系管理员。&quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);<br>    &#125;<br>  &#125;<br>);<br></code></pre></div></td></tr></table></figure><h3 id="validateStatus配置"><a href="#validateStatus配置" class="headerlink" title="validateStatus配置"></a>validateStatus配置</h3><p>通过在<code>request.ts</code>中增加<code>validateStatus</code>配置，获取错误code，可以直接返回到调用接口的位置。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteDataBatch</span>(<span class="hljs-params">url: string, json: object</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">axios</span>(&#123;<br>    <span class="hljs-attr">url</span>: url,<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;delete&quot;</span>,<br>    <span class="hljs-attr">data</span>: json,<br>    <span class="hljs-attr">validateStatus</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">status</span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;status=&#x27;</span>, status) <span class="hljs-comment">// 403</span><br>      <span class="hljs-keyword">return</span> status &lt; <span class="hljs-number">500</span>;<br>    &#125;<br>  &#125;)<br>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> res)<br>    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> error);<br></code></pre></div></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">deleteBatchStandard</span>(&#123; ids &#125;)<br>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span>(!res) &#123;<br>        <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;这里需要前端处理错误信息展示&quot;</span>); <br>      &#125;<span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">const</span> &#123; status, data, msg &#125; = res.<span class="hljs-property">data</span>;<br>        <span class="hljs-keyword">if</span> (status == <span class="hljs-number">200</span>) &#123;<br>          <span class="hljs-comment">//success</span><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(msg); <span class="hljs-comment">//业务信息错误</span><br>        &#125;<br>      &#125;<br>      <br>    &#125;)<br>    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;服务器修复中，请稍后重试！&quot;</span>);<br>    &#125;);<br>&#125;)<br>.<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;error=&#x27;</span>,error) <span class="hljs-comment">//</span><br>&#125;);<br></code></pre></div></td></tr></table></figure><p><code>附录</code><br><a href="https://axios-http.com/docs/req_config">axios API</a><br><a href="https://blog.csdn.net/weixin_69506221/article/details/128017432">axios 详细配置</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（15）css计算属性</title>
    <link href="/2023/02/10/vue3%E7%AC%94%E8%AE%B0%EF%BC%8815%EF%BC%89css%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7/"/>
    <url>/2023/02/10/vue3%E7%AC%94%E8%AE%B0%EF%BC%8815%EF%BC%89css%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7/</url>
    
    <content type="html"><![CDATA[<blockquote><p>终于遇到需要css计算属性的需求啦～业务理解是“展示GPU在系统、业务、释放中、可用4中状态下的占比”，本项目基于vue3+element，数据展示使用了el-table，这篇记录一下使用过程中的坑。</p></blockquote><span id="more"></span><h3 id="css计算属性的直接写法"><a href="#css计算属性的直接写法" class="headerlink" title="css计算属性的直接写法"></a>css计算属性的直接写法</h3><p>大概实现效果如下：<br><img src="/img/vue14-1.png" alt="css计算属性"><br>占比条（percent bar）需要在column中定制化处理，使用一个宽度固定的块ul作为容器，里面排列4个小块li，4个小块的宽度是计算所得的。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"> <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;GPU&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;120&quot;</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;center&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">&quot;scope&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;&#123; scope.row.gpu_card_text &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;percent&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;scope.row.w1Style&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;scope.row.w2Style&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;scope.row.w3Style&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;scope.row.w4Style&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>样式计算属性代码设置如下：</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"> tempList.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">let</span> w1 = (i.<span class="hljs-property">gpu_card</span>[<span class="hljs-number">0</span>] / sum) * <span class="hljs-number">100</span>;<br>  <span class="hljs-keyword">let</span> w2 = (i.<span class="hljs-property">gpu_card</span>[<span class="hljs-number">1</span>] / sum) * <span class="hljs-number">100</span>;<br>  <span class="hljs-keyword">let</span> w3 = (i.<span class="hljs-property">gpu_card</span>[<span class="hljs-number">2</span>] / sum) * <span class="hljs-number">100</span>;<br>  <span class="hljs-keyword">let</span> w4 = (i.<span class="hljs-property">gpu_card</span>[<span class="hljs-number">3</span>] / sum) * <span class="hljs-number">100</span>;<br>  <span class="hljs-keyword">let</span> w1Style = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> &#123; <span class="hljs-string">&quot;--width&quot;</span>: w1 + <span class="hljs-string">&quot;%&quot;</span> &#125;;<br>  &#125;);<br>  <span class="hljs-keyword">let</span> w2Style = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> &#123; <span class="hljs-string">&quot;--width&quot;</span>: w2 + <span class="hljs-string">&quot;%&quot;</span> &#125;;<br>  &#125;);<br>  <span class="hljs-keyword">let</span> w3Style = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> &#123; <span class="hljs-string">&quot;--width&quot;</span>: w3 + <span class="hljs-string">&quot;%&quot;</span> &#125;;<br>  &#125;);<br>  <span class="hljs-keyword">let</span> w4Style = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> &#123; <span class="hljs-string">&quot;--width&quot;</span>: w4 + <span class="hljs-string">&quot;%&quot;</span> &#125;;<br>  &#125;);<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(i, &#123; w1Style, w2Style, w3Style, w4Style &#125;);<br>&#125;);<br>dataList.<span class="hljs-property">tableData</span> = tempList;<br></code></pre></div></td></tr></table></figure><p>还需要在css中添加：</p><figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-class">.percent</span> &#123;<br>  <span class="hljs-attribute">display</span>: flex;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;<br>  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;<br>  <span class="hljs-attribute">overflow</span>: hidden;<br>  <span class="hljs-selector-tag">li</span> &#123;<br>    <span class="hljs-attribute">height</span>: <span class="hljs-number">10px</span>;<br>  &#125;<br>  <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">1</span>) &#123;<br>    <span class="hljs-attribute">background-color</span>: red;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-built_in">var</span>(--width);<br>  &#125;<br>  <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>) &#123;<br>    <span class="hljs-attribute">background-color</span>: yellow;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-built_in">var</span>(--width);<br>  &#125;<br>  <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">3</span>) &#123;<br>    <span class="hljs-attribute">background-color</span>: blue;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-built_in">var</span>(--width);<br>  &#125;<br>  <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">4</span>) &#123;<br>    <span class="hljs-attribute">background-color</span>: green;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-built_in">var</span>(--width);<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="做成一个组件"><a href="#做成一个组件" class="headerlink" title="做成一个组件"></a>做成一个组件</h3><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">&lt;template&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;percent&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;w1Style&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;w2Style&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;w3Style&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;w4Style&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br>&lt;/template&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> &#123; defineComponent, computed &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineComponent</span>(&#123;</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;percent-bar&quot;</span>,</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-attr">props</span>: &#123;</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-attr">data</span>: &#123;</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-attr">type</span>: <span class="hljs-title class_">Array</span>,</span></span><br><span class="language-javascript"><span class="language-xml">    &#125;,</span></span><br><span class="language-javascript"><span class="language-xml">  &#125;,</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-title function_">setup</span>(<span class="hljs-params">props</span>) &#123;</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">let</span> tempList = props.<span class="hljs-property">data</span>;</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">const</span> sum = tempList.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">prev, cur</span>) =&gt;</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Number</span>(prev) + <span class="hljs-title class_">Number</span>(cur);</span></span><br><span class="language-javascript"><span class="language-xml">    &#125;);</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">let</span> w1 = (<span class="hljs-title class_">Number</span>(tempList[<span class="hljs-number">0</span>]) / <span class="hljs-title class_">Number</span>(sum)) * <span class="hljs-number">100</span>;</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">let</span> w2 = (<span class="hljs-title class_">Number</span>(tempList[<span class="hljs-number">1</span>]) / <span class="hljs-title class_">Number</span>(sum)) * <span class="hljs-number">100</span>;</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">let</span> w3 = (<span class="hljs-title class_">Number</span>(tempList[<span class="hljs-number">2</span>]) / <span class="hljs-title class_">Number</span>(sum)) * <span class="hljs-number">100</span>;</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">let</span> w4 = (<span class="hljs-title class_">Number</span>(tempList[<span class="hljs-number">3</span>]) / <span class="hljs-title class_">Number</span>(sum)) * <span class="hljs-number">100</span>;</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">let</span> w1Style = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-keyword">return</span> &#123; <span class="hljs-string">&quot;--width&quot;</span>: w1 + <span class="hljs-string">&quot;%&quot;</span> &#125;;</span></span><br><span class="language-javascript"><span class="language-xml">    &#125;);</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">let</span> w2Style = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-keyword">return</span> &#123; <span class="hljs-string">&quot;--width&quot;</span>: w2 + <span class="hljs-string">&quot;%&quot;</span> &#125;;</span></span><br><span class="language-javascript"><span class="language-xml">    &#125;);</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">let</span> w3Style = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-keyword">return</span> &#123; <span class="hljs-string">&quot;--width&quot;</span>: w3 + <span class="hljs-string">&quot;%&quot;</span> &#125;;</span></span><br><span class="language-javascript"><span class="language-xml">    &#125;);</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">let</span> w4Style = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-keyword">return</span> &#123; <span class="hljs-string">&quot;--width&quot;</span>: w4 + <span class="hljs-string">&quot;%&quot;</span> &#125;;</span></span><br><span class="language-javascript"><span class="language-xml">    &#125;);</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">return</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">      w1Style,</span></span><br><span class="language-javascript"><span class="language-xml">      w2Style,</span></span><br><span class="language-javascript"><span class="language-xml">      w3Style,</span></span><br><span class="language-javascript"><span class="language-xml">      w4Style,</span></span><br><span class="language-javascript"><span class="language-xml">    &#125;;</span></span><br><span class="language-javascript"><span class="language-xml">  &#125;,</span></span><br><span class="language-javascript"><span class="language-xml">&#125;);</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;scss&quot;</span> <span class="hljs-attr">scoped</span>&gt;</span></span><br><span class="language-xml"> .percent &#123;...&#125;</span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br></code></pre></div></td></tr></table></figure><p>在父组件中这样调用</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;GPU&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;120&quot;</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;center&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">&quot;scope&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;&#123; scope.row.gpu_card_text &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">percent-bar</span> <span class="hljs-attr">:data</span>=<span class="hljs-string">&quot;scope.row.gpu_card&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">percent-bar</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q &amp; A"></a>Q &amp; A</h3><p>在编写组件的时候，先使用了循环渲染，但是发现元素没有渲染出来，查看浏览器发现style上没有挂载成功。具体原因有待研究。<br><img src="/img/vue14-2.png" alt="error"></p>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（14）casdoor接入</title>
    <link href="/2023/01/18/vue3%E7%AC%94%E8%AE%B0%EF%BC%8814%EF%BC%89casdoor%E6%8E%A5%E5%85%A5/"/>
    <url>/2023/01/18/vue3%E7%AC%94%E8%AE%B0%EF%BC%8814%EF%BC%89casdoor%E6%8E%A5%E5%85%A5/</url>
    
    <content type="html"><![CDATA[<blockquote><p>遇到一个新需求，使用casdoor的登录入口，需要在我的项目中修改登录逻辑，这篇记录试用过程。</p></blockquote><span id="more"></span><h3 id="调用逻辑"><a href="#调用逻辑" class="headerlink" title="调用逻辑"></a>调用逻辑</h3><p>我的设计思路是当前系统处于未登录状态（即获取不到token）时，跳转login页面；<br>当前系统处于已登录状态时，跳转redirect页面（默认为主页home）。<br>操作步骤如下：</p><ol><li>在login页面触发casdoor中的<code>getSigninUrl</code>方法，跳转casdoor登录；</li><li>输入用户名密码，跳转已配置好的&#x2F;callback，本项目中为&#x2F;home。跳转时URL中携带有code；</li><li>在home主页中请求后端验证接口，参数为URL中取到的code；</li><li>后端验证接口返回res中携带token（JWT），home中使用cookie储存token；</li><li><code>permission.ts</code>中使用路由守卫验证token</li></ol><h3 id="casdoor-vue用法"><a href="#casdoor-vue用法" class="headerlink" title="casdoor-vue用法"></a>casdoor-vue用法</h3><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm i casdoor-vue-sdk<br></code></pre></div></td></tr></table></figure><p>在<code>main.ts</code>中引入：</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Casdoor</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;casdoor-vue-sdk&quot;</span>;<br><span class="hljs-keyword">const</span> config = &#123;<br>  <span class="hljs-attr">serverUrl</span>: <span class="hljs-string">&quot;http://***&quot;</span>,<br>  <span class="hljs-attr">clientId</span>: <span class="hljs-string">&quot;***&quot;</span>,<br>  <span class="hljs-attr">organizationName</span>: <span class="hljs-string">&quot;teco&quot;</span>,<br>  <span class="hljs-attr">appName</span>: <span class="hljs-string">&quot;tecoai&quot;</span>,<br>  <span class="hljs-attr">redirectPath</span>: <span class="hljs-string">&quot;/home&quot;</span>,<br>&#125;;<br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Casdoor</span>, config);<br></code></pre></div></td></tr></table></figure><p>在<code>login.vue</code>中使用：</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">&lt;script setup&gt;<br><span class="hljs-keyword">import</span> &#123; onMounted, getCurrentInstance &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; useCasdoor &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;casdoor-vue-sdk&quot;</span>;<br><br><span class="hljs-keyword">const</span> &#123; getSigninUrl, getSignupUrl &#125; = <span class="hljs-title function_">useCasdoor</span>();<br><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> = <span class="hljs-title function_">getSigninUrl</span>();<br>&#125;);<br>&lt;/script&gt;<br></code></pre></div></td></tr></table></figure><h2 id="自己实现一个应用管理系统"><a href="#自己实现一个应用管理系统" class="headerlink" title="自己实现一个应用管理系统"></a>自己实现一个应用管理系统</h2><h3 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h3><ol><li>首页地址：<a href="http://10.10.30.2:8003/">http://10.10.30.2:8003/</a></li><li>登录首页：<a href="http://10.10.30.2:8003/login">http://10.10.30.2:8003/login</a><br>登录组织：<a href="http://10.10.30.2:8003/login/teco">http://10.10.30.2:8003/login/teco</a></li></ol><h3 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h3><p>UMS系统负责所有用户的登录，登录进系统后，可以选择应用进行访问，采用单点登录。用token进行用户认证。<br>假设有应用A、B、C，成功登录访问应用A之后，在浏览器中输入应用B的UR，原理上应该是可以直接访问的。<br>问题：应用B的token从哪里获取？<br>代码执行顺序：permisson-axios&#x2F;service，也就是先进行路由守卫，若无token，直接跳转应用的login。<br>现在需要实现：</p><ol><li>若无token，处于UMS未登录状态，跳转UMS的login</li><li>若无token，处于UMS已登录状态，赋予token<br>解决方案：</li><li>在permisson路由守卫中，判断无token，getAccount()请求新token，通过res判断处理上述实现</li><li>使用微前端架构，实现应用间通信，共享token信息</li></ol><h3 id="前端设计"><a href="#前端设计" class="headerlink" title="前端设计"></a>前端设计</h3><ol><li>UMS-登录页：请求login接口</li><li>UMS-首页：展示各个子系统入口，点击后登录子系统（使用静默登录方式-已登录app1，在同一浏览器输入app2的地址，这两个app属于同一组织，app2可以自动登录）</li><li>UMS-个人中心：可以修改用户密码、邮箱、手机号，和casdoor相关联</li><li>子系统：初始化时请求用户个人信息及系统菜单，动态渲染菜单；菜单中包含按钮权限，需要获取后在页面渲染中处理</li></ol><p><code>附录</code><br><a href="https://github.com/casdoor/casdoor-vue-sdk">casdoor-vue-sdk文档</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（13）自定义Hooks</title>
    <link href="/2023/01/17/vue3%E7%AC%94%E8%AE%B0%EF%BC%8813%EF%BC%89%E8%87%AA%E5%AE%9A%E4%B9%89Hooks/"/>
    <url>/2023/01/17/vue3%E7%AC%94%E8%AE%B0%EF%BC%8813%EF%BC%89%E8%87%AA%E5%AE%9A%E4%B9%89Hooks/</url>
    
    <content type="html"><![CDATA[<blockquote><p>年前赶项目真累啊～<br>这篇记录Hooks相关的定义、用法。</p></blockquote><span id="more"></span><h3 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h3><ol><li>Hooks 在JS里是 callback，事件驱动，集成定义一些可复用的方法；</li><li>可以随时被引入和调用以实现高内聚低耦合的目标；</li><li>自定义 Hooks，将代码通过功能分块写、响应变量和方法在一起定义和调用；每个Hooks显式暴露响应式变量和方法；</li><li>将可复用功能抽离为外部JS文件；</li><li>自定义 Hooks 可以灵活传递任何参数来改变它的逻辑，参数不限于其他hook的暴露出来的变量，这提高了Vue3在抽象逻辑方面的灵活性；</li><li>利用ES6对象解构很轻松给变量重命名；</li><li>自定义 Hooks 是属于组件下的函数作用域的；</li><li>utils 的工具函数脱离框架也能使用，hooks 和框架耦合配合业务定义；</li></ol><h3 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h3><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; ref, watch &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">useAdd</span> = (<span class="hljs-params">&#123; num1, num2 &#125;</span>)  =&gt;&#123;<br>    <span class="hljs-keyword">const</span> addNum = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)<br>    <span class="hljs-title function_">watch</span>([num1, num2], <span class="hljs-function">(<span class="hljs-params">[num1, num2]</span>) =&gt;</span> &#123;<br>      <span class="hljs-title function_">addFn</span>(num1, num2)<br>    &#125;)<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">addFn</span> = (<span class="hljs-params">num1, num2</span>) =&gt; &#123;<br>      addNum.<span class="hljs-property">value</span> = num1 + num2<br>    &#125;<br>    <span class="hljs-keyword">return</span> &#123;<br>      addNum,<br>      addFn<br>    &#125;<br>&#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> useAdd<br></code></pre></div></td></tr></table></figure><p>使用hook</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> useAdd <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./useAdd.js&#x27;</span>     <span class="hljs-comment">//引入hook</span><br><span class="hljs-keyword">const</span> num1 = <span class="hljs-title function_">ref</span>(<span class="hljs-number">2</span>)<br><span class="hljs-keyword">const</span> num2 = <span class="hljs-title function_">ref</span>(<span class="hljs-number">1</span>)<br><br><span class="hljs-keyword">const</span> &#123; addNum, addFn &#125; = <span class="hljs-title function_">useAdd</span>(&#123; num1, num2 &#125;)<br><span class="hljs-title function_">addFn</span>(num1.<span class="hljs-property">value</span>, num2.<span class="hljs-property">value</span>)<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>typescript</tag>
      
      <tag>vue3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>总结语言（1）</title>
    <link href="/2022/12/14/%E6%80%BB%E7%BB%93%E8%AF%AD%E8%A8%80%EF%BC%881%EF%BC%89/"/>
    <url>/2022/12/14/%E6%80%BB%E7%BB%93%E8%AF%AD%E8%A8%80%EF%BC%881%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<blockquote><p>这篇记录在工作中用到的KPI语言。</p></blockquote><span id="more"></span><h3 id="技术调研报告-前端"><a href="#技术调研报告-前端" class="headerlink" title="技术调研报告-前端"></a>技术调研报告-前端</h3><ol><li>调研目的</li><li>调研过程<br>下载后尝试运行，由于时间久远，nodejs各个包依赖变化较大，项目报错。后手动解决部分依赖问题，忽略部分错误后强制项目运行。***。后尝试直接阅读项目源码。</li><li>结论<br>首先，该项目使用**框架，代码组织形式较为复杂，拆分组件粒度细，阅读代码困难。<br>其次，由于前端package更新较快，该项目使用了大量外部package，部分package可能已经不维护了，依赖解决比较麻烦。<br>再者，该项目使用的UI组件库较为小众(可能来自网易的内部)，查阅后发现可用资料非常少。<br>综上，该项目不太适合直接二次开发。<br>由于此项目的 功能与我方需要开发的功能点有部分相似，也有一定的参考价值，在外部组件使用上可以作为代码编写的学习示例。</li></ol><h3 id="鬼话连篇"><a href="#鬼话连篇" class="headerlink" title="鬼话连篇"></a>鬼话连篇</h3><ol><li>解耦，拆分页面级封装，以 mixins 复用公共逻辑。</li><li>将工具类方法整合，以 wiki 输出文档。</li><li>在未耦合业务逻辑时，保留最佳实践分支，以供类似业务可以快速展开。 </li><li>业务代码冗余，UI 重复设计，且由于 QA 检查严格，沟通成本较大。主动推动前端和 UI 形成组件共识，如模态窗口，状态提示等业务，形成固定样式，输出固定组件，有效减少此类代码量超50%。</li><li>负责业务梳理、需求分析、技术选型、框架搭建，根据业务需求和后端架构，为项目选择最优前端解决方案。</li><li>负责项目更新迭代，版本升级，持续提升研发效率和研发质量。</li><li>对项目代码持续优化，并提供稳定流畅的页面体验。</li></ol><h3 id="发展学习"><a href="#发展学习" class="headerlink" title="发展学习"></a>发展学习</h3><ol><li>深刻理解业务，从技术角度实现为业务短期、中期、长期目标负责，平衡业务功能需求重要紧急程度、实现成本、未来可能业务变动方向，综合考虑系统的稳定性、性能、拓展性等非功能性需求的设计匹配业务发展阶段。</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>product</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>产品笔记（1）</title>
    <link href="/2022/12/14/%E4%BA%A7%E5%93%81%E7%AC%94%E8%AE%B0%EF%BC%881%EF%BC%89/"/>
    <url>/2022/12/14/%E4%BA%A7%E5%93%81%E7%AC%94%E8%AE%B0%EF%BC%881%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<blockquote><p>这篇记录在项目中学到的产品知识。</p></blockquote><span id="more"></span><h3 id="需求属性"><a href="#需求属性" class="headerlink" title="需求属性"></a>需求属性</h3><table><thead><tr><th>需求属性</th><th>属性说明</th></tr></thead><tbody><tr><td>编号</td><td>需求的顺序号，唯一性标识</td></tr><tr><td>提交人(*)</td><td>需求的录入PD，负责解释需求</td></tr><tr><td>提交时间</td><td>需求的录入时间，辅助信息</td></tr><tr><td>模块(*)</td><td>根据产品的模块划分</td></tr><tr><td>名称(*)</td><td>用简洁的短语描述需求</td></tr><tr><td>描述(*)</td><td>需求描述：无歧义、完整性、一致性、可测试等</td></tr><tr><td>提出者</td><td>即需求的原始提出者，有疑惑时便于追溯</td></tr><tr><td>提出时间</td><td>原始需求的获得时间，辅助信息</td></tr><tr><td>Bug编号</td><td>一些Bug视为需求，统一管理</td></tr><tr><td>分类</td><td>新增功能、功能改进、体验提升、Bug修复、内部需求等</td></tr><tr><td>层次</td><td>基础、扩展（期望需求）、增值（兴奋需求）</td></tr><tr><td>重要性</td><td>重要程度，辅助确定商业价值</td></tr><tr><td>紧迫度</td><td>紧急程度，辅助确定商业价值</td></tr><tr><td>持续时间</td><td>持续时间，辅助确定商业价值</td></tr><tr><td>商业价值(*)</td><td>商业优先级，不考虑实现难度，群体决策</td></tr><tr><td>开发量(*)</td><td>需求的开发工作量，表征实现难度</td></tr><tr><td>性价比(*)</td><td>“商业价值&#x2F;开发量”，用于决定先做哪个</td></tr><tr><td>状态(*)</td><td>需求生命周期：待讨论、暂缓、拒绝、需求中、开发中、已发布</td></tr><tr><td>负责PD(*)</td><td>状态进入“需求中”后确定</td></tr><tr><td>开发工程师</td><td>状态进入“开发中”后确定</td></tr><tr><td>项目名称</td><td>需求的发布项目</td></tr><tr><td>发布时间</td><td>需求的发布时间</td></tr><tr><td>备注</td><td>其它任何信息，如：1.被拒绝的理由 2.被暂缓的理由和重启条件 3.其它相关文档 ……</td></tr></tbody></table><h3 id="需求文档"><a href="#需求文档" class="headerlink" title="需求文档"></a>需求文档</h3><p>管理台—登录&#x2F;个人中心需求文档</p><table><thead><tr><th>需求概要</th><th></th></tr></thead><tbody><tr><td>部署方式</td><td>私有化部署</td></tr><tr><td>文档状态</td><td>IN REVIEW &#x2F; v0.1.0</td></tr><tr><td>产品负责人</td><td>ginny</td></tr><tr><td>产品版本</td><td>v0.1.0</td></tr><tr><td>产品名称</td><td>我的产品</td></tr><tr><td>原型 link</td><td></td></tr></tbody></table><p>变更记录</p><table><thead><tr><th>时间</th><th>版本</th><th>变更人</th><th>变更说明</th></tr></thead><tbody><tr><td>2023-1-1</td><td>v0.1.0</td><td>ginny</td><td>初版需求文档</td></tr></tbody></table><p>一、名词定义及方法论</p><table><thead><tr><th>名词</th><th>定义</th><th>备注</th></tr></thead><tbody><tr><td>集群管理员</td><td>拥有平台最高权限，能够登录集群管理平台。目前有且仅有一位，后续支持增加管理员</td><td>admin用户</td></tr></tbody></table><p>二、功能性需求</p><table><thead><tr><th>一级功能</th><th>功能说明</th><th>优先级</th><th>备注</th></tr></thead><tbody><tr><td>个人中心</td><td>支持查看个人信息</td><td>3</td><td></td></tr></tbody></table><p>三、功能性需求详细说明</p><table><thead><tr><th>功能</th><th>详细说明</th><th>备注</th></tr></thead><tbody><tr><td>XX管理列表</td><td>列表字段包括：XXX</td><td></td></tr></tbody></table><p>四、性能需求<br>支持最大管理X台机器。允许支持X个用户的创建。<br>支持100人同时登录&#x2F;注册平台。支持2000人同时处于登录状态。</p><p>五、产品边界与限制<br>六、附录</p><h3 id="产品里程碑规划"><a href="#产品里程碑规划" class="headerlink" title="产品里程碑规划"></a>产品里程碑规划</h3><table><thead><tr><th>时间</th><th>202X.3</th><th>202X.6</th><th>202X.12</th></tr></thead><tbody><tr><td>商业化目标</td><td></td><td></td><td></td></tr><tr><td>产品目标</td><td>产品功能：输出XXX</td><td>产品功能：完成mvp版本，配备XXX，功能包括：XXX</td><td>产品质量： 稳定性达到70%</td></tr><tr><td>研发目标</td><td>依赖环境搭建完成</td><td></td><td></td></tr></tbody></table><h3 id="竞品分析"><a href="#竞品分析" class="headerlink" title="竞品分析"></a>竞品分析</h3><p>一、调研背景<br>二、产品基本信息<br>  1.产品定位&#x2F;产品介绍&#x2F;产品价值<br>  2.面向用户&#x2F;适用行业<br>  3.产品优势<br>三、产品架构<br>四、功能分析</p><h3 id="版本管理"><a href="#版本管理" class="headerlink" title="版本管理"></a>版本管理</h3><p>版本管理是对软件开发过程中特定功能的集合或特定代码构建结果进行管理。版本管理是为满足不同需求，对同一产品或系统进行局部的改进和改型所产生的产品或系统系列的变更情况进行记录、跟踪、维护和控制的过程。</p><h4 id="版本号定义"><a href="#版本号定义" class="headerlink" title="版本号定义"></a>版本号定义</h4><p>A.B.C.D<br>A—主板本号：当发生大的版本迭代、如架构重构、页面重构或有颠覆性功能上线时，主版本号+1。<br>B—次版本号：相对于主版本号而言，次版本号的升级对应的只是局部的变动，但该局部的变动造成程序和以前版本不能兼容，或者对该程序以前的协作关系产生了破坏，或者是功能上有大的改进或增强。次版本号+1。<br>C—修订版本号：当每个次版本中规划出多个sprint时，每个sprint结束后，版本更为为修订版本更新，修订版本号+1.<br>D—日期版本号：当客户侧&#x2F;内测时出现bug需要紧急修改，并且临时发版时，使用日期版本号。</p><h4 id="版本迭代节奏"><a href="#版本迭代节奏" class="headerlink" title="版本迭代节奏"></a>版本迭代节奏</h4><p>每个Q发布一个大版本，其中一个Q内再以两周为一个sprint周期进行迭代，每完成一个sprint，修订版本号+1</p><h4 id="sprint内开发测试流程"><a href="#sprint内开发测试流程" class="headerlink" title="sprint内开发测试流程"></a>sprint内开发测试流程</h4><p><img src="/img/pm-1.jpg" alt="开发测试流程"><br>每个Q最后一个sprint预留用于对本Q要上线功能的整体回归以及内部用户试用的内测阶段，并根据回归测试或内测时发现的bug进行修复，一般情况不进行功能开发。</p><h3 id="git版本管理"><a href="#git版本管理" class="headerlink" title="git版本管理"></a>git版本管理</h3><p><img src="/img/pm-2.png" alt="git版本管理"><br>master： 用于生产部署的版本，永远不会commit，只能由hotfix、release分支合并，并打tag<br>develop： 开发用的主分支<br>feature： 开发特性的分支，由develop分支创建，最终合并到develop<br>release： 当大版本中所有特性都完成开发后，由develop分支创建release分支，进行qa测试<br>hotfix： 线上出现bug时，从master生产一个bugfix版本，修复完成后，合并到master和develop分支并打tag</p><h3 id="部署-amp-环境"><a href="#部署-amp-环境" class="headerlink" title="部署 &amp; 环境"></a>部署 &amp; 环境</h3><h4 id="环境资源需求"><a href="#环境资源需求" class="headerlink" title="环境资源需求"></a>环境资源需求</h4><table><thead><tr><th>环境</th><th>用途</th><th>配置</th><th>数量</th><th>开始时间</th><th>结束时间</th><th>拥有者</th><th>缺口</th><th>缺口成本</th></tr></thead><tbody><tr><td>开发环境</td><td></td><td>cpu:48核，内存512G，硬盘2T+8T</td><td>1</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>测试环境</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>运维开发</td><td>公共组件、存储服务</td><td>硬盘100T</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>网络设备及配件</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><h4 id="环境清单"><a href="#环境清单" class="headerlink" title="环境清单"></a>环境清单</h4><table><thead><tr><th>环境类型</th><th>环境用途</th><th>环境负责人</th><th>环境配置</th><th>环境数量</th></tr></thead><tbody><tr><td>开发环境</td><td>用于每个sprint功能开发</td><td>研发</td><td></td><td></td></tr><tr><td>测试环境</td><td>用于每个sprint功能测试</td><td>QA</td><td></td><td></td></tr><tr><td>内部稳定环境</td><td>作为内部正式使用的稳定环境</td><td>PM</td><td></td><td></td></tr><tr><td>外部PoC&#x2F;Demo试用环境</td><td>面向外部客户前期交流时，用户试用环境</td><td>PM</td><td></td><td></td></tr><tr><td>客户私有环境</td><td>客户签订合同后部署的正式使用环境</td><td>客户联系人</td><td></td><td></td></tr></tbody></table>]]></content>
    
    
    
    <tags>
      
      <tag>product</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>uniapp学习（1）</title>
    <link href="/2022/12/06/uniapp%E5%AD%A6%E4%B9%A0%EF%BC%881%EF%BC%89/"/>
    <url>/2022/12/06/uniapp%E5%AD%A6%E4%B9%A0%EF%BC%881%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<blockquote><p>部门需要快速开发一个跨平台的app，前端担起重任。<br>简单调研后发现uni-app可以同时编译成小程序和客户端应用，本项目需求对客户端原生API调用较少，和后端交互较多，且部门内技术栈偏向于vue，对于uni-app学习成本不高，比较适合这个框架。<br>本篇记录框架的学习及使用过程。 </p></blockquote> <span id="more"></span><h3 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h3><ol><li>uni-app是一个使用 Vue.js 开发所有前端应用的框架，一套代码可发布到 H5、以及各种小程序，并且在 HBuilderX 中可直接打包生成 Android、iOS App。</li></ol><h3 id="开发规范"><a href="#开发规范" class="headerlink" title="开发规范"></a>开发规范</h3><p>1.页面文件遵循 Vue 单文件组件 (SFC) 规范<br>2.组件标签靠近小程序规范，详见uni-app组件规范<br>3.接口能力（JS API）靠近微信小程序规范，但需将前缀 wx 替换为 uni，详见uni-app接口规范<br>4.数据绑定及事件处理同 Vue.js 规范，同时补充了App及页面的生命周期<br>5.为兼容多端运行，建议使用flex布局进行开发</p>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AIGC试用</title>
    <link href="/2022/12/02/AIGC%E8%AF%95%E7%94%A8/"/>
    <url>/2022/12/02/AIGC%E8%AF%95%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<blockquote><p>尝试跑一个AIGC开源项目，了解前后端交互、模型推理流程，重在学习。<br>本篇记录使用的命令，以及跑项目过程遇到的问题。</p></blockquote><span id="more"></span><h3 id="实验步骤"><a href="#实验步骤" class="headerlink" title="实验步骤"></a>实验步骤</h3><ol><li>下载安装anaconda<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">wget https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/Miniconda3-py39_4.12.0-Linux-x86_64.sh<br>sh ***<br><br></code></pre></div></td></tr></table></figure></li></ol><h3 id="conda命令"><a href="#conda命令" class="headerlink" title="conda命令"></a>conda命令</h3><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment">#创建虚拟环境</span><br>conda create -n your_env_name python=X.X（3.6、3.7等）<br><span class="hljs-comment">#激活虚拟环境</span><br><span class="hljs-built_in">source</span> activate your_env_name(虚拟环境名称)<br><span class="hljs-comment">#退出虚拟环境</span><br><span class="hljs-built_in">source</span> deactivate your_env_name(虚拟环境名称)<br><span class="hljs-comment">#删除虚拟环境</span><br>conda remove -n your_env_name(虚拟环境名称) --all<br>conda remove --name your_env_name package_name  <span class="hljs-comment"># 删除环境中的某个包</span><br><br><span class="hljs-comment">#查看安装了哪些包</span><br>conda list<br><br><span class="hljs-comment">#安装包</span><br>conda install package_name(包名)<br>conda install scrapy==1.3 <span class="hljs-comment"># 安装指定版本的包</span><br>conda install -n 环境名 包名 <span class="hljs-comment"># 在conda指定的某个环境中安装包</span><br><br><span class="hljs-comment">#查看当前存在哪些虚拟环境</span><br>conda <span class="hljs-built_in">env</span> list <br><span class="hljs-comment">#或 </span><br>conda info -e<br><span class="hljs-comment">#或</span><br>conda info --envs<br></code></pre></div></td></tr></table></figure><h3 id="安装requirements-txt依赖"><a href="#安装requirements-txt依赖" class="headerlink" title="安装requirements.txt依赖"></a>安装requirements.txt依赖</h3><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">pip install -r requirements.txt<br></code></pre></div></td></tr></table></figure><h3 id="环境查看"><a href="#环境查看" class="headerlink" title="环境查看"></a>环境查看</h3><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment"># 查看Linux系统版本</span><br><span class="hljs-built_in">cat</span> /proc/version<br><span class="hljs-comment"># 查看驱动信息</span><br>nvidia-smi<br><span class="hljs-comment">#  NVIDIA-SMI 465.19.01    Driver Version: 465.19.01    CUDA Version: 11.3</span><br></code></pre></div></td></tr></table></figure><p><code>bash</code></p><p><code>附录</code><br><a href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/?C=M&O=A">清华大学开源软件镜像站</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>ml</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MLOps实战（1）</title>
    <link href="/2022/11/15/MLOps%E5%AE%9E%E6%88%98%EF%BC%881%EF%BC%89/"/>
    <url>/2022/11/15/MLOps%E5%AE%9E%E6%88%98%EF%BC%881%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<blockquote><p>2022年11月正式接触MLOps，本篇记录理论学习。</p></blockquote><span id="more"></span><h3 id="理论概念"><a href="#理论概念" class="headerlink" title="理论概念"></a>理论概念</h3><ol><li>传统系统模块化设计，松耦合；<br>ML系统牵一发动全身（数据、model、参数改变触发新版本）</li><li>ML技术可能适用的场景：<br>（1）无法通过经验给出规则；<br>（2）已有好数据，业务依赖数据作决策；<br>（3）目标问题不断发生变化；<br>（4）无法扩展；</li><li>业务需求是一个问题或者痛点，需要在冲突的需求之间找到合适的平衡点，并将其转化为模型的输入和输出、损失函数和性能指标的选择。</li><li>MLOps提供所有已部署模型以及所有经过A&#x2F;B测试的模型的性能的可见性。</li><li>ML实验跟踪<br>（1）简化从实验到生产的模型迁移<br>（2）模型投产后的版本控制<br>（3）在ML模型注册中心管理模型工件<br>（4）在生产中测试各种模型版本<br>（5）serving</li><li>A&#x2F;B test：统计技术，用于online模型评估<br>（1）确定商业目标的衡量指标（通常为代理指标）<br>（2）确定实验本身的参数（样本量、持续时间）</li><li>CI：持续集成，经常测试每个软件单元的代码库，以及通过单元测试、集成测试、系统测试来测试不同软件工件共同工作的完整性。在ML领域，需要：<br>（1）测试和验证模型代码及依赖组件的有效性<br>（2）测试和验证数据、数据模式、模型的性能<br>CD：持续部署，模型开发人员将更新后的模型、模型代码（含预测代码）上传至中央存储，然后部署到生产环境中。设计一个ML pipeline，将模型预测所涉及的流程和依赖自动部署或更新到一个ML服务。<br>建议：使用进程锁的单节点+基于Kubernetes的多节点部署方案。<br>交付：构建一个完全打包并经过验证的模型版本的过程，该版本可以部署到生产环境中。</li><li>模型衰退&#x2F;出错的原因：<br>（1）新训练集质量不高<br>（2）数据漂移P(X) or 概念漂移P(y|X)-持续、周期性出现<br>（3）特征修复<br>（4）依赖资源改变</li><li>版本控制：假设条件、随机性、数据、设定值、结果、执行、环境，将版本控制和再现性相关的基础文档任务自动化，通过集成平台进行设计和部署。</li><li>模型评估指标<br>   （1）统计：准确度、精准度、召回<br>   （2）计算：平均延迟、延迟的95百分位等</li><li>模型监控<br>   （1）资源层面：CPU、RAM、网络使用率和磁盘空间是否符合预期？请求是否以预期的速度得到处理？<br>   （2）性能层面：随着时间的推移，模型仍然是新输入数据模式的准确表示吗？性能和设计阶段一样好吗？</li></ol><h3 id="ML"><a href="#ML" class="headerlink" title="ML"></a>ML</h3><ol><li>监督学习：分类、回归；无监督学习：聚类</li><li>model choose –》algorithm + config + training;<br>error &amp; performance trade off</li><li>泛化：对新鲜样本进行准确预测的能力</li></ol><h3 id="Engineering"><a href="#Engineering" class="headerlink" title="Engineering"></a>Engineering</h3><ol><li>特征工程：对原始数据或中间特征进行一系列工程化处理，映射为一个更适合建模的新的表现形式，以降低原始数据的噪声和冗余。</li><li>基类（接口）：定义一个标准和基础功能，独立软件块之间的“边界”，定义不同组件的交流方式。</li><li>工件：可测试和可部署的项目包</li></ol><h3 id="MLOps"><a href="#MLOps" class="headerlink" title="MLOps"></a>MLOps</h3><ol><li>ML模型需要两个版本的管道：一个用于训练-history，一个用于服务-real time。<br>   将管道中的节点进行抽象，整个管道作为产品进行集中化开发和维护。<br>   可用于抽象的节点：<br>   （1）特征存储<br>   （2）训练过程各节点模块化<br>   （3）Maas，服务管道封装成通用的模型服务接口，一键生成模型服务</li><li>首先确定业务可以产生哪些数据，目标输出是什么，然后界定哪些模型适合加工这类输入和输出;<br>规划ML任务的步骤：<br>（1）将业务目标框定在一个ML范式中<br>（2）评估该任务的可行性，根据评估结果，重新调整ML框架和算法，直到获取满意的结果为止</li><li>数据准备-特征工程-模型开发-模型部署-模型监控    </li><li>评估指标<br>（1）模型表现（代理指标-模型侧指标）-模型目标-模型开发时期<br>（2）业务表现-业务目标-模型部署时期</li><li>ML项目生命周期<br>（1）定业务目标-行业专家和数据科学家合作<br>（2）数据准备：clean-feature engineering-sample<br>（3）模型实验：通过离线评估进行最佳模型的选择<br>（4）模型工程：对实验过程进行脚本封装并生成ML管道<br>（5）模型评估<br>（6）模型预测<br>（7）模型监控</li><li>模型部署<br>-生成代码&amp;模型的序列化：将代码、环境依赖、模型实例部署到中央存储，为后续模型的版本化及回溯使用。<br>-模型的服务化：通过数据库批量推理模式（offline）、推入式推理模式、单服务推理模式和微服务推理模式为应用提供服务。</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>ml</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>egg笔记（2）Mac配置使用mysql</title>
    <link href="/2022/10/27/egg%E7%AC%94%E8%AE%B0%EF%BC%882%EF%BC%89Mac%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8mysql/"/>
    <url>/2022/10/27/egg%E7%AC%94%E8%AE%B0%EF%BC%882%EF%BC%89Mac%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8mysql/</url>
    
    <content type="html"><![CDATA[<blockquote><p>我的egg.js项目中使用mysql数据库，先在本机做一个配置测试环境。<br>这篇记录Mac上本地配置数据库，以及代码编写。</p></blockquote><span id="more"></span><h3 id="mysql安装配置"><a href="#mysql安装配置" class="headerlink" title="mysql安装配置"></a>mysql安装配置</h3><p>安装见附录。</p><ol><li><p>登录查看数据库，操作指令如下：</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">mysql -uroot -p***<br></code></pre></div></td></tr></table></figure></li><li><p>数据库交互操作</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">// 创建一个名字为<span class="hljs-built_in">test</span>数据库<br>create database <span class="hljs-built_in">test</span>;<br>// 查看所有数据库<br>show databases;<br>// 进入数据库<br>use <span class="hljs-built_in">test</span>;<br>// 查看该数据库中的表<br>show tables;<br></code></pre></div></td></tr></table></figure></li><li><p>手动创建表</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">create table aaa(<br>  <span class="hljs-built_in">id</span> int not null auto_increment,<br>  name varchar(100) not null,<br>  PRIMARY KEY ( <span class="hljs-built_in">id</span> )<br>)DEFAULT CHARSET=utf8;<br></code></pre></div></td></tr></table></figure><p>此时<code>show tables;</code>，会显示<code>1 row in set</code>，接下来就可以使用代码在表中插入数据啦～</p></li></ol><h3 id="egg-js配置"><a href="#egg-js配置" class="headerlink" title="egg.js配置"></a>egg.js配置</h3><p>在<code>/config/plugin.ts</code>中加入插件配置，<code>/config/config.default.ts</code>中配置mysql登录账户，见附录。</p><ol><li>插入数据<br>在表名为aaa的表中插入一条数据，要和初始化表中设定的数据结构相同。<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> item = &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;ginny&#x27;</span> &#125;;<br><span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span>.<span class="hljs-property">mysql</span>.<span class="hljs-title function_">insert</span>(<span class="hljs-string">&#x27;aaa&#x27;</span>, item);<br></code></pre></div></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><br></code></pre></div></td></tr></table></figure></li></ol><p><code>附录</code></p><ol><li><a href="https://blog.csdn.net/guorenhao/article/details/124508441">Mac安装MySQL详细教程</a></li><li><a href="https://www.eggjs.org/tutorials/mysql">egg官方操作文档</a></li><li><a href="https://github.com/search?q=topic:egg-plugin&type=Repositories">egg插件</a></li><li><a href="https://downloads.mysql.com/archives/workbench/">可视化工具workbench下载</a></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>typescript</tag>
      
      <tag>egg</tag>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（12）目录 &amp; 文件拆分</title>
    <link href="/2022/10/19/vue3%E7%AC%94%E8%AE%B0%EF%BC%8812%EF%BC%89%E7%9B%AE%E5%BD%95-%E6%96%87%E4%BB%B6%E6%8B%86%E5%88%86/"/>
    <url>/2022/10/19/vue3%E7%AC%94%E8%AE%B0%EF%BC%8812%EF%BC%89%E7%9B%AE%E5%BD%95-%E6%96%87%E4%BB%B6%E6%8B%86%E5%88%86/</url>
    
    <content type="html"><![CDATA[<blockquote><p>项目有时候有部分代码可以复用，有时候需要整体修改（eg: API暴露），这篇记录一下实践中的感受。</p></blockquote><span id="more"></span><h3 id="请求axios统一"><a href="#请求axios统一" class="headerlink" title="请求axios统一"></a>请求axios统一</h3><p><code>utils/request.ts</code>中封装axios，在<code>api/***.ts</code>中调用。</p><ol><li><p>若所有接口来自同一台服务器<br>在<code>.env.***</code>中设置<code>VUE_APP_BASE_API</code></p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">NODE_ENV = <span class="hljs-string">&#x27;server&#x27;</span><br>VUE_APP_BASE_API = <span class="hljs-string">&quot;http://***&quot;</span><br>VUE_APP_INTERFACE_URL = <span class="hljs-string">&quot;http://***&quot;</span><br></code></pre></div></td></tr></table></figure><p><code>utils/request.ts</code>中配置<code>VUE_APP_BASE_API</code></p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> axios, &#123; <span class="hljs-title class_">AxiosRequestConfig</span>, <span class="hljs-title class_">AxiosResponse</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;axios&quot;</span>;<br><br>axios.<span class="hljs-property">defaults</span>.<span class="hljs-property">timeout</span> = <span class="hljs-number">50000</span>;<br>axios.<span class="hljs-property">defaults</span>.<span class="hljs-property">headers</span> = &#123;<br>  <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json;charset=utf8&quot;</span>,<br>&#125;;<br>axios.<span class="hljs-property">defaults</span>.<span class="hljs-property">baseURL</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">VUE_APP_BASE_API</span><br>  ? process.<span class="hljs-property">env</span>.<span class="hljs-property">VUE_APP_BASE_API</span><br>  : <span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-comment">// getData, postData, putData, delData 封装</span><br></code></pre></div></td></tr></table></figure></li><li><p>若接口来自不同服务器，或者不同环境使用不同服务器，不使用base url。<br>根据不同服务器接口分别在<code>api/***.ts</code>中编写host。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> host = process.<span class="hljs-property">env</span>.<span class="hljs-property">VUE_APP_MOCK</span><br>  ? <span class="hljs-string">&quot;http://0.0.0.0:8080&quot;</span><br>  : process.<span class="hljs-property">env</span>.<span class="hljs-property">VUE_APP_INTERFACE_URL</span>;<br></code></pre></div></td></tr></table></figure></li></ol><h3 id="接口暴露"><a href="#接口暴露" class="headerlink" title="接口暴露"></a>接口暴露</h3><p>本项目生产环境中，由于接口地址是变化的，前端硬逻辑修改麻烦，所以暴露一个<code>static/config.js</code>文件，后端可以通过修改这个文件来给定当前接口地址。</p><ol><li><p><code>static/config.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">g</span> = &#123;<br>  <span class="hljs-attr">apiUrl</span>: <span class="hljs-string">&quot;http://***&quot;</span><br>&#125;<br></code></pre></div></td></tr></table></figure></li><li><p>在<code>index.html</code>中引入，<code>&lt;script src=&quot;./static/config.js&quot;&gt;&lt;/script&gt;</code></p></li><li><p><code>api/***.ts</code>中根据环境获取</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> host =<br>  process.<span class="hljs-property">env</span>.<span class="hljs-property">VUE_APP_PRO</span> == <span class="hljs-string">&quot;true&quot;</span><br>    ? <span class="hljs-variable language_">window</span>.<span class="hljs-property">g</span>.<span class="hljs-property">apiUrl</span><br>    : process.<span class="hljs-property">env</span>.<span class="hljs-property">VUE_APP_INTERFACE_URL</span>;<br></code></pre></div></td></tr></table></figure></li><li><p><code>package.json</code>中配置生产环境命令</p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json"><span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>   <span class="hljs-attr">&quot;prod&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;vue-cli-service build --mode prod&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></div></td></tr></table></figure><p>编写<code>.env.prod</code></p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">NODE_ENV = <span class="hljs-string">&#x27;prod&#x27;</span><br>VUE_APP_PRO = <span class="hljs-string">&#x27;true&#x27;</span><br></code></pre></div></td></tr></table></figure><p>运行<code>npm run prod</code>时，打包所有文件到dist，<code>./static/*</code>下文件将直接移动到dist目录下，后期修改<code>apiUrl</code>，也将直接改变请求地址。</p></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>环境配置</tag>
      
      <tag>typescript</tag>
      
      <tag>vue3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>wx小程序（1）</title>
    <link href="/2022/09/26/wx%E5%B0%8F%E7%A8%8B%E5%BA%8F%EF%BC%881%EF%BC%89/"/>
    <url>/2022/09/26/wx%E5%B0%8F%E7%A8%8B%E5%BA%8F%EF%BC%881%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<blockquote><p>简单记录一下微信小程序的学习。</p></blockquote><span id="more"></span><h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><figure class="highlight 1c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs 1c"><span class="hljs-comment">// 整个小程序只有一个App实例</span><br><span class="hljs-string">|-- app.json (整体配置：窗口样式、网络延迟...)</span><br><span class="hljs-string">|-- app.js (总体逻辑：onLaunch、onShow、onHide、onError)</span><br><span class="hljs-string">|-- app.wxss (公共样式)</span><br><span class="hljs-string">|-- pages</span><br>    <span class="hljs-string">|-- index</span><br>        <span class="hljs-string">|-- index.js (页面注册)</span><br>        <span class="hljs-string">|-- index.json</span><br>        <span class="hljs-string">|-- index.wxml</span><br>        <span class="hljs-string">|-- index.wxss</span><br><span class="hljs-string">|-- img 图片资源</span><br><span class="hljs-string">|-- utils</span><br>    <span class="hljs-string">|-- common.js (公用方法)</span><br></code></pre></div></td></tr></table></figure><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><ol><li>小程序有appid</li><li>可以使用<open-data>标签获取用户信息</li></ol><h3 id="关键思想-amp-设计写法"><a href="#关键思想-amp-设计写法" class="headerlink" title="关键思想 &amp; 设计写法"></a>关键思想 &amp; 设计写法</h3><ol><li><p>响应式数据绑定，逻辑层（js）数据处理，视图层（view）自动更新，需要将页面的数据、方法、生命周期函数注册到框架中。</p></li><li><p>window、document等DOM和BOM的API不可用，可以调用微信环境提供的各种API，例如：地理定位，扫码，支付。</p></li><li><p>页面引用<code>behaviors</code>共享数据字段和方法。</p></li><li><p><code>Page</code>适用于简单的页面，<code>Component</code>用于复杂页面。</p></li><li><p>页面生命周期<br> <img src="/img/wx1-pagelc.png" alt="页面生命周期"></p></li><li><p>不支持直接引入<code>node_modules</code>，可copy相关代码。</p></li><li><p><code>common.js</code>中抽取公共代码，使用<code>module.exports</code>导出，需要使用时通过<code>require</code>导入</p></li><li><p>监听事件触发，数据以参数形式传入回调函数.<br> <code>wx.onCompassChange(function (res) &#123;...&#125;)</code></p></li><li><p>同步API的执行结果可以通过函数返回值直接获取，如果执行出错会抛出异常；<br> 异步API接口接受一个Object类型的参数，Object对象中不包含<code>success/fail/complete</code>时将默认返回 promise，否则仍按回调方式执行，无返回值。</p></li><li><p>尺寸单位rpx（responsive pixel）:可以根据屏幕宽度进行自适应。</p> <figure class="highlight nim"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nim"> // 同步<br> <span class="hljs-keyword">try</span> &#123;<br>  wx.setStorageSync(&#x27;key&#x27;, &#x27;value&#x27;)<br> &#125; catch(e) <span class="hljs-meta">&#123;...&#125;</span><br><br>// 异步<br> wx.login(&#123;<br>  success(res) &#123;<br>    ...<br>  &#125;<br>&#125;)<br></code></pre></div></td></tr></table></figure></li><li><figure class="highlight handlebars"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs handlebars"><span class="language-xml">// 单向数据绑定</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;</span></span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">value</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span> /&gt;</span></span><br><span class="language-xml">// 双向数据绑定</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">model:value</span>=<span class="hljs-string">&quot;值为 </span></span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">value</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span> /&gt;</span></span><br></code></pre></div></td></tr></table></figure></li><li><p>节点信息查询API可以用于获取节点属性、样式、在界面上的位置等信息</p><figure class="highlight stylus"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stylus">const query = wx<span class="hljs-selector-class">.createSelectorQuery</span>()<br>query<span class="hljs-selector-class">.select</span>(<span class="hljs-string">&#x27;#the-id&#x27;</span>)<span class="hljs-selector-class">.boundingClientRect</span>(<span class="hljs-built_in">function</span>(res)&#123;<br>  res<span class="hljs-selector-class">.top</span> <span class="hljs-comment">// #the-id 节点的上边界坐标（相对于显示区域）</span><br>&#125;)<br>query<span class="hljs-selector-class">.selectViewport</span>()<span class="hljs-selector-class">.scrollOffset</span>(<span class="hljs-built_in">function</span>(res)&#123;<br>  res<span class="hljs-selector-class">.scrollTop</span> <span class="hljs-comment">// 显示区域的竖直滚动位置</span><br>&#125;)<br>query<span class="hljs-selector-class">.exec</span>()<br></code></pre></div></td></tr></table></figure></li></ol><h4 id="路阻且长，还得走"><a href="#路阻且长，还得走" class="headerlink" title="路阻且长，还得走"></a>路阻且长，还得走</h4><ol><li>引入TDDesign，编译之后，出现<code>WAServiceMainContext.js:2 Error: module &quot;miniprogram_npm/tdesign-miniprogram/toast/props.js&quot; is not defined</code>，关闭重启dev tools即可。</li></ol><p><code>附录</code>学习资料<br><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/">wx官网</a><br><a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/project.html#%E6%9C%AC%E5%9C%B0%E8%AE%BE%E7%BD%AE">wx开发者工具</a><br><a href="https://tdesign.tencent.com/miniprogram/components/icon">tddesign</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
      <tag>wx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MAC终端配置</title>
    <link href="/2022/09/15/MAC%E7%BB%88%E7%AB%AF%E9%85%8D%E7%BD%AE/"/>
    <url>/2022/09/15/MAC%E7%BB%88%E7%AB%AF%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<blockquote><p>用了7年MBP终于要准备退休了，新电脑到手重新配置一下开发环境，稍微做个记录。</p></blockquote><span id="more"></span><h3 id="git显示分支-amp-大小写补全"><a href="#git显示分支-amp-大小写补全" class="headerlink" title="git显示分支 &amp; 大小写补全"></a>git显示分支 &amp; 大小写补全</h3><p>zsh 终端设置</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">vi ~/.zshrc<br></code></pre></div></td></tr></table></figure><p>写入以下语句</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment"># git显示分支</span><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">parse_git_branch</span></span>() &#123;<br>    git branch 2&gt; /dev/null | sed -n -e <span class="hljs-string">&#x27;s/^\* \(.*\)/[\1]/p&#x27;</span><br>&#125;<br><br><span class="hljs-built_in">setopt</span> PROMPT_SUBST<br><span class="hljs-built_in">export</span> PROMPT=<span class="hljs-string">&#x27;%F&#123;grey&#125;%n%f %F&#123;cyan&#125;%~%f %F&#123;green&#125;$(parse_git_branch)%f %F&#123;normal&#125;$%f &#x27;</span><br><br><span class="hljs-comment"># 大小写补全</span><br><span class="hljs-built_in">autoload</span> -Uz compinit &amp;&amp; compinit<br><span class="hljs-built_in">zstyle</span> <span class="hljs-string">&#x27;:completion:*&#x27;</span> matcher-list <span class="hljs-string">&#x27;m:&#123;a-z&#125;=&#123;A-Z&#125;&#x27;</span><br></code></pre></div></td></tr></table></figure><p>重启终端或通过 source 命令生效</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">source ~/.zshrc<br></code></pre></div></td></tr></table></figure><p><code>附录</code>资料<br><a href="https://blog.csdn.net/weixin_39802884/article/details/121723889">MacOS 上 oh-my-zsh 安装与卸载</a><br><a href="https://copyfuture.com/blogs-details/20210413165715428a">终端显示出git分支</a><br><a href="https://blog.csdn.net/sl285720967/article/details/122510493">大小写补全</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>环境配置</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>问题解决备忘</title>
    <link href="/2022/09/07/%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E5%A4%87%E5%BF%98/"/>
    <url>/2022/09/07/%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E5%A4%87%E5%BF%98/</url>
    
    <content type="html"><![CDATA[<blockquote><p>这篇记录一下问题解决</p></blockquote><span id="more"></span><h3 id="css"><a href="#css" class="headerlink" title="css"></a>css</h3><ol><li><p>下拉列表显示模糊问题<br>项目里用了一个select组件，如下图所示，下拉时发现字体模糊了：<br><img src="/img/q-css1.png" alt="blur1"><br>查看元素，发现去掉transform后字体模糊消失了：<br><img src="/img/q-css2.png" alt="blur2"><br>查阅资料后发现，通过 <code>transform:translate(X,Y)</code> 偏移元素可以达到定位的效果，但是如果元素内部有字体的话，会出现模糊的问题。<br>解决方案：给translate的Y值偏移设为绝对单位。</p></li><li></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>typescript</tag>
      
      <tag>css</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（11）加载更多</title>
    <link href="/2022/08/23/vue3%E7%AC%94%E8%AE%B0%EF%BC%8811%EF%BC%89%E5%8A%A0%E8%BD%BD%E6%9B%B4%E5%A4%9A/"/>
    <url>/2022/08/23/vue3%E7%AC%94%E8%AE%B0%EF%BC%8811%EF%BC%89%E5%8A%A0%E8%BD%BD%E6%9B%B4%E5%A4%9A/</url>
    
    <content type="html"><![CDATA[<blockquote><p>业务需求，下拉列表点击“加载更多”请求下一页数据。<br>加载返回数据太多时，会造成卡顿，因此需要一个滚动加载的方法。</p></blockquote><span id="more"></span><h3 id="自定义指令"><a href="#自定义指令" class="headerlink" title="自定义指令"></a>自定义指令</h3><p>在Vue中，代码复用和抽象的主要形式是组件。然而，有的情况下仍然需要对普通DOM元素进行底层操作，这时候就会用到自定义指令。<br>自定义指令是Vue提供给我们用原生DOM封装一系列DOM相关功能、视图变化的一个接口(API)。</p><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p>在<code>main.ts</code>中定义一个指令，用于内容的插入。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// 滚动加载更多</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-string">&#x27;loadMore&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">el,binding,vNode,prevNode</span>)=&gt;</span> &#123;<br>  <span class="hljs-comment">// bind(el, binding) &#123;</span><br>    <span class="hljs-comment">// 获取element，定义scroll</span><br>    <span class="hljs-keyword">let</span> select_dom = el.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.el-select-dropdown .el-select-dropdown__wrap&#x27;</span>);<br>    select_dom.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;scroll&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-keyword">let</span> height = <span class="hljs-variable language_">this</span>.<span class="hljs-property">scrollHeight</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">scrollTop</span> &lt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">clientHeight</span>;<br>      <span class="hljs-keyword">if</span> (height) &#123;<br>        binding.<span class="hljs-title function_">value</span>()<br>      &#125;<br>    &#125;)<br>  <span class="hljs-comment">// &#125;</span><br>&#125;);<br></code></pre></div></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">&lt;template&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">el-select</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">v-loadMore</span>=<span class="hljs-string">&quot;loadMore&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">el-option</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;item in list&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;item.id&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">:label</span>=<span class="hljs-string">&quot;item.name&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">:value</span>=<span class="hljs-string">&quot;item.value&quot;</span>&gt;</span></span><br><span class="language-xml">         <span class="hljs-tag">&lt;/<span class="hljs-name">el-option</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">el-select</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span></span><br>&lt;/template&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineComponent</span>(&#123;</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Setting&quot;</span>,</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-attr">directives</span>: &#123;</span></span><br><span class="language-javascript"><span class="language-xml">    loadMore,</span></span><br><span class="language-javascript"><span class="language-xml">  &#125;,</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) &#123;  </span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">const</span> <span class="hljs-title function_">getData</span> = (<span class="hljs-params"></span>) =&gt; &#123;</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-comment">// API </span></span></span><br><span class="language-javascript"><span class="language-xml">    &#125;</span></span><br><span class="language-javascript"><span class="language-xml">    </span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">const</span> <span class="hljs-title function_">loadMore</span> = (<span class="hljs-params"></span>) =&gt; &#123;</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-title function_">getData</span>();</span></span><br><span class="language-javascript"><span class="language-xml">    &#125;</span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">return</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">      loadMore,</span></span><br><span class="language-javascript"><span class="language-xml">    &#125;</span></span><br><span class="language-javascript"><span class="language-xml">  &#125;</span></span><br><span class="language-javascript"><span class="language-xml">&#125;);</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></div></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><br></code></pre></div></td></tr></table></figure><h4 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h4><ol><li><p>el.querySelector找不到元素，只有el-select，没有找到el-option。<br>原因：el-option不在el-select元素的范围内。<br>解决方案：换成document.querySelector</p></li><li><p>监听器没有执行，是没有绑定上？？？，或者是有多个，，多个怎么操作</p></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>环境配置</tag>
      
      <tag>typescript</tag>
      
      <tag>vue3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>egg笔记（1）</title>
    <link href="/2022/08/10/egg%E7%AC%94%E8%AE%B0%EF%BC%881%EF%BC%89/"/>
    <url>/2022/08/10/egg%E7%AC%94%E8%AE%B0%EF%BC%881%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<blockquote><p>有个业务需求必须写个后端做逻辑处理，大佬告知周围用egg框架的较多，就选这个了！<br>作为一个前后端分离项目，仅做一个登录逻辑的处理，使用restful API，不涉及前端模版渲染，这篇简单记录下使用。</p></blockquote><span id="more"></span><h3 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h3><p>使用简单模式初始化框架，中间选择ts，</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> demo &amp;&amp; <span class="hljs-built_in">cd</span> demo<br>npm init egg --<span class="hljs-built_in">type</span>=simple<br>npm install<br></code></pre></div></td></tr></table></figure><h3 id="跨域设置"><a href="#跨域设置" class="headerlink" title="跨域设置"></a>跨域设置</h3><p>安装egg-cors</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">npm install  egg-cors --save<br></code></pre></div></td></tr></table></figure><p>配置plugin.ts</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">EggPlugin</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;egg&#x27;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-attr">plugin</span>: <span class="hljs-title class_">EggPlugin</span> = &#123;<br>  <span class="hljs-attr">cors</span>: &#123;<br>    <span class="hljs-attr">enable</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">package</span>: <span class="hljs-string">&#x27;egg-cors&#x27;</span>,<br>  &#125;<br>&#125;;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> plugin;<br></code></pre></div></td></tr></table></figure><p>配置config.default.ts</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">config.<span class="hljs-property">security</span> = &#123;<br>  <span class="hljs-attr">csrf</span>: &#123;<br>    <span class="hljs-attr">enable</span>: <span class="hljs-literal">false</span>,<br>  &#125;,<br>  <span class="hljs-attr">domainWhiteList</span>: [<span class="hljs-string">&#x27;*&#x27;</span>],<span class="hljs-comment">//允许访问接口的白名单，例如：http://localhost:8080 *表示均可访问</span><br>&#125;;<br>config.<span class="hljs-property">cors</span> = &#123;<br>  <span class="hljs-attr">origin</span>: <span class="hljs-string">&#x27;*&#x27;</span>,<br>  <span class="hljs-attr">allowMethods</span>: <span class="hljs-string">&#x27;GET,HEAD,PUT,POST,DELETE,PATCH,OPTIONS&#x27;</span>,<br>  <span class="hljs-attr">credentials</span>:<span class="hljs-literal">true</span><span class="hljs-comment">//允许前端带cookie</span><br>&#125;;<br></code></pre></div></td></tr></table></figure><p><code>附录</code>学习资料<br><a href="https://eggjs.github.io/zh">egg官网</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>typescript</tag>
      
      <tag>egg</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（10-2）mock数据-vite</title>
    <link href="/2022/07/14/vue3%E7%AC%94%E8%AE%B0%EF%BC%8810-2%EF%BC%89mock%E6%95%B0%E6%8D%AE-vite/"/>
    <url>/2022/07/14/vue3%E7%AC%94%E8%AE%B0%EF%BC%8810-2%EF%BC%89mock%E6%95%B0%E6%8D%AE-vite/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本篇是上一篇的另一种实现，框架更新后，使用vite+pinia，自然mock数据也要跟上。基于vite-plugin-mock实现开发。</p></blockquote><span id="more"></span><h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><h4 id="1-安装vite-plugin-mock包"><a href="#1-安装vite-plugin-mock包" class="headerlink" title="1. 安装vite-plugin-mock包"></a>1. 安装vite-plugin-mock包</h4><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">npm i vite-plugin-mock<br></code></pre></div></td></tr></table></figure><h4 id="2-在vite-config-ts中添加插件"><a href="#2-在vite-config-ts中添加插件" class="headerlink" title="2. 在vite.config.ts中添加插件"></a>2. 在vite.config.ts中添加插件</h4><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; viteMockServe &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite-plugin-mock&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-function">(<span class="hljs-params">&#123; mode &#125;: ConfigEnv</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">plugins</span>: [<br>      <span class="hljs-comment">// 配置mock</span><br>      <span class="hljs-title function_">viteMockServe</span>(&#123;<br>        <span class="hljs-attr">mockPath</span>: <span class="hljs-string">&#x27;src/mock&#x27;</span>,<br>        <span class="hljs-attr">localEnabled</span>: <span class="hljs-literal">true</span>,<br>      &#125;),<br>    ],<br>  &#125;<br>&#125;)<br></code></pre></div></td></tr></table></figure><h4 id="3-新建mock文件夹"><a href="#3-新建mock文件夹" class="headerlink" title="3. 新建mock文件夹"></a>3. 新建mock文件夹</h4><p><code>mock/index.ts</code>中存放mock的API列表</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">MockMethod</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite-plugin-mock&#x27;</span><br><br><span class="hljs-comment">// 数组中存放多个请求</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">mockList</span>: <span class="hljs-title class_">MockMethod</span>[] = [<br>  &#123;<br>    <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/mock/menu&#x27;</span>,<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;get&#x27;</span>, <span class="hljs-comment">// 请求方式</span><br>    <span class="hljs-attr">statusCode</span>: <span class="hljs-number">200</span>, <span class="hljs-comment">// 返回的http状态码</span><br>    <span class="hljs-attr">response</span>: <span class="hljs-function">(<span class="hljs-params">opt</span>) =&gt;</span> &#123;<br>      <span class="hljs-comment">// opt 对象中包含 url  body  query  headers</span><br>      <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-comment">// 返回的结果集</span><br>        <span class="hljs-attr">status</span>: <span class="hljs-number">200</span>,<br>        <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;登录成功&#x27;</span>,<br>        <span class="hljs-attr">data</span>: [<br>          &#123;<br>            <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/dash3&#x27;</span>,<br>            <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;dash3&#x27;</span>,<br>            <span class="hljs-attr">component</span>: <span class="hljs-string">&#x27;BasicLayout&#x27;</span>,<br>            <span class="hljs-attr">meta</span>: &#123;<br>              <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;动态管理3&#x27;</span>,<br>              <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;userm&#x27;</span>,<br>              <span class="hljs-attr">hidden</span>: <span class="hljs-literal">false</span>,<br>              <span class="hljs-attr">level</span>: <span class="hljs-number">1</span><br>            &#125;,<br>            <span class="hljs-attr">children</span>: [<br>              &#123;<br>                <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;dash3&#x27;</span>,<br>                <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/dash3&#x27;</span>,<br>                <span class="hljs-attr">component</span>: <span class="hljs-string">&#x27;test&#x27;</span>,<br>                <span class="hljs-attr">fold</span>: <span class="hljs-string">&#x27;home&#x27;</span><br>              &#125;<br>            ]<br>          &#125;<br>        ]<br>      &#125;<br>    &#125;<br>  &#125;<br>]<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> mockList<br></code></pre></div></td></tr></table></figure><h4 id="4-写请求"><a href="#4-写请求" class="headerlink" title="4. 写请求"></a>4. 写请求</h4><p><code>api/user.ts</code></p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getUserRoutes</span> = (<span class="hljs-params">params: any</span>) =&gt; request.<span class="hljs-title function_">get</span>(&#123; <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/mock/menu&#x27;</span>, params &#125;)<br></code></pre></div></td></tr></table></figure><h4 id="5-开启"><a href="#5-开启" class="headerlink" title="5. 开启"></a>5. 开启</h4><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">npm run dev<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>环境配置</tag>
      
      <tag>typescript</tag>
      
      <tag>vue3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（10-1）mock数据-mockjs</title>
    <link href="/2022/07/14/vue3%E7%AC%94%E8%AE%B0%EF%BC%8810-1%EF%BC%89mock%E6%95%B0%E6%8D%AE-mockjs/"/>
    <url>/2022/07/14/vue3%E7%AC%94%E8%AE%B0%EF%BC%8810-1%EF%BC%89mock%E6%95%B0%E6%8D%AE-mockjs/</url>
    
    <content type="html"><![CDATA[<blockquote><p>mock数据的好处，万一遇到居家办公，本地就能完成开发。<br>本篇基于mockjs开发。</p></blockquote><span id="more"></span><h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><h4 id="1-安装mockjs包"><a href="#1-安装mockjs包" class="headerlink" title="1. 安装mockjs包"></a>1. 安装mockjs包</h4><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">npm install mockjs --save<br></code></pre></div></td></tr></table></figure><h4 id="2-修改-env-dev"><a href="#2-修改-env-dev" class="headerlink" title="2. 修改.env.dev"></a>2. 修改<code>.env.dev</code></h4><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">NODE_ENV = <span class="hljs-string">&#x27;development&#x27;</span><br>VUE_APP_TITLE = <span class="hljs-string">&#x27;development&#x27;</span><br>VUE_APP_INTERFACE_URL=<span class="hljs-string">&quot;/&quot;</span><br>VUE_APP_PROXYURL=<span class="hljs-string">&#x27;/&#x27;</span><br>VUE_APP_MOCK = <span class="hljs-literal">true</span><br></code></pre></div></td></tr></table></figure><h4 id="3-新建mock文件夹"><a href="#3-新建mock文件夹" class="headerlink" title="3. 新建mock文件夹"></a>3. 新建mock文件夹</h4><p>3.1 <code>@/mock/api/</code>存放<code>***.json</code>文件，为API文件。<br>3.2 <code>@/mock/utils/</code>存放mock相关代码。<br><code>formatOptions.ts</code></p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> qs <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;qs&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">formatOptions</span>(<span class="hljs-params">options</span>) &#123;<br>  <span class="hljs-keyword">let</span> &#123; url, type, body &#125; = options;<br>  <span class="hljs-keyword">let</span> params = <span class="hljs-literal">null</span>;<br>  <span class="hljs-keyword">if</span> (type === <span class="hljs-string">&quot;GET&quot;</span> || type === <span class="hljs-string">&quot;DELETE&quot;</span>) &#123;<br>    <span class="hljs-keyword">let</span> index = url.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;?&quot;</span>);<br>    <span class="hljs-keyword">let</span> paramsString = index &gt; -<span class="hljs-number">1</span> ? url.<span class="hljs-title function_">slice</span>(index + <span class="hljs-number">1</span>) : <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">if</span> (paramsString !== <span class="hljs-string">&quot;&quot;</span>) &#123;<br>      params = qs.<span class="hljs-title function_">parse</span>(paramsString);<br>    &#125;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    params = &#123;&#125;;<br>    <span class="hljs-keyword">if</span> (body <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">FormData</span>) &#123;<br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> [key, value] <span class="hljs-keyword">of</span> body.<span class="hljs-title function_">entries</span>()) &#123;<br>      &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">try</span> &#123;<br>        params = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(body);<br>      &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>        params = qs.<span class="hljs-title function_">parse</span>(body);<br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (params !== <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(params).<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) &#123;<br>    params = <span class="hljs-literal">null</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> &#123; url, type, params &#125;;<br>&#125;<br></code></pre></div></td></tr></table></figure><p><code>mock.ts</code></p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Mock</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;mockjs&quot;</span>;<br><span class="hljs-keyword">import</span> formatOptions <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./formatOptions&quot;</span>;<br><br><span class="hljs-title class_">Mock</span>.<span class="hljs-property">_mock</span> = <span class="hljs-title class_">Mock</span>.<span class="hljs-property">mock</span>;<br><span class="hljs-title class_">Mock</span>.<span class="hljs-property">mock</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">url, method, resFunc</span>) &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">arguments</span>.<span class="hljs-property">length</span> === <span class="hljs-number">1</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_mock</span>(url);<br>  &#125;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">arguments</span>.<span class="hljs-property">length</span> === <span class="hljs-number">2</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<br>      <span class="hljs-string">&quot;Function Mock.mock require three params: url, method, resFunc!!!&quot;</span><br>    );<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">arguments</span>.<span class="hljs-property">length</span> === <span class="hljs-number">3</span>) &#123;<br>    <span class="hljs-keyword">let</span> methods = [<span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;post&quot;</span>, <span class="hljs-string">&quot;put&quot;</span>, <span class="hljs-string">&quot;delete&quot;</span>];<br>    <span class="hljs-keyword">if</span> (!methods.<span class="hljs-title function_">includes</span>(method.<span class="hljs-title function_">toLowerCase</span>())) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<br>        <span class="hljs-string">&quot;Function Mock.mock&#x27;s second param should be get, post, put, delete!!!&quot;</span><br>      );<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> resFunc !== <span class="hljs-string">&quot;function&quot;</span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;Function Mock.mock&#x27;s third param should be a function!!!&quot;</span>);<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-comment">// 将注册的 url 转成能匹配查询字符串的正则</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> url === <span class="hljs-string">&quot;string&quot;</span>) &#123;<br>    url = url.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\//g</span>, <span class="hljs-string">&quot;\\/&quot;</span>);<br>    url += <span class="hljs-string">&quot;(|\\?.*)$&quot;</span>;<br>    url = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(url);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!(url <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">RegExp</span>)) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<br>      <span class="hljs-string">&quot;Function Mock.mock&#x27;s first param should be a string or regexp!!!&quot;</span><br>    );<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_mock</span>(url, method, <span class="hljs-keyword">function</span> (<span class="hljs-params">options</span>) &#123;<br>    <span class="hljs-comment">// 格式化 options 对象</span><br>    options = <span class="hljs-title function_">formatOptions</span>(options);<br>    <span class="hljs-keyword">let</span> res = <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>      res = <span class="hljs-title function_">resFunc</span>(options);<br>    &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>      res = err;<br>    &#125;<br>    <span class="hljs-keyword">return</span> res;<br>  &#125;);<br>&#125;;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Mock</span>;<br></code></pre></div></td></tr></table></figure><p>3.3 <code>@/mock/index.ts</code>为开启mock的主要文件。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Mock</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./utils/mock&quot;</span>;<br><br><span class="hljs-title class_">Mock</span>.<span class="hljs-title function_">setup</span>(&#123; <span class="hljs-attr">timeout</span>: <span class="hljs-number">2000</span> &#125;);<br><span class="hljs-keyword">import</span> getgenInfoJSON <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/mock/api/getgenInfo.json&quot;</span>;<br><br><span class="hljs-title class_">Mock</span>.<span class="hljs-title function_">mock</span>(<span class="hljs-string">&quot;http://0.0.0.0:8080/api/v1/getgenInfo&quot;</span>, <span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-function">(<span class="hljs-params">options</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> getgenInfoJSON;<br>&#125;);<br></code></pre></div></td></tr></table></figure><h4 id="4-在AppMain-vue中按环境引入"><a href="#4-在AppMain-vue中按环境引入" class="headerlink" title="4. 在AppMain.vue中按环境引入"></a>4. 在AppMain.vue中按环境引入</h4><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">if</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">VUE_APP_MOCK</span>) &#123;<br>  <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@/mock/index&quot;</span>) <br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="5-开启"><a href="#5-开启" class="headerlink" title="5. 开启"></a>5. 开启</h4><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">npm run dev<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>环境配置</tag>
      
      <tag>typescript</tag>
      
      <tag>vue3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>flex备忘</title>
    <link href="/2022/07/11/flex%E5%A4%87%E5%BF%98/"/>
    <url>/2022/07/11/flex%E5%A4%87%E5%BF%98/</url>
    
    <content type="html"><![CDATA[<blockquote><p>维护老代码很麻烦的一点就是布局，改来改去还是决定全部改成flex，这篇记录下flex的一般用法，以备以后使用。<br>记住设为Flex布局以后，子元素的float、clear和vertical-align属性将失效。</p></blockquote> <span id="more"></span><h4 id="弹性盒子"><a href="#弹性盒子" class="headerlink" title="弹性盒子"></a>弹性盒子</h4><p> display:flex 是一种布局方式。它即可以应用于容器中，也可以应用于行内元素。</p><p>容器默认存在两根轴：水平的主轴（main axis）和垂直的交叉轴（cross axis）。<br>采用Flex布局的元素，称为Flex容器（flex container），简称”容器”。它的所有子元素自动成为容器成员，称为Flex项目（flex item）</p><h4 id="container属性"><a href="#container属性" class="headerlink" title="container属性"></a>container属性</h4><ol><li><p>flex-direction<br>定义主轴的方向（即项目的排列方向）<br>column-reverse：主轴为垂直方向，起点在下沿<br>column：主轴为垂直方向，起点在上沿<br>row（默认值）：主轴为水平方向，起点在左端<br>row-reverse：主轴为水平方向，起点在右端</p></li><li><p>flex-wrap<br>定义项目是否换行以及如何换行<br>nowrap：不换行<br>wrap：换行，第一行在上方<br>wrap-reverse：换行，第一行在下方</p></li><li><p>justify-content<br>定义项目在主轴上的对齐方式<br>flex-start（默认值）：左对齐<br>flex-end：右对齐<br>center：居中<br>space-between：两端对齐，项目之间的间隔都相等。<br>space-around：每个项目两侧的间隔相等。所以，项目之间的间隔比项目与边框的间隔大一倍</p></li><li><p>align-items<br>定义项目在竖直方向上对齐方式<br>flex-start：交叉轴的起点对齐。<br>flex-end：交叉轴的终点对齐。<br>center：交叉轴的中点对齐。<br>baseline: 项目的第一行文字的基线对齐。<br>stretch（默认值）：如果项目未设置高度或设为auto，将占满整个容器的高度</p></li><li><p>align-content<br>定义多根轴线的对齐方式，如果项目只有一根轴线，该属性不起作用<br>flex-start：与交叉轴的起点对齐。<br>flex-end：与交叉轴的终点对齐。<br>center：与交叉轴的中点对齐。<br>space-between：与交叉轴两端对齐，轴线之间的间隔平均分布。<br>space-around：每根轴线两侧的间隔都相等。所以，轴线之间的间隔比轴线与边框的间隔大一倍。<br>stretch（默认值）：轴线占满整个交叉轴。</p></li></ol><h4 id="item属性"><a href="#item属性" class="headerlink" title="item属性"></a>item属性</h4><ol><li><p>order<br>定义项目的排列顺序。数值越小，排列越靠前，默认为0</p></li><li><p>flex-grow<br>定义项目的放大比例，默认为0，即如果存在剩余空间，也不放大<br>如果所有项目的flex-grow属性都为1，则它们将等分剩余空间（如果有的话）。如果一个项目的flex-grow属性为2，其他项目都为1，则前者占据的剩余空间将比其他项多一倍。</p></li><li><p>flex-shrink<br>定义项目的缩小比例，默认为1，即如果空间不足，该项目将缩小<br>如果所有项目的flex-shrink属性都为1，当空间不足时，都将等比例缩小。如果一个项目的flex-shrink属性为0，其他项目都为1，则空间不足时，前者不缩小。<br>负值对该属性无效。</p></li><li><p>flex-basis<br>定义了在分配多余空间之前，项目占据的主轴空间（main size）<br>浏览器根据这个属性，计算主轴是否有多余空间。它的默认值为auto，即项目的本来大小。<br>它可以设为跟width或height属性一样的值（比如350px），则项目将占据固定空间。</p></li><li><p>align-self<br>允许单个项目有与其他项目不一样的对齐方式，可覆盖align-items属性。默认值为auto，表示继承父元素的align-items属性，如果没有父元素，则等同于stretch。</p></li></ol><h4 id="实战问题"><a href="#实战问题" class="headerlink" title="实战问题"></a>实战问题</h4><p>需要实现两个固定大小的盒子摆放，当页面宽度变小时，盒子自动垂直摆放。大概效果如下所示：<br><img src="/../img/flex-1.png" alt="两个盒子排放"></p><p>方案一：容器按照中间对齐，盒子分别与中轴线隔开一段距离。</p><figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-class">.container</span> &#123;<br>  <span class="hljs-attribute">display</span>: flex;<br>  <span class="hljs-attribute">justify-content</span>: center;<br>  <span class="hljs-attribute">flex-wrap</span>: wrap;<br>&#125;<br><span class="hljs-selector-class">.box</span> &#123;<br>  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">0</span> <span class="hljs-number">1rem</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>方案二：容器按照左中右分隔。<br>如果直接使用space-between，则会出现中间是左右两边的2倍距，和设计稿差距较大，舍弃；<br>实验时发现一个神奇的space-evenly，可以实现左中右距离相等，但是查阅资料以后发现兼容性比较差（etc:iphone的SE上不支持），舍弃；<br>最后决定使用特殊方法模拟space-evenly。<br>出现问题：当垂直排列时，奇数盒子紧贴右侧，偶数盒子紧贴左侧。</p><figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-class">.container</span> &#123;<br>  <span class="hljs-attribute">display</span>: flex;<br>  <span class="hljs-attribute">flex-wrap</span>: wrap;<br>  <span class="hljs-attribute">align-items</span>: center;<br>  <span class="hljs-attribute">justify-content</span>: space-between;<br>    &amp;<span class="hljs-selector-pseudo">:before</span>,<br>    &amp;<span class="hljs-selector-pseudo">:after</span> &#123;<br>        <span class="hljs-attribute">content</span>: <span class="hljs-string">&#x27;&#x27;</span>;<br>        <span class="hljs-attribute">display</span>: block;<br>  &#125;<br>&#125;<br><span class="hljs-selector-class">.box</span><span class="hljs-selector-pseudo">:nth-child</span>(even) &#123;<br>  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">1rem</span>;<br>&#125;<br><span class="hljs-selector-class">.box</span><span class="hljs-selector-pseudo">:nth-child</span>(odd) &#123;<br>  <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">1rem</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>css</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（9）scss配置</title>
    <link href="/2022/07/04/vue3%E7%AC%94%E8%AE%B0%EF%BC%889%EF%BC%89scss%E9%85%8D%E7%BD%AE/"/>
    <url>/2022/07/04/vue3%E7%AC%94%E8%AE%B0%EF%BC%889%EF%BC%89scss%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<blockquote><p>有个需求是网页的整体配色需要和公司官网一致，在这里我使用scss写样式代码，需要全局引入颜色样式，以便在各个组件中使用。<br>这篇记录scss样式引入及使用。</p></blockquote><span id="more"></span><h4 id="项目配置"><a href="#项目配置" class="headerlink" title="项目配置"></a>项目配置</h4><p>使用<code>vue-cli</code>创建项目时，可以选择使用scss，相关的配置会自动加入<code>package.json</code>，检查是否含有以下两项：</p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json"><span class="hljs-attr">&quot;devDependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;sass&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^1.32.7&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;sass-loader&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^12.0.0&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br></code></pre></div></td></tr></table></figure><h4 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h4><p>在本项目中，<code>assets/scss/_variables.scss</code>文件中编写颜色样式。</p><figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css">$text-yellow: yellow;<br></code></pre></div></td></tr></table></figure><p>方法一：单组件引入<br>可用的写法：</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">&lt;style lang=<span class="hljs-string">&quot;scss&quot;</span> scoped&gt;<br>@<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;../../assets/scss/_variables.scss&quot;</span>;<br>span &#123;<br>  <span class="hljs-attr">color</span>: $text-yellow;<br>&#125;<br>&lt;/style&gt;<br></code></pre></div></td></tr></table></figure><p>如果报错”Undefined variable. root stylesheet”，说明文件没有引入成功；<br>如果报错”Can’t find stylesheet to import. root stylesheet”，说明引入的文件路径有问题；<br>不知道为什么下面这个写法会报错，显示无法找到文件。</p><p>方法二：整体引入<br>如果在每个组件中引入一次，稍微有点麻烦。按照我这里的设计，最好是整体引入，每个组件中都能使用。查阅一些资料后，发现可以在<code>vue.config.js</code>中这样写：</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> &#123; defineConfig &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@vue/cli-service&quot;</span>);<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title function_">defineConfig</span>(&#123;<br>  <span class="hljs-attr">css</span>: &#123;<br>    <span class="hljs-attr">loaderOptions</span>: &#123;<br>      <span class="hljs-attr">sass</span>: &#123;<br>        <span class="hljs-attr">additionalData</span>: <span class="hljs-string">`@import &quot;@/assets/scss/_variables.scss&quot;;`</span>,<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>&#125;);<br></code></pre></div></td></tr></table></figure><p>重启项目，更改成功！</p>]]></content>
    
    
    
    <tags>
      
      <tag>typescript</tag>
      
      <tag>vue3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（8）组件复用</title>
    <link href="/2022/05/16/vue3%E7%AC%94%E8%AE%B0%EF%BC%888%EF%BC%89%E7%BB%84%E4%BB%B6%E5%A4%8D%E7%94%A8/"/>
    <url>/2022/05/16/vue3%E7%AC%94%E8%AE%B0%EF%BC%888%EF%BC%89%E7%BB%84%E4%BB%B6%E5%A4%8D%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<blockquote><p>一般来说，新增和编辑基本校验规则相同，我进行了组件复用。<br>这篇记录组件复用过程中遇到的问题</p></blockquote><span id="more"></span><h4 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h4><p>在更新任务时，我复用了新建任务的组件，通过url携带参数，填充表单。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">router.<span class="hljs-title function_">push</span>(&#123;<br>  <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/taskcreate&#x27;</span>,<br>  <span class="hljs-attr">query</span>: &#123; <span class="hljs-attr">params</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(row) &#125;<br>&#125;)<br></code></pre></div></td></tr></table></figure><p>新建任务拥有单独的侧栏，当处于更新任务状态时，若点击“新建任务”，url发生改变，但是组件状态没有变化。具体表现如下图所示：<br><img src="/../img/vue3-8-1.png" alt="更新任务"><br><img src="/../img/vue3-8-2.png" alt="新建任务"></p><p>方法一：使用watch观察参数变化</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  state.<span class="hljs-property">TaskForm</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(emyptForm));<br>  <span class="hljs-title function_">getDataServer</span>();<br>  <span class="hljs-title function_">watch</span>(route.<span class="hljs-property">query</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">getDataServer</span>();<br>  &#125;, &#123; <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span> &#125;)<br>&#125;);<br></code></pre></div></td></tr></table></figure><p>此时点击“新建任务”，url发生改变，但是watch并没有监测到参数变化，此方法不管用。</p><p>方法二：使用<code>onBeforeRouteUpdate</code>路由API</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">onBeforeRouteUpdate</span>(<span class="hljs-function">(<span class="hljs-params">to</span>) =&gt;</span> &#123;<br>  state.<span class="hljs-property">TaskForm</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(emyptForm));<br>  <span class="hljs-title function_">getDataServer</span>();<br>&#125;)<br></code></pre></div></td></tr></table></figure><p>此时点击“新建任务”，url发生改变，<code>onBeforeRouteUpdate</code>执行，页面初始化成功。</p>]]></content>
    
    
    
    <tags>
      
      <tag>typescript</tag>
      
      <tag>vue3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（7）监听</title>
    <link href="/2022/05/10/vue3%E7%AC%94%E8%AE%B0%EF%BC%887%EF%BC%89%E7%9B%91%E5%90%AC/"/>
    <url>/2022/05/10/vue3%E7%AC%94%E8%AE%B0%EF%BC%887%EF%BC%89%E7%9B%91%E5%90%AC/</url>
    
    <content type="html"><![CDATA[<blockquote><p>这篇记录vue组件的属性，以及computed, watch, watchEffect的使用区分。</p></blockquote><span id="more"></span><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><h5 id="computed"><a href="#computed" class="headerlink" title="computed"></a>computed</h5><p>computed是计算属性，依赖其它属性值。<br>computed 的值有缓存，只有它依赖的属性值发生改变，下一次获取 computed 的值时才会重新计算。<br>接受一个 <code>getter</code> 函数，并根据 <code>getter</code> 的返回值返回一个不可变的响应式 ref 对象</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">const</span> plusOne = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> count.<span class="hljs-property">value</span> + <span class="hljs-number">1</span>)<br></code></pre></div></td></tr></table></figure><p>接受一个具有 <code>get</code> 和 <code>set</code> 函数的对象，用来创建可写的 ref 对象。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">const</span> plusOne = <span class="hljs-title function_">computed</span>(&#123;<br>  <span class="hljs-attr">get</span>: <span class="hljs-function">() =&gt;</span> count.<span class="hljs-property">value</span> + <span class="hljs-number">1</span>,<br>  <span class="hljs-attr">set</span>: <span class="hljs-function"><span class="hljs-params">val</span> =&gt;</span> &#123;<br>    count.<span class="hljs-property">value</span> = val - <span class="hljs-number">1</span><br>  &#125;<br>&#125;)<br></code></pre></div></td></tr></table></figure><h5 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h5><p>watch更多的是「观察」的作用，类似于某些数据的监听回调 ，每当监听的数据变化时都会执行回调进行后续操作。<br>需要侦听特定的数据源，并在单独的回调函数中执行副作用。<br>默认情况下，它是惰性的——即回调仅在侦听源发生变化时被调用。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> num = <span class="hljs-title function_">ref</span>(<span class="hljs-number">1</span>);<br><span class="hljs-title function_">watch</span>(num, <span class="hljs-function">() =&gt;</span> &#123; <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;num.value&#125;</span>`</span>&#125;);<br><span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> num.<span class="hljs-property">value</span>, <span class="hljs-function">() =&gt;</span> &#123;&#125;); <span class="hljs-comment">//有返回值的getter函数</span><br><span class="hljs-title function_">watch</span>([a, b], <span class="hljs-function">(<span class="hljs-params">[a, b], [prevA, prevB]</span>) =&gt;</span> &#123;&#125;); <span class="hljs-comment">//多个源</span><br></code></pre></div></td></tr></table></figure><h5 id="watchEffect"><a href="#watchEffect" class="headerlink" title="watchEffect"></a>watchEffect</h5><p>立即执行传入的一个函数，同时响应式追踪其依赖，并在其依赖变更时重新运行该函数。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">(<span class="hljs-params">onInvalidate</span>) =&gt;</span> &#123;<br>  <span class="hljs-title function_">onInvalidate</span>(<span class="hljs-function">() =&gt;</span> &#123;&#125;)<br>&#125;)<br></code></pre></div></td></tr></table></figure><h5 id="watch-VS-watchEffect"><a href="#watch-VS-watchEffect" class="headerlink" title="watch VS watchEffect"></a>watch VS watchEffect</h5><p><code>watch</code> 与 <code>watchEffect</code> 在以下方面相同：</p><ol><li>手动停止侦听</li><li>清除副作用 (将 <code>onInvalidate</code> 作为第三个参数传递给回调)</li><li>刷新时机和调试。</li></ol><p>与 <code>watchEffect</code> 相比，<code>watch</code> 允许我们：</p><ol><li>惰性地执行副作用</li><li>更具体地说明应触发侦听器重新运行的状态</li><li>访问被侦听状态的先前值和当前值</li></ol><h3 id="运用场景"><a href="#运用场景" class="headerlink" title="运用场景"></a>运用场景</h3><p>当我们需要进行数值计算，并且依赖于其它数据时，应该使用 computed，因为可以利用 computed 的缓存特性，避免每次获取值时，都要重新计算；</p><p>当我们需要在数据变化时执行异步或开销较大的操作时，应该使用 watch，使用 watch 选项允许我们执行异步操作 (访问一个API)，限制我们执行该操作的频率，并在我们得到最终结果前，设置中间状态。这些都是计算属性无法做到的。</p><h3 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h3><p><a href="https://v3.cn.vuejs.org/api/computed-watch-api.html#computed">官方文档 Computed 与 watch</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>typescript</tag>
      
      <tag>vue3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（6）echarts图表使用</title>
    <link href="/2022/05/09/vue3%E7%AC%94%E8%AE%B0%EF%BC%886%EF%BC%89echarts%E5%9B%BE%E8%A1%A8%E4%BD%BF%E7%94%A8/"/>
    <url>/2022/05/09/vue3%E7%AC%94%E8%AE%B0%EF%BC%886%EF%BC%89echarts%E5%9B%BE%E8%A1%A8%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<blockquote><p>业务需求中需要实时（最近1分钟）展示数据变化。通过echarts图表注入，定时拉取数据，渲染图表，展示给用户。<br>这篇记录图表使用。</p></blockquote><span id="more"></span><h3 id="插件使用"><a href="#插件使用" class="headerlink" title="插件使用"></a>插件使用</h3><p>vue中插件使用遵循以下原则：</p><ol><li>插件是一个对象，必须暴露一个 install 方法</li><li>插件本身是一个函数，则它将被视为 install 方法。</li></ol><p> install 方法将以应用实例作为第一个参数被调用。传给 use 的其他 options 参数将作为后续参数传入该安装方法。<br>当在同一个插件上多次调用此方法时，该插件将仅安装一次。</p><h3 id="echart使用逻辑"><a href="#echart使用逻辑" class="headerlink" title="echart使用逻辑"></a>echart使用逻辑</h3><ol><li>获取dom节点</li><li>初始化实例</li><li>在dom渲染后进行<code>setOption</code>设置<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> chartDom = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;main&#x27;</span>)!;<br><span class="hljs-keyword">var</span> myChart = echarts.<span class="hljs-title function_">init</span>(chartDom);<br><span class="hljs-keyword">var</span> <span class="hljs-attr">option</span>: <span class="hljs-title class_">EChartsOption</span>;<br>option = &#123;...&#125;<br>option &amp;&amp; myChart.<span class="hljs-title function_">setOption</span>(option);<br></code></pre></div></td></tr></table></figure></li></ol><h3 id="echarts插件"><a href="#echarts插件" class="headerlink" title="echarts插件"></a>echarts插件</h3><p>要将 echarts 作为插件在 vue 项目中使用，首先在 <code>index.jsx</code> 中进行 echart 插件的封装，使其符合 vue 组件的使用方式，在生命周期中创建、渲染、更新以及销毁。<br>后续所有传入参数必须遵循 <code>PropsType</code> 中的配置。<br><code>chartRef</code>用来指向渲染图表的 DOM 节点。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> theme <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/common/echart/style/theme.js&#x27;</span> <span class="hljs-comment">// 引入默认主题</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> echarts <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;echarts&#x27;</span><br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">PropsType</span> = &#123;<br>  <span class="hljs-attr">id</span>: <span class="hljs-title class_">String</span>, <span class="hljs-comment">// 图表唯一 id</span><br>  <span class="hljs-attr">className</span>: &#123; <span class="hljs-comment">// 图表类名</span><br>    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,<br>    <span class="hljs-attr">default</span>: <span class="hljs-string">&#x27;chart&#x27;</span><br>  &#125;,<br>  <span class="hljs-attr">width</span>: &#123; <span class="hljs-comment">// 图表宽度</span><br>    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,<br>    <span class="hljs-attr">require</span>: <span class="hljs-literal">true</span><br>  &#125;,<br>  <span class="hljs-attr">height</span>: &#123; <span class="hljs-comment">// 图表高度</span><br>    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,<br>    <span class="hljs-attr">require</span>: <span class="hljs-literal">true</span><br>  &#125;,<br>  <span class="hljs-attr">options</span>: &#123; <span class="hljs-comment">// 图表数据项</span><br>    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>,<br>    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> (&#123;&#125;),<br>  &#125;<br>&#125; <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineComponent</span>(&#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Echarts&#x27;</span>,<br>  <span class="hljs-attr">props</span>: <span class="hljs-title class_">PropsType</span>,<br>  <span class="hljs-title function_">setup</span>(<span class="hljs-params">props, &#123; expose &#125;</span>) &#123;<br>    <span class="hljs-keyword">const</span> chartRef = ref&lt;<span class="hljs-title class_">HTMLElement</span>&gt;()<br>    <span class="hljs-keyword">const</span> charts = &#123;<br>      <span class="hljs-attr">chart</span>: <span class="hljs-literal">null</span><br>    &#125;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">initChart</span> = (<span class="hljs-params">data?: any, clearCaching = <span class="hljs-literal">false</span></span>) =&gt; &#123;<br>      <span class="hljs-keyword">if</span> (data || props.<span class="hljs-property">options</span>) &#123;<br>        charts.<span class="hljs-property">chart</span>.<span class="hljs-title function_">setOption</span>(data || props.<span class="hljs-property">options</span>, clearCaching)<br>      &#125;<br>    &#125;<br><br>    <span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      echarts.<span class="hljs-title function_">registerTheme</span>(<span class="hljs-string">&#x27;myTheme&#x27;</span>, theme) <span class="hljs-comment">// 覆盖默认主题</span><br>      charts.<span class="hljs-property">chart</span> = echarts.<span class="hljs-title function_">init</span>(chartRef.<span class="hljs-property">value</span>, <span class="hljs-string">&#x27;myTheme&#x27;</span>)<br>      <span class="hljs-title function_">initChart</span>()<br>    &#125;)<br><br>    <span class="hljs-title function_">onBeforeUnmount</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      charts.<span class="hljs-property">chart</span>.<span class="hljs-title function_">dispose</span>()<br>      charts.<span class="hljs-property">chart</span> = <span class="hljs-literal">null</span><br>    &#125;)<br><br>    <span class="hljs-title function_">watch</span>(<br>      <span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">options</span>,<br>      <span class="hljs-function"><span class="hljs-params">val</span> =&gt;</span> &#123;<br>        val &amp;&amp; <span class="hljs-title function_">initChart</span>(val)<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span><br>      &#125;<br>    )<br><br>    <span class="hljs-title function_">expose</span>(&#123; <span class="hljs-comment">// 对外暴露接口</span><br>      chartRef,<br>      initChart<br>    &#125;);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-keyword">const</span> &#123; id, className, height, width &#125; = props<br>      <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;chartRef&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">id</span>=<span class="hljs-string">&#123;id</span> <span class="hljs-attr">as</span> <span class="hljs-attr">string</span>&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">class</span>=<span class="hljs-string">&#123;className</span> <span class="hljs-attr">as</span> <span class="hljs-attr">string</span>&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          &#x27;<span class="hljs-attr">height</span>&#x27;<span class="hljs-attr">:</span> <span class="hljs-attr">height</span> <span class="hljs-attr">as</span> <span class="hljs-attr">string</span>,</span></span><br><span class="hljs-tag"><span class="language-xml">          &#x27;<span class="hljs-attr">width</span>&#x27;<span class="hljs-attr">:</span> <span class="hljs-attr">width</span> <span class="hljs-attr">as</span> <span class="hljs-attr">string</span></span></span><br><span class="hljs-tag"><span class="language-xml">        &#125;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br>    &#125;<br>  &#125;<br>&#125;)<br></code></pre></div></td></tr></table></figure><p>在<code>componentInstall.ts</code>中定义一个有 install 方法的 component 组件对象</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> type &#123; <span class="hljs-title class_">DefineComponent</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Echart</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./echartCanvas/index&#x27;</span><br><br><span class="hljs-keyword">const</span> component = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>)<br><br>component.<span class="hljs-property">install</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">vue: DefineComponent</span>) &#123;<br>  vue.<span class="hljs-title function_">component</span>(<span class="hljs-string">&#x27;echart&#x27;</span>, <span class="hljs-title class_">Echart</span>)<br>&#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> component<br></code></pre></div></td></tr></table></figure><p>在<code>main.ts</code>中添加可全局使用的ComponentEchart，后续<code>import Echart</code>时，使用的是封装好的组件。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">ComponentEchart</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/components/componentInstall&quot;</span>;<br><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">ComponentEchart</span>);<br></code></pre></div></td></tr></table></figure><h3 id="图表组件使用"><a href="#图表组件使用" class="headerlink" title="图表组件使用"></a>图表组件使用</h3><p>这里的例子是用仪表盘来表示温度，展示GPU运行的实际温度。temperature设置中shutdown(95)、slowdown(92)、max operation(85)，实时获取当前温度current。 </p><p>最终效果如下：<br><img src="/../img/vue6-1.png" alt="仪表盘图"></p><p>首先进行仪表盘的绘制配置，通过<code>draw.tsx</code>实现。<br>使用<code>watch</code>监听数据改变，手动触发更新（图表初始化）。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> echarts <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;echarts&#x27;</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">PropsType</span> = &#123;<br>  <span class="hljs-attr">cdata</span>: &#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>,<br>    <span class="hljs-attr">require</span>: <span class="hljs-literal">true</span><br>  &#125;<br>&#125; <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineComponent</span>(&#123;<br>  <span class="hljs-attr">props</span>: <span class="hljs-title class_">PropsType</span>,<br>  <span class="hljs-title function_">setup</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-keyword">const</span> chartRef = <span class="hljs-title function_">ref</span>()<br>    <span class="hljs-keyword">let</span> options = &#123;&#125;<br><br>    <span class="hljs-title function_">watch</span>(<br>      <span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">cdata</span>,<br>      <span class="hljs-function">(<span class="hljs-params">val: any</span>) =&gt;</span> &#123;<br>        options = &#123;<br>          <span class="hljs-attr">series</span>: [<br>            &#123;<br>              <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;gauge&#x27;</span>,<br>              ...<br>              <span class="hljs-attr">data</span>: val.<span class="hljs-property">current</span><br>            &#125;,<br>            &#123;<br>              <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;gauge&#x27;</span>,<br>              ...<br>              <span class="hljs-attr">data</span>: val.<span class="hljs-property">maxoperation</span><br>            &#125;,<br>            &#123;<br>              <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;gauge&#x27;</span>,<br>              ...<br>              <span class="hljs-attr">data</span>: val.<span class="hljs-property">slowdown</span><br>            &#125;<br>          ]<br>        &#125;<br>        <span class="hljs-comment">// 手动触发更新,通过初始化参数打入数据</span><br>        <span class="hljs-keyword">if</span> (chartRef.<span class="hljs-property">value</span>) &#123;<br>          chartRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">initChart</span>(options)<br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span><br>      &#125;<br>    )<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-keyword">const</span> height = <span class="hljs-string">&quot;450px&quot;</span><br>      <span class="hljs-keyword">const</span> width = <span class="hljs-string">&quot;200px&quot;</span><br><br>      <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">echart</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;chartRef&#125;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&#123;height&#125;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&#123;width&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>    &#125;<br>  &#125;<br>&#125;)<br></code></pre></div></td></tr></table></figure><p>在<code>index.jsx</code>中向仪表盘注入数据，初次使用时我直接这样写：</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineComponent</span>(&#123;<br>  <span class="hljs-attr">components</span>: &#123; <span class="hljs-title class_">Draw</span> &#125;,<br>  <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> cdata = <span class="hljs-title function_">reactive</span>(&#123;<br>      <span class="hljs-attr">current</span>: [&#123; <span class="hljs-attr">value</span>: <span class="hljs-number">24</span> &#125;],<br>      <span class="hljs-attr">maxoperation</span>: [&#123; <span class="hljs-attr">value</span>: <span class="hljs-number">85</span> &#125;],<br>      <span class="hljs-attr">slowdown</span>: [&#123; <span class="hljs-attr">value</span>: <span class="hljs-number">92</span> &#125;],<br>    &#125;)<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Draw</span> <span class="hljs-attr">cdata</span>=<span class="hljs-string">&#123;cdata&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>    &#125;<br>  &#125;<br>&#125;)<br></code></pre></div></td></tr></table></figure><p>出现了图表没有渲染的问题，仔细检查后，发现 echarts 没有实例化（可能是没有数据）。<br>修改<code>index.jsx</code>，设置一个<code>setData</code>方法，在 DOM 挂载时修改 cdata 中的数据，图表绘制成功。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> cdata = <span class="hljs-title function_">reactive</span>(&#123;<br>    <span class="hljs-attr">current</span>: [],<br>    <span class="hljs-attr">maxoperation</span>: [&#123; <span class="hljs-attr">value</span>: <span class="hljs-number">85</span> &#125;],<br>    <span class="hljs-attr">slowdown</span>: [&#123; <span class="hljs-attr">value</span>: <span class="hljs-number">92</span> &#125;],<br>  &#125;)<br><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">setData</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    cdata.<span class="hljs-property">current</span>.<span class="hljs-title function_">push</span>(&#123; <span class="hljs-attr">value</span>: <span class="hljs-number">24</span> &#125;)<br>  &#125;<br><br>  <span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">setData</span>()<br>  &#125;)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>需要注意的是代码更新会触发重新编译，但是浏览器没有主动刷新，需要手动刷新浏览器。</p><h3 id="定时拉取数据"><a href="#定时拉取数据" class="headerlink" title="定时拉取数据"></a>定时拉取数据</h3><p>在本项目中，需要实时（最近1分钟）展示数据变化，采取的方式是通过定时器<code>setInterval</code>实现，每隔60s发送一次请求。<br>组件挂载时开启定时器，组件卸载时及时清除定时器。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> drawTiming = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">setData</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-comment">//请求数据改变</span><br>&#125;<br><span class="hljs-comment">// 定时函数，60秒刷新一次</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">drawTimingFn</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-title function_">setData</span>();<br>  drawTiming.<span class="hljs-property">value</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">setData</span>();<br>  &#125;, <span class="hljs-number">60000</span>);<br>&#125;<br><br><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">drawTimingFn</span>()<br>&#125;)<br><br><span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-built_in">clearInterval</span>(drawTiming.<span class="hljs-property">value</span>)<br>&#125;)<br></code></pre></div></td></tr></table></figure><h3 id="UI渲染"><a href="#UI渲染" class="headerlink" title="UI渲染"></a>UI渲染</h3><ol><li>echarts由数据驱动，数据的改变驱动图表展现的改变。<br>动态数据的实现：获取数据，填入数据，echarts会找到两组数据之间的差异然后通过合适的动画去表现数据的变化。</li><li>vue由数据驱动，数据改变驱动视图变化。<br>vue在更新DOM时是异步执行的。当数据发生变化，vue将开启一个异步更新队列，视图需要等队列中所有数据变化完成之后，再统一进行更新。</li></ol><p><img src="/../img/vue6-2.png" alt="event loop"></p><ol start="3"><li>vue有一种渲染优化策略<code>nextTick</code>，也是性能优化手段，基于JS执行机制实现。等待同一事件循环中的所有数据变化完成之后（一直修改相同数据，异步操作队列还会去重），再将队列中的事件拿来进行处理，进行DOM的更新，此时DOM只需要更新一次。<br>vue中我们改变数据时不会立即触发视图，如果需要实时获取到最新的DOM，可以手动调用 <code>nextTick</code>。</li><li>在以下情况下，会用到<code>nextTick</code>：<br>(1) 在数据变化后执行的某个操作，而这个操作需要使用随数据变化而变化的DOM结构的时候，这个操作就需要方法在<code>nextTick()</code>的回调函数中。<br>(2) 在vue生命周期中，如果在<code>created()</code>钩子进行DOM操作，也一定要放在<code>nextTick()</code>的回调函数中。因为在<code>created()</code>钩子函数中，页面的DOM还未渲染。<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">nextTick</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// DOM 更新了</span><br>&#125;)<br><br><span class="hljs-comment">// 作为一个 Promise 使用</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">nextTick</span>()<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// DOM 更新了</span><br>&#125;)<br></code></pre></div></td></tr></table></figure></li></ol><h3 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h3><p><a href="https://v3.cn.vuejs.org/guide/plugins.html#%E7%BC%96%E5%86%99%E6%8F%92%E4%BB%B6">官方文档 插件</a><br><a href="https://echarts.apache.org/examples/zh/index.html">echarts官网示例</a><br><a href="https://github.com/vuejs/awesome-vue#components--libraries">各种插件</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>typescript</tag>
      
      <tag>vue3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（5）异步请求</title>
    <link href="/2022/05/07/vue3%E7%AC%94%E8%AE%B0%EF%BC%885%EF%BC%89%E5%BC%82%E6%AD%A5%E8%AF%B7%E6%B1%82/"/>
    <url>/2022/05/07/vue3%E7%AC%94%E8%AE%B0%EF%BC%885%EF%BC%89%E5%BC%82%E6%AD%A5%E8%AF%B7%E6%B1%82/</url>
    
    <content type="html"><![CDATA[<blockquote><p>业务需求一中，用户选择多项，每项都需要发一个请求给后端执行相应任务，并且请求返回需要反馈给用户。<br>方案一是发送多个请求，弹出多个返回值；方案二是发送多个请求，等待所有答复后给用户一个反馈。这篇记录项目中用到的异步请求。<br>业务需求二中，用户点击item，需要通过请求一、请求二…的连续请求后，获取返回值中数据的值。涉及到多次异步的公共逻辑方法抽取。这篇也进行一些写法记录。</p></blockquote><span id="more"></span><h2 id="业务需求一"><a href="#业务需求一" class="headerlink" title="业务需求一"></a>业务需求一</h2><h3 id="multi-req-multi-res"><a href="#multi-req-multi-res" class="headerlink" title="multi req, multi res"></a>multi req, multi res</h3><p>方案一：发送多个请求，弹出多个返回值。<br>优点：可即时看到任务反馈。<br>缺点：很多弹窗用户体验不佳。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">params.<span class="hljs-property">host</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>  params[<span class="hljs-string">&quot;servername&quot;</span>] = item;<br>  <span class="hljs-title function_">createServerUser</span>(params).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;create &#x27;</span>,res)<br>  <span class="hljs-keyword">const</span> &#123; code, msg &#125; = res.<span class="hljs-property">data</span><br>    <span class="hljs-keyword">if</span> (code == <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-title class_">ElNotification</span>(&#123;<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;操作成功&#x27;</span>,<br>        <span class="hljs-attr">message</span>: <span class="hljs-title function_">h</span>(<span class="hljs-string">&#x27;i&#x27;</span>, &#123; <span class="hljs-attr">style</span>: <span class="hljs-string">&#x27;color: teal&#x27;</span> &#125;, <span class="hljs-string">&#x27;创建服务器用户成功！&#x27;</span>),<br>      &#125;);<br>      <span class="hljs-title function_">getDataSU</span>();<br>      <span class="hljs-title function_">clearAll</span>();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(msg);<br>    &#125;<br>    isCreating.<span class="hljs-property">value</span>  = <span class="hljs-literal">false</span>;<br>  &#125;)<br>  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;创建服务器用户失败...&#x27;</span>);<br>    isCreating.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;<br>  &#125;);<br>&#125;)<br></code></pre></div></td></tr></table></figure><h3 id="multi-req-one-res"><a href="#multi-req-one-res" class="headerlink" title="multi req, one res"></a>multi req, one res</h3><p>方案二是发送多个请求，等待所有答复后给用户一个答复。<br>优点：不会出现多次连续弹窗。<br>缺点：如果任务失败或者执行时间较长，用户等待过程比较煎熬。<br>这里使用<code>Promise.all</code>这个API。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> reqArr = [];<br>params.<span class="hljs-property">host</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>  params[<span class="hljs-string">&quot;servername&quot;</span>] = item;<br>  reqArr.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">createServerUser</span>(params));<br>&#125;)<br><br><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(reqArr).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> &#123; code, msg &#125; = res[<span class="hljs-number">0</span>].<span class="hljs-property">data</span><br>    <span class="hljs-keyword">if</span> (code == <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-title class_">ElNotification</span>(&#123;<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;操作成功&#x27;</span>,<br>        <span class="hljs-attr">message</span>: <span class="hljs-title function_">h</span>(<span class="hljs-string">&#x27;i&#x27;</span>, &#123; <span class="hljs-attr">style</span>: <span class="hljs-string">&#x27;color: teal&#x27;</span> &#125;, <span class="hljs-string">&#x27;创建服务器用户成功！&#x27;</span>),<br>      &#125;);<br>      <span class="hljs-title function_">getDataSU</span>();<br>      <span class="hljs-title function_">clearAll</span>();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(msg);<br>    &#125;<br>    isCreating.<span class="hljs-property">value</span>  = <span class="hljs-literal">false</span>;<br>  &#125;)<br>  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;创建服务器用户失败...&#x27;</span>);<br>    isCreating.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;<br>  &#125;);<br></code></pre></div></td></tr></table></figure><h3 id="问题思考"><a href="#问题思考" class="headerlink" title="问题思考"></a>问题思考</h3><ol><li><code>async/await</code>和<code>promise</code>关系？</li><li>如何避免回调地狱？</li><li>更直观的回调写法？</li></ol><h2 id="业务需求二"><a href="#业务需求二" class="headerlink" title="业务需求二"></a>业务需求二</h2><h3 id="Promise作为方法的返回"><a href="#Promise作为方法的返回" class="headerlink" title="Promise作为方法的返回"></a>Promise作为方法的返回</h3><p>A方法执行两个异步请求，data1作为第二个请求的输入，获取data2。当两个请求执行完毕后，通过获取返回数据data2的值，进行下一步操作。<br>A可以作为公共请求抽取出来，多处可用。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">A</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">id</span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> data1  = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getData1</span>(&#123;<span class="hljs-attr">id</span>: id&#125;)<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,reject</span>) =&gt;</span> &#123;<br>      <span class="hljs-title function_">getData2</span>(&#123;<br>        <span class="hljs-attr">id</span>: data1.<span class="hljs-property">d1_id</span><br>      &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>        <span class="hljs-title function_">resolve</span>(res.<span class="hljs-property">data2</span>)<br>      &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-title function_">reject</span>()<br>      &#125;)<br>    &#125;)<br>  &#125;<br><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">B</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">row</span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">A</span>(row.<span class="hljs-property">id</span>)<br>    <span class="hljs-keyword">const</span> status = data &amp;&amp; data[<span class="hljs-string">&quot;status&quot;</span>]<br>     <span class="hljs-keyword">if</span>(status == <span class="hljs-string">&quot;SUCCESS&quot;</span>) &#123;<br>        <span class="hljs-comment">//doSth</span><br>     &#125;<span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">//doSth </span><br>     &#125;<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>typescript</tag>
      
      <tag>vue3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（4）vuex</title>
    <link href="/2022/04/29/vue3%E7%AC%94%E8%AE%B0%EF%BC%884%EF%BC%89vuex/"/>
    <url>/2022/04/29/vue3%E7%AC%94%E8%AE%B0%EF%BC%884%EF%BC%89vuex/</url>
    
    <content type="html"><![CDATA[<blockquote><p>更复杂的通信可以使用vuex实现，以增加代码维护性。<br>这篇记录vuex的使用。</p></blockquote><span id="more"></span><h3 id="vuex简介"><a href="#vuex简介" class="headerlink" title="vuex简介"></a>vuex简介</h3><p><code>vuex</code>是一个专为Vue.js应用程序开发的状态管理模式。每一个vuex应用的核心就是store（仓库）。store 基本上就是一个容器，它包含着你的应用中大部分的状态 ( state )。<br>（1）vsuex 的状态存储是响应式的。当 Vue 组件从 store 中读取状态的时候，若 store 中的状态发生变化，那么相应的组件也会相应地得到高效更新；<br>（2）改变 store 中的状态的唯一途径就是显式地提交 (commit) mutation。这样使得我们可以方便地跟踪每一个状态的变化；</p><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><p><code>store</code>文件夹下<code>index.ts</code>中。</p><figure class="highlight typescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; createStore &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">createStore</span>(&#123;<br>  <span class="hljs-attr">state</span>: &#123;&#125;,<br>  <span class="hljs-attr">getters</span>: &#123;&#125;,<br>  <span class="hljs-attr">mutations</span>: &#123;&#125;,<br>  <span class="hljs-attr">actions</span>: &#123;&#125;,<br>  <span class="hljs-attr">modules</span>: &#123;&#125;,<br>&#125;);<br></code></pre></div></td></tr></table></figure><p>State &#x3D;&gt; 基本数据，定义了应用状态的数据结构，可以在这里设置默认的初始状态。<br>Getter &#x3D;&gt; 从基本数据派生的数据，允许组件从 Store 中获取数据，mapGetters 辅助函数仅仅是将 store 中的 getter 映射到局部计算属性。<br>Mutation &#x3D;&gt; 是唯一更改 store 中状态的方法，且必须是同步函数。<br>Action &#x3D;&gt; 像一个装饰器，包裹mutations，使之可以异步。用于提交 mutation，而不是直接变更状态，可以包含任意异步操作。<br>Module &#x3D;&gt; 模块化Vuex，允许将单一的 Store 拆分为多个 store 且同时保存在单一的状态树中。</p><p><code>store/modules/</code>文件夹下<code>user.ts</code></p><figure class="highlight typescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IUserState</span> &#123;<br>  <span class="hljs-attr">token</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">user_info</span>: <span class="hljs-title class_">IUserInfo</span>;<br>&#125;<br><span class="hljs-meta">@Module</span>(&#123; <span class="hljs-attr">dynamic</span>: <span class="hljs-literal">true</span>, store, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;user&quot;</span> &#125;)<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">VuexModule</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IUserState</span> &#123;<br>  <span class="hljs-keyword">public</span> token = <span class="hljs-title function_">getToken</span>() || <span class="hljs-string">&quot;&quot;</span>;<br>  <span class="hljs-keyword">public</span> user_info = <span class="hljs-title function_">getUserBag</span>() || &#123;&#125;;<br><br>  <span class="hljs-comment">// @Mutation 标注为mutation</span><br>  <span class="hljs-meta">@Mutation</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">SET_TOKEN</span>(<span class="hljs-params">token: <span class="hljs-built_in">string</span></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">token</span> = token;<br>  &#125;<br>  <span class="hljs-meta">@Mutation</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">SET_USERINFO</span>(<span class="hljs-params">username: <span class="hljs-built_in">string</span>, id: <span class="hljs-built_in">number</span></span>) &#123;<br>    <span class="hljs-comment">// 设置用户名</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">user_info</span>[<span class="hljs-string">&quot;username&quot;</span>] = username;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">user_info</span>[<span class="hljs-string">&quot;id&quot;</span>] = id;<br>  &#125;<br><br>    <span class="hljs-comment">// @Action 标注为action</span><br>  <span class="hljs-meta">@Action</span>(&#123; <span class="hljs-attr">rawError</span>: <span class="hljs-literal">true</span> &#125;)<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-title class_">Login</span>(<br>    <span class="hljs-attr">userInfo</span>: &#123; <span class="hljs-attr">username</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">password</span>: <span class="hljs-built_in">string</span> &#125;,<br>  ) &#123;<br>    <span class="hljs-comment">// 登录接口，拿到token</span><br>    <span class="hljs-keyword">let</span> &#123; username, password &#125; = userInfo;<br>    username = username.<span class="hljs-title function_">trim</span>();<br>    password = password.<span class="hljs-title function_">trim</span>();<br>      <span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-keyword">await</span> <span class="hljs-title function_">login</span>(&#123; username, password &#125;);<br>      <span class="hljs-keyword">if</span> (data &amp;&amp; data.<span class="hljs-property">code</span> == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">const</span> &#123; token, user_id, username&#125; = data.<span class="hljs-property">data</span>;<br>        <span class="hljs-keyword">const</span> newUser = &#123;<br>          <span class="hljs-attr">username</span>: username,<br>          <span class="hljs-attr">id</span>: user_id,<br>        &#125;;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">SET_TOKEN</span>(token);<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">SET_USERINFO</span>(username, user_id);<br>        <span class="hljs-title function_">setToken</span>(token, newUser);<br>        <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-title function_">reload</span>();<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">const</span> errMsg = (data &amp;&amp; data.<span class="hljs-property">msg</span>) || <span class="hljs-string">&quot;服务器升级中...&quot;</span><br>        <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(errMsg);<br>      &#125;<br>  &#125;<br><span class="hljs-comment">// getModule 得到一个类型安全的store，module必须提供name属性</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">UserModule</span> = <span class="hljs-title function_">getModule</span>(<span class="hljs-title class_">User</span>);<br></code></pre></div></td></tr></table></figure><h3 id="问题debug"><a href="#问题debug" class="headerlink" title="问题debug"></a>问题debug</h3><p>登录过程某一方法错误，被框架捕获。<br>解决方案：只需在注释中添加<code>rawError</code>选项即可，<code>@Action(&#123;rawError: true&#125;)</code>，这样console就会显示正常问题报错了。<br><img src="/img/vue3-4-1.png" alt="vue3登录过程错误"></p><h3 id="ajax请求数据"><a href="#ajax请求数据" class="headerlink" title="ajax请求数据"></a>ajax请求数据</h3><p>如果请求来的数据不是要被其他组件公用，仅仅在请求的组件内使用，就不需要放入 vuex 的 state 里；如果被其他地方复用，最好将请求放入 action 里，方便复用，并包装成 promise 返回。</p>]]></content>
    
    
    
    <tags>
      
      <tag>typescript</tag>
      
      <tag>vue3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（3-2）通信 父子组件通信</title>
    <link href="/2022/04/29/vue3%E7%AC%94%E8%AE%B0%EF%BC%883-2%EF%BC%89%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1/"/>
    <url>/2022/04/29/vue3%E7%AC%94%E8%AE%B0%EF%BC%883-2%EF%BC%89%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本篇是对3-1的补充，使用setup语法糖，以及eslint之后的bug修复。</p></blockquote><span id="more"></span><h3 id="单向数据流"><a href="#单向数据流" class="headerlink" title="单向数据流"></a>单向数据流</h3><p>可以使用eslint来主动识别是否编码过程违背了单向数据流的思想，若有问题，编译时可能出现<code>Unexpected mutation of &quot;props&quot; prop</code>的报错。</p><h3 id="业务描述"><a href="#业务描述" class="headerlink" title="业务描述"></a>业务描述</h3><p>Navbar中有一个avatar，鼠标悬浮出现下拉框，点击个人中心后使用抽屉形式的表单来做个人信息的修改。<br>具体设计如下：<br><img src="/img/vue3-3.png" alt="vue3"><br><img src="/img/vue3-4.png" alt="vue3"></p><h3 id="父子组件通信实现"><a href="#父子组件通信实现" class="headerlink" title="父子组件通信实现"></a>父子组件通信实现</h3><p>我的想法是Navbar作为一个父组件（总控制器），有Avatar和Drawer两个子组件，子组件管理自己的状态，当有对其他组件有影响的状态的改变要通知父组件。<br>Navbar.vue</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;navbar-wrapper&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">Avatar</span> @<span class="hljs-attr">handleDrawer</span>=<span class="hljs-string">&quot;handleDrawer&quot;</span> /&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">Drawer</span> <span class="hljs-attr">:show</span>=<span class="hljs-string">&quot;showDrawer&quot;</span> @<span class="hljs-attr">handleDrawer</span>=<span class="hljs-string">&quot;handleDrawer&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Avatar</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./avatar.vue&#x27;</span></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Drawer</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./drawer.vue&#x27;</span> </span><br><span class="language-javascript"><span class="hljs-keyword">const</span> showDrawer = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-comment">// drawer总控制器</span></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleDrawer</span> = (<span class="hljs-params">flag: boolean</span>) =&gt; &#123;</span><br><span class="language-javascript">  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;flag=&#x27;</span>, flag)</span><br><span class="language-javascript">  showDrawer.<span class="hljs-property">value</span> = flag</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>Avatar.vue中图标的hover状态只与自身有关，点击“个人中心”-openMyInfo方法会触发Drawer状态改变，使用emit告知父组件状态改变。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;avatar-container right-menu-item hover-effect&quot;</span> <span class="hljs-attr">trigger</span>=<span class="hljs-string">&quot;hover&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;avatar-wrapper&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;user-avatar&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">dropdown</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown-menu</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown-item</span></span><br><span class="hljs-tag">          @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;openMyInfo&quot;</span></span><br><span class="hljs-tag">          @<span class="hljs-attr">mouseenter</span>=<span class="hljs-string">&quot;handleHover(1, true)&quot;</span></span><br><span class="hljs-tag">          @<span class="hljs-attr">mouseleave</span>=<span class="hljs-string">&quot;handleHover(1, false)&quot;</span></span><br><span class="hljs-tag">        &gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;left-img&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;!state.hoverInfo&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;@/assets/img/my-info.png&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span> /&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">v-else</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;@/assets/img/my-info-active.png&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span> /&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>个人中心<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown-item</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown-menu</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">FormInstance</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-plus&#x27;</span></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ElMessage</span>, <span class="hljs-title class_">ElMessageBox</span>, <span class="hljs-title class_">ElNotification</span>, <span class="hljs-title class_">ElDrawer</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-plus&#x27;</span></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>(&#123;</span><br><span class="language-javascript">  <span class="hljs-attr">hoverInfo</span>: <span class="hljs-literal">false</span>,</span><br><span class="language-javascript">&#125;)</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleHover</span> = (<span class="hljs-params">flag: <span class="hljs-built_in">Number</span>, action: any</span>) =&gt; &#123;</span><br><span class="language-javascript">    state.<span class="hljs-property">hoverInfo</span> = action</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> myEmit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">&#x27;handleDrawer&#x27;</span>])</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">openMyInfo</span> = (<span class="hljs-params"></span>) =&gt; &#123;</span><br><span class="language-javascript">  <span class="hljs-title function_">myEmit</span>(<span class="hljs-string">&#x27;handleDrawer&#x27;</span>, <span class="hljs-literal">true</span>)</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>Drawer.vue<br>这里需要注意的是，我一开始直接将 props.show 赋予 v-model，结果出现了<code>vue/no-mutating-props</code>问题，查阅资料后发现， 是直接对 prop 的内容进行了修改，违反了单向数据流原则。<br>原因：实质上，在子组件内，我们并不可以直接将 prop 的变量应用于子组件深层次组件的 v-model 上（因为 v-model 会隐含的对 prop 值更新。<br>解决方式：将 props.show 通过中间变量进行 v-model 化，再把中间变量传入子组件深层次组件的 v-model 。下面的计算属性showDrawer就是这里的中介。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-drawer</span></span><br><span class="hljs-tag">    <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;drawerRef&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;showDrawer&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">:before-close</span>=<span class="hljs-string">&quot;handleClose&quot;</span></span><br><span class="hljs-tag">  &gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">el-tabs</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;drawActive&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;card&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">el-tab-pane</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;修改密码&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;first&quot;</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">el-form</span> <span class="hljs-attr">:model</span>=<span class="hljs-string">&quot;pwdForm&quot;</span> <span class="hljs-attr">:rules</span>=<span class="hljs-string">&quot;pwdRules&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;pwdFormRef&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;新密码&quot;</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;pwdForm.password&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;drawer__footer&quot;</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;cancelForm&quot;</span>&gt;</span>取消<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;primary&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;Sumbit(pwdFormRef)&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">el-form</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">el-tab-pane</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">el-tabs</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">el-drawer</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">FormInstance</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-plus&#x27;</span></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ElMessage</span>, <span class="hljs-title class_">ElNotification</span>, <span class="hljs-title class_">ElDrawer</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-plus&#x27;</span></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123; updateUserPwd &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/api/users&#x27;</span></span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>(&#123;</span><br><span class="language-javascript">  <span class="hljs-attr">show</span>: &#123;</span><br><span class="language-javascript">    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span></span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript">&#125;)</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> myEmit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">&#x27;handleDrawer&#x27;</span>])</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> showDrawer = <span class="hljs-title function_">computed</span>(&#123;</span><br><span class="language-javascript">  <span class="hljs-attr">get</span>: <span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">show</span>, </span><br><span class="language-javascript">  <span class="hljs-attr">set</span>: <span class="hljs-function">() =&gt;</span> &#123;&#125;</span><br><span class="language-javascript">&#125;)</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClose</span> = (<span class="hljs-params"></span>) =&gt; &#123;</span><br><span class="language-javascript">  <span class="hljs-title function_">myEmit</span>(<span class="hljs-string">&#x27;handleDrawer&#x27;</span>, <span class="hljs-literal">false</span>)</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">cancelForm</span> = (<span class="hljs-params"></span>) =&gt; &#123;</span><br><span class="language-javascript">  <span class="hljs-title function_">myEmit</span>(<span class="hljs-string">&#x27;handleDrawer&#x27;</span>, <span class="hljs-literal">false</span>)</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>typescript</tag>
      
      <tag>vue3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（3-1）通信 父子组件通信</title>
    <link href="/2022/04/29/vue3%E7%AC%94%E8%AE%B0%EF%BC%883-1%EF%BC%89%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1/"/>
    <url>/2022/04/29/vue3%E7%AC%94%E8%AE%B0%EF%BC%883-1%EF%BC%89%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1/</url>
    
    <content type="html"><![CDATA[<blockquote><p>一个功能在多个页面中被使用到，可以抽成了组件，以实现复用。<br>vue使用单项数据流保持数据的统一，业务中难免遇到父子组件通信问题，这篇做一个使用记录。</p></blockquote><span id="more"></span><h3 id="执行顺序"><a href="#执行顺序" class="headerlink" title="执行顺序"></a>执行顺序</h3><p>执行顺序：父组件先创建，然后子组件创建；子组件先挂载，然后父组件挂载，即“父beforeCreate-&gt; 父create -&gt; 子beforeCreate-&gt; 子created -&gt; 子mounted -&gt; 父mounted”。</p><h3 id="单向数据流"><a href="#单向数据流" class="headerlink" title="单向数据流"></a>单向数据流</h3><p>所有的<code>prop</code>都使得其父子之间形成了一个单向下行绑定：父级<code>prop</code>的更新会向下流动到子组件中，但是反过来则不行。这样会防止从子组件意外改变父级组件的状态，从而导致应用的数据流向难以理解。额外的，每次父级组件发生更新时，子组件中所有的<code>prop</code>都将会刷新为最新的值。</p><h3 id="父子组件通信实现—父组件修改子组件数据"><a href="#父子组件通信实现—父组件修改子组件数据" class="headerlink" title="父子组件通信实现—父组件修改子组件数据"></a>父子组件通信实现—父组件修改子组件数据</h3><p>应用场景：父组件改变子组件的值。<br>应用方法：子组件通过defineExpose暴露自己的属性，父组件通过ref获取子组件的属性并进行修改。<br>子组件 child.vue</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>我是demo组件<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">import</span> &#123; ref, reactive &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span></span><br><span class="language-javascript">  <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">reactive</span>(&#123;</span><br><span class="language-javascript">    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;ginny&#x27;</span>,</span><br><span class="language-javascript">  &#125;)</span><br><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-title function_">defineExpose</span>(&#123;</span><br><span class="language-javascript">    data,</span><br><span class="language-javascript">  &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;refChild&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Child</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123; ref ,reactive,onMounted&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./view/child.vue&#x27;</span></span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">let</span> refChild = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">  <span class="hljs-keyword">const</span> &#123; data &#125; = refChild.<span class="hljs-property">value</span> <span class="hljs-comment">//子组件属性</span></span><br><span class="language-javascript">&#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>注意：子组件只能是vue形式写的组件，之前复用了一个tsx组件，defineExpose方法失效。</p><h3 id="父子组件通信—自定义事件"><a href="#父子组件通信—自定义事件" class="headerlink" title="父子组件通信—自定义事件"></a>父子组件通信—自定义事件</h3><p>应用场景：子组件的状态改变时，父组件对应状态也发生改变。<br>应用方法：子组件通过<code>$emit</code>派发一个自定义事件，父组件接收到后，由父组件修改自身状态。</p><p>业务描述：公司的项目需要实现针对组织架构选择部门—即树状展示部门，同时多选。部门展示被抽成子组件，调用时，需要获取子组件已经勾选的内容。<br>实现方案：父级向子级dept-tree通过props传入状态sum（这里为父级sumbit事件中的触发的状态改变）。子组件观察状态的变化，通过 $emit 事件告诉父组件。父组件使用自定义的<code>getDeptNodes</code>方法获取payload（即子组件已选内容）。</p><p>父组件调用代码如下：</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">dept-tree</span></span><br><span class="hljs-tag">  @<span class="hljs-attr">getDeptNodes</span>=<span class="hljs-string">&quot;getDeptNodes&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:sum</span>=<span class="hljs-string">&quot;deptChosen&quot;</span></span><br><span class="hljs-tag">&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dept-tree</span>&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">DeptTree</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/components/Tree/dept.vue&quot;</span>;<br><span class="hljs-attr">components</span>: &#123;<br>  <span class="hljs-title class_">DeptTree</span><br>&#125;,<br><span class="hljs-attr">setup</span>: &#123;<br>  <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>(&#123;<br>    <span class="hljs-attr">deptChosen</span>: [], <span class="hljs-comment">//dept checkbox选中状态数组</span><br>  &#125;);  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getDeptNodes</span> = (<span class="hljs-params">params</span>) =&gt; &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;deptNodes=&#x27;</span>,params);<br>  &#125;<br>  <span class="hljs-keyword">return</span> &#123;<br>    getDeptNodes<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>子组件模板渲染部门数据。<br>通过观察状态sum的变化，通过<code>emit</code>触发自定义的<code>getDeptNodes</code>方法，传入已选内容。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-tree</span></span><br><span class="hljs-tag">    <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;treeRef&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">:data</span>=<span class="hljs-string">&quot;deptTree&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">show-checkbox</span></span><br><span class="hljs-tag">    <span class="hljs-attr">default-expand-all</span> </span><br><span class="hljs-tag">    <span class="hljs-attr">check-strictly</span>=<span class="hljs-string">true</span></span><br><span class="hljs-tag">    <span class="hljs-attr">node-key</span>=<span class="hljs-string">&quot;id&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">:props</span>=<span class="hljs-string">&quot;defaultProps&quot;</span></span><br><span class="hljs-tag">/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>Vue对定义了<code>type</code>的<code>prop</code>执行运行时验证。</p><figure class="highlight typescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs typescript">&lt;script lang=<span class="hljs-string">&quot;ts&quot;</span>&gt;<br>  <span class="hljs-keyword">import</span> &#123; defineComponent, reactive, toRefs, onMounted, watch &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>;<br>  <span class="hljs-keyword">import</span> &#123; getDept&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/api/users&quot;</span>;<br>  <span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ElMessage</span>, <span class="hljs-title class_">ElTree</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;element-plus&quot;</span>;<br>  <span class="hljs-keyword">import</span> &#123; arrToTree &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/utils&quot;</span>;<br><br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineComponent</span>(&#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;deptTree&quot;</span>,<br>    <span class="hljs-attr">props</span>: &#123;<br>      <span class="hljs-attr">sum</span>: &#123; <span class="hljs-comment">// 作为ref对象传入，可能有其他问题</span><br>        <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>,<br>        <span class="hljs-attr">default</span>: <span class="hljs-literal">null</span><br>      &#125;<br>    &#125;,<br>    <span class="hljs-title function_">setup</span>(<span class="hljs-params">props, &#123; emit &#125;</span>) &#123;<br>      <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>(&#123;<br>        <span class="hljs-attr">deptTree</span>:[]<br>      &#125;);<br><br>      <span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-title function_">getDataDept</span>();<br>      &#125;);<br><br>      <span class="hljs-comment">// 部门数据</span><br>      <span class="hljs-keyword">const</span> <span class="hljs-title function_">getDataDept</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>        <span class="hljs-title function_">getDept</span>(&#123;&#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>          <span class="hljs-keyword">const</span> &#123; data &#125; = res.<span class="hljs-property">data</span>;<br>          <span class="hljs-keyword">let</span> deptTreeArr = [];<br>          deptTreeArr.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">arrToTree</span>(data));<br>          state.<span class="hljs-property">deptTree</span> = deptTreeArr<br>        &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>          <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;获取部门数据错误！&#x27;</span>);<br>        &#125;)<br>      &#125;;<br>      <span class="hljs-keyword">const</span> treeRef = ref&lt;<span class="hljs-title class_">InstanceType</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">ElTree</span>&gt;&gt;();<br>      <span class="hljs-keyword">const</span> defaultProps = &#123;<br>        <span class="hljs-attr">children</span>: <span class="hljs-string">&#x27;children&#x27;</span>,<br>        <span class="hljs-attr">label</span>: <span class="hljs-string">&#x27;label&#x27;</span>,<br>      &#125;<br><br>      <span class="hljs-keyword">const</span> sum = props.<span class="hljs-property">sum</span>;<br>      <span class="hljs-title function_">watch</span>(sum,<span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;props.sum=&#x27;</span>,sum)<br>        <span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;getDeptNodes&#x27;</span>,&#123;<span class="hljs-string">&quot;deptNodes&quot;</span>:<span class="hljs-title function_">getCheckedNodes</span>()&#125;)<br>      &#125;);<br><br>      <span class="hljs-keyword">const</span> <span class="hljs-title function_">getCheckedNodes</span> = (<span class="hljs-params"></span>) =&gt; &#123; <span class="hljs-comment">// 选中的部门</span><br>        <span class="hljs-keyword">return</span> treeRef.<span class="hljs-property">value</span>!.<span class="hljs-title function_">getCheckedNodes</span>(<span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);<br>      &#125;<br><br>      <span class="hljs-keyword">return</span> &#123;<br>        treeRef,<br>        defaultProps,<br>        ...<span class="hljs-title function_">toRefs</span>(state),<br>      &#125;<br>    &#125;<br>  &#125;);<br>  &lt;/script&gt;<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>typescript</tag>
      
      <tag>vue3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（2）打包 &amp; 部署</title>
    <link href="/2022/04/29/vue3%E7%AC%94%E8%AE%B0%EF%BC%882%EF%BC%89%E6%89%93%E5%8C%85%20&amp;%20%E9%83%A8%E7%BD%B2/"/>
    <url>/2022/04/29/vue3%E7%AC%94%E8%AE%B0%EF%BC%882%EF%BC%89%E6%89%93%E5%8C%85%20&amp;%20%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<blockquote><p>业务中分为测试环境和生产环境，对应API地址不同，我分别做了打包配置。<br>当前vue项目配置和之前的略有不同，记录一下打包上线配置。代码上传到服务器中，使用nginx代理。</p></blockquote><span id="more"></span><h3 id="按照环境模式区分"><a href="#按照环境模式区分" class="headerlink" title="按照环境模式区分"></a>按照环境模式区分</h3><p><code>package.json</code>中配置命令，其中<code>--host</code>可以在dev模式下，使用本机IP访问系统。</p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json"><span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>   <span class="hljs-attr">&quot;dev&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;vue-cli-service serve --mode dev --host 0.0.0.0&quot;</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;serve&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;vue-cli-service serve --mode serve&quot;</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;test&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;vue-cli-service build --mode serve&quot;</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;prod&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;vue-cli-service build --mode prod&quot;</span><br> <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br></code></pre></div></td></tr></table></figure><p>针对3个不同的环境，创建3个文件，这里定义在<code>src/api/**</code>中使用<code>process.env.VUE_APP_INTERFACE_URL</code>来获取当前环境下的API地址。</p><h4 id="dev环境"><a href="#dev环境" class="headerlink" title="dev环境"></a>dev环境</h4><p>根目录下新建<code>.env.dev</code>文件</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">NODE_ENV = <span class="hljs-string">&#x27;development&#x27;</span><br>VUE_APP_TITLE = <span class="hljs-string">&#x27;development&#x27;</span><br>VUE_APP_INTERFACE_URL=<span class="hljs-string">&quot;&quot;</span> /* 请求接口地址 */<br>VUE_APP_MOCK = <span class="hljs-literal">true</span><br></code></pre></div></td></tr></table></figure><p>dev环境若需要设置代理，<code>vue.config.js</code>中添加以下内容：</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> &#123; defineConfig &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@vue/cli-service&quot;</span>);<br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title function_">defineConfig</span>(&#123;<br>  <span class="hljs-attr">publicPath</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&quot;production&quot;</span> ? <span class="hljs-string">&quot;/&quot;</span> : <span class="hljs-string">&quot;/&quot;</span>,<br>  <span class="hljs-attr">transpileDependencies</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">lintOnSave</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-attr">devServer</span>: &#123;<br>    <span class="hljs-attr">port</span>: <span class="hljs-number">8080</span>,<br>    <span class="hljs-attr">host</span>: <span class="hljs-string">&quot;127.0.0.1&quot;</span>,<br>    <span class="hljs-attr">open</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">//配置浏览器自动访问</span><br>    <span class="hljs-attr">headers</span>: &#123;<br>      <span class="hljs-string">&quot;Access-Control-Allow-Origin&quot;</span>: <span class="hljs-string">&quot;*&quot;</span>,<br>      <span class="hljs-string">&quot;Access-Control-Allow-Methods&quot;</span>: <span class="hljs-string">&quot;GET, POST, PUT, DELETE, PATCH, OPTIONS&quot;</span>,<br>      <span class="hljs-string">&quot;Access-Control-Allow-Headers&quot;</span>:<br>        <span class="hljs-string">&quot;X-Requested-With, content-type, Authorization&quot;</span>,<br>    &#125;,<br>    <span class="hljs-attr">proxy</span>: &#123;<br>      <span class="hljs-string">&quot;/api&quot;</span>: &#123;<br>        <span class="hljs-attr">target</span>: <span class="hljs-string">&quot;http://***&quot;</span>,<br>        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">secure</span>: <span class="hljs-literal">false</span>,<br>        <span class="hljs-attr">pathRewrite</span>: &#123; <span class="hljs-string">&quot;^/api&quot;</span>: <span class="hljs-string">&quot;/api&quot;</span> &#125;,<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>&#125;);<br></code></pre></div></td></tr></table></figure><h4 id="test环境"><a href="#test环境" class="headerlink" title="test环境"></a>test环境</h4><p>根目录下新建<code>.env.serve</code>文件</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">NODE_ENV = <span class="hljs-string">&#x27;server&#x27;</span><br>VUE_APP_TITLE = <span class="hljs-string">&#x27;server&#x27;</span><br>VUE_APP_INTERFACE_URL=<span class="hljs-string">&quot;http://***:19991&quot;</span><br></code></pre></div></td></tr></table></figure><h4 id="production环境"><a href="#production环境" class="headerlink" title="production环境"></a>production环境</h4><p>根目录下新建<code>.env.prod</code>文件</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">NODE_ENV=<span class="hljs-string">&#x27;production&#x27;</span><br>VUE_APP_TITLE=<span class="hljs-string">&#x27;prod&#x27;</span><br>VUE_APP_INTERFACE_URL=<span class="hljs-string">&quot;http://***:19999&quot;</span><br></code></pre></div></td></tr></table></figure><h3 id="打包去除console"><a href="#打包去除console" class="headerlink" title="打包去除console"></a>打包去除console</h3><p>因为开发环境写了一些log，打包上线时为了更加干净需要去除。<br>安装插件</p><figure class="highlight sh"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sh">npm install babel-plugin-transform-remove-console --save-dev<br></code></pre></div></td></tr></table></figure><p>在项目的<code>babel.config.js</code>的plugin中添加如下代码：</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">presets</span>: [<span class="hljs-string">&quot;@vue/cli-plugin-babel/preset&quot;</span>],<br>  <span class="hljs-attr">plugins</span>:[<br>    ...proPlugins<br>  ]<br>&#125;;<br></code></pre></div></td></tr></table></figure><h3 id="打包到服务器指定目录下"><a href="#打包到服务器指定目录下" class="headerlink" title="打包到服务器指定目录下"></a>打包到服务器指定目录下</h3><p>如最终需要浏览器访问地址为http:&#x2F;&#x2F;***:port&#x2F;demo&#x2F;，就需要修改路径，已解决无法访问静态资源的问题。<br>修改<code>vue.config.js</code>中的地址：</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title function_">defineConfig</span>(&#123;<br>  <span class="hljs-attr">publicPath</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;production&#x27;</span> ? <span class="hljs-string">&#x27;/demo/&#x27;</span> : <span class="hljs-string">&#x27;/&#x27;</span>,<br>&#125;<br></code></pre></div></td></tr></table></figure><p>nginx中添加如下配置：</p><figure class="highlight sh"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sh">location /demo/ &#123;<br>  root /data/; //root<br>  index index.html index.htm;<br>  try_files <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /demo/;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="错误"><a href="#错误" class="headerlink" title="错误"></a>错误</h3><p><img src="/img/vue3-2.png" alt="env报错"></p>]]></content>
    
    
    
    <tags>
      
      <tag>环境配置</tag>
      
      <tag>typescript</tag>
      
      <tag>vue3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（1-3）基础写法</title>
    <link href="/2022/04/26/vue3%E7%AC%94%E8%AE%B0%EF%BC%881-3%EF%BC%89%E5%9F%BA%E7%A1%80%E5%86%99%E6%B3%95/"/>
    <url>/2022/04/26/vue3%E7%AC%94%E8%AE%B0%EF%BC%881-3%EF%BC%89%E5%9F%BA%E7%A1%80%E5%86%99%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本篇记录使用过的功能，包括：表格数据为空、表格序号自增、表格内部点击实现路由跳转、表格排序；自定义提示信息；通过deep改变组件样式；ts忽略类型检查</p></blockquote><h3 id="数据为空"><a href="#数据为空" class="headerlink" title="数据为空"></a>数据为空</h3><ol><li><p>table-column中没有数据时，可以通过css控制显示–<br>当项目中只有部分表格需要此功能时，建议给需要的表格添加类名。注意：如果表格数据使用slot，也需要添加<code>prop=&quot;XXX&quot;</code>，否则类似于开关（el-switch）按钮上会有–</p><figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css">// 所有表格<br><span class="hljs-selector-class">.cell</span><span class="hljs-selector-pseudo">:empty</span><span class="hljs-selector-pseudo">::before</span> &#123;<br>  <span class="hljs-attribute">content</span>: <span class="hljs-string">&quot;--&quot;</span>;<br>  <span class="hljs-attribute">color</span>: gray;<br>&#125;<br><br>// 自定义class的表格<br><span class="hljs-selector-class">.table-special</span> <span class="hljs-selector-pseudo">:empty</span><span class="hljs-selector-pseudo">::before</span> &#123;<br>  <span class="hljs-attribute">content</span>: <span class="hljs-string">&#x27;--&#x27;</span> <span class="hljs-meta">!important</span>;<br>  <span class="hljs-attribute">color</span>: gray <span class="hljs-meta">!important</span>;<br>&#125;<br><br></code></pre></div></td></tr></table></figure></li><li><p>table没有数据时，通过slot插槽控制UI</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">&quot;empty&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align: left;&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-empty</span> <span class="hljs-attr">description</span>=<span class="hljs-string">&quot;div里面可以自定义空内容&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li></ol><h3 id="el-table使用过的功能记录"><a href="#el-table使用过的功能记录" class="headerlink" title="el-table使用过的功能记录"></a>el-table使用过的功能记录</h3><ol><li>表格序号自增</li><li>路由跳转（外链+内部）<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;index&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;80&quot;</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">&quot;startIndex&quot;</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;序号&quot;</span> /&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;客户&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">&quot;scope&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">&quot;&#123; path: &#x27;/orderDetail&#x27;, query: &#123; detail: scope.row.id &#125; &#125;&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;&#123; scope.row.name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;地址&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">&quot;scope&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">:href</span>=<span class="hljs-string">&quot;scope.row.url&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span>&#123;&#123; scope.row.url &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> startIndex = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">  <span class="hljs-keyword">return</span> (query.<span class="hljs-property">value</span>.<span class="hljs-property">page</span> - <span class="hljs-number">1</span>) * query.<span class="hljs-property">value</span>.<span class="hljs-property">pagesize</span> + <span class="hljs-number">1</span></span><br><span class="language-javascript">&#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li></ol><h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><h4 id="前端排序"><a href="#前端排序" class="headerlink" title="前端排序"></a>前端排序</h4><p><code>el-table-column</code>中添加 <code>sortable</code>即可。<br>要注意的是，这只是当前页面的排序，如果翻到下一页，排序还是默认的第二页的排序。如果需要全局排序，则由后端排序处理。</p><h4 id="后端排序"><a href="#后端排序" class="headerlink" title="后端排序"></a>后端排序</h4><ol><li><p>方法一</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-table</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;table&quot;</span> @<span class="hljs-attr">sort-change</span>=<span class="hljs-string">&quot;onSortChange&quot;</span> <span class="hljs-attr">:default-sort</span> =<span class="hljs-string">&quot;&#123;&#x27;prop&#x27;: prop,&#x27;order&#x27;:type&#125;&quot;</span> <span class="hljs-attr">:data</span>=<span class="hljs-string">&quot;tableData&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;100&quot;</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">&quot;parent_name&quot;</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;组织&quot;</span> <span class="hljs-attr">sortable</span>=<span class="hljs-string">&#x27;custom&#x27;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot-scope</span>=<span class="hljs-string">&quot;scope&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;&#123;scope.row.name ? scope.row.id: &#x27;&#x27;&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-table</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-title function_">onSortChange</span>(<span class="hljs-params">&#123; prop, order &#125;</span>) &#123;</span><br><span class="language-javascript">  <span class="hljs-keyword">let</span> orderF;</span><br><span class="language-javascript">  <span class="hljs-keyword">if</span>(order==<span class="hljs-string">&#x27;descending&#x27;</span>) &#123;</span><br><span class="language-javascript">    orderF = <span class="hljs-string">&#x27;desc&#x27;</span></span><br><span class="language-javascript">  &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( order==<span class="hljs-string">&#x27;ascending&#x27;</span>) &#123;</span><br><span class="language-javascript">    orderF = <span class="hljs-string">&#x27;asc&#x27;</span></span><br><span class="language-javascript">  &#125;<span class="hljs-keyword">else</span> &#123;&#125;</span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> ordering = <span class="hljs-title function_">getSortOrdering</span>(prop, orderF);</span><br><span class="language-javascript">    <span class="hljs-title function_">getApi</span>(&#123;</span><br><span class="language-javascript">      <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>,</span><br><span class="language-javascript">      <span class="hljs-attr">pagesize</span>: <span class="hljs-number">10</span>,</span><br><span class="language-javascript">      <span class="hljs-attr">ordering</span>: ordering</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript">    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">      dataList.<span class="hljs-property">tableData</span> = res.<span class="hljs-property">data</span>;</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-comment">// 根据交互数据格式修改</span></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> getSortOrdering = (<span class="hljs-attr">prop</span>: string, <span class="hljs-attr">order</span>: string): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> &#123;</span><br><span class="language-javascript">  <span class="hljs-keyword">const</span> prefix = order === <span class="hljs-string">&quot;asc&quot;</span> ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;-&quot;</span>;</span><br><span class="language-javascript">  <span class="hljs-keyword">return</span> prefix + <span class="hljs-string">&quot;time&quot;</span>;</span><br><span class="language-javascript">&#125;;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li><li><p>方法二</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"> <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">header</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;&#123; item.label &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;item.prop === &#x27;time&#x27;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;icons&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;sort-caret ascending&quot;</span></span><br><span class="hljs-tag">        @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;sortColumn(item.prop, &#x27;asc&#x27;)&quot;</span></span><br><span class="hljs-tag">      &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;sort-caret descending&quot;</span></span><br><span class="hljs-tag">        @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;sortColumn(item.prop, &#x27;desc&#x27;)&quot;</span></span><br><span class="hljs-tag">      &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">sortColumn</span> = (<span class="hljs-params">prop: string, order: string</span>) =&gt; &#123;</span><br><span class="language-javascript">  <span class="hljs-keyword">const</span> ordering = <span class="hljs-title function_">getSortOrdering</span>(prop, order);</span><br><span class="language-javascript">  <span class="hljs-title function_">getApi</span>(&#123;</span><br><span class="language-javascript">    <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">pagesize</span>: <span class="hljs-number">10</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">ordering</span>: ordering</span><br><span class="language-javascript">  &#125;)</span><br><span class="language-javascript">    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">      dataList.<span class="hljs-property">tableData</span> = res.<span class="hljs-property">data</span>;</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript">&#125;;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li></ol><h3 id="自定义提示信息"><a href="#自定义提示信息" class="headerlink" title="自定义提示信息"></a>自定义提示信息</h3><p>tip采用拼接string字符串形式，换行使用<code>&lt;/br&gt;</code>，通过raw-content注入到组件中</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-tooltip</span> <span class="hljs-attr">:content</span>=<span class="hljs-string">&quot;tip&quot;</span> <span class="hljs-attr">placement</span>=<span class="hljs-string">&quot;top&quot;</span> <span class="hljs-attr">raw-content</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Warning</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-tooltip</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="通过deep改变组件样式"><a href="#通过deep改变组件样式" class="headerlink" title="通过deep改变组件样式"></a>通过deep改变组件样式</h3><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;scss&quot;</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span><br><span class="language-css">:<span class="hljs-built_in">deep</span>(.el-tabs__header) &#123;</span><br><span class="language-css">  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;</span><br><span class="language-css">&#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="typescript忽略类型检查"><a href="#typescript忽略类型检查" class="headerlink" title="typescript忽略类型检查"></a>typescript忽略类型检查</h3><p>单行忽略(添加到特定行的行前来忽略这一行的错误)<br>&#x2F;&#x2F; @ts-ignore</p><p>跳过对某些文件的检查 (添加到该文件的首行才起作用)<br>&#x2F;&#x2F; @ts-nocheck</p><p>对某些文件的检查<br>&#x2F;&#x2F; @ts-check</p>]]></content>
    
    
    
    <tags>
      
      <tag>typescript</tag>
      
      <tag>vue3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（1-2）基础写法</title>
    <link href="/2022/04/26/vue3%E7%AC%94%E8%AE%B0%EF%BC%881-2%EF%BC%89%E5%9F%BA%E7%A1%80%E5%86%99%E6%B3%95/"/>
    <url>/2022/04/26/vue3%E7%AC%94%E8%AE%B0%EF%BC%881-2%EF%BC%89%E5%9F%BA%E7%A1%80%E5%86%99%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本篇是上一篇的延伸，使用pinia作为状态管理，对项目进行了一次升级。<br>使用setup语法糖进行组合式API的编写。</p></blockquote><h3 id="setup语法糖"><a href="#setup语法糖" class="headerlink" title="setup语法糖"></a>setup语法糖</h3><p>执行顺序：</p><ol><li>创建组件实例</li><li>props解析</li><li>setup调用执行（一次）</li><li>组件创建beforeCreate</li></ol><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> dataList = <span class="hljs-title function_">reactive</span>(&#123;</span><br><span class="language-javascript">  <span class="hljs-attr">tableData</span>: [],</span><br><span class="language-javascript">  <span class="hljs-attr">pageTotal</span>: <span class="hljs-number">0</span>,</span><br><span class="language-javascript">  <span class="hljs-attr">query</span>: &#123; <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">pagesize</span>: <span class="hljs-number">10</span> &#125;</span><br><span class="language-javascript">&#125;)</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> &#123; tableData, pageTotal, query &#125; = <span class="hljs-title function_">toRefs</span>(dataList)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></div></td></tr></table></figure><ol><li>toRefs(dataList)，为对象属性添加响应式</li><li>不需要return对象、方法等</li><li>通过<code>defineProps</code>指定当前props类型，获得上下文props对象</li></ol><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>(&#123;<br>  <span class="hljs-attr">show</span>: &#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>,<br>    <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span><br>  &#125;<br>&#125;)<br><br><span class="hljs-comment">// 增加类型-不能使用default</span><br><span class="hljs-keyword">const</span> props = defineProps&lt;&#123;<br>  <span class="hljs-attr">show</span>: <span class="hljs-title class_">String</span><br>&#125;&gt;<br></code></pre></div></td></tr></table></figure><h3 id="自定义指令"><a href="#自定义指令" class="headerlink" title="自定义指令"></a>自定义指令</h3><p>需要对普通 DOM 元素进行底层操作，会用到自定义指令。</p><ol><li><p>全局自定义指令</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">app.<span class="hljs-title function_">directive</span>(<span class="hljs-string">&#x27;focus&#x27;</span>,&#123;<br> <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el</span>)&#123;<br>  el.<span class="hljs-title function_">focus</span>()<br> &#125;<br>&#125;)<br><br><span class="hljs-comment">//组件使用</span><br>&lt;input type=<span class="hljs-string">&quot;text&quot;</span> v-focus /&gt;<br></code></pre></div></td></tr></table></figure></li><li><p>局部自定义指令<br>binding是一个对象，包含该指令的所有信息。（arg 自定义指令的参数名；value 自定义指令绑定的值；oldValue 指令绑定的前一个值；dir 被执行的钩子函数；modifiers：一个包含修饰符的对象）</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> defineDir = &#123;<br> <span class="hljs-attr">focus</span>: &#123;<br>  <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>)&#123;<br>    el.<span class="hljs-title function_">focus</span>()<br>    el.<span class="hljs-property">style</span>.<span class="hljs-property">left</span> = binding.<span class="hljs-property">value</span>.<span class="hljs-property">left</span>+<span class="hljs-string">&#x27;px&#x27;</span><br>  &#125;<br> &#125;<br>&#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br> <span class="hljs-attr">directives</span>: defineDir,<br> <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-keyword">const</span> posData = &#123;<br>   <span class="hljs-attr">left</span>:<span class="hljs-number">20</span><br>  &#125;<br> &#125;<br>&#125;<br><br><span class="hljs-comment">//组件使用</span><br>&lt;input type=<span class="hljs-string">&quot;text&quot;</span> v-focus /&gt;<br></code></pre></div></td></tr></table></figure></li><li><p>自定义指令中的生命周期钩子函数<br>一个指令定义对象可以提供如下几个钩子函数（可选）:<br>created ：绑定元素属性或事件监听器被应用之前调用。(eg: 附加在 v-on 事件监听器前调用的事件监听器时)。<br>beforeMounted ：当指令第一次绑定到元素并且在挂载父组件之前执行。<br>mounted ：绑定元素的父组件被挂载之后调用。<br>beforeUpdate ：在更新包含组件的 VNode 之前调用。<br>updated ：在包含组件的 VNode 及其子组件的 VNode 更新后调用。<br>beforeUnmounted ：在卸载绑定元素的父组件之前调用<br>unmounted ：当指令与元素解除绑定且父组件已卸载时，只调用一次。</p></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>typescript</tag>
      
      <tag>vue3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue3笔记（1-1）基础写法</title>
    <link href="/2022/04/26/vue3%E7%AC%94%E8%AE%B0%EF%BC%881-1%EF%BC%89%E5%9F%BA%E7%A1%80%E5%86%99%E6%B3%95/"/>
    <url>/2022/04/26/vue3%E7%AC%94%E8%AE%B0%EF%BC%881-1%EF%BC%89%E5%9F%BA%E7%A1%80%E5%86%99%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<blockquote><p>人生兜兜转转几年没更新，转眼从产品变到项目管理又变成了前端。<br>最近使用Vue3+TS搭建了公司的服务平台，使用vue-cli5构建项目，UI使用了element-plus，记录一下代码写法和使用过程中的坑。</p></blockquote><span id="more"></span><h3 id="版本号对应"><a href="#版本号对应" class="headerlink" title="版本号对应"></a>版本号对应</h3><p>Vue CLI 4.5以下，对应的是Vue2。<br>Vue CLI 4.5及以上，对应的是Vue3，当然，创建项目的时候可以选择Vue2。</p><h3 id="配置使用IP访问"><a href="#配置使用IP访问" class="headerlink" title="配置使用IP访问"></a>配置使用IP访问</h3><p><code>package.json</code>中添加启动配置</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-string">&quot;serve&quot;</span>: <span class="hljs-string">&quot;vue-cli-service serve  --host 0.0.0.0&quot;</span><br></code></pre></div></td></tr></table></figure><h3 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h3><ol><li>ref定义一个基本类型（包含一个数据）的响应式，创建一个包含响应式数据的引用对象。通过给value属性添加getter&#x2F;setter实现对数据的劫持。</li><li>reactive定义对象（可以包含多个数据）的响应式，返回响应式代理对象（基于Proxy实现），会影响对象内部所有的嵌套属性–递归深度响应式。通过Proxy实现对对象内部所有数据的劫持，并通过Reflect操作对象内部的数据。</li></ol><h3 id="组合式API"><a href="#组合式API" class="headerlink" title="组合式API"></a>组合式API</h3><ol><li>Composition API 可以减少强耦合，避免方法之间互相 this 调用，方法之间互相共享变量，后期维护很麻烦。</li></ol><h3 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h3><p><img src="/img/vue2-1.png" alt="vue3搜索"></p><h3 id="基础写法"><a href="#基础写法" class="headerlink" title="基础写法"></a>基础写法</h3><p>功能：通过表单内容搜索，列表展示搜索结果。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-main</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;server-main&quot;</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">el-form</span></span><br><span class="hljs-tag">      <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;serverUserFormRef&quot;</span></span><br><span class="hljs-tag">      <span class="hljs-attr">:model</span>=<span class="hljs-string">&quot;serverUserForm&quot;</span></span><br><span class="hljs-tag">      <span class="hljs-attr">:rules</span>=<span class="hljs-string">&quot;rules&quot;</span></span><br><span class="hljs-tag">      &gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;姓名&quot;</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">&quot;alias_name&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span></span><br><span class="hljs-tag">        <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;serverUserForm.alias_name&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;alias_name&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入用户名&quot;</span></span><br><span class="hljs-tag">      &gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">el-input</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span></span><br><span class="hljs-tag">          <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;primary&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">icon</span>=<span class="hljs-string">&quot;Edit&quot;</span></span><br><span class="hljs-tag">          @<span class="hljs-attr">click.prevent</span>=<span class="hljs-string">&quot;handleAdd(serverUserFormRef)&quot;</span></span><br><span class="hljs-tag">        &gt;</span>创建<br>      <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">el-form</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">el-table</span> <span class="hljs-attr">:data</span>=<span class="hljs-string">&quot;tableData&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(item, index) in columns&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span></span><br><span class="hljs-tag">          <span class="hljs-attr">v-bind</span>=<span class="hljs-string">&quot;item&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">show-overflow-tooltip</span>&gt;</span> <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">el-table</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">el-main</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs JavaScript">&lt;script lang=<span class="hljs-string">&quot;ts&quot;</span>&gt;<br><span class="hljs-keyword">import</span> &#123; defineComponent, ref, reactive, toRefs, onMounted &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; getUsers, createUser&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/api/users&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ElMessage</span>, <span class="hljs-title class_">ElMessageBox</span>, <span class="hljs-title class_">ElNotification</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;element-plus&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Search</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@element-plus/icons-vue&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">FormInstance</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;element-plus&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineComponent</span>(&#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;XX&quot;</span>,<br>  <span class="hljs-attr">components</span>: &#123;&#125;,<br>  <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> emyptForm = &#123;<br>      <span class="hljs-attr">alias_name</span>: <span class="hljs-string">&quot;&quot;</span>,<br>    &#125;<br>    <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>(&#123;<br>      <span class="hljs-attr">serverUserForm</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(emyptForm)),<br>      <span class="hljs-attr">tableData</span>:[]<br>    &#125;);<br>    <span class="hljs-keyword">const</span> columns = [<br>      &#123; <span class="hljs-attr">label</span>: <span class="hljs-string">&quot;用户&quot;</span>, <span class="hljs-attr">prop</span>: <span class="hljs-string">&quot;alias_name&quot;</span>, <span class="hljs-attr">width</span>: <span class="hljs-string">&quot;200&quot;</span> &#125;,<br>    ];<br><br>    <span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-title function_">getData</span>();<br>    &#125;);<br><br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">getData</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>      <span class="hljs-title function_">getUsers</span>(&#123;&#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">const</span> &#123; data &#125; = res.<span class="hljs-property">data</span><br>        state.<span class="hljs-property">tableData</span> = data.<span class="hljs-property">results</span>;<br>      &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>        <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;获取数据错误！&#x27;</span>);<br>      &#125;)<br>    &#125;<br>    <span class="hljs-keyword">const</span> serverUserFormRef = ref&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">FormInstance</span>&gt;();<br>    <span class="hljs-keyword">const</span> rules = &#123;<br>      <span class="hljs-attr">alias_name</span>: [&#123; <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;请输入用户名&quot;</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">&quot;blur&quot;</span> &#125;]<br>    &#125;;<br><br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">clearAll</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>      state.<span class="hljs-property">serverUserForm</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(emyptForm));<br>    &#125;<br>    <span class="hljs-comment">// 新增</span><br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleAdd</span> = (<span class="hljs-params">formEl</span>) =&gt; &#123;<br>        formEl.<span class="hljs-title function_">validate</span>(<span class="hljs-function">(<span class="hljs-params">valid: boolean</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (valid) &#123;<br>          <span class="hljs-keyword">const</span> params = state.<span class="hljs-property">serverUserForm</span>;<br>          <span class="hljs-title function_">createUser</span>(params).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>              <span class="hljs-keyword">const</span> &#123; code, data &#125; = res.<span class="hljs-property">data</span><br>              <span class="hljs-keyword">if</span>(code == <span class="hljs-number">0</span>) &#123;<br>                  <span class="hljs-title class_">ElNotification</span>(&#123;<br>                      <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;操作成功&#x27;</span>,<br>                      <span class="hljs-attr">message</span>: <span class="hljs-title function_">h</span>(<span class="hljs-string">&#x27;i&#x27;</span>, &#123; <span class="hljs-attr">style</span>: <span class="hljs-string">&#x27;color: teal&#x27;</span> &#125;, <span class="hljs-string">&#x27;用户已新增！&#x27;</span>),<br>                  &#125;);<br>                  <span class="hljs-title function_">getData</span>();<br>              &#125; <span class="hljs-keyword">else</span> &#123;<br>                  <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;新增用户错误，请重试！&#x27;</span>);<br>              &#125; <br>          &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;<br>              <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;服务器修复中，请稍后重试！&#x27;</span>);<br>          &#125;);<br>          <span class="hljs-title function_">clearAll</span>();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>      &#125;)<br>    &#125;<br>    <span class="hljs-keyword">return</span> &#123;<br>      serverUserFormRef,<br>      ...<span class="hljs-title function_">toRefs</span>(state),<br>      rules,     <br>      handleAdd,<br>      columns,<br>    &#125;;<br>  &#125;<br>&#125;);<br>&lt;/script&gt;<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>typescript</tag>
      
      <tag>vue3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>工作-短暂的PM随想</title>
    <link href="/2022/02/28/%E5%B7%A5%E4%BD%9C-%E7%9F%AD%E6%9A%82%E7%9A%84PM%E9%9A%8F%E6%83%B3/"/>
    <url>/2022/02/28/%E5%B7%A5%E4%BD%9C-%E7%9F%AD%E6%9A%82%E7%9A%84PM%E9%9A%8F%E6%83%B3/</url>
    
    <content type="html"><![CDATA[<p>这起起落落曲曲折折像极了人生。— ginny</p><span id="more"></span><p>记录我项目管理+产品经理的神奇一年。<br>悟出的都是人生。</p><p>需求就像渣男的出轨，只有零次和无数次。</p><p>不管有没有意义，真正做的事才让你不焦虑。</p><p>概念恒久远，ROI永流传。</p>]]></content>
    
    
    
    <tags>
      
      <tag>工作实习</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>react笔记（3）react-redux数据管理</title>
    <link href="/2020/05/28/react%E7%AC%94%E8%AE%B0%EF%BC%883%EF%BC%89react-redux%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/"/>
    <url>/2020/05/28/react%E7%AC%94%E8%AE%B0%EF%BC%883%EF%BC%89react-redux%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/</url>
    
    <content type="html"><![CDATA[<blockquote><p>前期考虑不周的坑，后期总要来填的。— ginny Guo<br>在这个项目的时候技术选型的时候，因为“时间周期较短”和“产品交流不充分”，没能完全get到prd中的一些细节问题，当时感觉传统的状态管理已经完全hold住这个项目了，结果在后期出现了一个state对应多个view改变，多个action触发一个state改变等问题。多个组件保留状态需要多个copy，简直是灾难啊啊！！！更加难过的是，后期出现了渲染太慢的问题，严重影响用户体验，所以不得不重构引入Redux状态管理了。<br>本篇记录了react-redux的使用，以及项目前后设计的对比，为以后技术选型做一个铺垫。<br>本篇真的写了好几天啊，好难讲清楚Orz，以后还要填坑几次才行。</p></blockquote><span id="more"></span><h4 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h4><p><code>Redux</code> 是 <code>JavaScript</code> 状态容器，提供可预测化的状态管理。<br>其数据流大致如下：<br><img src="/img/redux-1.jpg" alt="redux"></p><h4 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h4><p>Redux 中只有一个单一的 <code>Store</code> ，存储了所有共享状态（以一个对象树的形式储存）。<br>合并后的reducer（之后讨论）作为参数传入store。</p><p>根目录下入口文件index.js中添加store：</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123;<span class="hljs-title class_">Provider</span>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123;createStore&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;redux&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App&#x27;</span><br><span class="hljs-keyword">import</span> myreducer <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./reducers&#x27;</span>;<br><br><span class="hljs-keyword">const</span> store = <span class="hljs-title function_">createStore</span>(myreducers);<br><br><span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">render</span>(<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Provider</span> <span class="hljs-attr">store</span>=<span class="hljs-string">&#123;store&#125;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Provider</span>&gt;</span></span>,<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;root&#x27;</span>)<br>);<br></code></pre></div></td></tr></table></figure><h4 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h4><p>Redux中把动作和状态独立，通过动作来改变状态。<code>Action</code> 是改变 <code>Store</code> 数据的唯一来源，包含 <code>View</code> 中数据变化、用户操作、服务器响应等等。</p><p>Redux中通过Action创建函数的结果（返回值是一个action对象），传给 <code>dispatch</code> 方法即可发起一次dispatch过程。<br>Store里能直接通过 <code>store.dispatch()</code> 调用dispatch方法。</p><p>Action本质上是一个对象，type是一个字符串常量，表示要执行的动作。<br>Action只有指定动作，不包含更新状态的方法，方法在下面的reducer中会提到。</p><p>触发AReducer的actions，存放于actions&#x2F;index.js：</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// some actions</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">AddSth</span> = (<span class="hljs-params">data</span>) =&gt; (&#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;sthAdd&#x27;</span>,<br>    data<br>&#125;)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">DelSth</span> = (<span class="hljs-params">data</span>) =&gt; (&#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;sthDel&#x27;</span>,<br>    data<br>&#125;)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">UpdateSth</span> = (<span class="hljs-params">data</span>) =&gt; (&#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;sthUpdate&#x27;</span>,<br>    data<br>&#125;)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">ClearList</span> = (<span class="hljs-params">data</span>) =&gt; (&#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;listClear&#x27;</span>,<br>    data<br>&#125;);<br></code></pre></div></td></tr></table></figure><h4 id="Reducer"><a href="#Reducer" class="headerlink" title="Reducer"></a>Reducer</h4><p><code>Reducer</code> 是一个用于处理事件的纯函数，决定每个action如何改变应用的state。<br>在本项目中为了方便区分各个业务逻辑（互相独立），为每个业务逻辑编写一个reducer，存放于reducers文件夹中间，reduce文件夹中的index.js合并所有reduce，作为一个根级的reducer。</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123;combineReducers&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;redux&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">AReducer</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;reducers&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">BReducer</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;reducers&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">CReducer</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;reducers&#x27;</span>;<br><br><span class="hljs-keyword">const</span> myreducer = <span class="hljs-title function_">combineReducers</span>(&#123;<br>    <span class="hljs-title class_">AReducer</span>,<br>    <span class="hljs-title class_">BReducer</span>,<br>    <span class="hljs-title class_">CReducer</span>,<br>&#125;);<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> myreducers;<br></code></pre></div></td></tr></table></figure><p>单个reduce是形式为 <code>(state, action) =&gt; state</code> 的纯函数，state的形式可以是基本类型、数组、对象等等。在本项目中状态是存储的数据，数据用数组list来表示。</p><p>举例AReducer，代码如下：</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// reducer </span><br><span class="hljs-keyword">import</span> _ <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;lodash&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">AReducer</span>(<span class="hljs-params">list:[], action</span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123;data = &#123;&#125;&#125; = action;<br>    <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;sthAdd&#x27;</span>: &#123;<br>           <span class="hljs-keyword">const</span> arrIndex = _.<span class="hljs-title function_">findIndex</span>(<br>                list,<br>                <span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> <span class="hljs-built_in">parseInt</span>(item.<span class="hljs-property">id</span>, <span class="hljs-number">10</span>) === <span class="hljs-built_in">parseInt</span>(data.<span class="hljs-property">id</span>, <span class="hljs-number">10</span>)<br>            );<br>            <span class="hljs-keyword">if</span> (arrIndex &gt; -<span class="hljs-number">1</span>) &#123;<br>                list.<span class="hljs-title function_">splice</span>(arrIndex, <span class="hljs-number">1</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                list.<span class="hljs-title function_">push</span>(data);<br>            &#125;<br>            <span class="hljs-keyword">return</span> list;<br>        &#125;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;sthDel&#x27;</span>: &#123;<br>            <span class="hljs-keyword">const</span> arrIndex = _.<span class="hljs-title function_">findIndex</span>(<br>                list,<br>                <span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> <span class="hljs-built_in">parseInt</span>(item.<span class="hljs-property">id</span>, <span class="hljs-number">10</span>) === <span class="hljs-built_in">parseInt</span>(data.<span class="hljs-property">id</span>, <span class="hljs-number">10</span>)<br>            );<br>            <span class="hljs-keyword">if</span> (arrIndex &gt; -<span class="hljs-number">1</span>) &#123;<br>                list.<span class="hljs-title function_">splice</span>(arrIndex, <span class="hljs-number">1</span>);<br>            &#125;<br>            <span class="hljs-keyword">return</span> list;<br>        &#125;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;sthUpdate&#x27;</span>: &#123;<br>          list.<span class="hljs-property">data</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> &#123;<br>              <span class="hljs-keyword">if</span> (<span class="hljs-built_in">parseInt</span>(item.<span class="hljs-property">id</span>, <span class="hljs-number">10</span>) === <span class="hljs-built_in">parseInt</span>(data.<span class="hljs-property">id</span>, <span class="hljs-number">10</span>)) &#123;<br>                item.<span class="hljs-property">xxx</span> = data.<span class="hljs-property">xxx</span>;<br>              &#125;<br>              <span class="hljs-keyword">return</span> item;<br>          &#125;);<br>          <span class="hljs-keyword">return</span> list;<br>        &#125; <br><br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;listClear&#x27;</span>: &#123;<br>            <span class="hljs-keyword">return</span> [];<br>        &#125;<br><br>        <span class="hljs-attr">default</span>:<br>            <span class="hljs-keyword">return</span> list;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="react-redux容器组件"><a href="#react-redux容器组件" class="headerlink" title="react-redux容器组件"></a>react-redux容器组件</h4><p><code>react-redux</code> 使用容器组件来把展示组件连接到Redux ，容器组件向Redux派发actions，同时监听state改变。<br>对于容器组件和展示组件的划分附录中有一篇官网推荐的阅读。目前来说，我在本项目中把需要处理共享数据的页面作为了容器组件，后期可能还要修改下。</p><p>可以使用 <code>mapStateToProps</code> 来订阅 <code>Store</code>，其原理相当于在Store上安装了一个监听器，当Store中state改变了，子组件重新渲染。<br>可以定义 <code>mapDispatchToProps</code> 方法接收dispatch()方法并返回期望注入到展示组件的props中的回调方法。<br>在本项目中把action作为props整合数据，相当于包了一层dispatch的执行。</p><p>假设AList为容器组件，AList中代码如下：</p><figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123;connect&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">AItem</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../components/AItem&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123;<span class="hljs-title class_">AddSth</span>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./actions&#x27;</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AList</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123;<br>      <span class="hljs-attr">aList</span>: []<br>    &#125;;<br><br>    getBetList = <span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-keyword">const</span> &#123;list&#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>        <span class="hljs-keyword">return</span> list || [];<br>    &#125;<br><br>    listAddHandle = <span class="hljs-function">(<span class="hljs-params">obj</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">const</span> &#123;<span class="hljs-title class_">AddSth</span>&#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>;<br>        <span class="hljs-title class_">AddSth</span>(obj);<br>    &#125;<br><br>    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">const</span> aList = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getBetList</span>();<br>        <span class="hljs-keyword">return</span> (<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;</span>&#x27;<span class="hljs-attr">components-alist</span>&#x27;&#125;&gt;</span></span><br><span class="language-xml">          &#123;aList.map((item) =&gt; </span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item.id&#125;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">AItem</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;item&#125;</span> <span class="hljs-attr">onAdd</span> = <span class="hljs-string">&#123;this.listAddHandle.bind(this)&#125;/</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>)&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">mapStateToProps</span> = state =&gt; (&#123;<br>    <span class="hljs-attr">aList</span>: state.<span class="hljs-property">list</span><br>&#125;);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">connect</span>(mapItemToProps, &#123;<span class="hljs-title class_">AddSth</span>&#125;)(<span class="hljs-title class_">AList</span>);<br></code></pre></div></td></tr></table></figure><p><code>附录</code>：<br><a href="https://www.redux.org.cn/">Redux</a><br><a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0">Presentational and Container Components</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
      <tag>react</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>react笔记（2）websocket实时改变数据</title>
    <link href="/2020/05/14/react%E7%AC%94%E8%AE%B0%EF%BC%882%EF%BC%89websocket%E5%AE%9E%E6%97%B6%E6%94%B9%E5%8F%98%E6%95%B0%E6%8D%AE/"/>
    <url>/2020/05/14/react%E7%AC%94%E8%AE%B0%EF%BC%882%EF%BC%89websocket%E5%AE%9E%E6%97%B6%E6%94%B9%E5%8F%98%E6%95%B0%E6%8D%AE/</url>
    
    <content type="html"><![CDATA[<blockquote><p>项目中有个需求，需要实时改变数据。实时改变数据有两种方式。<br>第一种方式是通过Ajax轮询，浏览器需要不断的向服务器发出请求，在本项目中需要改变数据的地方有多处，连续的Ajax请求对服务器的压力很大，所以不适合这种方式。<br>第二种方式是通过HTML5 定义的 WebSocket 协议，使浏览器和服务器保持持久性的连接，服务端向客户端主动推送信息。<br>本项目中采用了第二种方式，这里对react中使用WebSocket实时改变数据做了一点笔记。</p></blockquote><span id="more"></span><h4 id="WebSocket简介"><a href="#WebSocket简介" class="headerlink" title="WebSocket简介"></a>WebSocket简介</h4><p><code>WebSocket</code> 是 HTML5 开始提供的一种在单个 <code>TCP</code> 连接上进行全双工通讯的协议，本质上是一个基于 <code>TCP</code> 的协议。<br>在 <code>WebSocket API</code> 中，浏览器和服务器只需要完成一次握手，两者之间就直接可以创建持久性的连接，并进行<code>双向数据传输</code>。  </p><h4 id="WebSocket创建、使用API"><a href="#WebSocket创建、使用API" class="headerlink" title="WebSocket创建、使用API"></a>WebSocket创建、使用API</h4><p>创建 WebSocket 对象</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">var</span> ws = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(url, [protocol] );<br></code></pre></div></td></tr></table></figure><p>在获取 WebSocket 连接后，可以通过 <code>send</code> 方法来向服务器发送数据，并通过 <code>onmessage</code> 事件来接收服务器返回的数据。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">ws.<span class="hljs-property">onopen</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// Web Socket 已连接上，使用 send() 方法发送数据</span><br>  ws.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;发送数据&quot;</span>);<br>  <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;数据发送中...&quot;</span>);<br>&#125;;<br>                <br>ws.<span class="hljs-property">onmessage</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">evt</span>) &#123; <br>  <span class="hljs-keyword">var</span> received_msg = evt.<span class="hljs-property">data</span>;<br>  <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;数据已接收...&quot;</span>);<br>&#125;;<br>ws.<span class="hljs-property">onclose</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123; <br>  <span class="hljs-comment">// 关闭 websocket</span><br>  <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;连接已关闭...&quot;</span>); <br>&#125;;               <br></code></pre></div></td></tr></table></figure><h4 id="react中使用WebSocket"><a href="#react中使用WebSocket" class="headerlink" title="react中使用WebSocket"></a>react中使用WebSocket</h4><p> 首先抽取一个通用方法开启WebSocket</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">startWs</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-comment">// wss://域名/api/wsname</span><br><br>    <span class="hljs-keyword">const</span> host = <span class="hljs-string">&#x27;aaa.com&#x27;</span>;<br>    <span class="hljs-keyword">let</span> protocol = <span class="hljs-string">&#x27;wss&#x27;</span>;<br>    <span class="hljs-keyword">const</span> &#123;<span class="hljs-attr">host</span>: host2&#125; = <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">protocol</span> === <span class="hljs-string">&#x27;http:&#x27;</span> &amp;&amp; host2 !== <span class="hljs-string">&#x27;localhost:3000&#x27;</span>) &#123;<br>        protocol = <span class="hljs-string">&#x27;ws&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;protocol&#125;</span>://<span class="hljs-subst">$&#123;host&#125;</span>/api/wsname`</span>);<br>&#125;;<br></code></pre></div></td></tr></table></figure><p>在page中使用WebSocket，并将数据传递给组件</p><figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Index</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>        <span class="hljs-variable language_">super</span>(props);<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span> = <span class="hljs-title function_">startWs</span>();<br>    &#125;<br><br>    <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">watchWs</span>();<br>    &#125;<br><br>    componentWillUnmount = <span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>.<span class="hljs-title function_">close</span>();<br>    &#125;<br><br>    watchWs = <span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">evt</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">let</span> data = &#123;&#125;;<br>            <span class="hljs-keyword">try</span> &#123;<br>                data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(evt.<span class="hljs-property">data</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (e) &#123; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e); &#125;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123;<br>                <span class="hljs-attr">currentData</span>: data,<br>            &#125;);<br>        &#125;;<br>    &#125;<br><br>    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">const</span> &#123; item, currentData &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>        <span class="hljs-keyword">return</span> (<br>            <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;pages-index&quot;</span> &gt;</span></span><br><span class="language-xml">                 <span class="hljs-tag">&lt;<span class="hljs-name">Item</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;item&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">                    <span class="hljs-attr">currentData</span>=<span class="hljs-string">&#123;currentData&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">                /&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>)<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>组件接受数据后实时改变自身。<br>这里使用<code>getDerivedStateFromProps</code>这个生命周期，意思就是从props中获取state，即将传入的props映射到state上面，意味着即使你的props没有任何变化，而是父state发生了变化，导致子组件发生了re-render，这个生命周期函数依然会被调用。<br><code>getDerivedStateFromProps</code>是一个<code>静态函数</code>，也就是这个函数不能通过this访问到class的属性，也并不推荐直接访问属性。而是应该通过参数提供的<code>nextProps</code>以及<code>prevState</code>来进行判断，根据新传入的props来映射到state。</p><figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>        <span class="hljs-variable language_">super</span>(props);<br>    &#125;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-title function_">getDerivedStateFromProps</span>(<span class="hljs-params">nextProps, prevState</span>) &#123;<br>        <span class="hljs-keyword">const</span> &#123;currentData = &#123;&#125;&#125; = nextProps;<br>        <span class="hljs-keyword">if</span> (currentData !== prevState.<span class="hljs-property">currentData</span>) &#123;<br>          <span class="hljs-keyword">return</span> newObj &#123;<br>            <span class="hljs-attr">attr</span>: attr1<br>          &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">const</span> &#123;newObj&#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>        <span class="hljs-keyword">return</span> (<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;components-item&quot;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;newObj.attr&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>)<br>        &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>这里Item组件通过接受父组件的props来改变自身状态。</p>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
      <tag>react</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>react笔记（1）父子组件通信</title>
    <link href="/2020/05/07/react%E7%AC%94%E8%AE%B0%EF%BC%881%EF%BC%89%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1/"/>
    <url>/2020/05/07/react%E7%AC%94%E8%AE%B0%EF%BC%881%EF%BC%89%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1/</url>
    
    <content type="html"><![CDATA[<blockquote><p> 最近做了一个pc项目，技术选型为react，中间涉及到了各种状态管理、消息传递，做个小小的笔记记录下，方便以后做同类项目可以快速起步。</p></blockquote><span id="more"></span><h4 id="项目使用框架版本"><a href="#项目使用框架版本" class="headerlink" title="项目使用框架版本"></a>项目使用框架版本</h4><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;dependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;@babel/preset-react&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^7.9.4&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;react&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^16.12.0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;webpack&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;4.41.0&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></div></td></tr></table></figure><h4 id="父组件传递消息给子组件"><a href="#父组件传递消息给子组件" class="headerlink" title="父组件传递消息给子组件"></a>父组件传递消息给子组件</h4><p>父组件可以向子组件通过传 <code>props</code> 的方式进行通信。<br>子组件Child.jsx</p><figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span>&#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>)&#123;<br>        <span class="hljs-variable language_">super</span>(props);<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123;<br>            <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;ginny is a child&#x27;</span>,<br>            <span class="hljs-attr">message</span>:<span class="hljs-string">&#x27;&#x27;</span><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>)&#123;<br>      <span class="hljs-keyword">const</span> &#123;name&#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>      <span class="hljs-keyword">const</span> &#123;message&#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>;<br>        <span class="hljs-keyword">return</span>(<br>            <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;component-child&quot;</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;message&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>        )<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>父组件Father.jsx</p><figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Child&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Father</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>)&#123;<br>        <span class="hljs-variable language_">super</span>(props);<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123;<br>            <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;I am father&#x27;</span>,<br>            <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;Here is a message&#x27;</span><br>        &#125;<br>    &#125;<br><br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123;message&#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;component-father&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">message</span>=<span class="hljs-string">&#123;message&#125;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Child</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="子组件传递消息给父组件"><a href="#子组件传递消息给父组件" class="headerlink" title="子组件传递消息给父组件"></a>子组件传递消息给父组件</h4><p>子组件向父组件通讯，也是通过父组件向子组件传递 <code>props</code> 进行通讯，只是父组件传递的，是作用域为父组件自身的函数。子组件调用该函数，把想要传递的信息以参数的方式传递给父组件。<br>在子组件Child中绑定 onClick 事件。 调用 change 方法，在change方法中调用父组件的 childClick 方法。<br>子组件Child.jsx</p><figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span>&#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>)&#123;<br>        <span class="hljs-variable language_">super</span>(props);<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>=&#123;<br>            <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;ginny is a child&#x27;</span>,<br>            <span class="hljs-attr">messageFromChild</span>:<span class="hljs-string">&#x27;Here is a message from ginny!&#x27;</span><br>        &#125;<br>    &#125;<br><br>    change = <span class="hljs-function">(<span class="hljs-params">msg</span>) =&gt;</span> &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-title function_">childClick</span>(msg);<br>    &#125;<br><br>    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>)&#123;<br>      <span class="hljs-keyword">const</span> &#123;name, messageFromChild&#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>      <span class="hljs-keyword">const</span> &#123;message&#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>;<br>        <span class="hljs-keyword">return</span>(<br>            <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;component-child&quot;</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;message&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;this.change.bind(this,</span> <span class="hljs-attr">messageFromChild</span>)&#125;&gt;</span>点击<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>        )<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>父组件Father.jsx</p><figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Child&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Father</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>)&#123;<br>        <span class="hljs-variable language_">super</span>(props);<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123;<br>            <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;I am father&#x27;</span>,<br>            <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;Here is a message&#x27;</span><br>        &#125;<br>    &#125;<br>  childClickHandle = <span class="hljs-function">(<span class="hljs-params">msg</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Message form child is:&#x27;</span> + msg);<br>  &#125;<br><br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123;message&#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;component-father&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">message</span>=<span class="hljs-string">&#123;message&#125;</span> <span class="hljs-attr">childClick</span>=<span class="hljs-string">&#123;this.childClickHandle&#125;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Child</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="函数this指向"><a href="#函数this指向" class="headerlink" title="函数this指向"></a>函数this指向</h4><p>本项目中涉及到各种函数调用，所以最后对 <code>this</code> 的指向问题稍微加一个小小的总结。<br>非箭头函数：<br>(1) <code>this</code> 指向调用其所在函数的对象（离其最近的对象）；<br>(2) 构造函数下，<code>this</code>与被创建的新对象绑定；<br>(3) DOM事件，<code>this</code>指向触发事件的元素；<br>(3) 当函数通过Function对象的原型中继承的方法 <code>call</code> 和 <code>apply</code> 方法调用时， 其函数内部的<code>this</code>值可绑定到 <code>call</code>和<code>apply</code> 方法指定的第一个对象上， 如果第一个参数不是对象，JavaScript内部会尝试将其转换成对象然后指向它；<br>(4) 通过<code>bind</code>方法绑定后， 函数将被永远绑定在其第一个参数对象上， 而无论其在什么情况下被调用；<br>(5) 当代码被内联处理函数调用时，它的<code>this</code>指向监听器所在的DOM元素；<br>(6) 当代码被包括在函数内部执行时，其<code>this</code>指向等同于 函数直接调用的情况，即在非严格模式指向全局对象<code>window</code>， 在严格模式指向<code>undefined</code>；<br>(7) 对于延时函数内部<code>setTimeout</code>和<code>setInterval</code>的回调函数的<code>this</code>指向全局对象<code>window</code>。<br>箭头函数：<br>(8) 箭头函数不绑定this， 它会捕获其所在（即定义的位置）上下文的<code>this</code>值， 作为自己的this值，<code>call,apply,bind</code>方法对于箭头函数来说只是传入参数，对它的<code>this</code> 无影响；</p><p>在本项目中，如果组件触发自身的方法，需要将方法写成箭头函数的形式，这样调用的时候就会指向自身，可以获取自身的state等等属性。如果不写成箭头函数，只是普通函数，则在绑定函数的地方需要使用this.change.bind(this)，把组件当前的this绑定在函数上。</p>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
      <tag>react</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ngixn笔记（1） 前后端跨域设置</title>
    <link href="/2019/08/12/ngixn%E7%AC%94%E8%AE%B0%EF%BC%881%EF%BC%89%E5%89%8D%E5%90%8E%E7%AB%AF%E8%B7%A8%E5%9F%9F%E8%AE%BE%E7%BD%AE/"/>
    <url>/2019/08/12/ngixn%E7%AC%94%E8%AE%B0%EF%BC%881%EF%BC%89%E5%89%8D%E5%90%8E%E7%AB%AF%E8%B7%A8%E5%9F%9F%E8%AE%BE%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<blockquote><p>最近公司项目需要我调用别的部门开发的接口，由于部门之间服务器独立，必然涉及到了跨域问题。这篇文章记录了我配置的nginx，前后端允许跨域。</p></blockquote><span id="more"></span><h3 id="跨域的产生"><a href="#跨域的产生" class="headerlink" title="跨域的产生"></a>跨域的产生</h3><p>首先明确跨域的产生是由于浏览器通源策略，限制了从同一个源加载的文档或脚本如何与来自另一个源的资源进行交互。这是一个用于隔离潜在恶意文件的重要安全机制。</p><h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>发了请求之后迟迟没有收到回复，打开控制台一看，请求404了，再仔细找原因之后发现，我原来发送的<code>post</code>请求变成了<code>option</code>请求。<br><img src="/img/nginx1-error2.png" alt="chrome跨域"></p><p>chrome认为前端没有添加头部信息，所以不允许前端页面发出请求。<br><img src="/img/nginx1-error1.png" alt="chrome跨域"></p><h3 id="后端允许跨域（开发环境）"><a href="#后端允许跨域（开发环境）" class="headerlink" title="后端允许跨域（开发环境）"></a>后端允许跨域（开发环境）</h3><p>服务器默认是不被允许跨域的。给Nginx服务器配置<code>Access-Control-Allow-Origin *</code>后，表示服务器可以接受所有的请求源（Origin）,即接受所有跨域的请求。 <code>Access-Control-Allow-Methods</code> 是为了防止出现Content-Type is not allowed by Access-Control-Allow-Headers in preflight response. <code>Access-Control-Allow-Headers</code>是为了防止出现当前请求<code>Content-Type</code>的值不被支持，当发起了<code>application/json</code>的类型请求时添加这个头可以解决。<br>服务器nginx添加以下配置：</p><figure class="highlight sh"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sh">location /myurl/ &#123;  <br>    add_header Access-Control-Allow-Origin *;<br>    add_header Access-Control-Allow-Methods <span class="hljs-string">&#x27;GET, POST, OPTIONS&#x27;</span>;<br>    add_header Access-Control-Allow-Headers <span class="hljs-string">&#x27;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization&#x27;</span>;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$request_method</span> = <span class="hljs-string">&#x27;OPTIONS&#x27;</span>) &#123;<br>        <span class="hljs-built_in">return</span> 204;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="预检请求"><a href="#预检请求" class="headerlink" title="预检请求"></a>预检请求</h3><p>对那些可能对服务器数据产生副作用的HTTP请求方法（特别是<code>GET</code>以外的HTTP请求，或者搭配某些MIME类型的<code>POST</code>请求），浏览器必须首先使用 <code>OPTIONS</code>方法发起一个预检请求（preflight request），从而获知服务端是否允许该跨域请求。服务器确认允许之后，才发起实际的HTTP请求。在预检请求的返回中，服务器端也可以通知客户端，是否需要携带身份凭证（包括 Cookies 和 HTTP 认证相关数据）。</p><p>Content-Type不属于以下MIME类型的，都属于预检请求：</p><figure class="highlight txt"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs txt">application/x-www-form-urlencoded<br>multipart/form-data<br>text/plain<br></code></pre></div></td></tr></table></figure><p><code>OPTIONS</code>先行验证是否允许跨域，若不允许，就不会进行下一个<code>POST</code>请求，所以之前会出现请求404的情况。</p><h3 id="后端允许跨域（生产环境）"><a href="#后端允许跨域（生产环境）" class="headerlink" title="后端允许跨域（生产环境）"></a>后端允许跨域（生产环境）</h3><p>此时处于生产环境，允许所有请求不太安全，所以可以由后端自定义请求的格式，当格式符合条件时，才添加跨域头。<br>后端接口一般带有统一前缀，这里设置所有带有<code>api</code>的请求都可以绕过跨域限制。<br><code>nginx.conf</code>中修改结果如下：</p><figure class="highlight sh"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sh">location /api &#123;<br>    add_header <span class="hljs-string">&#x27;Access-Control-Allow-Origin&#x27;</span> <span class="hljs-string">&#x27;*&#x27;</span>;<br>    add_header <span class="hljs-string">&#x27;Access-Control-Allow-Credentials&#x27;</span> <span class="hljs-string">&#x27;true&#x27;</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="前端允许跨域（生产环境）"><a href="#前端允许跨域（生产环境）" class="headerlink" title="前端允许跨域（生产环境）"></a>前端允许跨域（生产环境）</h3><p>由于这个项目涉及到了不同部门的接口，某个前辈的接口并没有按照规定来写，所以这里前端需要自己修改一下地址格式。<br>例如：原来的请求地址为<code>http://abc.com/origin</code>，现在设计一个新的请求地址<code>http://abc.com/myapi/origin</code><br>修改nginx配置如下：</p><figure class="highlight sh"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sh">location @router &#123;<br>    rewrite ^.*$ /index.html last;<br>&#125;   <br>location /myurl/ &#123;<br>    root /home/guoningyan/myproject/;<br>    index index.html;<br>    try_files <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ @router;<br>&#125;<br><br>location /myapi/origin &#123;<br>    proxy_pass http://abc.com/origin;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>意思为当发送的请求以<code>/myapi/origin</code>为后缀时，自动代理到原请求地址<code>http://abc.com/origin</code>。<br>有一点要注意的是，在<code>nginx</code>中配置<code>proxy_pass</code>代理转发时，如果在<code>proxy_pass</code>后面的url加&#x2F;，表示绝对根路径；如果没有&#x2F;，表示相对路径。</p><h3 id="常用配置简单写法"><a href="#常用配置简单写法" class="headerlink" title="常用配置简单写法"></a>常用配置简单写法</h3><figure class="highlight sh"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sh">location /consolefe/ &#123;<br>  root /data/gny; <br>  index index.html index.htm;<br>  try_files <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /consolefe/;<br>&#125;<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue2笔记（1）</title>
    <link href="/2019/07/12/vue2%E7%AC%94%E8%AE%B0%EF%BC%881%EF%BC%89/"/>
    <url>/2019/07/12/vue2%E7%AC%94%E8%AE%B0%EF%BC%881%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<blockquote><p>最近的项目用了vue2.0，备忘一些关键用法。这是第一篇，需求为展示一堆带有各自内容的卡牌，鼠标在卡牌上悬停时展示文字细节，点击时切换vue-router，所有数据在初始化时通过数组获取。本篇主要内容为v-for实现卡牌渲染，包括图片、文字绑定，针对特定卡片进行css特效选择等等。</p></blockquote><span id="more"></span><h3 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h3><p><img src="/img/vue_cards.png" alt="cards"></p><h3 id="需求切分"><a href="#需求切分" class="headerlink" title="需求切分"></a>需求切分</h3><ol><li><p>数据格式为json，在data中输出</p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">caseList<span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;link&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;/taxi&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;Taxi tickets recognization --- quickly find out date, distance, price and so on. &quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;CV&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;img&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;../assets/taxi-icon.png&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><br></code></pre></div></td></tr></table></figure></li><li><p>使用v-for实现数组元素的循环渲染卡牌</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(item,index) in caseList&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span>       <br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">item.img</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>&#123;&#123;item.text&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;des&quot;</span>&gt;</span>&#123;&#123;item.title&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>     <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p> 这个时候遇到一个问题，浏览器中图片并没有加载出来。<br> 我首先检查了一下相对路径没有问题，然后想到当把图片硬编码在html中时，<code>webpack</code>打包会用<code>loader</code>打包图片，这样图片的位置就改变了，所以需要在加载图片数据时加入<code>require</code>，这样图片就能展示出来了。<br> 修改如下:</p> <figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-string">&quot;img&quot;</span>:<span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../assets/taxi-icon.png&quot;</span>)<br></code></pre></div></td></tr></table></figure></li><li><p>点击卡牌跳转页面<br>使用<code>router</code>来实现，<code>router</code>中也可以直接修改tag属性</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">item.link</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li><li><p>鼠标悬停在卡牌上方时出现特效<br>这里将<code>mouseenter</code>和<code>mouseleave</code>配合使用，通过改变DOM元素class的方式实现效果。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"> <span class="hljs-tag">&lt;<span class="hljs-name">li</span> @<span class="hljs-attr">mouseenter</span>=<span class="hljs-string">&quot;enterCase&quot;</span> </span><br><span class="hljs-tag">    @<span class="hljs-attr">mouseleave</span>=<span class="hljs-string">&quot;leaveCase&quot;</span> </span><br><span class="hljs-tag">    <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(item,index) in caseList&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-bind:class</span>=<span class="hljs-string">&quot;[isHoverCase ? &#x27;img-change&#x27; : &#x27;img-wrap&#x27; ]&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br></code></pre></div></td></tr></table></figure> <figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">data () &#123;<br>  <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">isHoverCase</span>:<span class="hljs-literal">false</span><br>  &#125;<br>&#125;,<br>methods () &#123;<br>    <span class="hljs-title function_">enterCase</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">isHoverCase</span> = <span class="hljs-literal">true</span>;<br>    &#125;,<br>    <span class="hljs-title function_">leaveCase</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">isHoverCase</span> = <span class="hljs-literal">false</span>;<br>    &#125; <br> &#125; <br></code></pre></div></td></tr></table></figure><p> 这时候出现了新的问题，当鼠标悬停在一张卡牌上时，所有的卡牌出现了相同的特效。<br> 思考了一下，这里我把isHoverCase设置成了所有卡牌都能访问的变量，当其中一个改变时，自然所有卡牌的class都改变了。<br> 查询资料后了解到设置index可以解决这个问题，于是给每一张卡牌添加了<code>isHoverCase:false</code>，在元素方法中添加<code>@mouseleave=&quot;leaveCase(index)&quot;</code>，元素class修改为<code>v-bind:class=&quot;[item.isHoverCase ? &#39;img-change&#39; : &#39;img-wrap&#39; ]&quot;</code>，完美解决。</p></li></ol><h3 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h3><p>template写法如下：</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> @<span class="hljs-attr">mouseenter</span>=<span class="hljs-string">&quot;enterCase(index)&quot;</span> @<span class="hljs-attr">mouseleave</span>=<span class="hljs-string">&quot;leaveCase(index)&quot;</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(item,index) in caseList&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">item.link</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-bind:class</span>=<span class="hljs-string">&quot;[item.isHoverCase ? &#x27;img-change&#x27; : &#x27;img-wrap&#x27; ]&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">item.img</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>&#123;&#123;item.text&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;des&quot;</span>&gt;</span>&#123;&#123;item.title&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>javascrip写法t如下：</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>     data () &#123;<br>      <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-attr">caseList</span>:[&#123;<br>          <span class="hljs-attr">link</span>:<span class="hljs-string">&#x27;/taxi&#x27;</span>,<br>          <span class="hljs-attr">text</span>:<span class="hljs-string">&#x27;Taxi tickets recognization --- quickly find out date, distance, price and so on. &#x27;</span>,<br>          <span class="hljs-attr">title</span>:<span class="hljs-string">&#x27;CV&#x27;</span>,<br>          <span class="hljs-attr">img</span>:<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../assets/taxi-icon.png&#x27;</span>),<br>          <span class="hljs-attr">isHoverCase</span>:<span class="hljs-literal">false</span><br>        &#125;,&#123;<br>          <span class="hljs-attr">link</span>:<span class="hljs-string">&#x27;/translate&#x27;</span>,<br>          <span class="hljs-attr">text</span>:<span class="hljs-string">&#x27;Chinese-English translation --- use our dictionary to translate your sentences.&#x27;</span>,<br>          <span class="hljs-attr">title</span>:<span class="hljs-string">&#x27;NLP&#x27;</span>,<br>          <span class="hljs-attr">img</span>:<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../assets/translate-icon.png&#x27;</span>),<br>          <span class="hljs-attr">isHoverCase</span>:<span class="hljs-literal">false</span><br>        &#125;],<br>      &#125;<br>     &#125;,<br>     <span class="hljs-attr">methods</span>: &#123;<br>       <span class="hljs-title function_">enterCase</span>(<span class="hljs-params">index</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">caseList</span>[index].<span class="hljs-property">isHoverCase</span> = <span class="hljs-literal">true</span>;<br>      &#125;,<br>      <span class="hljs-title function_">leaveCase</span>(<span class="hljs-params">index</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">caseList</span>[index].<span class="hljs-property">isHoverCase</span> = <span class="hljs-literal">false</span>;<br>      &#125;  <br>     &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="debug遇到问题"><a href="#debug遇到问题" class="headerlink" title="debug遇到问题"></a>debug遇到问题</h3><p>在适配手机样式时出现了一个小问题，我需要将手机链接电脑后用ip进行访问，但是当我将<code>vue-cli</code>起的服务<code>127.0.0.1:8080</code>改成本机<code>ip:8080</code>时，出现网页无法访问的情况。<br><img src="/img/openfail.png" alt="网页无法访问"><br>查询资料后发现，需要在<code>build/webpack.dev.conf.js</code>中间修改host，将<code>host:127.0.0.1</code>修改为<code>host:0.0.0.0</code>，重启服务，通过ip可以正常访问。</p><h3 id="Mixin"><a href="#Mixin" class="headerlink" title="Mixin"></a>Mixin</h3><p>mixin用于组件共用逻辑抽取<br>vue组件初始化时，会将引入的mixin对象与当前组件进行合并（组件本身优先级更高，会覆盖冲突）<br>生命周期钩子函数，会先触发mixin中的钩子，然后触发组件的钩子</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs JavaScript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">mixin</span>: [<span class="hljs-title class_">MixinTest</span>] <span class="hljs-comment">// 数组，可以同时注册多个mixin</span><br>&#125;<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
      <tag>vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue+flask前后端分离项目（3）</title>
    <link href="/2019/06/20/vue-flask%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE%EF%BC%883%EF%BC%89/"/>
    <url>/2019/06/20/vue-flask%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE%EF%BC%883%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<blockquote><p>这是总结第三篇，包括linux服务器中nginx安装配置，使用nginx部署服务，以及允许跨域资源访问。</p></blockquote><span id="more"></span><p><code>Linux</code>中安装<code>nginx</code>网上很多文章都有写，附录链接中有我推荐的一篇。<br>简单的可以使用<code>apt-get</code>安装，但因为我没有root权限，所以只能通过源码安装，幸好服务器中大佬已经安装好gcc环境了，我只需要下载好直接编译就行。</p><h4 id="nginx安装"><a href="#nginx安装" class="headerlink" title="nginx安装"></a>nginx安装</h4><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">wget http://nginx.org/download/nginx-1.17.0.tar.gz<br>tar -zxvf nginx-1.17.0.tar.gz<br><span class="hljs-built_in">cd</span> nginx-1.17.0/<br>./configure --prefix=nginx<br>make &amp;&amp; make install<br></code></pre></div></td></tr></table></figure><p>启动nginx</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> nginx/<br>./sbin/nginx<br></code></pre></div></td></tr></table></figure><p>若遇到端口占用，可以先杀死进程再启动。</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">ps -A | grep nginx<br><span class="hljs-built_in">kill</span> -9 pid<br></code></pre></div></td></tr></table></figure><p>在浏览器输入 <a href="http://ip:port">http://ip:port</a> 地址，出现<code>Welcome to nginx!</code>即为安装成功。</p><h4 id="nginx配置"><a href="#nginx配置" class="headerlink" title="nginx配置"></a>nginx配置</h4><p>接下来是修改端口，因为在服务器中我没有root权限，所以需要在<code>nginx.conf</code>中修改<code>listen</code>端口，并且端口号需要是大于1024的任何一个数字。</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">vi ~/nginx-1.17.0/nginx/conf/nginx.conf<br></code></pre></div></td></tr></table></figure><p><code>nginx.conf</code>中修改结果如下：</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">server &#123;<br>    listen       1025;<br>    server_name  localhost;<br>&#125;<br></code></pre></div></td></tr></table></figure><p><code>dist</code>文件夹是我的前端项目打包后生成的文件，存放于<code>/home/myname</code>之中，作为静态文件的根目录，我希望在浏览器中输入 <a href="http://ip:port">http://ip:port</a> 可以直接访问到dist中首页，所以还要修改下配置。<br><code>nginx.conf</code>中修改结果如下：</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"> server &#123;<br>     listen       1025;<br>     server_name  localhost;<br><br>     location / &#123;<br>         root   root /home/myname/dist;<br>         index  index.html index.htm;<br>     &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="nginx跨域访问配置"><a href="#nginx跨域访问配置" class="headerlink" title="nginx跨域访问配置"></a>nginx跨域访问配置</h4><p>接下来在<code>nginx</code>中添加允许跨域访问，设置所有带有<code>api</code>的请求都可以绕过跨域限制。<br><code>nginx.conf</code>中修改结果如下：</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">location /api &#123;<br>    add_header <span class="hljs-string">&#x27;Access-Control-Allow-Origin&#x27;</span> <span class="hljs-string">&#x27;*&#x27;</span>;<br>    add_header <span class="hljs-string">&#x27;Access-Control-Allow-Credentials&#x27;</span> <span class="hljs-string">&#x27;true&#x27;</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>一般还需要在第一行添加：（没有root权限的用户这一行是不起作用的）</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">user root owner;<br></code></pre></div></td></tr></table></figure><p>保存修改后重启<code>nginx</code>，用浏览器打开 <a href="http://ip:1025/">http://ip:1025</a> ，就能直接访问到前端首页啦～也能顺利和服务端进行数据请求～愉快！</p><p><code>附录</code>：<br><a href="https://www.jianshu.com/p/7cb1a824333e">Linux环境nginx配置</a><br><a href="https://blog.csdn.net/shixiufang/article/details/44309971">如何在没有root权限下安装Nginx</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
      <tag>nginx</tag>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue+flask前后端分离项目（2）</title>
    <link href="/2019/06/20/vue-flask%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE%EF%BC%882%EF%BC%89/"/>
    <url>/2019/06/20/vue-flask%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE%EF%BC%882%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<blockquote><p>这是总结第二篇，总结flask项目搭建，restful接口设计，以及返回结果中添加允许跨域头。</p></blockquote><span id="more"></span><h4 id="flask搭建server端"><a href="#flask搭建server端" class="headerlink" title="flask搭建server端"></a>flask搭建server端</h4><p>本项目采用<code>python3</code>环境，使用<code>pip3</code>安装依赖包。<br>如果直接用命令行生成<code>flask</code>项目，可以使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> myProject<br><span class="hljs-built_in">cd</span> myProject<br>pip3 install flask<br></code></pre></div></td></tr></table></figure><h4 id="定义restful接口返回"><a href="#定义restful接口返回" class="headerlink" title="定义restful接口返回"></a>定义restful接口返回</h4><p>将<code>response</code>定义为如下格式的返回结果，其中<code>code=0</code>代表成功，<code>msg</code>由server端自定义返回结果的文字描述，<code>data</code>中为需要回传给客户端的内容，定义为<code>json</code>格式。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> jsonify<br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/api/upload&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload</span>():<br>    res = jsonify(&#123;<br>        <span class="hljs-string">&#x27;code&#x27;</span>: <span class="hljs-number">0</span>,<br>        <span class="hljs-string">&#x27;msg&#x27;</span>: <span class="hljs-string">&#x27;ok&#x27;</span>,<br>        <span class="hljs-string">&#x27;data&#x27;</span>: &#123; <br>            <span class="hljs-string">&#x27;text&#x27;</span>: <span class="hljs-string">&#x27;这里是返回结果&#x27;</span><br>        &#125;<br>    &#125;)<br>    <span class="hljs-keyword">return</span> res<br></code></pre></div></td></tr></table></figure><p>我的前端请求使用的是<code>formData</code>格式，需要将请求变为字典格式后用<code>key-value</code>进行取值，遇到<code>file</code>形式的数据则直接使用<code>request.files[&#39;file&#39;]</code>进行取值。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> request<br><br>data = request.form.to_dict()<br>username = data.get(<span class="hljs-string">&#x27;username&#x27;</span>)<br>file = request.files[<span class="hljs-string">&#x27;file&#x27;</span>]<br></code></pre></div></td></tr></table></figure><h4 id="flask中允许跨域"><a href="#flask中允许跨域" class="headerlink" title="flask中允许跨域"></a>flask中允许跨域</h4><p>在返回结果中允许跨域需要使用<code>flask_cors</code>：</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">pip3 install flask-cors<br></code></pre></div></td></tr></table></figure><p>server端添加如下代码：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask_cors <span class="hljs-keyword">import</span> *<br>app = Flask(__name__)<br>CORS(app, resources=<span class="hljs-string">r&#x27;/*&#x27;</span>)<br><br>res.headers[<span class="hljs-string">&#x27;Access-Control-Allow-Origin&#x27;</span>] = <span class="hljs-string">&#x27;*&#x27;</span><br>res.headers[<span class="hljs-string">&#x27;Access-Control-Allow-Methods&#x27;</span>] = <span class="hljs-string">&#x27;POST,GET,OPTIONS&#x27;</span><br>res.headers[<span class="hljs-string">&#x27;Access-Control-Allow-Headers&#x27;</span>] = <span class="hljs-string">&#x27;x-requested-with,content-type&#x27;</span><br></code></pre></div></td></tr></table></figure><h4 id="跨域小结"><a href="#跨域小结" class="headerlink" title="跨域小结"></a>跨域小结</h4><p>在（1）中已经总结了在开发环境中绕过跨域限制，现在对跨域作一个小结。<br>跨域是指从一个域名的网页去请求另一个域名的资，更加严格一点的定义是：只要协议，域名，端口有任何一个的不同，就被当作是跨域。<br>CORS是一个W3C标准，全称是”跨域资源共享”（Cross-origin resource sharing）。它允许浏览器向跨源服务器，发出XMLHttpRequest请求，从而克服了AJAX只能同源使用的限制。<br>实现CORS通信的关键是服务器。只要服务器实现了CORS接口，就可以跨源通信。<br>经过测试，确实是只要server添加头信息，不管我是本地起的服务还是其他http服务，都能和接口顺利通信。</p><p><code>附录</code>：<br><a href="http://www.ruanyifeng.com/blog/2016/04/cors.html">跨域资源共享 CORS 详解</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue+flask前后端分离项目（1）</title>
    <link href="/2019/06/20/vue-flask%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE%EF%BC%881%EF%BC%89/"/>
    <url>/2019/06/20/vue-flask%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE%EF%BC%881%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<blockquote><p>最近公司项目需要我进行包装一下，厉害的大佬们训练好模型，全周期工程师我负责在用户和大佬代码之间搭桥，用vue+flask完成整个项目的搭建和部署。<br>写完前端写后端，写完后端改nginx，改完nginx配服务器环境，全周期超爽有木有～<br>这是总结第一篇，总结vue搭建纯前端项目以及在开发环境配置nodejs反向代理绕过浏览器跨域限制。</p></blockquote><span id="more"></span><h4 id="新建vue项目"><a href="#新建vue项目" class="headerlink" title="新建vue项目"></a>新建vue项目</h4><p>本项目的node和npm为全局安装版本，<code>node&gt;=6.0.0</code>，<code>npm&gt;=3.0.0</code>，使用<code>vue-cli</code>进行一键配置。<br>新建项目命令：</p><figure class="highlight sh"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> projectName<br>vue init webpack client<br><span class="hljs-built_in">cd</span> client<br>npm run dev<br></code></pre></div></td></tr></table></figure><p>用浏览器打开<code>http://127.0.0.1:8080</code>看到有<code>vue</code>图片出现即启动成功。</p><p>文件目录格式如下图所示，需要在<code>component</code>中编写<code>vue</code>组件，在<code>router</code>中的<code>index.js</code>中配置路由。<br><img src="/img/vue_pro.png" alt="vue目录结构"></p><p>这时可能会出现一个问题，例如需要访问页面<code>http://://127.0.0.1:8080/a/</code>，浏览器却始终显示首页内容，url显示为<code>http://://127.0.0.1:8080/a#/</code>，解决方式是在<code>index.js</code>中添加一个<code>mode</code>参数，充分利用 <code>history.pushState</code> API来完成URL跳转。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>(&#123;<br>  <span class="hljs-attr">mode</span>:<span class="hljs-string">&#x27;history&#x27;</span>,<br>  <span class="hljs-attr">routes</span>: [&#123;&#125;]<br>&#125;);<br></code></pre></div></td></tr></table></figure><p>生成打包命令：</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">npm run build<br></code></pre></div></td></tr></table></figure><p>打包将在原目录下生成<code>dist</code>文件夹，<code>static</code>下面是打包后的静态文件<br><img src="/img/vue_dist.png" alt="dist目录"> </p><h4 id="vue中使用less"><a href="#vue中使用less" class="headerlink" title="vue中使用less"></a>vue中使用less</h4><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">cnpm install less less-loader --save--dev<br></code></pre></div></td></tr></table></figure><p><code>style</code>中添加如下代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;style lang=&quot;less&quot; scoped&gt;<br>@import &#x27;../assets/reset.less&#x27;; <br>&lt;/style&gt;<br></code></pre></div></td></tr></table></figure><h4 id="使用axios发送请求"><a href="#使用axios发送请求" class="headerlink" title="使用axios发送请求"></a>使用axios发送请求</h4><p><code>vue</code>中推荐使用<code>axios</code>进行<code>http</code>请求处理。</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">cnpm install axios --save--dev<br></code></pre></div></td></tr></table></figure><p><code>script</code>中这样使用：</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;axios&#x27;</span>;<br>axios.<span class="hljs-title function_">post</span>(reqPath+<span class="hljs-string">&#x27;upload&#x27;</span>,form,config).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> data = res.<span class="hljs-property">data</span>;<br>    <span class="hljs-keyword">if</span>(data.<span class="hljs-property">code</span> == <span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-comment">//do something </span><br>    &#125;<br>    &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error);<br> &#125;);<br></code></pre></div></td></tr></table></figure><h4 id="开发环境允许跨域"><a href="#开发环境允许跨域" class="headerlink" title="开发环境允许跨域"></a>开发环境允许跨域</h4><p>当我的客户端发起一个<code>post</code>请求后，迟迟没有收到server端的返回结果，打开控制台，发现了以下提示：<br><img src="/img/error2.png" alt="浏览器跨域"><br>在求助一个朋友之后得知，chrome内核已经把http头为json的返回强制做了cros ，即使加了跨域头也不行。所以需要在开发环境中使用nodejs做反向代理。<br>在<code>build/webpack.dev.conf.js</code>中修改代码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-attr">devServer</span>: &#123;<br>    <span class="hljs-attr">proxy</span>: &#123;<br>      <span class="hljs-string">&#x27;/api&#x27;</span>: &#123;<br>        <span class="hljs-attr">target</span>: <span class="hljs-string">&#x27;serverip:port&#x27;</span>,<br>        <span class="hljs-attr">headers</span>: &#123;<br>          <span class="hljs-string">&#x27;host&#x27;</span>: <span class="hljs-string">&#x27;&#x27;</span><br>        &#125;<br>      &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>这样配置之后，请求接口时不要写完整地址，写成例如<code>./api/upload</code>的形式，即可绕过跨域限制。</p><h4 id="记录一个问题"><a href="#记录一个问题" class="headerlink" title="记录一个问题"></a>记录一个问题</h4><p>我在向后端发请求时还遇到过这样一个问题：<br><img src="/img/error1.png" alt="error1"><br>查阅资料后发现时找不到资源，我重启服务端之后问题解决。</p>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MathQuiz-an Android Project</title>
    <link href="/2017/11/17/MathQuiz-an-Android-Project/"/>
    <url>/2017/11/17/MathQuiz-an-Android-Project/</url>
    
    <content type="html"><![CDATA[<blockquote><p>MathQuiz是我在香港大学学习Smart Phone这门课程的个人作业，一个用来进行数学测验的android app。<br>使用API Level 24 with minimum API Level 21，使用AVD (Nexus S with resolution 800X480).<br>这篇文章将归纳我做这个小项目过程中遇到的难点和收获。</p></blockquote><span id="more"></span><h4 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h4><p>这个项目我使用了android studio，app是root目录，manifests是配置文件，java是编写的业务代码文件，res是资源文件。<br><img src="/img/android-content.png" alt="android studio 文件目录结构"></p><h4 id="重要代码demo"><a href="#重要代码demo" class="headerlink" title="重要代码demo"></a>重要代码demo</h4><p><code>页面跳转</code></p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(getBaseContext(), GradeActivity.class);<br>intent.putExtra(<span class="hljs-string">&quot;ansCorrect&quot;</span>,ansCorrect);<br>startActivity(intent);<br></code></pre></div></td></tr></table></figure><p><code>用户输入答案保留两位小数</code><br>这里我用了监听用户输入，当用户输入小数位数超过两位时，调用处理函数</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-type">boolean</span> <span class="hljs-title function_">checkDecimal</span><span class="hljs-params">(String text)</span>&#123;<br>        <span class="hljs-type">Boolean</span> <span class="hljs-variable">ifFormat</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">if</span> (text.contains(<span class="hljs-string">&quot;.&quot;</span>)) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> text.indexOf(<span class="hljs-string">&quot;.&quot;</span>);<br>            <span class="hljs-keyword">if</span> (index + <span class="hljs-number">3</span> &lt; text.length()) &#123;<br>                initPrompt(<span class="hljs-string">&quot;Warning&quot;</span>,<span class="hljs-string">&quot;If your answers are not integers, please round them to 2 decimal places.&quot;</span>);<br>                ifFormat = <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> ifFormat;<br>    &#125;<br></code></pre></div></td></tr></table></figure><p><code>自定义图标提示框</code></p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">initPrompt</span><span class="hljs-params">(String txt, String msg)</span> &#123;<br>        <span class="hljs-type">LayoutInflater</span> <span class="hljs-variable">inflater</span> <span class="hljs-operator">=</span> getLayoutInflater();<br>        <span class="hljs-type">View</span>  <span class="hljs-variable">dialog</span> <span class="hljs-operator">=</span> inflater.inflate(R.layout.prompt,(ViewGroup)findViewById(R.id.dialog;<br>        AlertDialog.<span class="hljs-type">Builder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AlertDialog</span>.Builder(<span class="hljs-built_in">this</span>);<br>        <span class="hljs-type">TextView</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> (TextView)dialog.findViewById(R.id.tv);<br>        message.setText(msg);<br>        builder.setTitle(txt);<br>        builder.setPositiveButton(<span class="hljs-string">&quot;OK&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">DialogInterface</span>.OnClickListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(DialogInterface dialog, <span class="hljs-type">int</span> which)</span> &#123;<br>            &#125;<br>        &#125;);<br>        builder.setView(dialog);<br>        builder.setIcon(R.drawable.logo);<br>        builder.show();<br>    &#125;<br></code></pre></div></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/dialog&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">&quot;horizontal&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_margin</span>=<span class="hljs-string">&quot;8dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/tv&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:text</span>=<span class="hljs-string">&quot;textview show&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h4 id="神奇的错误"><a href="#神奇的错误" class="headerlink" title="神奇的错误"></a>神奇的错误</h4><p>在我调试代码的过程中控制台出现了这样的错误提示：</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"> <span class="hljs-attribute">10</span>-<span class="hljs-number">22</span> <span class="hljs-number">14</span>:<span class="hljs-number">00</span>:<span class="hljs-number">11</span>.<span class="hljs-number">310</span> <span class="hljs-number">1689</span>-<span class="hljs-number">1689</span>/com.android.inputmethod.latin E/RichInputConnection: Unable to connect to the editor to retrieve text.<br><span class="hljs-attribute">10</span>-<span class="hljs-number">22</span> <span class="hljs-number">14</span>:<span class="hljs-number">00</span>:<span class="hljs-number">11</span>.<span class="hljs-number">310</span> <span class="hljs-number">1689</span>-<span class="hljs-number">1689</span>/com.android.inputmethod.latin D/RichInputConnection: Will try to retrieve text later.<br></code></pre></div></td></tr></table></figure><p>这个错误会导致控制台无法打印信息，给我的调试带来很大的麻烦。我google了很久也没有找到合适的解决方案，最后我重建了一个项目，将相关代码复制才强硬解决了这个问题，如果还有好的方式，希望看到的人能联系我，谢谢了。</p><p><code>附录</code><br><a href="https://github.com/ginny315/MathQuizAssignment">项目成果 &amp; github链接</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>上海工作</title>
    <link href="/2017/07/01/%E4%B8%8A%E6%B5%B7%E5%B7%A5%E4%BD%9C/"/>
    <url>/2017/07/01/%E4%B8%8A%E6%B5%B7%E5%B7%A5%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<p>2015年11月到2016年4月我随着原来的团队从一号店到了壹药网，2016年6月我大学毕业了，之后的一年一直在壹药网html5团队工作。</p><p>跟着这个团队两年的时间，从fresh man到一个可以自己做中等项目，为大型项目贡献代码的工程师，一路以来我经历了很多，也成长了很多。</p><span id="more"></span><p>团队有个创新项目“健康助手”（又名小依赖）app，主要用来帮助用户养成良好的生活习惯，顺便和公司的产品相结合，打卡竞赛排名靠前的用户将获得公司的奖励，也是公司产品的营销类app。这个项目采用hybrid架构，我们组承担了h5的功能编写，native端的解决方案则由其他同事承担。很荣幸，我深度参与了这个项目。</p><p>项目初期我承担了angular后台代码编写，由于竞赛规则设计的非常复杂，逻辑非常多，那段时间我每天都用大量时间在代码调试上，同时我还在写毕业设计，承受了很大的压力，但是最终我还是在规定时间完成了任务。</p><p>刚工作那段时间也是这个项目的迭代期，我负责了微信营销部分的代码编写，即邀请用户参与挑战。我阅读了很多微信的接口文档，也对hybrid底层交互进行了研究。同时我也参与了部分组件的编写。印象最深的是我编写的打卡成果统计的组件，这个app是基于系统时间的，测试只能在更改系统时间后进行。真正release（热更新上线）之后，晚上十点我拿着手机等待我的“按钮”（打卡成果统计的入口）出现，结果等了10秒钟都没出来，当时我特别惊慌，似乎懂了“程序员背锅”这个情景，这是我第一次参与的多用户线上项目的更新，难道出现了测试时没有出现的bug？还好又过了5秒之后，按钮出现了，虚惊一场。也让我懂得了程序员背负的压力之大。</p><p>几个月后我又接手了公司的大型项目CRM，一个医生用来看病的系统，并且完全编写了后期的更新迭代，这个项目的坑在于使用的IM插件需要时常更新，每次更新牵扯到之前的很多业务代码，所以测试需要很长时间。</p><p>接下来几个月公司的h5用户端也更新了，我参与了h5端的用户聊天代码的编写，和医生端终于能一起聊天了，也是很棒的！同时编写h5也是和两个很有经验的同事合作的，同事写代码用了很多trick，我也学到了很多。</p><p>在不断维护项目，迭代项目的过程中，我还有幸接到了一个新的项目。公司的BI客户端原来是用java编写的，现在希望能做成前后端分离的形式，并且使用更丰富的图表展示，方便用户研究和运营的同事进行新活动策划。这个项目中我深入学习了echarts，进行了各种代码的封装和重用。</p><p>2017年6月，由于我要去香港大学深造了，向这个团队提出了离职，这是陪伴我长大的一个团队，不管是从技术上还是与人相处上，感谢我迈上社会的第一步遇上了你们，我的同事也是我终身的朋友。</p>]]></content>
    
    
    
    <tags>
      
      <tag>工作实习</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PWA -- Progress Web App</title>
    <link href="/2016/12/20/pwa/"/>
    <url>/2016/12/20/pwa/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Progress Web App目的在于利用现代浏览器的能力来达到类似APP的用户体验，让浏览器打开的网址像APP一样运行在手机上（无框架限制）。但是可能会使浏览器的负荷增加导致崩溃，所以提倡使用渐进式开发。<br>参加了Google Developer Day之后，对PWA这个概念有了自己的理解，个人觉得在可期的未来PWA会有很好的发展，值得深入学习。</p></blockquote><span id="more"></span> <h5 id="PWA简介"><a href="#PWA简介" class="headerlink" title="PWA简介"></a>PWA简介</h5><p><img src="/img/pwa.jpg" alt="PWA"><br><code>特性：</code></p><blockquote><p>支持将图标添加到屏幕，从屏幕点击启动<br>支持全屏体验<br>支持离线应用（利用Service Worker来实现离线存储）<br>支持Push Notification </p></blockquote><p><code>优势</code></p><blockquote><p>跨平台，任何安装符合标准的浏览器的设备上均可运行<br>渐进式，无论用户使用什么浏览器，始终以渐近增强为原则<br>低网速离线情况下依然有较好的用户体验<br>实时持续更新<br>使用TLS来保证传输安全<br>对搜索引擎友好<br>推送通知可以让用户再次访问变的容易</p></blockquote><p>除了Chrome支持以外，Firefox和Opera也支持了PWA</p><h5 id="service-worker"><a href="#service-worker" class="headerlink" title="service worker"></a>service worker</h5><p>相当于一个用户端的代理，拦截url，优先从缓存中获取资源，若缓存中没有，则向服务端请求。<br><code>优势及作用</code><br>预缓存加载，也可以作为file cache（static）。<br><img src="/img/service-worker.jpg" alt="service-worker"></p><blockquote><p>现在Service Worker在chrome、firefox和opera中是被支持的。Safari和Edge也正在努力中。<br>devtool - application - service worker</p></blockquote><h5 id="PWA设计概念-–-peanut-M-amp-M"><a href="#PWA设计概念-–-peanut-M-amp-M" class="headerlink" title="PWA设计概念 – peanut M&amp;M"></a>PWA设计概念 – peanut M&amp;M</h5><p>Aaron把PWA比作peanut M&amp;M，这是一种称为<code>应用外壳架构</code>的设计概念，javascript是一种外壳，是需要存储在浏览器中，保证始终可用，当无互联网连接（ offline）时，也能保证用户能看到应用的基本框架，而不是一片空白或者错误提示。<br>css相当于中间的巧克力层，可以缓存，也可以从服务端获取。<br>content（即需要）相当于里面的花生，可以缓存，也可以直接从服务端获取。但是一般来说内容是动态的，可能频繁发生改变，所以大部分都是从服务端获取（项目设计中应该尽量减少把不必要的内容都存储下来）。</p><h5 id="Manifest-json"><a href="#Manifest-json" class="headerlink" title="Manifest.json"></a>Manifest.json</h5><p>PWA主要一个 <code>Manifest.json</code>来配置一些功能，可以设置浏览器的样式，添加到屏幕的图标等等。</p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;PWA DEMO FM.202&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;short_name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;FM.202&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Simple Progressive Web App for ginny&#x27;s friends.&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;icons&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;src&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;assets/icons/ic-face.png&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;image/png&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;sizes&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;72x72&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;src&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;assets/icons/ic-face-large.png&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;image/png&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;sizes&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;144x144 256x256&quot;</span> <br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;start_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;index.html&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;display&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;standalone&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;background_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#fff&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;theme_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#fff&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;orientation&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;portrait&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></div></td></tr></table></figure><h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h5><p>可以通过Chrome的“添加到主屏幕”按钮，保存到主屏幕上。<br>只有满足如下条件时窗口才会显示。</p><blockquote><p>1、有一个有效的 Web Manifest。<br>2、安装有有效的 Service Worker。<br>3、通过 HTTPS 访问应用程序。</p></blockquote><h5 id="测试工具Lighthome"><a href="#测试工具Lighthome" class="headerlink" title="测试工具Lighthome"></a>测试工具Lighthome</h5><p>对PWA的评分工具，包括检测在各种网络状态下应用的加载情况。仅测试静态网页，对用户交互等动态行为并不作评分。可以在chrome插件中找到。<br>swPrecache进行预抓取，有service worker一整套体系。</p><p><code>参考链接</code><br><a href="https://www.w3.org/TR/service-workers/">Service Worker W3C官方草案</a><br><a href="https://www.chromestatus.com/features">chrome-feature</a><br><a href="https://developers.google.com/web/updates/2015/12/getting-started-pwa">Getting Started with Progressive Web Apps</a><br><a href="https://pwa.rocks/">有趣的PWA游戏和工具</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>关于requestAnimationFrame</title>
    <link href="/2016/12/04/%E5%85%B3%E4%BA%8ErequestAnimationFrame/"/>
    <url>/2016/12/04/%E5%85%B3%E4%BA%8ErequestAnimationFrame/</url>
    
    <content type="html"><![CDATA[<blockquote><p>这两个礼拜做图文h5的时候看到同组大神一个关于渲染的神奇写法，用了requestAnimationFrame这个之前我从来没有使用过的属性。<br>看了hax的知乎live，其中也提到了浏览器的渲染问题，特意查了paper做个总结。</p></blockquote><span id="more"></span> <h5 id="一个简单的需求"><a href="#一个简单的需求" class="headerlink" title="一个简单的需求"></a>一个简单的需求</h5><p><code>setBtnStatus</code>这个函数用来设置按钮状态，这个按钮主要做submit作用，也包含对表单提交的检验，当用户输入没有经过校验时，按钮置灰，用户输入满足时，按钮可以点击（即用户点击之后可以提交表单）。<br>macsen110大神指导我写的一段代码。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-attr">setBtnStatus</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> that = <span class="hljs-variable language_">this</span>;<br>    <span class="hljs-keyword">var</span> addressSave = $(<span class="hljs-string">&#x27;#addressSave&#x27;</span>);<br>    <span class="hljs-keyword">if</span> (that.<span class="hljs-title function_">isReady</span>()) &#123;<br>        addressSave.<span class="hljs-title function_">removeAttr</span>(<span class="hljs-string">&#x27;disabled&#x27;</span>)<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        addressSave.<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;disabled&#x27;</span>,<span class="hljs-literal">true</span>)<br>    &#125;<br>    that.<span class="hljs-property">reqId</span>=<span class="hljs-title function_">requestAnimationFrame</span>(that.<span class="hljs-property">setBtnStatus</span>.<span class="hljs-title function_">bind</span>(that));<br>&#125;,<br><br><span class="hljs-keyword">var</span> requestAnimationFrame = <span class="hljs-variable language_">window</span>.<span class="hljs-property">requestAnimationFrame</span> || <br>        <span class="hljs-variable language_">window</span>.<span class="hljs-property">mozRequestAnimationFrame</span> || <br>        <span class="hljs-variable language_">window</span>.<span class="hljs-property">webkitRequestAnimationFrame</span> || <br>        <span class="hljs-variable language_">window</span>.<span class="hljs-property">msRequestAnimationFrame</span> || <br>        <span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>)&#123;<span class="hljs-keyword">var</span> id = <span class="hljs-variable language_">window</span>.<span class="hljs-built_in">setTimeout</span>(callback, <span class="hljs-number">1000</span> / <span class="hljs-number">60</span>);<span class="hljs-keyword">return</span> id;&#125;;<span class="hljs-comment">//IE9- 兼容</span><br><br><span class="hljs-keyword">var</span> cancelAnimationFrame = <span class="hljs-variable language_">window</span>.<span class="hljs-property">cancelAnimationFrame</span> || <br>        <span class="hljs-variable language_">window</span>.<span class="hljs-property">mozCancelAnimationFrame</span> || <br>        <span class="hljs-keyword">function</span>(<span class="hljs-params">id</span>)&#123;<span class="hljs-built_in">clearTimeout</span>(id);&#125;;<br></code></pre></div></td></tr></table></figure><p>调用<code>requestAnimationFrame</code>API可以让开发者写出更流畅的动画，以时间戳为单位（帧间隔），代码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> handle = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(callback); <br></code></pre></div></td></tr></table></figure><p>调用<code>requestAnimationFrame</code>这个函数需要一个回调函数作为参数，当下一个画面（frame）到来之前执行。这样实现在帧间隔给按钮平滑变色。</p><h5 id="浏览器的反馈—用户已访问"><a href="#浏览器的反馈—用户已访问" class="headerlink" title="浏览器的反馈—用户已访问"></a>浏览器的反馈—用户已访问</h5><p>浏览器有一个数据库专门用来存储用户已经访问过的URLs，有些浏览器可以决定如何展现用户已经点击过的链接，比如加深颜色等等，这些都是浏览器的默认行为。<br>IE和firefox的数据库操作行为是异步的，当操作结果还没返回时，表现为unvisited，返回时将触发页面的重绘操作，给这个链接添加访问过的标记。Chrome的数据库操作是同步的，只有全部操作完成才会渲染整个页面。<br>当链接中的地址被js改变时，IE中不会发生visited-&gt;unvisited的改变，这个改变会在firefox中发生。而在Chrome中只有改变链接并手动点击才会触发渲染，所以需要用js控制强制重绘。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://www.guoningyan.com&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;link&quot;</span>&gt;</span>过宁妍<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> <br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">var</span> el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;link&#x27;</span>); </span><br><span class="language-javascript">el.<span class="hljs-property">href</span> = <span class="hljs-string">&#x27;http://www.google.com&#x27;</span>; </span><br><span class="language-javascript">el.<span class="hljs-property">style</span>.<span class="hljs-property">color</span> = <span class="hljs-string">&#x27;red&#x27;</span>;</span><br><span class="language-javascript">el.<span class="hljs-property">style</span>.<span class="hljs-property">color</span> = <span class="hljs-string">&#x27;&#x27;</span>; </span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span> <br></code></pre></div></td></tr></table></figure><h5 id="浏览器的重绘（redraw）事件是可以被嗅探的"><a href="#浏览器的重绘（redraw）事件是可以被嗅探的" class="headerlink" title="浏览器的重绘（redraw）事件是可以被嗅探的"></a>浏览器的重绘（redraw）事件是可以被嗅探的</h5><p>众所周知，帧渲染时间最佳为每秒60次（60fps，渲染一帧的时间为1000ms&#x2F;60&#x3D;16.7ms，这样人眼不会察觉到卡顿），<code>requestAnimationFrame</code>时间间隔为帧间隔，渲染时间可能会比16.7ms更短，而<code>阴影shadow</code>和<code>透明度transparency</code>或者是大量复杂的样式改变会影响浏览器的渲染时间（painting step），导致渲染时间变长，这段时间可能经历了很多帧，所以通过<code>requestAnimationFrame</code>可以计算出画面切换之间的时间。<br>恶意的网站可以通过浏览器对网页的渲染时间差窃取用户的敏感数据，即用户访问的历史记录。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> lastTime = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">loop</span>(<span class="hljs-params">time</span>) &#123;<br>  <span class="hljs-keyword">var</span> delay = time – lastTime;<br>  <span class="hljs-keyword">var</span> fps = <span class="hljs-number">1000</span>/delay;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(delay + <span class="hljs-string">&#x27;ms&#x27;</span> fps);<br>  <span class="hljs-title function_">updateAnimation</span>();<br>  <span class="hljs-title function_">requestAnimationFrame</span>(loop);<br>  lastTime = time;<br>&#125;<br><span class="hljs-title function_">requestAnimationFrame</span>(loop);<br></code></pre></div></td></tr></table></figure><h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p><code>requestAnimationFrame</code>可以进行帧变化操作，可以使动画更流畅。阴影颜色等重绘耗时长的操作在对用户已访问的标记上是应该禁止使用的，浏览器的不同操作会导致用户浏览信息泄露。</p><p><code>参考资料</code><br><a href="https://www.contextis.com/documents/2/Browser_Timing_Attacks.pdf">Browser_Timing_Attacks.pdf</a><br><a href="http://www.zhangxinxu.com/wordpress/2013/09/css3-animation-requestanimationframe-tween-%E5%8A%A8%E7%94%BB%E7%AE%97%E6%B3%95/">张鑫旭的博客</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>调试技巧之暴露全局方法</title>
    <link href="/2016/10/19/%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7%E4%B9%8B%E6%9A%B4%E9%9C%B2%E5%85%A8%E5%B1%80%E6%96%B9%E6%B3%95/"/>
    <url>/2016/10/19/%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7%E4%B9%8B%E6%9A%B4%E9%9C%B2%E5%85%A8%E5%B1%80%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<blockquote><p>最近的项目中使用了setInterval轮询，由于浏览器执行轮询时会阻塞其他，造成了一些麻烦。<br>本文记录一下测试时候在代码中放置的两个全局方法，用于在浏览器console中进行调用，开启和关闭轮询。</p></blockquote><span id="more"></span><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> myIntervel = <span class="hljs-built_in">setInterval</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-comment">//doing sth;</span><br>&#125;,spollingTime);<br><br><span class="hljs-variable language_">window</span>.<span class="hljs-property">cancleIntervel</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;    <br>    <span class="hljs-built_in">clearInterval</span>(myIntervel);<br>&#125;<br><span class="hljs-variable language_">window</span>.<span class="hljs-property">refreshWindow</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-title function_">reload</span>(<span class="hljs-literal">true</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><p>浏览器console中输入<code>window.cancleIntervel()</code>则轮询暂停；<br>浏览器console中输入<code>window.refreshWindow()</code>则重新刷新页面，就和手动刷新一个效果；</p><p><code>注意</code><br>暴露给window的方法必须是原生js自带的方法，项目用了angularjs框架，一开始我直接使用了框架中的暂停语法糖，自然是控制台报错了，这点要注意哦～</p>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
      <tag>debug</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>canvas实践笔记</title>
    <link href="/2016/08/21/canvas%E5%AE%9E%E8%B7%B5%E7%AC%94%E8%AE%B0/"/>
    <url>/2016/08/21/canvas%E5%AE%9E%E8%B7%B5%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<blockquote><p>对canvas使用有过好几次了，曾经用基于canvas的createjs写过一个俄罗斯方块的游戏，毕业设计做的是多人在线绘图网站，自然也是canvas实现的。<br>最近工作需要，需要在h5端调用canvas API实现生成一张带有数据图的图片，“传送给native端”，所以对canvas的使用做一个总结。[2016-08-27更正：生成图片需要走http传输协议，app内与native通信走file传输协议，协议不同，不能直接通信，所以不能完成直接传送给native，只能传送给server端。]<br>由简到难，本文首先简单介绍canvas几个常用API，然后给出图片预加载的代码，最后会列举绘制过程中的多个坑。</p></blockquote><span id="more"></span><p>SVG绘制图形是通过构建一棵XML树来实现，canvas来绘制图形是通过调用它提供的方法。所以在canvas中移除相应的元素需要先将当前的相应元素擦除，然后重新绘制。</p><p>业务实现效果图，制作过程3.5天，踩了不少坑，下面进行详细讲解。<br><img src="/img/canvas-jk.png" alt="jk-img"></p><h5 id="图形绘制一些简单的API"><a href="#图形绘制一些简单的API" class="headerlink" title="图形绘制一些简单的API"></a>图形绘制一些简单的API</h5><p>canvas标签在html文档流中存放，标签内的区域都是画布，所以可以在标签上直接设置画布的长宽。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;mycanvas&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">100</span> <span class="hljs-attr">height</span>=<span class="hljs-string">100</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>前面已经说过，canvas需要调用API来绘制图形，大部分API需要调用一个上下文对象来实现，所以需要<code>getContext(&#39;2d&#39;)</code>方法（传参2d）来获取这个CanvasRenderingContext2D对象，使用这个对象来实现在画布上绘制二维图形。<br><code>注意</code>每个canvas元素只有一个上下文对象</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;mycanvas&#x27;</span>);<br><span class="hljs-keyword">var</span> context = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">&#x27;2d&#x27;</span>);<br></code></pre></div></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 绘制路径；</span><br><span class="hljs-comment"> * beginPath开始，closePath结束，绘制比较粗糙；</span><br><span class="hljs-comment"> * 手动lineTo结束位置到起点位置，绘制比较精细；</span><br><span class="hljs-comment"> * 完成一条路径后重新开始另一条路径，必须有beginPath</span><br><span class="hljs-comment"> */</span><br>context.<span class="hljs-title function_">beginPath</span>();<br>context.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">100</span>,<span class="hljs-number">100</span>);<br>context.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">200</span>,<span class="hljs-number">200</span>);<br>context.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">100</span>,<span class="hljs-number">200</span>);<br>context.<span class="hljs-title function_">closePath</span>();<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  画圆－（0,360）的弧线</span><br><span class="hljs-comment"> *  context.arc(left, right, radius, 0, Math.PI*2);</span><br><span class="hljs-comment"> */</span><br>context.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">&#x27;#999&#x27;</span>;<br>context.<span class="hljs-title function_">beginPath</span>();<br>context.<span class="hljs-title function_">arc</span>(<span class="hljs-number">30</span>, <span class="hljs-number">60</span>, <span class="hljs-number">30</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>*<span class="hljs-number">2</span>);<br>context.<span class="hljs-title function_">closePath</span>();<br>context.<span class="hljs-title function_">stroke</span>();<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  画矩形</span><br><span class="hljs-comment"> *  rect(x, y, width, height)</span><br><span class="hljs-comment"> */</span><br>context.<span class="hljs-title function_">rect</span>(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>);<br>context.<span class="hljs-title function_">fill</span>();<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">* 填充路径区域；</span><br><span class="hljs-comment">* 如果路径没有闭合，则默认起点与终点连接；</span><br><span class="hljs-comment">* 可以通过先设置类属性来控制外观；</span><br><span class="hljs-comment">*/</span><br>context.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">&#x27;#ccc&#x27;</span>;<br>context.<span class="hljs-title function_">fill</span>();<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 描边；</span><br><span class="hljs-comment"> * 可以通过先设置类属性来控制外观；</span><br><span class="hljs-comment"> */</span><br>context.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">&#x27;#008&#x27;</span>;<br>context.<span class="hljs-title function_">stroke</span>();<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 设置字体和大小</span><br><span class="hljs-comment"> */</span><br> context.<span class="hljs-property">font</span> = <span class="hljs-string">&quot;40pt Calibri&quot;</span>;<br> context.<span class="hljs-title function_">fillText</span>(<span class="hljs-string">&quot;Hello World!&quot;</span>, x, y);<br></code></pre></div></td></tr></table></figure><p><a href="http://jsbin.com/xapiqe/3/edit?html,css,js,output">在线demo</a></p><blockquote><p>实践过程中发现context.fill()有个坑，特别是在给矩形填充颜色的时候，context的指向会出现问题，可能会将之前已经填充的内容重新填充。<br>简易使用context.fillRect()这个属性来填充矩形。<br>如果不可避免需要使用context.fill()这个属性，尽量提前使用，不要影响到后面的内容。</p></blockquote><h5 id="插入图片"><a href="#插入图片" class="headerlink" title="插入图片"></a>插入图片</h5><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">DrawPic</span>(<span class="hljs-params">imgParam,left,top</span>)&#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">left</span> = left || <span class="hljs-number">0</span>;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">top</span> = top || <span class="hljs-number">0</span>;<br>  context.<span class="hljs-title function_">drawImage</span>(imgParam,<span class="hljs-variable language_">this</span>.<span class="hljs-property">left</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">top</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><p>[业务需求]：将切图展示在画布的指定位置，设置图片大小<br>canvas绘图阻塞浏览器，按顺序执行，画图之前需要图片全部加载成功，作者编写了图片预加载功能，在完全加载完成后进行绘制。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">batchProcessingImgs</span>(<span class="hljs-params">imgList,newImgList</span>)&#123;<br>  imgList.<span class="hljs-title function_">reduce</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">pre,cur</span>)&#123;<br>    <span class="hljs-keyword">var</span> img = <span class="hljs-title function_">createNewImg</span>(cur)<br>    img.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>    newImgList.<span class="hljs-title function_">push</span>(img);<br>  &#125;<br>&#125;,&#123;&#125;)<br><span class="hljs-keyword">return</span> newImgList;<br>&#125;<br><br><span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-keyword">if</span>(imgList.<span class="hljs-property">length</span> == newImgList.<span class="hljs-property">length</span>)&#123;<br>    <span class="hljs-comment">//do something</span><br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>imgList存储图片源文件，newImgList存储加载完成的图片，只有当两个list长度相等时，图片完全加载完成，可以进行画布绘制，另外加载图片的过程是浏览器的异步行为，newImgList中的图片顺序和imgList不一定相同，所以需要根据名字查询图片信息。（在附录的链接中作者给出了完整的实现）</p><h5 id="缩小图片并剪裁成圆形"><a href="#缩小图片并剪裁成圆形" class="headerlink" title="缩小图片并剪裁成圆形"></a>缩小图片并剪裁成圆形</h5><p>[业务需求]：展示用户的圆形小头像，后端返回的是一定尺寸的大头像，所以我需要先等比例缩放，然后进行圆形裁剪。<br>需要注意的是，arc+clip的方法只对绘制的图形产生效果，对图片不起作用。<br>所以只能用填充的方法，设置一个填充pattern(ctx.createPattern(image, repetition))，但是填充的效果是图片的原像素尺寸，如果原图是一张超大图，很有可能填充的只是黑色的一个小角，所以在填充之前需要对原图进行等比例缩小。<br>有个CanvasPattern.setTransform(matrix)的方法，matrix是SVG的缩放方式，OMG！难道写canvas还要和SVG合用吗？好吧，尝试之后遇到了更难过的结果，连亲爱的chrome都不支持！那就别说其他浏览器了。<br>换种思路，能不能用别的方式缩小图片呢？还是老大厉害，鼓励我尝试了先将图片绘制在另一个canvas上下文中，然后将新的canvas调整到我所需要的尺寸，然后将新的canvas作为填充pattern填充到老canvas的fill中，尝试结果，完美实现填充！</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 按比例缩小图像并裁剪</span><br><span class="hljs-comment"> * left，top:左上角</span><br><span class="hljs-comment"> * radius:裁剪后的圆半径，注意是半径</span><br><span class="hljs-comment"> * 比较宽和高，小的设置为圆的直径长，大的裁剪为scaleBorder</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">scaleAndClipImageToRound</span>(<span class="hljs-params">context,img,left,top,radius</span>)&#123;<br>  <span class="hljs-keyword">var</span> scaleBord,<br>  width = img.<span class="hljs-property">width</span>,<br>  height = img.<span class="hljs-property">height</span>;<br>  context.<span class="hljs-title function_">save</span>();<br>  <span class="hljs-keyword">var</span> newCanvans = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;canvas&#x27;</span>);<br>  newCanvans.<span class="hljs-property">width</span> = img.<span class="hljs-property">width</span>;<br>  newCanvans.<span class="hljs-property">height</span> = img.<span class="hljs-property">height</span>;<br>  <span class="hljs-keyword">var</span> newCtx = newCanvans.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">&quot;2d&quot;</span>);<br><br>  scaleBord = (width &gt;= height ? <span class="hljs-number">2</span>*radius/height : <span class="hljs-number">2</span>*radius/width);<br>  newCtx.<span class="hljs-title function_">scale</span>(scaleBord,scaleBord);<br>  newCtx.<span class="hljs-title function_">drawImage</span>(img,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">var</span> p = ctx.<span class="hljs-title function_">createPattern</span>(newCanvans,<span class="hljs-string">&quot;no-repeat&quot;</span>);<br>  context.<span class="hljs-property">fillStyle</span> = p;<br>  context.<span class="hljs-title function_">translate</span>(left, top);<br>  context.<span class="hljs-title function_">beginPath</span>();<br>  context.<span class="hljs-title function_">arc</span>(radius, radius, radius, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>*<span class="hljs-number">2</span>);<br>  context.<span class="hljs-title function_">fill</span>();<br>  context.<span class="hljs-title function_">closePath</span>();<br>  context.<span class="hljs-title function_">restore</span>();<br>&#125;<br></code></pre></div></td></tr></table></figure><h5 id="状态堆栈"><a href="#状态堆栈" class="headerlink" title="状态堆栈"></a>状态堆栈</h5><p>画布API允许保存当前画布的状态，采用的是堆栈的方式，采用save和restore方法，相当于push和pop，恢复堆栈中的状态。也可以理解为PS的一个图层，作者实践过程中在使用context.scale()这个属性的时候一定需要调用pop和restore。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">context.<span class="hljs-title function_">save</span>();<br>context.<span class="hljs-title function_">restore</span>();<br></code></pre></div></td></tr></table></figure><h5 id="toDataURL时间上的坑"><a href="#toDataURL时间上的坑" class="headerlink" title="toDataURL时间上的坑"></a>toDataURL时间上的坑</h5><p>业务需求需要先向后端请求数据，然后进行绘制，我在做这个需求的时候遇到两个坑。<br>第一个坑：toDataURL后发现ajax请求的数据还没有返回，所以canvas没有画完。因为ajax请求是异步的，无法判断精确data的返回时间，所以只能在请求成功的回调中进行绘制方法的调用。（附录代码段中作者封装了多个请求执行完毕后处理绘图）<br>第二个坑：需要在图片预加载结束后画图，然后toDataURL，本地运行时图片加载时间可以忽略不计，而生产环境时加载图片是需要一定时间的，所以判断加载完成的js语句根本没有执行。解决方法是每加载一次图片时进行图片加载判断，即有100张图片就需要执行100次判断，直到第100次判断图片加载完全执行完毕，调用绘图方法进行绘制。</p><p><code>附录</code><br><a href="https://github.com/ginny315/canvas-h5tonative/tree/master/canvas-drawProgressBar-function">我的纯函数式实现canvas绘制设计稿代码</a><br><a href="https://github.com/ginny315/canvas-h5tonative/tree/master/canvas-draw-objForm">我的对象方法整理版（包括处理多个请求）代码</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
      <tag>canvas</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>angular笔记（3）我所理解的MV*</title>
    <link href="/2016/08/01/angular%E7%AC%94%E8%AE%B0%EF%BC%883%EF%BC%89%E6%88%91%E6%89%80%E7%90%86%E8%A7%A3%E7%9A%84MV/"/>
    <url>/2016/08/01/angular%E7%AC%94%E8%AE%B0%EF%BC%883%EF%BC%89%E6%88%91%E6%89%80%E7%90%86%E8%A7%A3%E7%9A%84MV/</url>
    
    <content type="html"><![CDATA[<blockquote><p>大学里写java web，用过struct2和Hibernate框架，接触了后端MVC；<br>大四实习的时候自学了nodejs的express框架，并且在此基础上做了我的毕业设计，这也是一个基于MVC的后端框架；<br>近期工作的这段时间，也在做基于angular的后台的开发和维护。angualr是基于MVVM的前端框架，MVVM是MVC的衍生，把C用VM来替代，但是MVC的原理依旧是可以解释地通的（作者研究过前端设计模式，也有自己的观点，有疑惑请在评论里讨论）。</p></blockquote><span id="more"></span><p><code>java开篇</code><br>这里的java的设计模式和目前在做java开发的<a href="http://blog.csdn.net/yiluxiangqian7715">@组长ZJP同学</a>讨论过，用一张图简单地描述下。</p><p><img src="/img/angular3-mvc.png" alt="java中的MVC"></p><p>相信了解过MVC的朋友都知道，Model代表数据存储，用来处理数据库相关操作，一般会使用<a href="http://baike.baidu.com/link?url=jdLF0XztJUiIqHYzJONBdJYeHO7ZS_dWsRuTP1hVdvZWz_wAZsgHUaWtMWLeHeDgwV_j5VmbYLYvq0BCy2NCnK">ORM</a>进行封装，降低藕合度。<br>View代表视图层，在后端渲染的情况下一般是jsp页面，而在前端渲染的情况下，可能是web端或者是客户端的某些页面，用户操作致使View发送request请求。<br>Control代表控制器，顾名思义，整个流程依赖Control进行控制，所以View中的请求会经过Control处理，然后返回response给View，而view处理的业务逻辑对客户端是不透明的，用户也不用去理会数据库是怎样的操作，所以这些“黑盒”操作都是由后端程序员完成。Control返回的response也有两种方式，像structs2采用的是action跳转，这是一种可以直接返回jsp页面的方式，还有一种是我们熟悉的后端返回json数据的方式。<br>图中关于Model，引申出了service，在一些不算复杂的框架中，可能就模糊了Model的概念，直接由service处理业务逻辑，框架的选型还是结合业务相关，这里不再赘述。</p><p><code>Nodejs express框架深入</code><br>这里选用了我毕设用的目录结构做说明。</p><figure class="highlight sh"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sh">- db<br>  - admin.js<br>  - user.js<br>- routers<br>  - loginServer.js（require(<span class="hljs-string">&#x27;../db/user.js&#x27;</span>)）<br>  - adminServer.js（require(<span class="hljs-string">&#x27;../db/admin.js&#x27;</span>)）<br>- app.js<br></code></pre></div></td></tr></table></figure><p>我选用了mongoose包作为中间层，所以很明显可以看出db文件夹下就是ORM，每个单独的js文件代表数据库中的一张表，将数据类型相关以及CRUD操作进行封装，和Model类似，每个单独的js文件类似一个service实现类。<br>而router是一种路由的概念，每个**Server.js文件代表一个操作，需要调用db中的方法（类似于control调用service完成某个功能）。再划分细一点，router可以把不同请求对应到不同的方法中进行处理，此时router相当于一个过滤器和领路的作用，扩大了control的功能。而这些js文件会返回处理后的response。<br>app.js是项目启动文件，数据库连接，调用router方法等等，前端所有的请求request都需要经过app.js后，调用模块中的方法进行处理。</p><p><code>终于回到了重点angular</code><br>首先也先进行项目目录结构划分</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">－ js<br>  - app.js(root作用，调用service中的数据)<br>  - common.js(factory、service、provider)<br>  - main.js<br>  - router.js(可以直接写路由，也可以通过ui-router这种插件根据状态来改变页面渲染)<br>－ moudules<br>  - moduleName<br>    - ***.html<br>    - ***.js(controller)<br></code></pre></div></td></tr></table></figure><p>这里将页面划分为组件，每个contrller控制一个视图模型。<br>app.js起到root作用，包含了所有的controller。即这是一个总控制器。<br>common.js起Modul作用，在angular中有factory、service、contrller三个分类，service通过“构造器”（构造函数）创建，这个构造器即factory，而这些service又可以称为factory的实例化对象（实现类），以对象的形式存在。provider是一种更高级（可以通过config进行配置）的factory，作用也类似。<br>解释了这么多，再说一下angular的范式要求。在写angular的时候，尽量要将业务逻辑处理放在controller中，尽量不要在controller直接获取数据后处理，应该让service获取接口数据，此时的service相当于Model，这样angular的设计模式就完全和java对应了。</p><p><code>总结</code><br>都说angular适合后端程序员，确实总结时候发现了其中的相似之处非常多，当然，学好设计模式，框架什么的都是套路！</p>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
      <tag>angular</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>移动端开发总结（1）</title>
    <link href="/2016/07/31/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93%EF%BC%881%EF%BC%89/"/>
    <url>/2016/07/31/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93%EF%BC%881%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<blockquote><p>移动端布局一直是困扰我的一个大问题，特别是去年在某电商实习期间曾经做一个活动页做了好久好久好久，现在工作期间遇到活动页或者微信传播页也是必须要按时快速高质量任务的。<br>近期在做一个hybird项目的UAT，代码里出现了前辈们的各种不同的css写法，我必须要全部看懂然后再做修改，也是很蛋疼，所以周末在图书馆对遇到的坑做个总结吧。</p></blockquote><span id="more"></span><h5 id="常用单位"><a href="#常用单位" class="headerlink" title="常用单位"></a>常用单位</h5><p><code>rem</code></p><blockquote><p>[MDN]This unit represents the font-size of the root element.<br>这个单位代表了根元素的字体大小。<br>如果在document里面有html元素，即为根元素，通过在html上设置font-size，则可以使用rem来表示字体大小或者用来定义元素的高度、宽度等等。</p></blockquote><p>下面是一段我写的简易媒体查询的代码，即通过css来实现自适应，font-size的取值最好为偶数，避免发生字体渲染问题。这里选用<code>10px</code>作为基础值是因为设计师以iphone6作为设计图标准，设计稿上宽度<code>750px</code>，iphone6实际宽度<code>375px</code>，这样手动rem换算只要<code>设计稿px/10/2</code>，很容易进行布局计算，其余的自适应完全交给浏览器去实现。</p><figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-keyword">@media</span> screen <span class="hljs-keyword">and</span> (<span class="hljs-attribute">min-width</span>:<span class="hljs-number">361px</span>) &#123;<br>  <span class="hljs-selector-tag">html</span> &#123;<br>    <span class="hljs-attribute">font-size</span>:<span class="hljs-number">10px</span>;<br>  &#125;<br>&#125;<br><span class="hljs-keyword">@media</span> screen <span class="hljs-keyword">and</span> (<span class="hljs-attribute">min-width</span>:<span class="hljs-number">400px</span>) &#123;<br>  <span class="hljs-selector-tag">html</span> &#123;<br>    <span class="hljs-attribute">font-size</span>:<span class="hljs-number">12px</span>;<br>  &#125;<br>&#125;<br><span class="hljs-keyword">@media</span> screen <span class="hljs-keyword">and</span> (<span class="hljs-attribute">min-width</span>:<span class="hljs-number">500px</span>) &#123;<br>  <span class="hljs-selector-tag">html</span> &#123;<br>    <span class="hljs-attribute">font-size</span>:<span class="hljs-number">14px</span>;<br>  &#125;<br>&#125;<br><span class="hljs-keyword">@media</span> (<span class="hljs-attribute">-webkit-min-device-pixel-ratio</span>:X)&#123;<br>    <br>&#125;<br></code></pre></div></td></tr></table></figure><p>上面的写法比较适合普遍性的适应，不能保证所有机器得到最精准的适配，而且当遇到对像素要求很高的设计师抠细节的时候，总不能给每个手机都做<code>media quary</code>吧，于是下面给出一段js实现的，通过获取屏幕实际可用区域控制<code>root</code>元素<code>font-size</code>大小的代码。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-keyword">var</span> width = <span class="hljs-variable language_">window</span>.<span class="hljs-property">screen</span>.<span class="hljs-property">width</span>;<br>  <span class="hljs-keyword">var</span> rate = width/<span class="hljs-number">375</span>;<br>  <span class="hljs-keyword">var</span> newFontSize = <span class="hljs-string">&#x27;font-size:&#x27;</span> + rate*<span class="hljs-number">10</span> + <span class="hljs-string">&#x27;px&#x27;</span>;<br>  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByTagName</span>(<span class="hljs-string">&#x27;html&#x27;</span>).<span class="hljs-property">style</span> = newFontSize;<br>&#125;());<br><br><span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;text&#x27;</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByTagName</span>(<span class="hljs-string">&#x27;html&#x27;</span>).<span class="hljs-property">style</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>你也可以<a href="http://guoningyan.com/demo/testrem.html">点击这里</a>，查看我的在线demo。</p><p><code>em</code></p><blockquote><p>[MDN]This unit represents the calculated font-size of the element. If used on the font-size property itself, it represents the inherited font-size of the element.<br>从元素进行font-size属性的继承，即获取父元素的字体大小进行设置。<br>通过在父元素上设置font-size，则可以使用em来表示字体大小或者用来定义子元素的高度、宽度等等。</p></blockquote><p><code>vw、vh</code></p><blockquote><p>[MDN]vw:1&#x2F;100th of the height of the viewport.<br>[MDN]vh:1&#x2F;100th of the width of the viewport.<br>[MDN]vmin:1&#x2F;100th of the minimum value between the height and the width of the viewport.<br>[MDN]vmax:1&#x2F;100th of the maximum value between the height and the width of the viewport.<br>vw、vh相对于屏幕的百分比，1vw是屏幕宽度的1%，1vh是屏幕高度的1%，由于屏幕是固定的，所以设置的百分比也是固定的。<br>要注意的是，如果带有弹出式键盘，则vh会自动改变，所以在需要调用设备原生键盘的时候，尽量不要使用vh</p></blockquote><h5 id="改变viewport"><a href="#改变viewport" class="headerlink" title="改变viewport"></a>改变viewport</h5><p>和用js改变html的font-size类似，也可以通过js来改变meta标签。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> width = <span class="hljs-variable language_">window</span>.<span class="hljs-property">screen</span>.<span class="hljs-property">width</span>/<span class="hljs-number">320</span>;<br><span class="hljs-keyword">var</span> rate = width/<span class="hljs-number">375</span>,<br>    viewport = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;meta[name=viewport]&#x27;</span>);<br><br>viewport.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;content&#x27;</span>,<br>viewport.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&#x27;content&#x27;</span>)<br>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/(initial-scale)=[d.]?d/</span>,<span class="hljs-string">&#x27;$1=&#x27;</span>+rate))<br></code></pre></div></td></tr></table></figure><p><code>附录一</code>js常用获取屏幕信息</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">网页可见区域宽：<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">clientWidth</span><br>网页可见区域高：<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">clientHeight</span><br>网页可见区域高：<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">offsetWidth</span>（包括边线的宽）<br>网页可见区域宽：<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">offsetHeight</span>（包括边线的高）<br>网页正文全文宽：<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">scrollWidth</span><br>网页正文全文高：<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">srcollHeight</span><br>网页被卷去的高：<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">scrollTop</span><br>网页被卷去的左：<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">scrollLeft</span><br>网页正文部分上：<span class="hljs-variable language_">window</span>.<span class="hljs-property">screenTop</span><br>网页正文部分左：<span class="hljs-variable language_">window</span>.<span class="hljs-property">screenLeft</span><br>屏幕分辨率的高：<span class="hljs-variable language_">window</span>.<span class="hljs-property">screen</span>.<span class="hljs-property">height</span><br>屏幕分辨率的宽：<span class="hljs-variable language_">window</span>.<span class="hljs-property">screen</span>.<span class="hljs-property">width</span><br>屏幕可用工作区高度：<span class="hljs-variable language_">window</span>.<span class="hljs-property">screen</span>.<span class="hljs-property">availHeight</span><br>屏幕可用工作区宽度：<span class="hljs-variable language_">window</span>.<span class="hljs-property">srceen</span>.<span class="hljs-property">availWidth</span><br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
      <tag>css</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>开发了一个chrome外卖插件（1）</title>
    <link href="/2016/07/27/%E5%BC%80%E5%8F%91%E4%BA%86%E4%B8%80%E4%B8%AAchrome%E5%A4%96%E5%8D%96%E6%8F%92%E4%BB%B6%EF%BC%881%EF%BC%89/"/>
    <url>/2016/07/27/%E5%BC%80%E5%8F%91%E4%BA%86%E4%B8%80%E4%B8%AAchrome%E5%A4%96%E5%8D%96%E6%8F%92%E4%BB%B6%EF%BC%881%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<blockquote><p>今天真是无聊啊，弄点神奇的东西玩玩儿，想了想，还没做过chrome插件呢，Google了一下，chrome插件基本就是使用html,css,js来实现一些浏览器的扩展功能，前端完全能胜任呐！<br>团队平时（特别是周五）经常会一起点奶茶水果之类，那就把这些做个整理，顺便了解一下如何做插件，一举两得！</p></blockquote><span id="more"></span><p><img src="/img/chrome1-1.png" alt="这里是配图"><br><code>这是插件root文件夹</code><br>需要包含manifest.json、icon.png(大小一般为19px * 19px)、index.html（设置的弹出页面）<br><code>manifest.json</code><br>manifest在英语里是清单的意思，顾名思义，这个文件是整个插件的描述文件，开发插件就得说明这个插件叫什么，可以用来干什么，以及自己设计的功能etc…<br><code>brower_action</code>是当鼠标悬浮或点击图标是的下拉列表，<code>page_action</code>是点击图标之后的弹出的页面，官方文档表示两者只能选其中一个或者都不选。</p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;manifest_version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;takewayfood&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;0.1&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;takeway food for my friends&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;page_action&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;default_icon&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;eat.png&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;default_popup&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;index.html&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;default_title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;Yummy!&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;manifest_version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;takewayfood&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;0.1&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;takeway food for my friends&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;browser_action&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;default_icon&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;eat.png&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;default_title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;Yummy!&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></div></td></tr></table></figure><p><code>安装</code><br>点击chrome浏览器右上角的“三”图标，进入设置，点击“扩展程序”，勾选“开发者模式”，点击“打包扩展程序”，选择插件所在目录，第一次上传时不需要选择“私有密钥文件”。<br>然后打开目录，发现多了两个文件，后缀名分别为crx和pem，pem即上面说到的“私有密钥文件”，当插件做了修改需要再次上传时，就需要选择这个pem文件作为“私有密钥文件”了。将crx文件拖入chrome浏览器中，即可完成插件安装。</p><p><code>顺便当个开发者吧</code><br>昨晚写的代码，居然今天就被chrome禁用了，所以决定申请一个chrome开发者账号。成为开发者需要一次性支付5美元，而在地区选择中是没有中国这个选项的（很墙大），所以我选择了香港这个选项，支付也需要符合地区的账户，查找之后发现可以在全球付（附录中有链接）开一个账户，但是需要支付100RMB，支付后剩余的钱可以提取到银行卡账户，还是很方便的。</p><p> <code>附录</code><br> <a href="https://developer.chrome.com/extensions/getstarted">chrome插件官方文档</a><br> <a href="https://www.globalcash.hk/">全球付</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
      <tag>chrome</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>angular笔记（2）</title>
    <link href="/2016/07/25/angular%E7%AC%94%E8%AE%B0%EF%BC%882%EF%BC%89/"/>
    <url>/2016/07/25/angular%E7%AC%94%E8%AE%B0%EF%BC%882%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<blockquote><p>这篇是对angular笔记（2）的补充篇，由于项目需要，增加了一些新功能，这篇主要有对表格排序的业务解决，同时也对如何在数据双向绑定的框架中添加插件有了一定实践。</p></blockquote><span id="more"></span><p><code>表格排序</code><br>用表格展示数据的时候经常会遇到一个需求就是“按照升降序排列”。<br><img src="/img/angular2-1.png" alt="效果图"></p><p>ng-table本身带有sortable属性，在new NgTableParams实例化过程中添加参数sorting，sorting中包含表格中需要排序的列名可以在前端实现排序功能使用。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">sortable</span>=<span class="hljs-string">&quot;sortableId&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">$scope.<span class="hljs-property">tableParams</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NgTableParams</span>(&#123;<br>  <span class="hljs-attr">count</span>: <span class="hljs-variable constant_">PAGESIZE</span>,<br>  <span class="hljs-attr">sorting</span>: &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;sortableId&#x27;</span>, &#125;<br>&#125;, &#123;<br>     <span class="hljs-attr">getData</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">params</span>) &#123;<br>     <span class="hljs-comment">//doSth...</span><br>&#125;);<br></code></pre></div></td></tr></table></figure><p>但是很多时候这个已经封装好的排序功能不能满足自己的需求，比如已经数据已经实现了分页展示，每次请求都是带上当前页码的，所以不方便进行前端分页。此时需要后端完成排序，前端请求需要携带当前页码和排序参数，后端直接返回排序完成的数据给前端展示。</p><p>此时就需要自定义sort事件，在结合ng-table时也遇上了一些坑，下面通过代码来解释一下。<br>首先想到的是添加ng-click事件：</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">sortable</span>=<span class="hljs-string">&quot;sortableId&quot;</span> <span class="hljs-attr">ng-click</span>=<span class="hljs-string">&quot;sort(&#x27;sortParam&#x27;)&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>这样做有一个误区，ng-table插件自定义的click事件会覆盖自定义事件，完全起不到作用。</p><p>修改为下面这样：</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">data-title</span>=<span class="hljs-string">&quot;colNmae&quot;</span> <span class="hljs-attr">bo-bind</span>=<span class="hljs-string">&quot;item.userIntegral&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;sortable&quot;</span> <span class="hljs-attr">ng-click</span>=<span class="hljs-string">&quot;sort(&#x27;sortParam&#x27;)&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>此时放弃了使用插件自带的sortable，使用自定义的class&#x3D;’sortable’来显示出排序的上下箭头，结果是还是没有起作用。分析以后发现，此时的<td>标签实例化为表格的每一列，需求是在列名中添加点击事件实现排列，而普通的ng-click无法绑定进去。<br>chrome中DOM渲染出来的效果可以看到如下：<br><img src="/img/angular2-2.png" alt="效果图"></p><p>通过我们通过强制template注入的方式，将事件绑定在模板中的节点上，然后插入进表格。<br>修改为下面这样：</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">data-header</span>=<span class="hljs-string">&quot;&#x27;insert.html&#x27;&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;text-center&quot;</span> <span class="hljs-attr">bo-bind</span>=<span class="hljs-string">&quot;item.userDan&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/ng-template&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insert.html&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;sortable&quot;</span> ng-click=<span class="hljs-string">&quot;sort(&#x27;sortParam&#x27;)&quot;</span> ng-<span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;&#123;&#x27;sort-asc&#x27;: status == 1, &#x27;sort-desc&#x27;: status == -1 &#125;&quot;</span>&gt;</span><br><span class="language-javascript">        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;sort-indicator&quot;</span>&gt;</span>此列可以进行升降序排列<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span></span><br><span class="language-javascript">    &lt;/div&gt;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getTableParams</span>(<span class="hljs-params"></span>) &#123;<br>  $scope.<span class="hljs-property">tableParams</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NgTableParams</span>(&#123;<br>      <span class="hljs-attr">count</span>: <span class="hljs-variable constant_">PAGESIZE</span><br>  &#125;, &#123;<br>      <span class="hljs-attr">getData</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">params</span>) &#123;<br>          <span class="hljs-keyword">var</span> pageIndex = params.<span class="hljs-title function_">page</span>();<br>          <span class="hljs-keyword">return</span> httpData.<span class="hljs-title function_">loadUserHealthScoreRank</span>(&#123;<br>              <span class="hljs-attr">pageIndex</span>: pageIndex,<br>              <span class="hljs-attr">pageSize</span>: <span class="hljs-variable constant_">PAGESIZE</span>,<br>              <span class="hljs-attr">sortFieldName</span>:$scope.<span class="hljs-property">sortFieldName</span>,<br>              <span class="hljs-attr">sortDesc</span>:$scope.<span class="hljs-property">sortDesc</span><br>          &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) &#123;<br>              params.<span class="hljs-title function_">total</span>(response.<span class="hljs-property">totalNum</span>);<br>              $scope.<span class="hljs-property">tableCount</span> = response.<span class="hljs-property">totalNum</span>;<br>              <span class="hljs-keyword">return</span> response.<span class="hljs-property">list</span>;<br>          &#125;)<br>      &#125;<br>  &#125;);<br>&#125;<br><br><span class="hljs-comment">//排序</span><br>$scope.<span class="hljs-property">sort</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">type</span>) &#123;<br>  <span class="hljs-keyword">if</span>(type == <span class="hljs-string">&#x27;sortParam&#x27;</span>)&#123;<br>      $scope.<span class="hljs-property">sortFieldName</span> = <span class="hljs-string">&#x27;name&#x27;</span>;<br>      <span class="hljs-keyword">if</span>($scope.<span class="hljs-property">status</span> == <span class="hljs-string">&#x27;1&#x27;</span>)&#123;<br>          $scope.<span class="hljs-property">status</span> = <span class="hljs-string">&#x27;-1&#x27;</span>;<br>          $scope.<span class="hljs-property">sortDesc</span> = <span class="hljs-string">&#x27;asc&#x27;</span>;<br>      &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>($scope.<span class="hljs-property">moneystatus</span> == <span class="hljs-string">&#x27;-1&#x27;</span>)&#123;<br>          $scope.<span class="hljs-property">status</span> = <span class="hljs-string">&#x27;1&#x27;</span>;<br>          $scope.<span class="hljs-property">sortDesc</span> = <span class="hljs-string">&#x27;desc&#x27;</span>;<br>      &#125;<span class="hljs-keyword">else</span>&#123;<br>          $scope.<span class="hljs-property">status</span> = <span class="hljs-string">&#x27;1&#x27;</span>;<br>          $scope.<span class="hljs-property">sortDesc</span> = <span class="hljs-string">&#x27;desc&#x27;</span>;<br>      &#125;<br>   &#125;<br></code></pre></div></td></tr></table></figure><p>chrome中DOM渲染出来的效果可以看到如下：<br><img src="/img/angular2-3.png" alt="效果图"></p><p><code>表格爆栈</code><br>从后端获取json数据后匹配ng对象，进行模板填充，是使用ng的一般方法，有时候会出现如下错误：<br><img src="/img/angular2-4.png" alt="效果图"><br>翻译成中文就是：爆栈了…<br>查阅资料后发现，出现这个问题一般是进行了循环调用，即a调用b进行数据处理，同时b也调用了a，ng本身无法进行处理，只能报错。<br>而我出现这个问题的情况就比较诡异了，我在controller中初始化了一个对象，如下</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">$scope.<span class="hljs-property">search</span> = &#123;&#125;;<br>$scope.<span class="hljs-property">search</span>.<span class="hljs-property">rankType</span> = <span class="hljs-string">&#x27;1&#x27;</span>;<br></code></pre></div></td></tr></table></figure><p>当在表格参数中使用<code>$scope.search.rankType</code>时无法获取数据，报错就是爆栈了，后来经过<code>console.dir()</code>后发现<code>$scope.search</code>是拥有了众多方法的对象，自然循环起来就爆栈了，所以以后取名还得注意千万要避免ng自带的对象名。</p>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
      <tag>angular</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>搭一个little project脚手架（2）整合测试</title>
    <link href="/2016/06/28/%E6%90%AD%E4%B8%80%E4%B8%AAlittle-project%E8%84%9A%E6%89%8B%E6%9E%B6%EF%BC%882%EF%BC%89%E6%95%B4%E5%90%88%E6%B5%8B%E8%AF%95/"/>
    <url>/2016/06/28/%E6%90%AD%E4%B8%80%E4%B8%AAlittle-project%E8%84%9A%E6%89%8B%E6%9E%B6%EF%BC%882%EF%BC%89%E6%95%B4%E5%90%88%E6%B5%8B%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<blockquote><p>前文叙述了这个项目的搭建过程和理由，本文在这个工程中添加Jasmine+Karma测试，由于更新换代很快，在搭建这个脚手架的过程中走了好多坑，网上的很多解决方式在package更新后都不起作用，本文罗列了我在玩的过程中遇到的4个坑。</p></blockquote><span id="more"></span><p><code>Jasmine+Karma</code><br>Jasmine是BDD(行为驱动开发)框架，Karma是基于其的一个测试库。<br>Karma安装</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm install karma -g<br></code></pre></div></td></tr></table></figure><p>Karma+Jasmine配置，根据提示完成配置项</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">karma init<br></code></pre></div></td></tr></table></figure><p>创建测试文件（符合jasmineAPI的测试脚本）</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">decsribe(&quot;A suite of basic function&quot;,function() &#123;<br>  it(&quot;finish some function&quot;,function()&#123;<br>    except(&quot;result&quot;).toEqual(FuncName(&quot;params&quot;))<br>  &#125;);<br>&#125;)<br></code></pre></div></td></tr></table></figure><p>修改配置文件karma.conf.js</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-attr">browsers</span>: [<span class="hljs-string">&#x27;Chrome&#x27;</span>, <span class="hljs-string">&#x27;Firefox&#x27;</span>],<br><span class="hljs-attr">plugins</span>: [<br>      <span class="hljs-string">&#x27;karma-jasmine&#x27;</span>,<br>      <span class="hljs-string">&#x27;karma-chrome-launcher&#x27;</span>,<br>      <span class="hljs-string">&#x27;karma-firefox-launcher&#x27;</span><br>      ]<br></code></pre></div></td></tr></table></figure><h4 id="shell很大可能报错（1）"><a href="#shell很大可能报错（1）" class="headerlink" title="shell很大可能报错（1）"></a>shell很大可能报错（1）</h4><p><img src="/img/karma-error1.png" alt="karma start报错"><br>我已经在项目目录下运行了<code>npm install karma-chrome-launcher --save-dev</code> ，检查node_modules中也有了，还是显示上图错误。查阅了各种资源后，得出结论是因为我同时在全局和文件目录中安装了karma，默认启动了全局环境的karma，必须先卸载全局环境的karma，然后才能在文件目录中找到启动浏览器的插件。</p><h4 id="shell很大可能报错（2）"><a href="#shell很大可能报错（2）" class="headerlink" title="shell很大可能报错（2）"></a>shell很大可能报错（2）</h4><p>运行<code>karma start karma.conf.js</code>没有找到文件，原因是根目录下没有找到启动文件。解决方法是在<code>package.json</code>中的script中添加<code>&quot;test&quot;: &quot;node_modules/karma/bin/karma start karma.conf.js&quot;</code>，运行<code>npm run test</code>就可以进行测试了。</p><h4 id="shell很大可能报错（3）"><a href="#shell很大可能报错（3）" class="headerlink" title="shell很大可能报错（3）"></a>shell很大可能报错（3）</h4><p><img src="/img/karma-error2.png" alt="karma start报错"><br>这是因为karma直接打开了浏览器进行测试，目前浏览器对es6语法不是特别支持，特别是import关键字不支持，在文章（1） 中介绍了本项目使用了es6＋webpack构建，webpack完成了babel和解决了依赖问题，但是我们需要测试的是自己写的代码而不是打包后的代码，所以需要寻找新的办法。<br>我第一个项目是用babel，但是出现了上图的问题，原因是babel解决了es6编译的问题，但是处理不了依赖关系，所以需要新的方式进行操作。</p><h4 id="shell很大可能报错（4）"><a href="#shell很大可能报错（4）" class="headerlink" title="shell很大可能报错（4）"></a>shell很大可能报错（4）</h4><p><img src="/img/karma-error3.png" alt="karma start报错"><br> 出现上图错误基本是因为文件目录没有找到，需要在根目录下启动karma命令。</p><p>最后的配置文件karma.conf.js</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-attr">preprocessors</span>: &#123;<br> <span class="hljs-string">&#x27;../../*.js&#x27;</span>: [<span class="hljs-string">&#x27;webpack&#x27;</span>, <span class="hljs-string">&#x27;babel&#x27;</span>]<br>&#125;,<br><span class="hljs-attr">webpack</span>: &#123;<br>&#125;,<br><span class="hljs-attr">webpackMiddleware</span>: &#123;<br>   <span class="hljs-attr">noInfo</span>: <span class="hljs-literal">true</span><br>&#125;,<br><span class="hljs-attr">babelPreprocessor</span>: &#123;<br> <span class="hljs-attr">options</span>: &#123;<br>   <span class="hljs-attr">presets</span>: [<span class="hljs-string">&#x27;es2015&#x27;</span>],<br>   <span class="hljs-attr">sourceMap</span>: <span class="hljs-string">&#x27;inline&#x27;</span><br> &#125;,<br> <span class="hljs-attr">filename</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">file</span>) &#123;<br>   <span class="hljs-keyword">return</span> file.<span class="hljs-property">originalPath</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\.js$/</span>, <span class="hljs-string">&#x27;.es5.js&#x27;</span>);<br> &#125;,<br> <span class="hljs-attr">sourceFileName</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">file</span>) &#123;<br>   <span class="hljs-keyword">return</span> file.<span class="hljs-property">originalPath</span>;<br> &#125;<br>&#125;,<br><span class="hljs-attr">browsers</span>: [<span class="hljs-string">&#x27;Chrome&#x27;</span>, <span class="hljs-string">&#x27;Firefox&#x27;</span>],<br><span class="hljs-attr">plugins</span>: [<br>      <span class="hljs-string">&#x27;karma-jasmine&#x27;</span>,<br>      <span class="hljs-string">&#x27;karma-webpack&#x27;</span>,<br>      <span class="hljs-string">&#x27;karma-chrome-launcher&#x27;</span>,<br>      <span class="hljs-string">&#x27;karma-firefox-launcher&#x27;</span>,<br>      <span class="hljs-string">&#x27;karma-babel-preprocessor&#x27;</span><br>      ]<br></code></pre></div></td></tr></table></figure><p><code>附录</code><br><a href="http://blog.fens.me/nodejs-karma-jasmine/">Karma和Jasmine自动化单元测试</a><br><a href="https://karma-runner.github.io/latest/intro/configuration.html">karma文档</a><br><a href="https://github.com/babel/karma-babel-preprocessor">karma-babel-preprocessor</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>搭一个little-project脚手架（1）webpack+es6</title>
    <link href="/2016/06/22/%E6%90%AD%E4%B8%80%E4%B8%AAlittle-project%E8%84%9A%E6%89%8B%E6%9E%B6%EF%BC%881%EF%BC%89webpack+es6/"/>
    <url>/2016/06/22/%E6%90%AD%E4%B8%80%E4%B8%AAlittle-project%E8%84%9A%E6%89%8B%E6%9E%B6%EF%BC%881%EF%BC%89webpack+es6/</url>
    
    <content type="html"><![CDATA[<blockquote><p>这篇文章用于叙述这个项目的搭建过程和理由，用法比较简单，用es6进行代码书写（eslint代码检查），用babel编译，webpack打包，加入常用css库文件(eg:normalize.css)、js库文件(eg:fetch.js)，可选择BDD。若比较成功，后期将做成npm包使用。</p></blockquote><span id="more"></span><p><code>目录结构设置</code></p><figure class="highlight mipsasm"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mipsasm">- node_modules<br>- client - asserts(<span class="hljs-keyword">just </span>for images <span class="hljs-keyword">or </span>other resource like sounds <span class="hljs-keyword">or </span>movs)<br>         - components <br>            - page1.<span class="hljs-keyword">js(small </span>pros are <span class="hljs-keyword">just </span><span class="hljs-keyword">divided </span>into pages,<span class="hljs-keyword">or </span>exact <span class="hljs-keyword">divided </span>into slider,title)<br>            - page1.<span class="hljs-keyword">scss</span><br><span class="hljs-keyword"></span>         - public <br>            - <span class="hljs-keyword">scss </span><br>            - css<br>              - <span class="hljs-keyword">normalize.css</span><br><span class="hljs-keyword"></span>            - <span class="hljs-keyword">js</span><br><span class="hljs-keyword"></span>              - fetch.<span class="hljs-keyword">js</span><br><span class="hljs-keyword"></span>         - <span class="hljs-keyword">dist(release </span><span class="hljs-keyword">dictionary)</span><br><span class="hljs-keyword"></span>            - index.html<br>- package.<span class="hljs-keyword">json</span><br><span class="hljs-keyword"></span>- webpack.config.<span class="hljs-keyword">js</span><br><span class="hljs-keyword"></span>- .gitignore<br>- .eslintrc<br></code></pre></div></td></tr></table></figure><p><code>webpack</code><br>具体优势可以参考：<a href="http://zhaoda.net/webpack-handbook/what-is-webpack.html">webpack优势</a>，在本项目中主要是作为模块打包工具使用，通过自定义的方式将依赖树拆分成按需加载的块。<br>在项目根目录中使用<code>webpack.config.js</code>设置打包的文件目录，<code>dist</code>是最后需要提交的文件夹，所以将打包好的js文件命名为bundle.js保存到dist目录下，在index.html中引入。<br>index.html</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;bundle.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span> <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">webpack -w //启用监听模式，没有变化的模块编译后返回到内存中<br>webpack-dev-server  //默认启动在localhost:8080的服务<br></code></pre></div></td></tr></table></figure><p><code>fetch.js</code><br>目前引用了fetch.js来实现ajax请求，FetchAPI也可以使用，以后确定浏览器支持性可以完全替换。</p><p><code>附录</code><br><a href="https://github.com/ginny315/es6-proConstructor">本项目git地址</a><br><a href="http://www.cnblogs.com/qianlegeqian/p/4728170.html">配置eslint中文备注</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue1.0+es6+webpack脚手架搭建</title>
    <link href="/2016/05/02/vue1-0-es6-webpack%E8%84%9A%E6%89%8B%E6%9E%B6%E6%90%AD%E5%BB%BA/"/>
    <url>/2016/05/02/vue1-0-es6-webpack%E8%84%9A%E6%89%8B%E6%9E%B6%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<blockquote><p>终于es6学完了，过胖开始写demo，欧耶！学vue的时候恰好发布了2.0版本，着渐进增强的原则，本文先用1.0版本写demo，玩过之后再来一发2.0。<br>本篇属于webpack、vue语法基础篇，只要肯走坑，框架搭起来不是问题。</p></blockquote><span id="more"></span><h4 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h4><blockquote><p>vue语法不是浏览器原生支持的，所以需要做依赖管理和打包<br>loader机制支持载入各种静态资源（把所有非js资源转换成js，url-loader、css&#x2F;style-loader）<br>plugin机制对整个流程进行一定的控制</p></blockquote><p><code>安装</code></p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm install -g webpack<br>//项目文件夹下<br>npm init<br>npm install webpack --save-dev //只需要在生产环境使用<br></code></pre></div></td></tr></table></figure><p><code>配置</code><br>webpack使用起来本质就是做一个配置(webpack.config.js)<br>这里给出了安装相应加载器的配置：<br>加载器需要先安装，然后才能运行webpack指令</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">npm install --save xxx-loader <br></code></pre></div></td></tr></table></figure><p>webpack.config.js文件</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">entry</span>:<span class="hljs-string">&#x27;./main.js&#x27;</span>, <span class="hljs-comment">//入口文件</span><br>  <span class="hljs-attr">output</span>: &#123; <span class="hljs-comment">//输出</span><br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;dist&#x27;</span>,<br>    <span class="hljs-attr">publicPath</span>: <span class="hljs-string">&#x27;&#x27;</span>,<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;bundle.js&#x27;</span><br>  &#125;<br>  <span class="hljs-attr">module</span>: &#123;<br>    <span class="hljs-attr">loaders</span>: [&#123;<br>      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.vue$/</span>,<br>      <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;vue&#x27;</span>,<br>      <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/node_modules/</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>, <br>      <span class="hljs-attr">loader</span>:<span class="hljs-string">&quot;style-loader!css-loader&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.(png|jpg|gif)$/</span>, <br>      <span class="hljs-attr">loader</span>:<span class="hljs-string">&quot;url-loader&quot;</span><br>      <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/node_modules/</span>,<br>      <span class="hljs-attr">query</span>: &#123;<br>        <span class="hljs-attr">limit</span>: <span class="hljs-number">1000</span><br>      &#125;<br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js[x]?$/</span>, <br>      <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/node_modules/</span>, <br>      <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;babel-loader&#x27;</span>,<br>      <span class="hljs-attr">query</span>: &#123;<br>        <span class="hljs-attr">presets</span>: [<span class="hljs-string">&#x27;es2015&#x27;</span>],<br>        <span class="hljs-attr">plugins</span>: [<span class="hljs-string">&#x27;transform-runtime&#x27;</span>]<br>      &#125;<br>    &#125;]<br>  &#125;<br>  <span class="hljs-attr">resolve</span>: &#123; <span class="hljs-comment">//搜索默认路径</span><br>    <span class="hljs-attr">alias</span>: &#123;<br>      <span class="hljs-attr">js</span>: path.<span class="hljs-title function_">join</span>(__dirname,<span class="hljs-string">&quot;&quot;</span>),<br>      <span class="hljs-attr">src</span>: path.<span class="hljs-title function_">join</span>(__dirname,<span class="hljs-string">&quot;&quot;</span>)<br>    &#125;,<br>    <span class="hljs-attr">root</span>: [<br>      path.<span class="hljs-title function_">join</span>(__dirname,<span class="hljs-string">&quot;&quot;</span>)<br>    ],<br>    <span class="hljs-attr">modulesDirectories</span>: [<span class="hljs-string">&#x27;node_modules&#x27;</span>]<br>  &#125;,<br>&#125;<br></code></pre></div></td></tr></table></figure><blockquote><p>entry表示输入，output表示输出<br>&#x2F;.css$&#x2F;匹配xx.css文件，&#x2F;.css&#x2F;匹配xx.css以及xx.css.zip文件<br>?aa&#x3D;bb，表示将aa设置为bb<br>webpack优先搜索root目录，再搜索modulesDirectories</p></blockquote><p><code>启动</code></p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">webpack<br></code></pre></div></td></tr></table></figure><p>此时文件被打包到dist目录下，新建index.html默认入口文件，index.html中引入bundle.js文件，此时的dist文件夹就是打包后的目录文件夹。</p><p><code>文件分离按需加载</code><br>require.ensure会产生额外的boundle，按具体情况进行配置。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-built_in">require</span>.<span class="hljs-title function_">ensure</span>([<span class="hljs-string">&quot;jquery&quot;</span>,<span class="hljs-string">&quot;imgScrll&quot;</span>],<span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-built_in">require</span></span>)&#123;<br>  <span class="hljs-keyword">var</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;jquery&quot;</span>);<br>  <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;imgScroll&quot;</span>);<br>  $(<span class="hljs-string">&quot;#container&quot;</span>).<span class="hljs-title function_">scroll</span>(&#123; <br>    <span class="hljs-comment">//do sth</span><br>  &#125;)<br>&#125;)<br></code></pre></div></td></tr></table></figure><p><code>其他命令</code></p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">webpack -p //uglify<br>webpack -w //watch <br></code></pre></div></td></tr></table></figure><h4 id="vue-loader"><a href="#vue-loader" class="headerlink" title="vue-loader"></a>vue-loader</h4><p>vue-loader是vue作者提供的加载器。<br>teplate-name有多种，这里使用webpack相关标准来定制。<br>init时需要按照要求输入文件相关，官方提供了几个模板，支持ESLint以及Mocha（依赖包略多，有点担心升级麻烦）</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm install -g vue-cli<br>vue init &lt;template-name&gt; &lt;project-name&gt;<br></code></pre></div></td></tr></table></figure><h4 id="vue"><a href="#vue" class="headerlink" title="vue"></a>vue</h4><p><code>demo01</code>简单形式</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;demo&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;&#123;&#123;name&#125;&#125;&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&#123;&#123;name&#125;&#125;&quot;</span> <span class="hljs-attr">v-attr</span>=<span class="hljs-string">&quot;src:url&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">var</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">    <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#demo&#x27;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;ginny&#x27;</span>,</span><br><span class="language-javascript">      <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;http://guoningyan.com/test.png&#x27;</span></span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">  &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p><code>思考</code></p><blockquote><p>“如果想绑定的特性是像 img[src] 这样的不能在 html 中随意初始化的 (可能默认会产生预期外的网络请求)，没关系，有 v-attr&#x3D;”src: url” 这样的写法，把被绑定的数据里的 url 同步过来。”（引用自勾三股四的blog）<br>之前写过同样是 MVVM 框架的 angular ，数据绑定写法类似，用的是ng-src&#x3D;””，使用过程中没有发现上面的问题，这点以后研究一下再补上。</p></blockquote><p><code>demo02</code>xx.vue格式<br>这种格式将模板（jade etc..）、样式（css、sass etc..）、脚本（es6 etc..）集合成一整个文件，每个文件是一个组件，预编译文件使用lang说明文件格式。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">other-component</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">other-component</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css"><span class="hljs-selector-tag">html</span>&#123;</span><br><span class="language-css">  <span class="hljs-attribute">background-color</span>:red;</span><br><span class="language-css">&#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">OtherComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/other-component.vue&#x27;</span></span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">let</span> testDemo = &#123;</span><br><span class="language-javascript">  <span class="hljs-attr">components</span>: &#123; <span class="hljs-title class_">OtherComponent</span> &#125;,</span><br><span class="language-javascript">  <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">    <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">      <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;test&#x27;</span></span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> testDemo;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>使用vue-loader进行预编译打包</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm run dev<br></code></pre></div></td></tr></table></figure><p><code>目录结构</code><br>以下的写法皆是使用webpack模板后的目录结构</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">- build<br>- node_moudles<br>- src<br>- assets<br>- components (每个组件对应.vue文件 )<br>- App.vue (主vue)<br>- main.js<br>- static<br>- test<br>- .babelrc //babel配置<br>- eslintrc //eslint配置，建议使用airborb<br>- config.js //生产建构路径<br>- gulpfile.js //gulp监听<br>- index.html //启动后的首页<br>- package.json <br></code></pre></div></td></tr></table></figure><p>先将组件写在components中，每个.vue文件对应一个组件，然后通过打包工具集成。gulpfile文件配件见附录勾三股四的博客。</p><p><code>附录</code>参考资料<br><a href="https://github.com/ruanyf/webpack-demos#demo01-entry-file-source">阮老师的webpack很好上手</a><br><a href="https://github.com/yesvods/Blog/issues/2">git上某个webpack简明教程</a><br><a href="http://jiongks.name/blog/just-vue/">vue+webpack 勾三股四的blog</a><br><a href="https://www.npmjs.com/package/vue-loader">vue-loader</a><br><a href="http://eslint.org/">eslint</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>环境配置</tag>
      
      <tag>javascript</tag>
      
      <tag>vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ES6备忘</title>
    <link href="/2016/05/01/ES6%E5%A4%87%E5%BF%98/"/>
    <url>/2016/05/01/ES6%E5%A4%87%E5%BF%98/</url>
    
    <content type="html"><![CDATA[<p>花了一个礼拜时间学习了ES6，本文记录了一些常用关键语法备忘。这篇内容比较简单，对于Promise及异步操作之类的本文暂且略过，将在后续实践中展开。</p><h4 id="let"><a href="#let" class="headerlink" title="let"></a>let</h4><ul><li>块级作用域（构成块级的大括号不能少）有效，声明后不管全局中有没有，都会形成一个封闭作用域</li><li>不存在变量提升，使用前需要先声明（注意函数声明，在块级作用域中声明的函数只有在此块级中可以使用）</li><li>不允许在相同作用域内，重复声明同一个变量</li></ul><span id="more"></span><h4 id="const"><a href="#const" class="headerlink" title="const"></a>const</h4><ul><li>声明的是常量（声明时必须初始化）</li><li>块级作用域有效</li><li>复合类型时指向数据所在地址（注意将对象设置为const时不能改变其属性的值；将数组设置为const时不能将另一个数组赋值给它，可以在当前数组中对数组元素作操作）</li><li>跨模块常量  <figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">//moduleA.js</span><br><span class="hljs-built_in">exports</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">AA</span> = <span class="hljs-number">123</span>;<br><span class="hljs-built_in">exports</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">BB</span> = <span class="hljs-number">456</span>;<br><br><span class="hljs-comment">//main.js</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> moduleA form <span class="hljs-string">&#x27;./moduleA&#x27;</span>;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(moduleA.<span class="hljs-property">AA</span>);<span class="hljs-comment">//123</span><br><span class="hljs-comment">//another way</span><br><span class="hljs-keyword">import</span> &#123;<span class="hljs-variable constant_">AA</span>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./moduleA&#x27;</span>;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable constant_">AA</span>);<span class="hljs-comment">//123</span><br></code></pre></div></td></tr></table></figure><blockquote><p>ES6中，有6种声明变量的方法;<br>var、function声明的全局变量是全局对象的属性;<br>let、const、class声明的全局变量不属于全局对象的属性</p></blockquote></li></ul><h4 id="Symbol"><a href="#Symbol" class="headerlink" title="Symbol"></a>Symbol</h4><ul><li>新的（Boolean,String,Number,Object,null,undefined之外的第七种）原始数据类型，表示独一无二的值</li><li>不是对象，不能添加属性，不能new，可以加参数，可以显示转为字符串，布尔值，但是不能转为数值   <figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> s = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">&#x27;foo&#x27;</span>);<br>s <span class="hljs-comment">//Symbol(foo)</span><br>s.<span class="hljs-property">toString</span> <span class="hljs-comment">//&quot;Symbol(foo)&quot;</span><br></code></pre></div></td></tr></table></figure></li><li>每一个Symbol值都是不相等的，可以作为标志符，用于对象的属性名（不能用点运算符），能保证不会出现同名的属性   <figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> test = &#123;<br>  [<span class="hljs-title class_">Symbol</span>()]:<span class="hljs-string">&#x27;test&#x27;</span><br>&#125;<br>test[<span class="hljs-title class_">Symbol</span>()] <span class="hljs-comment">//test</span><br></code></pre></div></td></tr></table></figure></li><li>通过Object.getOwnPropertySymbols()获取，返回一个数组</li><li>Symbol.for()为Symbol值登记的名字。使用同一个Symbol值</li></ul><h4 id="解构赋值"><a href="#解构赋值" class="headerlink" title="解构赋值"></a>解构赋值</h4><p>从数组或对象中提取值（解构），然后按照层级对应位置进行赋值。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">//Array</span><br><span class="hljs-keyword">let</span> [a,[b],c = <span class="hljs-number">0</span>,d = <span class="hljs-number">33</span>,e,f,g] = [<span class="hljs-number">1</span>,[<span class="hljs-number">2</span>],<span class="hljs-number">3</span>,<span class="hljs-literal">undefined</span>,<span class="hljs-literal">null</span>];<span class="hljs-comment">//a=1,b=2,c=3,d=33,e=null,g=undefined</span><br><span class="hljs-keyword">let</span> [d,e] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>]);<span class="hljs-comment">//d=4,e=5</span><br><span class="hljs-keyword">let</span> [x = <span class="hljs-number">1</span>,y = <span class="hljs-number">2</span>] = [<span class="hljs-number">2</span>];<span class="hljs-comment">//x=2,y=2</span><br>[x,y] = [y,x];<span class="hljs-comment">//交换变量的值</span><br><br><span class="hljs-comment">//Object</span><br><span class="hljs-keyword">let</span> &#123;a,b&#125; = &#123;<span class="hljs-attr">b</span>:<span class="hljs-number">11</span>,<span class="hljs-attr">a</span>:<span class="hljs-number">22</span>&#125;;<span class="hljs-comment">//a=22,b=11</span><br><span class="hljs-keyword">let</span> &#123;<span class="hljs-attr">y</span>:x&#125; = &#123;<span class="hljs-attr">x</span>:<span class="hljs-number">111</span>&#125;;<span class="hljs-comment">//y=111,x=undefined</span><br>(&#123;x&#125; = &#123;<span class="hljs-attr">x</span>:<span class="hljs-number">1</span>&#125;);<span class="hljs-comment">//()避免js引擎将&#123;&#125;理解为一个代码块，可能导致歧义，尽量不用;</span><br><span class="hljs-keyword">let</span> &#123; log, sin, cos &#125; = <span class="hljs-title class_">Math</span>;<br><br><span class="hljs-comment">//String(转化为类数组对象)</span><br><span class="hljs-keyword">const</span> [a,b] = <span class="hljs-string">&#x27;hi&#x27;</span>;<span class="hljs-comment">//a=&#x27;h&#x27;,b=&#x27;i&#x27;</span><br><span class="hljs-keyword">const</span> &#123;<span class="hljs-attr">length</span>:a&#125; = <span class="hljs-string">&#x27;hi&#x27;</span><span class="hljs-comment">//a=2</span><br><br><span class="hljs-comment">//function</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">[x=<span class="hljs-number">0</span>,y=<span class="hljs-number">9</span>]</span>)&#123;<br>  <span class="hljs-keyword">return</span> x+y;<br>&#125;<br><span class="hljs-title function_">add</span>([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>]);<span class="hljs-comment">//3</span><br><span class="hljs-title function_">add</span>([]);<span class="hljs-comment">//9</span><br></code></pre></div></td></tr></table></figure><blockquote><p>等号右边必须是可遍历的结构;<br>undefined !&#x3D;&#x3D; null，只有&#x3D;&#x3D;&#x3D;undefined的变量为undefined，其余情况均为其值;<br>对象结构的内部机制，先找到同名属性，再复制给对应的变量，对应的变量获得赋值的结果，同名属性（理解为模式，非变量）并没有获得赋值;<br>可以将现有对象的方法赋值到某个变量;<br>若等号右边为Number和Boolean，则先转为对象;</p></blockquote><h4 id="字符串的扩展"><a href="#字符串的扩展" class="headerlink" title="字符串的扩展"></a>字符串的扩展</h4><p>模板字符串（运行效率较慢）</p><blockquote><p>模板字符串表示多行字符串，空格和tab保留<br>静态字符串一律使用单引号或反引号，不使用双引号<br>动态字符串使用反引号。</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;a&#x27;</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`link<span class="hljs-subst">$&#123;A.linkText&#125;</span><span class="hljs-subst">$&#123;A.otherProp&#125;</span>`</span>;<br><span class="hljs-string">`<span class="hljs-subst">$&#123;a&#125;</span> + <span class="hljs-subst">$&#123;b&#125;</span> = <span class="hljs-subst">$&#123;a+b&#125;</span>`</span>;<br></code></pre></div></td></tr></table></figure><h4 id="正则的扩展"><a href="#正则的扩展" class="headerlink" title="正则的扩展"></a>正则的扩展</h4><ul><li>RegExp构造函数参数改变 <figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> reg = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-regexp">/abc/ig</span>,<span class="hljs-string">&#x27;i&#x27;</span>);<span class="hljs-comment">//等同于new RegExp(&#x27;abc&#x27;,&#x27;i&#x27;)</span><br></code></pre></div></td></tr></table></figure></li><li>字符串对象的正则方法（match、replace、search、split）全部调用RegExp的实力方法</li><li>u修饰符代表Unicode模式</li><li>&#x2F;\u{BBB30}&#x2F;u，{}表示Unicode字符</li><li>y修饰符表示全局模式（区别于g修饰符，y只能从剩余的第一个位置开始）</li></ul><h4 id="数值的扩展"><a href="#数值的扩展" class="headerlink" title="数值的扩展"></a>数值的扩展</h4><ul><li>减少全局性方法，使语言逐步模块化<ul><li>Number.isFinite()，是否非正无穷</li><li>Number.isNaN()</li><li>Number.parseInt(),Number.parseFloat()</li></ul></li><li>Number.isInteger()，是否为整数（整数浮点数存储方法相同）</li></ul><h4 id="数组的扩展"><a href="#数组的扩展" class="headerlink" title="数组的扩展"></a>数组的扩展</h4><ul><li>Array.from(arr,item &#x3D;&gt; item*item)将类数组对象（有length属性）和可遍历的对象转为真正的数组，第二个参数用法类似于map</li><li>[…arguments]将一些数据结构转为数组</li><li>Array.of(arg0,arg1)将一组值转换为数组</li><li>空位转为undefined</li></ul><h4 id="函数的扩展"><a href="#函数的扩展" class="headerlink" title="函数的扩展"></a>函数的扩展</h4><ul><li>参数声明变量默认值之后，不能用let,const再次声明</li><li>解构赋值时，传参数据类型相对应</li><li>参数先对应默认值（运行时执行，默认值设置为undefined表明可以省略），然后解构赋值生效</li><li>rest参数将多余参数放入数组中，之后不能有其他参数。</li><li>有iterator接口的类数组对象可以使用扩展运算符，没有此接口使用Array.from转为真正的数组</li><li>箭头函数，this指向定义时的对象（外层代码块this），不可以作为构造函数（本身没有this），不可以使用arguments（用rest），不能作为Generator函数。  <figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> <span class="hljs-title function_">f</span> = param =&gt; returnParam<br><span class="hljs-keyword">var</span> <span class="hljs-title function_">sum</span> = (<span class="hljs-params">num1,num2</span>) =&gt; &#123;<span class="hljs-keyword">return</span> num1+num2;&#125;<br></code></pre></div></td></tr></table></figure></li><li>使用尾递归（严格模式），防止栈溢出</li></ul><h4 id="对象的扩展"><a href="#对象的扩展" class="headerlink" title="对象的扩展"></a>对象的扩展</h4><ul><li>属性、方法简写（Generator函数加＊）</li><li>name作为对象名、方法名（get、set、bound、anonymous、Symbol的描述）</li><li>Object.is()，同值相等（针对＋1-1，NaN）</li><li>Object.assign(target,source1,source2)浅拷贝，只拷贝源对象的自身属性（不拷贝继承属性和不可枚举属性），遇到同名属性替换<br><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">//浅克隆</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">clone</span>(<span class="hljs-params">origin</span>) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(&#123;&#125;,origin);<br>&#125;<br><span class="hljs-comment">//深克隆</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">clone</span>(<span class="hljs-params">origin</span>) &#123;<br><span class="hljs-keyword">let</span> originProto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(origin);<br><span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(originProto),origin);<br>&#125;<br></code></pre></div></td></tr></table></figure></li><li>Object.setPrototypeOf(target,origin)设置原型对象</li></ul><h4 id="Iterator"><a href="#Iterator" class="headerlink" title="Iterator"></a>Iterator</h4><ul><li>为不同的数据结构提供统一的访问机制，有Iterator接口（数组、类数组对象String etc..、Set、Map原生具有）就能完成遍历操作。<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">NewIterator</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>)&#123;&#125;<br>  [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>]() &#123; <br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>; <br>  &#125;<br> &#125;<br> <span class="hljs-comment">//类数组对象调用数组的Iterator方法</span><br> <span class="hljs-title class_">ArrLike</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>[<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>] = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>[<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>];<br></code></pre></div></td></tr></table></figure></li><li>具有Iterator接口的数据结构，通过[…arg]或者Array.from(arrayLike)转为数组</li></ul><h4 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h4><ul><li>Generator函数封装了多个内部的状态</li><li>函数返回一个迭代器对象，可以依次遍历Generator函数内部的每一个状态。也是一个iterator对象生成函数</li><li>只有调用next方法才会执行<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span>* <span class="hljs-title class_">GenDemo</span>() &#123;<br>  <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;firstState&quot;</span>;<br>  <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;secondState&quot;</span>;<br>  <span class="hljs-keyword">yield</span>* <span class="hljs-string">&quot;divideStr&quot;</span>; <span class="hljs-comment">//相当于for(var value of &quot;divideStr&quot;)</span><br>&#125;<br></code></pre></div></td></tr></table></figure></li><li>遇到yield暂停执行后面的操作，返回紧跟语句后表达式的值</li><li>next()继续执行，return()返回给定的值并终结函数执行，若有finally,return推迟到finally代码块执行完再执行</li></ul><h4 id="class"><a href="#class" class="headerlink" title="class"></a>class</h4><ul><li>等同于构造函数，类内部定义的方法不可枚举 <figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> &#123;<br><span class="hljs-title function_">constructor</span>(<span class="hljs-params">x,y</span>) &#123;<br><span class="hljs-variable language_">this</span>.<span class="hljs-property">x</span> = x;<br><span class="hljs-variable language_">this</span>.<span class="hljs-property">y</span> = y;<br>&#125;<br><span class="hljs-title function_">toString</span>(<span class="hljs-params"></span>) &#123;&#125;<br><span class="hljs-title function_">toValue</span>(<span class="hljs-params"></span>) &#123;&#125;<br>[methodName]()&#123;&#125;<br>state = &#123;<span class="hljs-comment">//实例属性</span><br>  <span class="hljs-attr">count</span>:<span class="hljs-number">0</span><br>&#125;<br>&#125;<br></code></pre></div></td></tr></table></figure></li><li>可以立刻执行<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> a = <span class="hljs-keyword">new</span> <span class="hljs-keyword">class</span> &#123;<br><span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>&#125;<br><span class="hljs-title function_">sayName</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);<br>&#125;<br>&#125;(<span class="hljs-string">&#x27;立刻执行参数&#x27;</span>);<br></code></pre></div></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">a.sayName();//立刻执行参数<br></code></pre></div></td></tr></table></figure></li><li>不存在变量提升</li><li>类和模块的内部，默认就是严格模式</li><li>类的继承（先创造父类的实例对象this，然后再通过调用super方法，用子类的构造函数修改this）  <figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Parent</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">x,y,color</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(x,y);<span class="hljs-comment">//父类的构造函数，用来新建父类的this对象，子类继承父类的this对象</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color;<br>  &#125;<br>  <span class="hljs-title function_">toString</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span>+<span class="hljs-string">&#x27;&#x27;</span>+<span class="hljs-variable language_">super</span>.<span class="hljs-title function_">toString</span>();<span class="hljs-comment">//通过super可以引用父类实例的属性和方法，也可以引用父类的静态方法</span><br>  &#125;<br>&#125;<br><span class="hljs-title class_">Child</span>.<span class="hljs-property">_proto</span> === parent;<span class="hljs-comment">//true</span><br><span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">_proto_</span> === <span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;<span class="hljs-comment">//true</span><br><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(<span class="hljs-title class_">Child</span>) === <span class="hljs-title class_">Parent</span>;<span class="hljs-comment">//true</span><br></code></pre></div></td></tr></table></figure></li><li>class内部只有静态方法，没有静态属性（babel已经支持，可用）</li><li>new.target查看构造函数（子类继承父类时返回子类）</li></ul><p>在继承这块ES6与ES5区别</p><blockquote><p>ES6通过引入class，让javascript引擎去实现原来需要我们自己编写的代码<br>ES5中需要通过中间对象继承，ES6中直接通过extents实现<br>ES5通过在原型链上添加方法，代码比较分散。ES6直接将方法写在类中<br>ES5原生构造函数无法继承（子类无法获得构造函数的内部属性），ES6允许继承构造函数定义子类-<br>ES5先创造子类的实例对象this，再将父类的方法添加到this上面，ES6先创建父类的实例对象this（必须先调用super方法），然后再用子类的构造函数修改this</p></blockquote><h4 id="Module"><a href="#Module" class="headerlink" title="Module"></a>Module</h4><ul><li>解决模块化问题，import加载，{}中的变量名必须与被导入模块对外接口的名称相同，import命令具有提升效果。</li><li>exports输出（必须是对外的接口，可以通过该接口取到模块内部实时的值），as重命名输出，可以用不同的名字输出多次。<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123;stat,exists,readFile&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;fs&#x27;</span>;<span class="hljs-comment">//编译时加载</span><br><span class="hljs-keyword">import</span> &#123;originName <span class="hljs-keyword">as</span> newName&#125; form <span class="hljs-string">&#x27;./test&#x27;</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">v1</span>(<span class="hljs-params"></span>)&#123;&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">v2</span>(<span class="hljs-params"></span>)&#123;&#125;<br><span class="hljs-keyword">export</span> &#123;<br>  v1 <span class="hljs-keyword">as</span> mod1,<br>  v2 <span class="hljs-keyword">as</span> mod2,<br>  v2 <span class="hljs-keyword">as</span> mod22<br>&#125;<br></code></pre></div></td></tr></table></figure></li><li>通过指定默认输出，黑盒模块名（一个模块只能有一个默认输出）<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">//A.js</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;&#125;<br><span class="hljs-comment">//main.js</span><br><span class="hljs-keyword">import</span> aaa <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./A.js&#x27;</span><br><span class="hljs-title function_">aaa</span>();<br></code></pre></div></td></tr></table></figure></li><li>模块输出实质是输出值的引用（commonjs输出值的拷贝），运用时访问模块取值，不会缓存。export接口输出对象实例时，任意import都是针对同一个对象实例操作。</li><li>es6 module transpiler（转成CommonJS或者AMD）<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">npm install -g es6-<span class="hljs-variable language_">module</span>-transpiler<br>compile-modules convert file1.<span class="hljs-property">js</span> file2.<span class="hljs-property">js</span><br>compile-modules convert -o newName.<span class="hljs-property">js</span> originName.<span class="hljs-property">js</span><br></code></pre></div></td></tr></table></figure></li></ul><h4 id="ESLint与Airbnb语法规则"><a href="#ESLint与Airbnb语法规则" class="headerlink" title="ESLint与Airbnb语法规则"></a>ESLint与Airbnb语法规则</h4><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm install -g eslint<br>npm install -g eslint-config-airbnb<br></code></pre></div></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json"><span class="hljs-comment">//.eslintrc</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;extends&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;eslint-config-airbnb&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">eslint index.js<br></code></pre></div></td></tr></table></figure><p><code>附录一</code>学习资料<br><a href="http://es6.ruanyifeng.com/#docs">阮老师的ECMAScript入门</a><br><a href="https://github.com/airbnb/javascript">airbnb编码规范</a><br><a href="http://v.youku.com/v_show/id_XMTU0NTk3NjY0MA==.html">ECMAScript6 开发体系实践</a><br><a href="http://www.liaoxuefeng.com/">廖雪峰的官方网站－原型继承、class继承</a><br><a href="https://babeljs.io/">babel</a></p><p><code>附录二</code> 现有选型</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">gulp+webpack+gulp-babel+es6<br>fis3+fis3-paser-babel+es6<br>react+webpack+es6<br>typescript+vscode+es6+ts transform<br></code></pre></div></td></tr></table></figure><p><code>附录三</code>环境配置</p><ul><li><p>npm安装</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm install --save-dev babel-cli<br>npm install --save-dev babel-polyfill<br></code></pre></div></td></tr></table></figure></li><li><p>创建一个.babelrc</p><figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css">&#123;<br>  presets:[<br>    <span class="hljs-string">&quot;es2015&quot;</span>,<br>  ]<br>&#125;<br></code></pre></div></td></tr></table></figure><p>​  ​</p><p>​</p></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>一小段js代码的思考（1）</title>
    <link href="/2016/04/14/%E4%B8%80%E5%B0%8F%E6%AE%B5js%E4%BB%A3%E7%A0%81%E7%9A%84%E6%80%9D%E8%80%83%EF%BC%881%EF%BC%89/"/>
    <url>/2016/04/14/%E4%B8%80%E5%B0%8F%E6%AE%B5js%E4%BB%A3%E7%A0%81%E7%9A%84%E6%80%9D%E8%80%83%EF%BC%881%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<blockquote><p>今天随手写了一段代码，被<a href="http://www.w3ctech.com/user/4434">@流浪大法师</a>吐槽了，于是整理出了关于一个比较友善的写法以及在这段代码中的思考。<br>本篇有一点js trick在里面，也有模块化、函数科里化的一些写法。</p></blockquote><span id="more"></span><p>先看下面的糟糕的<code>第一段代码</code>：</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> test  = (<span class="hljs-keyword">function</span>(<span class="hljs-params">arg0</span>)&#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;inner-arg0=&quot;</span>+arg0);<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">arg0</span>)&#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;return-arg0=&quot;</span>+arg0)<br>  &#125;<br>&#125;)();<br></code></pre></div></td></tr></table></figure><p>这里我犯了一个错误，我习惯性地将函数最外层用括号包起来使其立即执行，这是声明式的用法，在这里运用错误。函数有两种形式，表达式和声明式，函数表达式本身可以立即执行。</p><p><code>第二段代码</code>修改了一下</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"> <span class="hljs-keyword">var</span> test2 = <span class="hljs-keyword">function</span>(<span class="hljs-params">arg0</span>)&#123;<br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;inner-arg0=&quot;</span>+arg0);<br>     <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">arg0</span>)&#123;<br>       <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;return-arg0=&quot;</span>+arg0)<br>    &#125;<br>&#125;();<br></code></pre></div></td></tr></table></figure><p>去掉最外层括号之后本段代码也立即执行了。<br>若要让声明式立即执行，需要加一些小技巧。</p><p><code>最常见的写法</code>：</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<span class="hljs-comment">//这里的代码立即执行</span><br>&#125;)()<br></code></pre></div></td></tr></table></figure><p><code>奇特的写法</code>：<br>赋值，逻辑，甚至是逗号，各种操作符都可以告诉解析器，这个不是函数声明，它是个函数表达式。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">!<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;aaa&quot;</span>)&#125;<span class="hljs-comment">//可以使用+-~void new delete</span><br></code></pre></div></td></tr></table></figure><p>在chrome中的执行结果如下：<br><img src="/img/js1-code1.png" alt="exection code result show one"><br>截图中可以看出，inner部分直接执行了，调用test()的时候return的匿名函数执行了。<br>因为之前写别的语言的缘故，习惯在函数的起始位置就传参，由于本段代码是立即执行的，所以第一次传参并没有起作用，后续的函数调用根本就没有调用到，这种写法真是太糟糕了。</p><p>以下是<code>第三段代码</code></p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> test3 = <span class="hljs-keyword">function</span>(<span class="hljs-params">arg0</span>)&#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;inner-arg0=&quot;</span>+arg0);<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">arg1</span>)&#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;return-arg1=&quot;</span>+arg1)<br>    &#125;<br>&#125;;<br></code></pre></div></td></tr></table></figure><p>在chrome中的执行结果如下：<br><img src="/img/js1-code2.png" alt="exection code result show two"><br>这里放弃了立即执行，采用需要时调用的方式。<br>第一次调用函数表达式，第二次调用返回的匿名函数，根据调用次序的不同，可以满足不同的业务需求。<br>第一次调用时，传参进行初始化，参数在函数作用域中声明，当函数执行完毕之后，被gc掉（属于标记清除）。<br>第二次调用使用的是返回的函数，这里是一个闭包，注意执行的时候要谨慎，不要轻易赋值给全局变量，内存泄漏你们都懂。</p><p><code>第四段代码</code>是高阶函数的写法</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">//code4-1</span><br><span class="hljs-keyword">var</span> funcA = <span class="hljs-keyword">function</span>(<span class="hljs-params">arg0</span>)&#123;<br>  <span class="hljs-comment">//funcA do sth</span><br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params">f,<span class="hljs-variable language_">arguments</span></span>)&#123;<br>  <span class="hljs-comment">//if need funcA</span><br>  f.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>,<span class="hljs-variable language_">arguments</span>);<br>&#125;<br><span class="hljs-title function_">main</span>(funcA,<span class="hljs-number">123</span>);<br><br><span class="hljs-comment">//code4-2</span><br><span class="hljs-keyword">var</span> funcB = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-comment">//funB do sth</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-variable language_">arguments</span>-retB</span>)&#123;<br>    <span class="hljs-comment">//funB return sth</span><br>  &#125;<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">f,<span class="hljs-variable language_">arguments</span></span>)&#123;<br>  <span class="hljs-comment">//main return</span><br>  &#125;<br>&#125;<br><span class="hljs-title function_">main</span>()(funcB,<span class="hljs-number">123</span>);<br></code></pre></div></td></tr></table></figure><p>code4-1是标准的高阶函数调用，在需要的时候将函数作为参数传入，code4-2通过返回匿名函数的方式传参。在这里优势不明显，研究完继续填坑。</p><p>接下来看<code>第五段代码</code></p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">//moduleC</span><br><span class="hljs-title function_">define</span>([],<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-keyword">var</span> <span class="hljs-built_in">exports</span> = &#123;&#125;;<br>  <span class="hljs-built_in">exports</span>.<span class="hljs-property">func</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">arg0</span>)&#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;moduleC-arg0=&quot;</span>+arg0)<br>  &#125;;<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">exports</span>;<br>&#125;);<br><br><span class="hljs-comment">//module-main</span><br><span class="hljs-built_in">require</span>([moduleC],<span class="hljs-keyword">function</span>(<span class="hljs-params">moduleC</span>)&#123;<br>  <span class="hljs-keyword">var</span> <span class="hljs-built_in">exports</span> = &#123;&#125;;<br>  <span class="hljs-built_in">exports</span>.<span class="hljs-property">init</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">arg0</span>)&#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;transToC-arg0=&quot;</span>+arg0)<br>  &#125;;<br>  <span class="hljs-built_in">exports</span>.<span class="hljs-title function_">otherFunc</span>(<span class="hljs-params"></span>)&#123;<br>    moduleC.<span class="hljs-title function_">func</span>(<span class="hljs-string">&#x27;module-main-arg1&#x27;</span>);<br>  &#125;<br>  expots.<span class="hljs-title function_">init</span>(<span class="hljs-number">555</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">exports</span>;<br>&#125;)<br></code></pre></div></td></tr></table></figure><p>这是commonjs的写法，这样写也为了函数解耦，个人觉得将函数绑定到对象的属性属于面向对象编程，和前面的说明式编程思想是不一样的。</p><figure class="highlight node-repl"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs node-repl"><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">批注：［<span class="hljs-number">2016</span>-<span class="hljs-number">4</span>-<span class="hljs-number">17</span>修正］</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">今天吃饭的时候和<span class="hljs-variable constant_">WD</span>大神讨论了这个问题，我这里的理解有误，更正一下。</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">javascript本身没有类的概念，<span class="hljs-keyword">function</span> <span class="hljs-title function_">A</span>(<span class="hljs-params"></span>)&#123;&#125;作为“类”来使用的时候可以在原型链上添加方法，</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">但是只有当其<span class="hljs-keyword">new</span>一个对象实例时，才算是这个<span class="hljs-keyword">function</span>达到了“类”的作用；</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">只是将方法绑定在<span class="hljs-keyword">function</span> A属性上，通过<span class="hljs-keyword">function</span> A调用不能算是面相对象编程。</span><br></code></pre></div></td></tr></table></figure><p>还有<code>第六段代码</code></p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"> <span class="hljs-comment">//moduleA.js</span><br> <span class="hljs-keyword">var</span> <span class="hljs-built_in">exports</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>   <span class="hljs-keyword">return</span> &#123;<br>     <span class="hljs-attr">funcA1</span>:<span class="hljs-keyword">function</span>(<span class="hljs-params">arg0</span>)&#123;<br>       <span class="hljs-comment">//do funcA1</span><br>     &#125;<br>     <span class="hljs-attr">funcA2</span>:<span class="hljs-title function_">functioin</span>(<span class="hljs-params"></span>)&#123;<br>       <span class="hljs-comment">//do funcA2</span><br>     &#125;<br>  &#125;<br>&#125;<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-built_in">exports</span>;<br><br><span class="hljs-comment">//moduleB.js</span><br><span class="hljs-keyword">var</span> A = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./muduleA&quot;</span>)();<span class="hljs-comment">//pay attention</span><br>A.<span class="hljs-title function_">funcA1</span>(<span class="hljs-number">123</span>);<br>A.<span class="hljs-title function_">funcA2</span>();<br></code></pre></div></td></tr></table></figure><p><code>pay attention</code>这种写法在nodejs中非常常见，这样写更符合事件触发机制，适用于将函数的执行作为参数传入，表示事件的传入，而事件发生时传参执行。<br>moduleA返回了函数对象，函数对象的属性的值是匿名函数，在moduleB中require了moduleA的返回函数，当需要使用moduleA的方法时，可以通过对象的键值调用。</p><p><code>思考</code>：<br>本文通过执行调用的顺序，结合以前写代码的习惯，讨论了javascript书写方式，若实践中得到更好的方式本文将持续修改。</p><p><code>附录</code>：<br><a href="https://www.zhihu.com/question/28292740">知乎上关于函数式编程的讨论</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>js神奇的写法</title>
    <link href="/2016/04/12/js%E7%A5%9E%E5%A5%87%E7%9A%84%E5%86%99%E6%B3%95/"/>
    <url>/2016/04/12/js%E7%A5%9E%E5%A5%87%E7%9A%84%E5%86%99%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本篇总结了实践中用到的一些js trick，有些并非作者原创，但是作者都亲身坐过实验，效果奇佳。</p></blockquote><span id="more"></span><h5 id="数组浅复制"><a href="#数组浅复制" class="headerlink" title="数组浅复制"></a>数组浅复制</h5><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">newArr = oldArr.<span class="hljs-title function_">concat</span>([]);<br>newArr = oldArr.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>);<br></code></pre></div></td></tr></table></figure><h5 id="Function直接执行"><a href="#Function直接执行" class="headerlink" title="Function直接执行"></a>Function直接执行</h5><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-string">&#x27;alert(&quot;hello&quot;)&#x27;</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/.+/</span>,<span class="hljs-built_in">eval</span>); <br><span class="hljs-string">&#x27;alert(&quot;hello&quot;)&#x27;</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/.+/</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params">m</span>)&#123;<br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Function</span>(m)(); <br> &#125;);<br></code></pre></div></td></tr></table></figure><p>new Function(arg1,arg2,…argN,’body’)();<br>参数都是字符串类型，字符串里面的内容是js表达式。只有一个参数时，将该字符串里面的内容作为函数体的原生js代码执行，相当于eval;<br>&#x2F;.+&#x2F;匹配的是除回车之外的字符;<br>string.replace(regexp,replacement),replacement可以是function，作用于每个匹配到的字符</p><h5 id="拼接字符串"><a href="#拼接字符串" class="headerlink" title="拼接字符串"></a>拼接字符串</h5><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; <span class="hljs-built_in">eval</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">101</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;alert(++i);&#x27;</span>));<br><span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Function</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">101</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;alert(++i);&#x27;</span>))();<br></code></pre></div></td></tr></table></figure><p>通过new Array(n)我们可以创建n个空元素，n个空元素之间存在n-1个空白，通过arr.join()可以在空白中放一些东西组成我们需要的字符串</p><h5 id="浏览器变成编辑器"><a href="#浏览器变成编辑器" class="headerlink" title="浏览器变成编辑器"></a>浏览器变成编辑器</h5><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">//浏览器地址栏输入</span><br><span class="hljs-attr">data</span>:text/html,<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">contenteditable</span>&gt;</span></span><br></code></pre></div></td></tr></table></figure><h5 id="文档可编辑"><a href="#文档可编辑" class="headerlink" title="文档可编辑"></a>文档可编辑</h5><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">//console输入</span><br><span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">contentEditable</span> = <span class="hljs-string">&#x27;true&#x27;</span><br></code></pre></div></td></tr></table></figure><h5 id="整数的操作"><a href="#整数的操作" class="headerlink" title="整数的操作"></a>整数的操作</h5><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> foo = (<span class="hljs-number">12.4</span> / <span class="hljs-number">4.13</span>) | <span class="hljs-number">0</span><br><span class="hljs-keyword">var</span> foo2 = ~~(<span class="hljs-number">12.4</span> / <span class="hljs-number">4.13</span>)<br></code></pre></div></td></tr></table></figure><h5 id="将值很快转为bool"><a href="#将值很快转为bool" class="headerlink" title="将值很快转为bool"></a>将值很快转为bool</h5><figure class="highlight erlang-repl"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs erlang-repl">!!windoww === true;<br></code></pre></div></td></tr></table></figure><h5 id="函数的返回"><a href="#函数的返回" class="headerlink" title="函数的返回"></a>函数的返回</h5><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">//无返回值，默认为undefined，!undefined ＝ true</span><br>!(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;aaa&quot;</span>)&#125;)() <span class="hljs-comment">//true</span><br>!(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;aaa&quot;</span>)&#125;())<span class="hljs-comment">//true</span><br><span class="hljs-number">1</span> &amp;&amp; <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>&#125;()<span class="hljs-comment">//true</span><br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>微信SDK开发</title>
    <link href="/2016/04/10/%E5%BE%AE%E4%BF%A1SDK%E5%BC%80%E5%8F%91/"/>
    <url>/2016/04/10/%E5%BE%AE%E4%BF%A1SDK%E5%BC%80%E5%8F%91/</url>
    
    <content type="html"><![CDATA[<blockquote><p>这篇是3月做的基于微信公众号开发的总结。<br>有微信SDK的讲解以及我所走过的坑。还有调试实践和比较好的书写方法。</p></blockquote><span id="more"></span><p><code>步骤一</code>：绑定域名<br>通过微信公众平台登录后，可以设置公众号的“js接口安全域名”</p><p><code>步骤二</code>：引入js文件<br>在引用接口的页面引入</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-attr">http</span>:<span class="hljs-comment">//res.wx.qq.com/open/js/jweixin-1.0.0.js</span></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>require方式引入</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-built_in">require</span>.<span class="hljs-title function_">config</span>(&#123;<br>  <span class="hljs-attr">baseUrl</span>: <span class="hljs-string">&#x27;scripts/&#x27;</span>,<br>  <span class="hljs-attr">paths</span>:&#123;<br>    <span class="hljs-string">&#x27;wx&#x27;</span>:<span class="hljs-string">&#x27;http://res.wx.qq.com/open/js/jweixin-1.0.0&#x27;</span><br>  &#125;<br>&#125;)<br></code></pre></div></td></tr></table></figure><p><code>步骤三</code>：通过config接口注入权限验证配置</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">wx.<span class="hljs-title function_">config</span>(&#123;<br>    <span class="hljs-attr">debug</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。</span><br>    <span class="hljs-attr">appId</span>: <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-comment">// 必填，公众号的唯一标识</span><br>    <span class="hljs-attr">timestamp</span>: , <span class="hljs-comment">// 必填，生成签名的时间戳</span><br>    <span class="hljs-attr">nonceStr</span>: <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-comment">// 必填，生成签名的随机串</span><br>    <span class="hljs-attr">signature</span>: <span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-comment">// 必填，签名，见附录1</span><br>    <span class="hljs-attr">jsApiList</span>: [] <span class="hljs-comment">// 必填，需要使用的JS接口列表，所有JS接口列表见附录2</span><br>&#125;);<br></code></pre></div></td></tr></table></figure><p><code>注意</code>发布的时候一定记住把debug模式去掉</p><p> <code>步骤四</code>：通过ready接口处理成功的验证</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">wx.<span class="hljs-title function_">ready</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-comment">//获取“分享到朋友圈”按钮点击状态及自定义分享内容接口</span><br>  wx.<span class="hljs-title function_">onMenuShareTimeline</span>(&#123;<br>    <span class="hljs-attr">title</span>: that.<span class="hljs-property">title</span>, <span class="hljs-comment">// 分享标题</span><br>    <span class="hljs-attr">link</span>: that.<span class="hljs-property">link</span>, <span class="hljs-comment">// 分享链接</span><br>    <span class="hljs-attr">imgUrl</span>: that.<span class="hljs-property">icon</span>, <span class="hljs-comment">// 分享图标</span><br>    <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123; <br>    <span class="hljs-comment">// 用户确认分享后执行的回调函数 </span><br>    <span class="hljs-comment">//alert(&#x27;success&#x27;)</span><br>    &#125;,<br>    <span class="hljs-attr">cancel</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123; <br>    <span class="hljs-comment">// 用户取消分享后执行的回调函数</span><br>    &#125;<br>  &#125;);<br><br>  <span class="hljs-comment">//获取“分享给朋友”按钮点击状态及自定义分享内容接口</span><br>  wx.<span class="hljs-title function_">onMenuShareAppMessage</span>(&#123;<br>    <span class="hljs-attr">title</span>: that.<span class="hljs-property">title</span>, <span class="hljs-comment">// 分享标题</span><br>    <span class="hljs-attr">desc</span>: that.<span class="hljs-property">desc</span>, <span class="hljs-comment">// 分享描述</span><br>    <span class="hljs-attr">link</span>: that.<span class="hljs-property">link</span>, <span class="hljs-comment">// 分享链接</span><br>    <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123; <br>    <span class="hljs-comment">// 用户确认分享后执行的回调函数</span><br>    <span class="hljs-comment">//alert(&#x27;share to friend success&#x27;)</span><br>    &#125;,<br>    <span class="hljs-attr">cancel</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123; <br>    <span class="hljs-comment">// 用户取消分享后执行的回调函数</span><br>    &#125;<br>  &#125;);<br>&#125;);<br><br>wx.<span class="hljs-title function_">error</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>    common.<span class="hljs-title function_">showPrompt</span>(<span class="hljs-string">&#x27;网络提醒&lt;br&gt;网络连接异常，请稍后重试&#x27;</span>);<br>&#125;);<br></code></pre></div></td></tr></table></figure><p>以上为分享给朋友及分享到朋友所适用的SDK，其余功能参见附录链接。</p><p><code>可能遇到的需求</code><br>点击按钮后触发弹框，然后进行页面跳转.<br>对用户来说，阅读弹框中的文字需要时间（即设置弹框出现到消失的定时器），跳转之前需要时间（即设置弹框消失之后执行跳转这一时间间隔的定时器），所以需要设置两个定时器让它们自己排队解决。注意setTimeout的用法，有关eventloop的内容详见《深入浅出nodejs》60页。</p><p><code>一些逻辑实现</code><br>实现原理来说，获取微信授权需要先跳转再回到当前页面，对于用户来说，跳转越少越好，所以采用缓存的方式，将用户的unionId（代表该用户微信帐号的唯一值）缓存到微信浏览器中。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">//设置</span><br><span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;unionId&#x27;</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">unionId</span>);<br><span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>=<span class="hljs-string">&quot;unionId=&quot;</span>+<span class="hljs-built_in">escape</span>(unionId);<br><span class="hljs-comment">//获取</span><br><span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;unionId&#x27;</span>);<br><span class="hljs-title function_">getCookie</span>(<span class="hljs-string">&#x27;unionId&#x27;</span>);<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getCookie</span>(<span class="hljs-params">name</span>)&#123;<br>  <span class="hljs-keyword">var</span> arr,reg=<span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">&quot;(^| )&quot;</span>+name+<span class="hljs-string">&quot;=([^;]*)(;|$)&quot;</span>);<br>  <span class="hljs-keyword">if</span>(arr=<span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>.<span class="hljs-title function_">match</span>(reg))<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">unescape</span>(arr[<span class="hljs-number">2</span>]);<br>  <span class="hljs-keyword">else</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>根据微信官方说法是4月底微信浏览器升级，之前的bug将修复。当设置缓存的时候可能遇到localstorage无法使用的情况，最好是同时设置localstorage和cookie，但是我实际操作中没有遇到此类问题，localstorage基本通用，所以仅做参考。</p><p><code>关于调试</code><br> 附录中有关于微信调试工具的链接，实测并没有特别好用（主要是没找到代理的设置），建议还是charles走代理调试，ios版微信有页面刷新功能，android版没有，建议用iphone调试。</p><p><code>需要注意的书写方式</code><br>后期会有URL地址变动或者实参的改变，地址或参数相关尽量写成可配置的形式，如在代码段的开头将参数设置为对象的属性。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> config = &#123;<br>  <span class="hljs-attr">url</span>:<span class="hljs-string">&#x27;api/app/userinfo&#x27;</span>,<span class="hljs-comment">//获取用户信息</span><br>  <span class="hljs-attr">android</span>:<span class="hljs-string">&#x27;https://www.aaa.com/android&#x27;</span>,<span class="hljs-comment">//android下载地址</span><br>  <span class="hljs-attr">iphone</span>:<span class="hljs-string">&#x27;https://www.aaa.com/iphone&#x27;</span>,<span class="hljs-comment">//iphone下载地址</span><br>  <span class="hljs-attr">imgDefault</span>:<span class="hljs-string">&#x27;http://aaa.com/c.jpg&#x27;</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p><code>附录</code></p><p><a href="http://mp.weixin.qq.com/wiki/home/">微信开发者文档</a><br><a href="%E5%BE%AE%E4%BF%A1JS-SDK%E8%AF%B4%E6%98%8E%E6%96%87%E6%A1%A3">微信JSSDK说明文档</a><br><a href="http://mp.weixin.qq.com/wiki/10/e5f772f4521da17fa0d7304f68b97d7e.html">微信web开发者工具</a><br><a href="http://www.charlesproxy.com/">charles下载地址</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
      <tag>微信SDK</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>angular笔记（1）</title>
    <link href="/2016/04/01/angular%E7%AC%94%E8%AE%B0%EF%BC%881%EF%BC%89/"/>
    <url>/2016/04/01/angular%E7%AC%94%E8%AE%B0%EF%BC%881%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<blockquote><p>这两周我参与了一个angular项目的迭代，说一下我的使用心得。<br>架构是大师姐搭建的，比较符合范式要求，讲一下我作为一个angular初学者、公司内部平台维护者的一些学习以及实践经验。</p></blockquote> <span id="more"></span><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">-app<br><br>-css //预处理器编译后的css文件<br><br>-data //模拟数据<br><br>-js<br><br>-app.js(项目主入口)<br><br>-common.js(路由、过滤)<br><br>-main.js(依赖关系，js入口文件)<br><br>-routes.js(状态切换)<br><br>-less<br><br>-lib(reset之类)<br><br>-index.less<br><br>-lib(js库文件包，在main.js中引入)<br><br>-modules<br><br>-子模块中html、js文件写在一起<br><br>-host.js(开发测试生产环境对应路由，当有新的URL时，需要对应三个环境)<br><br>-index.html(默认首页)<br></code></pre></div></td></tr></table></figure><p><code>下拉列表选项</code></p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;必填，用于表单校验&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">ng-model</span>=<span class="hljs-string">&quot;&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">ng-options</span>=<span class="hljs-string">&quot;item.id as item.name for item in List&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">ng-init</span>=<span class="hljs-string">&quot;设置初始值，慎用，尽量在js中设置&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">ng-change</span>=<span class="hljs-string">&quot;func()&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">ng-disabled</span>=<span class="hljs-string">&quot;满足条件时不可用&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">required</span>&gt;</span>        <br></code></pre></div></td></tr></table></figure><p><code>注意</code></p><p>ng-options :key as value，这样在<code>&lt;option value=&quot;value&quot;&gt;</code>中保存的是value，显示的是key .         </p><p>ng-change挂载在$scope.func ＝ function()上      </p><p><code>输入框选项</code></p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;inputName&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">ng-model</span>=<span class="hljs-string">&quot;&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">ng-pattern</span>=<span class="hljs-string">&quot;/此处需要正则表达式，用于检验表单的填写/&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ng-show</span>=<span class="hljs-string">&quot;formName.inputName.$dirty &amp;&amp; formName.inputName.$invalid&quot;</span>&gt;</span><br>  当表单检验不通过时显示提示语，dirty表示表单获得焦点，即表单初始化时提示语不现实，invalid表示满足表单非法状态下显示提示语<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p><code>表格</code></p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">ng-table</span>=<span class="hljs-string">&quot;tableParams&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">ng-repeat</span>=<span class="hljs-string">&quot;item in $data&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;&quot;</span>  <span class="hljs-attr">data-header</span>=<span class="hljs-string">&quot;&#x27;checkBoxHeader.html&#x27;&quot;</span> &gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">ng-model</span>=<span class="hljs-string">&quot;checkBoxes.items[item.id]&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">data-title</span>=<span class="hljs-string">&quot;&#x27;任务一级分类&#x27;&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;text-center&quot;</span> <span class="hljs-attr">bo-bind</span>=<span class="hljs-string">&quot;item.firstCategoryName  | demoLimit:15&quot;</span> <span class="hljs-attr">uib-tooltip</span>=<span class="hljs-string">&quot;&#123;&#123;item.firstCategoryName&#125;&#125;&quot;</span>&gt;</span>  <br>       <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> <br>     <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span>  <span class="hljs-title function_">checkBox</span>(<span class="hljs-params"></span>)&#123;<br>$scope.<span class="hljs-property">checkBoxes</span> = &#123; <span class="hljs-string">&#x27;checked&#x27;</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">items</span>: &#123;&#125; &#125;;<br>$scope.$watch(<span class="hljs-string">&#x27;checkBoxes.checked&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) &#123;<br> angular.<span class="hljs-title function_">forEach</span>(list, <span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) &#123;<br> <span class="hljs-keyword">if</span> (angular.<span class="hljs-title function_">isDefined</span>(item.<span class="hljs-property">id</span>)) &#123;<br> $scope.<span class="hljs-property">checkBoxes</span>.<span class="hljs-property">items</span>[item.<span class="hljs-property">id</span>] = value;<br> &#125;<br> &#125;);<br>&#125;);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getTableParams</span>(<span class="hljs-params"></span>) &#123;<br>     $scope.<span class="hljs-property">tableParams</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NgTableParams</span>(&#123;<br>           <span class="hljs-attr">count</span>: <span class="hljs-variable constant_">PAGESIZE</span><br>     &#125;, &#123;<br>       <span class="hljs-attr">getData</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">params</span>) &#123;<br>         <span class="hljs-keyword">var</span> pageIndex = params.<span class="hljs-title function_">page</span>();<br>         <span class="hljs-keyword">return</span> httpData.<span class="hljs-title function_">getThemeList</span>(&#123;<br>           <span class="hljs-attr">pageIndex</span>: pageIndex,<br>           <span class="hljs-attr">pageSize</span>: <span class="hljs-variable constant_">PAGESIZE</span>,<br>         &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) &#123;<br>           params.<span class="hljs-title function_">total</span>(response.<span class="hljs-property">totalNum</span>);<br>           $scope.<span class="hljs-property">tableCount</span> = response.<span class="hljs-property">totalNum</span>;<br>           list = response.<span class="hljs-property">list</span>;<br>           <span class="hljs-title function_">checkBox</span>();<br>           <span class="hljs-keyword">return</span> response.<span class="hljs-property">list</span>;<br>         &#125;);<br>       &#125;<br>     &#125;);<br>&#125;<br></code></pre></div></td></tr></table></figure><p><code>字符长度过滤</code></p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">.<span class="hljs-title function_">filter</span>(<span class="hljs-string">&quot;demoLimit&quot;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">string,num</span>)&#123;<br>        <span class="hljs-keyword">if</span>(string &amp;&amp; string.<span class="hljs-property">length</span> &gt; num)&#123;<br>           <span class="hljs-keyword">return</span> string.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>,num) + <span class="hljs-string">&quot;...&quot;</span> ;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>           <span class="hljs-keyword">return</span> string;<br>        &#125;<br>    &#125;<br>&#125;)<br></code></pre></div></td></tr></table></figure><p><code>注意</code></p><p>NgTableParams插件获取表单新数据，存入$data中在页面中使用，bindonce插件表示数据同步一次，bo前缀有自己的html语法，区别ng前缀，在加载图片是bo可能会有问题。</p><p><code>数据实时校验</code></p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>数据one<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;entryFee&quot;</span> <span class="hljs-attr">ng-model</span>=<span class="hljs-string">&quot;Item.dataone&quot;</span>/&gt;</span><br>    &lt;divng-show=&quot;dataoneError==0&quot; &gt;数据1不能超过数据2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>数据two<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;challengeReward&quot;</span> <span class="hljs-attr">ng-model</span>=<span class="hljs-string">&quot;Item.datatwo&quot;</span>/&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;text-danger&quot;</span> <span class="hljs-attr">ng-show</span>=<span class="hljs-string">&quot;dataoneError==0&quot;</span>&gt;</span>数据1不能超过数据2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">$scope.$watch(<span class="hljs-string">&#x27;Item.dataone&#x27;</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">if</span>(+$scope.<span class="hljs-property">dataone</span> &lt; +$scope.<span class="hljs-property">datatwo</span>)<br>        $scope.<span class="hljs-property">dataoneError</span> = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">else</span><br>        $scope.<span class="hljs-property">dataoneError</span> = <span class="hljs-number">1</span>;<br> &#125;)<br><br>$scope.$watch(<span class="hljs-string">&#x27;Item.datatwo&#x27;</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>     <span class="hljs-keyword">if</span>(+$scope.<span class="hljs-property">dataone</span> &lt; +$scope.<span class="hljs-property">datatwo</span>)<br>        $scope.<span class="hljs-property">dataoneError</span> = <span class="hljs-number">0</span>;<br>     <span class="hljs-keyword">else</span><br>        $scope.<span class="hljs-property">dataoneError</span> = <span class="hljs-number">1</span>;<br>&#125;)<br></code></pre></div></td></tr></table></figure><p><code>注意</code></p><p>我写了两个<code>watch</code>来同步监视数据变化，若只有一个<code>watch</code>，则可能导致两个数据之一改变另一数据不能检测到，页面中<code>watch</code>过多可能有性能问题，建议有更好的解决方案。</p><p><code>项目启动</code></p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">//app目录下<br>fone s<br></code></pre></div></td></tr></table></figure><p><code>项目打包</code></p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">//index.html打tag<br>//app目录下<br>fis3 release -d ../dist<br>//root目录下<br>git add/commit/push<br></code></pre></div></td></tr></table></figure><p><code>附录一</code></p><p>当页面中出现除了提交表单以外的按钮时，当在input输入框填写文字时键盘触发回车，会导致距离输入框最近的按钮触发，解决方式如下：添加不可用的按钮，则回车触发不可用按钮，完美解决。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">ng-disabled</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display:none&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">ng-click</span>=<span class="hljs-string">&quot;doChooseAdvice()&quot;</span>&gt;</span>选择<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">ng-disabled</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display:none&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p><code>附录二</code><br>需要掌握的资料<br><a href="http://showcase.ngnice.com/#/home/home">angular&amp;bootstrap插件合集</a><br><a href="http://angular-ui.github.io/bootstrap/#/datepicker">angular&amp;bootstrap插件</a><br><a href="http://chensd.com/2015-06/AngularJS-popular-Plugins-and-Directive.html">angular常用插件与指令收集</a><br><a href="https://github.com/angular-ui">angularui</a><br><a href="http://www.cnblogs.com/yjf512/p/3796229.html">javascript时间戳和日期字符串相互转换</a>  </p><p><code>附录三</code></p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">Error: [$compile:tplrt] Template for directive &#x27;AAA&#x27; must have exactly one root element. <br></code></pre></div></td></tr></table></figure><p>指令error:这个错误表示指令编译成标签的时候出现问题，可能的解决方式：</p><ul><li>外层包裹一个div</li><li>指令内有标签未闭合，检查代码</li></ul><p><code>附录四</code></p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">cannot set property &#x27;visiblecolumncount&#x27; of undefined<br></code></pre></div></td></tr></table></figure><p><img src="/img/ng1-error1.png" alt="angular-error"><br> 当时看到这个问题觉得很奇怪，后来发现是接口没有取到数据的问题，检查接口返回。</p><p><code>友情链接</code><br><a href="http://www.zhouxianbao.cn/">@XB</a>同学改造的<a href="https://www.npmjs.com/package/fone-angular">angular项目目录生成</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
      <tag>angular</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ife task1.9</title>
    <link href="/2016/03/26/ife-task1-9-1/"/>
    <url>/2016/03/26/ife-task1-9-1/</url>
    
    <content type="html"><![CDATA[<p><code>任务目的: </code>     </p><blockquote><p>通过实现一个较为复杂的页面，加深对于HTML，CSS的实战能力。       </p></blockquote><blockquote><p>实践代码的复用、优化    </p></blockquote><span id="more"></span> <p><code>任务链接</code><a href="http://http//ife.baidu.com/task/detail?taskId=9">ife_task1_9</a></p><p><img src="/img/task_1_9_2.jpg" alt="task1-9插图"></p><ul><li><p>双栏布局       </p><p>采用了侧栏固定宽度左浮动的方式，整体偏离左侧固定宽度，这样正文宽度100%正好撑满容器。</p></li></ul><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span>这是侧栏<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;maincontent&quot;</span>&gt;</span><br>     这里是主体<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-class">.container</span>&#123;<br>   <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">260px</span>;<br>&#125;<br><span class="hljs-selector-tag">nav</span>&#123;<br><span class="hljs-attribute">width</span>: <span class="hljs-number">260px</span>;<br><span class="hljs-attribute">height</span>: <span class="hljs-number">1200px</span>;<br><span class="hljs-attribute">background-color</span>: <span class="hljs-number">#2a2e3d</span>;<br><span class="hljs-attribute">display</span>: inline-block;<br><span class="hljs-attribute">margin-left</span>: -<span class="hljs-number">260px</span>;<br><span class="hljs-attribute">float</span>: left;<br>&#125;<br><span class="hljs-selector-class">.maincontent</span>&#123;<br><span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;<br><span class="hljs-attribute">height</span>: <span class="hljs-number">1200px</span>;<br><span class="hljs-attribute">background-color</span>: <span class="hljs-number">#eeeeed</span>;<br><span class="hljs-attribute">display</span>: inline-block;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li><p>csssprite</p><p>figure是html5图片的标签，固定占位后设置其背景图片，通过将小图切到一张大图中，然后设置背景图片的位置，完成图片的展示。</p></li></ul><figure class="highlight less"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs less"><span class="hljs-selector-class">.backUrl</span>(<span class="hljs-variable">@url</span>:<span class="hljs-string">&quot;/images/csssprite_1_9.png&quot;</span>)&#123;<br><span class="hljs-attribute">background</span>: url(<span class="hljs-string">@url</span>) no-repeat;<br>&#125;<br><span class="hljs-selector-tag">figure</span><span class="hljs-selector-pseudo">:first</span><span class="hljs-selector-tag">-child</span>&#123;<br><span class="hljs-attribute">display</span>: inline-block;<br><span class="hljs-attribute">margin</span>:<span class="hljs-number">0</span>;<br><span class="hljs-selector-class">.backUrl</span>();<br><span class="hljs-attribute">background-position</span>: -<span class="hljs-number">87px</span> -<span class="hljs-number">3px</span>;<br><span class="hljs-attribute">width</span>: <span class="hljs-number">20px</span>;<br><span class="hljs-attribute">height</span>: <span class="hljs-number">20px</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>css实现列表的选中下拉状态</li></ul><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav_first&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">figure</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav_post&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">figure</span>&gt;</span><br><span class="hljs-comment">&lt;!-- &lt;span&gt;个人报表&lt;/span&gt; --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;gerenbaobiao&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;fold1&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;fold1&quot;</span>&gt;</span>个人报表<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;foldlist1&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-class">.task_nav_foldlist</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[id^=<span class="hljs-string">&#x27;fold&#x27;</span>]</span>&#123;<br><span class="hljs-attribute">display</span>: none;<br>&#125;<br><span class="hljs-selector-class">.task_nav_foldlist</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[id^=<span class="hljs-string">&#x27;fold&#x27;</span>]</span><span class="hljs-selector-pseudo">:checked</span> ~ <span class="hljs-selector-attr">[id^=<span class="hljs-string">&#x27;foldlist&#x27;</span>]</span>&#123;<br><span class="hljs-attribute">display</span>: none;<br>&#125;<br></code></pre></div></td></tr></table></figure><p><code>总结</code></p><p>这次切图我基本精准到像素级，整个页面风格很像bootstrap。整体布局我首先注意到了双栏布局，但是没考虑滚动的时候侧栏和header是否应该固定这个体验，又因为中间多处使用position相对和绝对定位，所以后期修改比较麻烦，这点在以后页面总体布局的时候应该注意。</p><p>由于小图较多，所以我第一次尝试切雪碧图，是个不错的体验。</p><p><a href="https://github.com/ginny315/ife_spring2016_ginny/tree/master/task1-9">github链接</a><br><a href="http://guoningyan.com/ife/task09/index.html">demo链接</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>不是所有应用都适合ajax处理</title>
    <link href="/2016/01/17/%E4%B8%8D%E6%98%AF%E6%89%80%E6%9C%89%E5%BA%94%E7%94%A8%E9%83%BD%E9%80%82%E5%90%88ajax%E5%A4%84%E7%90%86/"/>
    <url>/2016/01/17/%E4%B8%8D%E6%98%AF%E6%89%80%E6%9C%89%E5%BA%94%E7%94%A8%E9%83%BD%E9%80%82%E5%90%88ajax%E5%A4%84%E7%90%86/</url>
    
    <content type="html"><![CDATA[<blockquote><p>这几日在学校生产实训，写基于<code>struts2</code>的web站点。<code>struct2</code>属于<code>拦截型</code>框架，会将http请求拦截下来，进行自己对应的过滤处理（包括上传等一些基本请求），若框架本身不能处理的，则回调所写的action处理，因为请求中涉及http协议相关，若对协议不是很明了，可能会处理起来较为麻烦，struts2封装了这些请求，只需要在action中实现相关业务逻辑，同时action给出set和get接口作为数据的请求处理。让使用者只关心核心业务的开发，屏蔽原有技术跟业务无关的技术问题。</p></blockquote><span id="more"></span><p><code>BS基本模型</code><br><img src="/img/cs1.png" alt="BS基本模型">  </p><p>java web中Servlet作用是接受浏览器传给服务端的请求，并将服务端处理完的响应返回给用户的浏览器。   </p><p><code>java web基本处理模型</code>（红色部分为使用ajax的请求处理流向）<br><img src="/img/cs2.png" alt="java web基本处理模型">      </p><p>struts2这是一个非常不错的框架，作为前端，自然是希望后端提供接口（即RESTFulAPI这种），我通过ajax访问接口就可以实现请求。</p><p><code>struts2处理模型</code>（红色部分为使用ajax的请求处理流向)<br><img src="/img/cs3.png" alt="struts2处理模型">          </p><p>但是我在使用过程中发现这种拦截并不适合处理ajax请求，所有的ajax请求都是action处理的，相当于原生java web中servlet处理一样，就失去的框架本身的意义（简化req,res除外）。     </p><p>总结：不能因为学了前端就妄想所有的接口都是RESTFulAPI，有些时候后端渲染会更好，特别是当有了EL标签和JSTL标签之后，不需要用js访问大量DOM节点，这种时候当个小美工就可以啦～</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>上海实习</title>
    <link href="/2015/12/26/%E4%B8%8A%E6%B5%B7%E5%AE%9E%E4%B9%A0/"/>
    <url>/2015/12/26/%E4%B8%8A%E6%B5%B7%E5%AE%9E%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<p>2015年6月到11月，我在1号店实习了5个月，实习的主要任务是练习移动端布局，使用css3属性，促销页面的动画，各种机型的兼容等等。</p><p>印象比较深刻的是新兵训练营，我和另外实习生一起，学习了内部框架FFF的使用，这是一个<code>OO模型</code>的框架，结合了zeptojs，是一个轻量级框架，适合移动端使用，主要是理解面向对象编程的概念，学会将页面拆分成组件，做了demo《疯狂的盒子》，当时XB同学帮了我很多。</p><p>这段学习让我比较深的理解了未来前端编程的发展方向，<code>组件化</code>易于拆分任务，结合时做好拼装就行。同时能可以提高组件的重用性，相同功能的应用可以用已经造好的轮子，避免了重复造轮子的累活儿。所以写代码不能只是能执行就完事儿了，要让代码易于拓展，复用性高。</p><span id="more"></span><p>还有就是命名规范，这在之前写小型项目时基本不考虑这个问题，但是当你的代码要和大家的结合在一起时，很可能就会命名冲突，甚至可能当时看起来没问题，后期出现问题排查时任务量巨大。</p><p>实习时还学到的一点是任务拆分，部门有一面任务墙，大家把要做的事情写在便利贴上，写上任务需要完成的时间，完成后移动位置，直至全部完成。可以看到同事的任务划分的很细，任务执行的每一步都划分成了几个小步，时间会有0.2天这种粒度，深以为这是非常好的完成任务方式，做完每一步都有成就感，同时也不会因为任务大而不知所措。我在这方面比较弱，需要同事的指导才知道怎么划分任务，我也没有养成切任务的习惯，在后期做自己的项目时依然是想到一个功能就添加，前端改不了就自己给后端加接口，这在大项目中是非常不好的，接下去的半年，我都要努力改进。</p><p>实习时做了一个内部创新项目《动效库》，是我和LL同学一起做的，我负责详情页，他负责主页，他选择了使用bootstrap进行布局，并且使用了基于其的一个瀑布流插件，而我是直接切图写逻辑的，后期整合时遇到了不小的麻烦，bootstrap的样式影响了我的原有样式，我不得不继续写样式去覆盖，这点告诉我们前期的技术选型一定要商量好，不然后期会很麻烦。</p><p>后来LL离职了，我完全接手了这个项目，主管提出了中间的一个问题，要我来修复。之前没有看过LL的代码，同时没有使用过这个插件，我花了挺长时间，其中还包括远程音频联系了LL，才理解了代码，修复了这个问题。LL当时的代码有些凌乱，但他确实是个技术不错的人，到现在我们还会常联系讨论技术问题，以后的文章我会继续写。</p><p>后来我又重构了这个项目，进行组件化了，写成了SPA，当然之后又有了新的问题，我之前一直不怎么重视的打开效率问题。下拉采用了懒加载，但是由于加载了大量DOM结构，导致在下拉多次以后页面里有太多的DOM，虽然渲染出来了，点击获取DOM信息再次渲染时会卡很久，这在当时我特意研究了chrome浏览器调试，写了挺多使用感悟，也了解了一些其他瀑布流布局在解决此类问题的方式，由于时间问题，我没有继续深入重构，也是一个小遗憾，有时间肯定会补回来。</p><p>技术篇到此结束了，5个月说长不长，说短也不短，我也学会了很多，有空继续聊。</p><p><a href="http://10.crazyboxginny.sinaapp.com/">动效库</a><br><a href="https://github.com/ginny315/dynamic_new/blob/master/readme.md">关于动效库实现细节及用户体验的思考</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>工作实习</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo搭建Github博客</title>
    <link href="/2015/12/24/Hexo%E6%90%AD%E5%BB%BAGithub%E5%8D%9A%E5%AE%A2/"/>
    <url>/2015/12/24/Hexo%E6%90%AD%E5%BB%BAGithub%E5%8D%9A%E5%AE%A2/</url>
    
    <content type="html"><![CDATA[<p>最近迷上了nodejs,hexo是基于nodejs搭建的博客，自然要玩一下～</p><p>整个安装配置过程大概花了一小时，写下来仅供参考。</p><span id="more"></span><ul><li><p>nodejs环境搭建</p><ul><li><p>官网<a href="http://nodejs.org/download/%EF%BC%8C%E6%A0%B9%E6%8D%AE%E8%87%AA%E5%B7%B1%E7%9A%84%E7%B3%BB%E7%BB%9F%E9%80%89%E6%8B%A9%E5%90%88%E9%80%82%E7%9A%84%E7%89%88%E6%9C%AC%EF%BC%8C%E7%82%B9%E5%87%BB%E5%AE%89%E8%A3%85%E5%90%8E%E7%82%B9next%E6%89%A7%E8%A1%8C%E5%88%B0finish%E3%80%82">http://nodejs.org/download/，根据自己的系统选择合适的版本，点击安装后点next执行到finish。</a></p></li><li><p>windows系统默认安装到C:\Program Files\nodejs\，需要添加环境变量Path里面增加nodejs的安装路径</p></li><li><p>控制台：which node 查找node的安装路径</p></li><li><p>Mac默认安装到&#x2F;usr&#x2F;local&#x2F;bin&#x2F;node</p><ul><li><p>Mac推荐通过brew安装</p><ul><li><p>terminal中执行</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">ruby -e &quot;$(curl -fsSkL https://raw.github.com/Homebrew/homebrew/go/install)&quot;<br></code></pre></div></td></tr></table></figure></li><li><p>若安装过程中提示安装xcode某个工具，按照提示走就行</p></li><li><p>执行brew doctor查看个模块是否正常</p></li></ul></li><li><p>brew install node,自动安装好node和npm</p></li></ul></li><li><p>node -v 查看node安装版本</p></li><li><p>npm -v  查看npm安装版本</p></li><li><p>淘宝镜像安装</p></li></ul><p>​ 低网速下很难通过 npm install fone -g等等来安装npm,解决方法是安装淘宝镜像</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></code></pre></div></td></tr></table></figure><p>从 registry.npm.taobao.org 安装所有模块. 当安装的时候发现安装的模块还没有同步过来, 淘宝 NPM 会自动在后台进行同步, 并且会让你从官方 NPMregistry.npmjs.org 进行安装. 下次你再安装这个模块的时候, 就会直接从 淘宝 NPM 安装了.</p><p>$ cnpm install [name]</p></li><li><p>git环境搭建</p><ul><li><a href="http://git-scm.com/download/">下载地址</a>，点next直到安装完成</li><li>windows下配置系统变量Path,加入安装目录</li><li>Mac下若已经安装了xcode,则不用另外下载</li><li>git —version  查看git版本</li></ul></li><li><p>安装Hexo</p><ul><li>官网<a href="https://hexo.io/">https://hexo.io</a></li><li>npm install -g hexo(已经安装淘宝镜像的用cnpm),Mac装全局需要用sudo</li><li>mkdir blog 新建文件夹blog</li><li>cd blog</li><li>hexo init</li><li>npm install 安装依赖</li><li>hexo server</li></ul></li></ul><p>​               [info] Hexo is running at <a href="http://localhost:4000/">http://localhost:4000/</a>. Press Ctrl+C to stop.</p><p>​               这时候在浏览器中访问上面的网址，就能看到一个默认主题的博客啦</p><ul><li><p>主题选择</p><ul><li>自己选择喜欢的，按照文档配置就可以了,<a href="https://www.zhihu.com/question/24422335">知乎推荐的hexo主题</a></li></ul></li><li><p>部署到git</p><ul><li><p>在项目配置文件_config.yml中</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">Deployment</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># Docs: http://hexo.io/docs/deployment.html</span></span><br>deploy:<br>  type:<br></code></pre></div></td></tr></table></figure></li></ul><p>修改为</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">Deployment</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># Docs: http://hexo.io/docs/deployment.html</span></span><br>deploy:<br>  type: git<br>  repository: git@github.com:yourname/yourname.github.io.git<br>  branch: master<br></code></pre></div></td></tr></table></figure><p>yourname是你的git账号名字，需要在github网站新建一个yourname.github.io的仓库，则默认为git托管的静态资源站点<br>若提示Deployer not found: git，执行npm install hexo-deployer-git –save</p></li><li><p>发布</p><ul><li><p>hexo  new “New Post” 创建新post，在source&#x2F;_posts目录下可以看到新建的markdown文件,或者直接将编辑好的文件放上面的目录下</p></li><li><p>hexo generate将markdown文件生成静态网页</p></li><li><p>hexo deploy发布</p></li><li><p>稍等片刻，访问yourname.github.io就可以看到hexo搭建在github的博客啦～～</p></li></ul><p>​</p><p>​</p></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>环境配置</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nodejs笔记（1）</title>
    <link href="/2015/12/24/nodejs/"/>
    <url>/2015/12/24/nodejs/</url>
    
    <content type="html"><![CDATA[<ul><li>核心模块和node_modules文件夹下各个模块直接require(“name”);其余需要添加require(“.&#x2F;name”);</li><li>path.join(__dirname,,”routes”,”messages”)可以生成有效的斜杠语法路径，根据系统不同分别会生成斜杠或者反斜杠</li><li>最好的调试console.log()，因为不会中断执行过程；暂停执行过程，观察异步代码中调用栈里的相关信息用debugger,  node debug filename</li><li>nodejs最大的好处：不需要编译代码，因为它被加载到内存中，由平台来解释执行</li><li>express提供了类似于MVC的架构（视图、路由、模型）</li><li>TDD测试驱动开发：定义一个单元测试、执行这个单元测试、验证这个测试是否通过</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>nodejs</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
